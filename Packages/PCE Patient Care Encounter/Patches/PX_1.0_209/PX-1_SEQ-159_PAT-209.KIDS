Released PX*1*209 SEQ #159
Extracted from mail message
**KIDS**:PX*1.0*209^

**INSTALL NAME**
PX*1.0*209
"BLD",9185,0)
PX*1.0*209^PCE PATIENT CARE ENCOUNTER^0^3150521^y
"BLD",9185,4,0)
^9.64PA^^
"BLD",9185,6)
1^
"BLD",9185,6.3)
4
"BLD",9185,"ABPKG")
n
"BLD",9185,"KRN",0)
^9.67PA^779.2^20
"BLD",9185,"KRN",.4,0)
.4
"BLD",9185,"KRN",.401,0)
.401
"BLD",9185,"KRN",.402,0)
.402
"BLD",9185,"KRN",.403,0)
.403
"BLD",9185,"KRN",.5,0)
.5
"BLD",9185,"KRN",.84,0)
.84
"BLD",9185,"KRN",3.6,0)
3.6
"BLD",9185,"KRN",3.8,0)
3.8
"BLD",9185,"KRN",9.2,0)
9.2
"BLD",9185,"KRN",9.8,0)
9.8
"BLD",9185,"KRN",9.8,"NM",0)
^9.68A^5^5
"BLD",9185,"KRN",9.8,"NM",1,0)
PXKFCPT1^^0^B23838795
"BLD",9185,"KRN",9.8,"NM",2,0)
PXAIIMM^^0^B9319960
"BLD",9185,"KRN",9.8,"NM",3,0)
PXKFIMM^^0^B4311499
"BLD",9185,"KRN",9.8,"NM",4,0)
PXRPC^^0^B64293018
"BLD",9185,"KRN",9.8,"NM",5,0)
PXAIIMMV^^0^B13493156
"BLD",9185,"KRN",9.8,"NM","B","PXAIIMM",2)

"BLD",9185,"KRN",9.8,"NM","B","PXAIIMMV",5)

"BLD",9185,"KRN",9.8,"NM","B","PXKFCPT1",1)

"BLD",9185,"KRN",9.8,"NM","B","PXKFIMM",3)

"BLD",9185,"KRN",9.8,"NM","B","PXRPC",4)

"BLD",9185,"KRN",19,0)
19
"BLD",9185,"KRN",19.1,0)
19.1
"BLD",9185,"KRN",101,0)
101
"BLD",9185,"KRN",409.61,0)
409.61
"BLD",9185,"KRN",771,0)
771
"BLD",9185,"KRN",779.2,0)
779.2
"BLD",9185,"KRN",870,0)
870
"BLD",9185,"KRN",8989.51,0)
8989.51
"BLD",9185,"KRN",8989.52,0)
8989.52
"BLD",9185,"KRN",8994,0)
8994
"BLD",9185,"KRN",8994,"NM",0)
^9.68A^1^1
"BLD",9185,"KRN",8994,"NM",1,0)
PX SAVE DATA^^0
"BLD",9185,"KRN",8994,"NM","B","PX SAVE DATA",1)

"BLD",9185,"KRN","B",.4,.4)

"BLD",9185,"KRN","B",.401,.401)

"BLD",9185,"KRN","B",.402,.402)

"BLD",9185,"KRN","B",.403,.403)

"BLD",9185,"KRN","B",.5,.5)

"BLD",9185,"KRN","B",.84,.84)

"BLD",9185,"KRN","B",3.6,3.6)

"BLD",9185,"KRN","B",3.8,3.8)

"BLD",9185,"KRN","B",9.2,9.2)

"BLD",9185,"KRN","B",9.8,9.8)

"BLD",9185,"KRN","B",19,19)

"BLD",9185,"KRN","B",19.1,19.1)

"BLD",9185,"KRN","B",101,101)

"BLD",9185,"KRN","B",409.61,409.61)

"BLD",9185,"KRN","B",771,771)

"BLD",9185,"KRN","B",779.2,779.2)

"BLD",9185,"KRN","B",870,870)

"BLD",9185,"KRN","B",8989.51,8989.51)

"BLD",9185,"KRN","B",8989.52,8989.52)

"BLD",9185,"KRN","B",8994,8994)

"BLD",9185,"QUES",0)
^9.62^^
"BLD",9185,"REQB",0)
^9.611^4^4
"BLD",9185,"REQB",1,0)
PX*1.0*200^2
"BLD",9185,"REQB",2,0)
PX*1.0*201^2
"BLD",9185,"REQB",3,0)
PX*1.0*194^2
"BLD",9185,"REQB",4,0)
PX*1.0*199^2
"BLD",9185,"REQB","B","PX*1.0*194",3)

"BLD",9185,"REQB","B","PX*1.0*199",4)

"BLD",9185,"REQB","B","PX*1.0*200",1)

"BLD",9185,"REQB","B","PX*1.0*201",2)

"KRN",8994,3286,-1)
0^1
"KRN",8994,3286,0)
PX SAVE DATA^SAVE^PXRPC^1^P^^^^^^1
"KRN",8994,3286,1,0)
^8994.01^3^3^3150407^^^
"KRN",8994,3286,1,1,0)
The purpose of this RPC is to allow the calling application to save data 
"KRN",8994,3286,1,2,0)
to PCE, such as Immunization data. See the Integration Control 
"KRN",8994,3286,1,3,0)
Registration document for the full description of the data needed.
"KRN",8994,3286,2,0)
^8994.02A^4^4
"KRN",8994,3286,2,1,0)
PCELIST^2^10000^1^1
"KRN",8994,3286,2,1,1,0)
^^48^48^3150407^
"KRN",8994,3286,2,1,1,1,0)
PCELIST (n)= HDR ^ Encounter Inpatient? ^ Note has CPT codes? ^ Visit 
"KRN",8994,3286,2,1,1,2,0)
             string [Encounter location; Encounter date/time; Encounter
"KRN",8994,3286,2,1,1,3,0)
             Service category]  (REQUIRED)
"KRN",8994,3286,2,1,1,4,0)
        (n)=VST^DT^Encounter date/time
"KRN",8994,3286,2,1,1,5,0)
        (n)=VST^PT^Encounter patient (DFN) (n)=VST^HL^Encounter location
"KRN",8994,3286,2,1,1,6,0)
        (n)=VST^VC^ Encounter Service Category
"KRN",8994,3286,2,1,1,7,0)
 
"KRN",8994,3286,2,1,1,8,0)
        If  applicable:
"KRN",8994,3286,2,1,1,9,0)
              
"KRN",8994,3286,2,1,1,10,0)
        (n)=VST^PR^ Parent for secondary visit
"KRN",8994,3286,2,1,1,11,0)
        (n)=VST^OL^ Outside Location for Historical visits
"KRN",8994,3286,2,1,1,12,0)
        (n)=VST^SC^ Service Connected related?
"KRN",8994,3286,2,1,1,13,0)
        (n)=VST^AO^ Agent Orange related?
"KRN",8994,3286,2,1,1,14,0)
        (n)=VST^IR^ Ionizing Radiation related?
"KRN",8994,3286,2,1,1,15,0)
        (n)=VST^EC^ Environmental Contaminates related?
"KRN",8994,3286,2,1,1,16,0)
        (n)=VST^MST^ Military Sexual Trauma related?
"KRN",8994,3286,2,1,1,17,0)
        (n)=VST^HNC^ Head and/or Neck Cancer related?
"KRN",8994,3286,2,1,1,18,0)
        (n)=VST^CV^ Combat Vet related?
"KRN",8994,3286,2,1,1,19,0)
        (n)=VST^SHD^ Shipboard Hazard and Defense related?
"KRN",8994,3286,2,1,1,20,0)
 
"KRN",8994,3286,2,1,1,21,0)
        (n)=PRV^PRV ^ Provider IEN ^^^ Provider Name ^ Primary Provider?
"KRN",8994,3286,2,1,1,22,0)
        (n)=POV(+:  add, -: delete) ^ ICD diagnosis code ^ Category  ^ 
"KRN",8994,3286,2,1,1,23,0)
            Narrative (Diagnosis description) ^ Primary Diagnosis? ^
"KRN",8994,3286,2,1,1,24,0)
            Provider String ^ Add to Problem List? ^^^ Next comment
"KRN",8994,3286,2,1,1,25,0)
            sequence # if saving comments
"KRN",8994,3286,2,1,1,26,0)
        (n)=COM^COM (Comments) ^ Next comment sequence # ^ @ = no 
"KRN",8994,3286,2,1,1,27,0)
            comments added
"KRN",8994,3286,2,1,1,28,0)
        (n)=CPT (+:  add, -: delete) ^ Procedural  CPT code ^ Category ^ 
"KRN",8994,3286,2,1,1,29,0)
            Narrative (Procedure description) ^ Quantity ^ Provider IEN
"KRN",8994,3286,2,1,1,30,0)
            ^^^ [# of modifiers;  Modifier code/Modifier IEN ^ Next
"KRN",8994,3286,2,1,1,31,0)
            comment sequence # ^
"KRN",8994,3286,2,1,1,32,0)
        (n)=IMM (+:  add, -: delete) ^ Immunization IEN ^ Category ^ 
"KRN",8994,3286,2,1,1,33,0)
            Narrative (Immunization description/name) ^ Series ^
"KRN",8994,3286,2,1,1,34,0)
            Encounter Provider ^ Reaction ^ Contraindicated? ^ Refused? ^
"KRN",8994,3286,2,1,1,35,0)
            Next comment sequence # ^ CVX ^ Event Info Source ^ Dosage ^
"KRN",8994,3286,2,1,1,36,0)
            Route ^ Admin Site ^ Lot# ^ Manufacturer ^ Expiration Date
"KRN",8994,3286,2,1,1,37,0)
        (n)=SK (+:  add, -: delete) ^ Skin Test IEN ^ Category ^ 
"KRN",8994,3286,2,1,1,38,0)
            Narrative (Skin Test description/name) ^ Results ^^ Reading
"KRN",8994,3286,2,1,1,39,0)
            ^^^ Next comment sequence #
"KRN",8994,3286,2,1,1,40,0)
        (n)=PED (+:  add, -: delete) ^ Patient Education IEN ^ Category ^ 
"KRN",8994,3286,2,1,1,41,0)
            Narrative (Patient Education description/name) ^ Level of
"KRN",8994,3286,2,1,1,42,0)
            understanding ^^^^^ ^^ Next comment sequence #
"KRN",8994,3286,2,1,1,43,0)
        (n)=HF (+:  add, -: delete) ^ Health Factor IEN ^ Category ^ 
"KRN",8994,3286,2,1,1,44,0)
            Narrative (Health Factor description/name) ^ Level ^^^^^ Next
"KRN",8994,3286,2,1,1,45,0)
            comment sequence # ^ Get Reminder
"KRN",8994,3286,2,1,1,46,0)
        (n)=XAM(+:  add, -: delete) ^ Exam IEN ^ Category ^ Narrative 
"KRN",8994,3286,2,1,1,47,0)
            (Exam description/name) ^ Results ^^^^^ Next comment sequence
"KRN",8994,3286,2,1,1,48,0)
            #
"KRN",8994,3286,2,2,0)
LOC^1^40^0^2
"KRN",8994,3286,2,2,1,0)
^^2^2^3140225^
"KRN",8994,3286,2,2,1,1,0)
This is the hospital location. This is not used when the information is 
"KRN",8994,3286,2,2,1,2,0)
from an outside source.
"KRN",8994,3286,2,3,0)
PKGNAME^1^60^1^3
"KRN",8994,3286,2,3,1,0)
^^2^2^3140225^
"KRN",8994,3286,2,3,1,1,0)
The package name that is sending the data to PCE. This should be the 
"KRN",8994,3286,2,3,1,2,0)
full package name, such as PATIENT CARE ENCOUNTERS. 
"KRN",8994,3286,2,4,0)
SRC^1^60^1^4
"KRN",8994,3286,2,4,1,0)
^8994.021^1^1^3150407^^^
"KRN",8994,3286,2,4,1,1,0)
The source of the data - such as VLER E-HEALTH EXCHANGE.
"KRN",8994,3286,2,"B","LOC",2)

"KRN",8994,3286,2,"B","PCELIST",1)

"KRN",8994,3286,2,"B","PKGNAME",3)

"KRN",8994,3286,2,"B","SRC",4)

"KRN",8994,3286,2,"PARAMSEQ",1,1)

"KRN",8994,3286,2,"PARAMSEQ",2,2)

"KRN",8994,3286,2,"PARAMSEQ",3,3)

"KRN",8994,3286,2,"PARAMSEQ",4,4)

"KRN",8994,3286,3,0)
^8994.03^8^8^3150407^^
"KRN",8994,3286,3,1,0)
The only return will be the one passed back to the calling application.
"KRN",8994,3286,3,2,0)
 
"KRN",8994,3286,3,3,0)
A -2 indicates that the routine PXAI found an issue even though the 
"KRN",8994,3286,3,4,0)
original input values appeared to be correct.
"KRN",8994,3286,3,5,0)
 
"KRN",8994,3286,3,6,0)
A -3 indicates that the input parameters were not properly defined.
"KRN",8994,3286,3,7,0)
 
"KRN",8994,3286,3,8,0)
A 1 indicate success.
"MBREQ")
0
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"PKG",507,-1)
1^1
"PKG",507,0)
PCE PATIENT CARE ENCOUNTER^PX^Patient Care Encounter
"PKG",507,22,0)
^9.49I^1^1
"PKG",507,22,1,0)
1.0^2960812^2960912^10958
"PKG",507,22,1,"PAH",1,0)
209^3150521^11963
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
5
"RTN","PXAIIMM")
0^2^B9319960^B7183500
"RTN","PXAIIMM",1,0)
PXAIIMM ;ISL/PKR - Set the IMMUNIZATION nodes. ;04/06/2015  13:15
"RTN","PXAIIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**45,124,209**;Aug 12, 1996;Build 4
"RTN","PXAIIMM",3,0)
 ;
"RTN","PXAIIMM",4,0)
IMM ;Main entry point.
"RTN","PXAIIMM",5,0)
 ;
"RTN","PXAIIMM",6,0)
 K PXAERR
"RTN","PXAIIMM",7,0)
 S PXAERR(8)=PXAK
"RTN","PXAIIMM",8,0)
 S PXAERR(7)="IMMUNIZATION"
"RTN","PXAIIMM",9,0)
 ;
"RTN","PXAIIMM",10,0)
 N IND,PXAA
"RTN","PXAIIMM",11,0)
 S IND=""
"RTN","PXAIIMM",12,0)
 F  S IND=$O(@PXADATA@("IMMUNIZATION",PXAK,IND)) Q:IND=""  D
"RTN","PXAIIMM",13,0)
 . S PXAA(IND)=@PXADATA@("IMMUNIZATION",PXAK,IND)
"RTN","PXAIIMM",14,0)
 ;
"RTN","PXAIIMM",15,0)
 ;Validate the data.
"RTN","PXAIIMM",16,0)
 N STOP
"RTN","PXAIIMM",17,0)
 D VAL^PXAIIMMV
"RTN","PXAIIMM",18,0)
 I $G(STOP) Q
"RTN","PXAIIMM",19,0)
 ;
"RTN","PXAIIMM",20,0)
SETVARA ;Set the after visit variables.
"RTN","PXAIIMM",21,0)
 N AFTER0,AFTER12,AFTER13,AFTER811,AFTER812
"RTN","PXAIIMM",22,0)
 S $P(AFTER0,U,1)=$G(PXAA("IMMUN"))
"RTN","PXAIIMM",23,0)
 I $G(PXAA("DELETE")) S $P(AFTER0,U,1)="@"
"RTN","PXAIIMM",24,0)
 S $P(AFTER0,U,2)=$G(PATIENT)
"RTN","PXAIIMM",25,0)
 S $P(AFTER0,U,3)=$G(PXAVISIT)
"RTN","PXAIIMM",26,0)
 S $P(AFTER0,U,4)=$G(PXAA("SERIES"))
"RTN","PXAIIMM",27,0)
 S $P(AFTER0,U,6)=$G(PXAA("REACTION"))
"RTN","PXAIIMM",28,0)
 S $P(AFTER0,U,7)=$G(PXAA("CONTRAINDICATED"))
"RTN","PXAIIMM",29,0)
 S $P(AFTER0,U,8)=$G(PXAA("DIAGNOSIS"))
"RTN","PXAIIMM",30,0)
 S $P(AFTER0,U,9)=$G(PXAA("DIAGNOSIS 2"))
"RTN","PXAIIMM",31,0)
 S $P(AFTER0,U,10)=$G(PXAA("DIAGNOSIS 3"))
"RTN","PXAIIMM",32,0)
 S $P(AFTER0,U,11)=$G(PXAA("DIAGNOSIS 4"))
"RTN","PXAIIMM",33,0)
 S $P(AFTER0,U,12)=$G(PXAA("DIAGNOSIS 5"))
"RTN","PXAIIMM",34,0)
 S $P(AFTER0,U,13)=$G(PXAA("DIAGNOSIS 6"))
"RTN","PXAIIMM",35,0)
 S $P(AFTER0,U,14)=$G(PXAA("DIAGNOSIS 7"))
"RTN","PXAIIMM",36,0)
 S $P(AFTER0,U,15)=$G(PXAA("DIAGNOSIS 8"))
"RTN","PXAIIMM",37,0)
 S $P(AFTER12,U,1)=$G(PXAA("EVENT D/T"))
"RTN","PXAIIMM",38,0)
 S $P(AFTER12,U,4)=$G(PXAA("ENC PROVIDER"))
"RTN","PXAIIMM",39,0)
 S $P(AFTER811,U,1)=$G(PXAA("COMMENT"))
"RTN","PXAIIMM",40,0)
 ;
"RTN","PXAIIMM",41,0)
 ;--PACKAGE AND SOURCE
"RTN","PXAIIMM",42,0)
 S $P(AFTER812,"^",2)=$G(PXAPKG)
"RTN","PXAIIMM",43,0)
 S $P(AFTER812,"^",3)=$G(PXASOURC)
"RTN","PXAIIMM",44,0)
 ;
"RTN","PXAIIMM",45,0)
 ;--Add new fields for VIMM 2.0 - PX*1*209
"RTN","PXAIIMM",46,0)
 S $P(AFTER12,U,7)=$G(PXAA("LOT NUM"))
"RTN","PXAIIMM",47,0)
 S $P(AFTER13,U)=$G(PXAA("INFO SOURCE"))
"RTN","PXAIIMM",48,0)
 S $P(AFTER13,U,2)=$G(PXAA("ADMIN ROUTE"))
"RTN","PXAIIMM",49,0)
 S $P(AFTER13,U,3)=$G(PXAA("ANATOMIC LOC"))
"RTN","PXAIIMM",50,0)
 S $P(AFTER13,U,12)=$G(PXAA("DOSAGE"))
"RTN","PXAIIMM",51,0)
 ;
"RTN","PXAIIMM",52,0)
 S ^TMP("PXK",$J,"IMM",PXAK,0,"AFTER")=AFTER0
"RTN","PXAIIMM",53,0)
 S ^TMP("PXK",$J,"IMM",PXAK,12,"AFTER")=AFTER12
"RTN","PXAIIMM",54,0)
 S ^TMP("PXK",$J,"IMM",PXAK,13,"AFTER")=AFTER13
"RTN","PXAIIMM",55,0)
 S ^TMP("PXK",$J,"IMM",PXAK,811,"AFTER")=AFTER811
"RTN","PXAIIMM",56,0)
 S ^TMP("PXK",$J,"IMM",PXAK,812,"AFTER")=AFTER812
"RTN","PXAIIMM",57,0)
 ;
"RTN","PXAIIMM",58,0)
SETVARB ;Set the before variables.
"RTN","PXAIIMM",59,0)
 N BEFOR0,BEFOR12,BEFOR13,BEFOR811,BEFOR812
"RTN","PXAIIMM",60,0)
 N IENB,PXAAX,PXBCNT,PXBKY,PXBSKY,PXBSAM
"RTN","PXAIIMM",61,0)
 D IMM^PXBGIMM(PXAVISIT)
"RTN","PXAIIMM",62,0)
 ;
"RTN","PXAIIMM",63,0)
 S IENB=""
"RTN","PXAIIMM",64,0)
 I PXBCNT>0 D
"RTN","PXAIIMM",65,0)
 . S PXAAX("IMMUN")=$P($G(^AUTTIMM(PXAA("IMMUN"),0)),U,1)
"RTN","PXAIIMM",66,0)
 . S IENB=$O(PXBKY(PXAAX("IMMUN"),IENB))
"RTN","PXAIIMM",67,0)
 I $G(IENB) D
"RTN","PXAIIMM",68,0)
 . S BEFOR0=$G(^AUPNVIMM(IENB,0))
"RTN","PXAIIMM",69,0)
 . S BEFOR12=$G(^AUPNVIMM(IENB,12))
"RTN","PXAIIMM",70,0)
 . S BEFOR13=$G(^AUPNVIMM(IENB,13))
"RTN","PXAIIMM",71,0)
 . S BEFOR811=$G(^AUPNVIMM(IENB,811))
"RTN","PXAIIMM",72,0)
 . S BEFOR812=$G(^AUPNVIMM(IENB,812))
"RTN","PXAIIMM",73,0)
 E  S (BEFOR0,BEFOR11,BEFOR12,BEFOR13,BEFOR811,BEFOR812)=""
"RTN","PXAIIMM",74,0)
 ;
"RTN","PXAIIMM",75,0)
 S ^TMP("PXK",$J,"IMM",PXAK,0,"BEFORE")=BEFOR0
"RTN","PXAIIMM",76,0)
 S ^TMP("PXK",$J,"IMM",PXAK,12,"BEFORE")=BEFOR12
"RTN","PXAIIMM",77,0)
 S ^TMP("PXK",$J,"IMM",PXAK,13,"BEFORE")=BEFOR13
"RTN","PXAIIMM",78,0)
 S ^TMP("PXK",$J,"IMM",PXAK,811,"BEFORE")=BEFOR811
"RTN","PXAIIMM",79,0)
 S ^TMP("PXK",$J,"IMM",PXAK,812,"BEFORE")=BEFOR812
"RTN","PXAIIMM",80,0)
 S ^TMP("PXK",$J,"IMM",PXAK,"IEN")=IENB
"RTN","PXAIIMM",81,0)
 ;
"RTN","PXAIIMM",82,0)
 Q
"RTN","PXAIIMMV")
0^5^B13493156^B4109825
"RTN","PXAIIMMV",1,0)
PXAIIMMV ;ISL/PKR - VALIDATE IMMUNIZATION DATA ;05/20/15  16:21
"RTN","PXAIIMMV",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**199,209**;Aug 12, 1996;Build 4
"RTN","PXAIIMMV",3,0)
 ;
"RTN","PXAIIMMV",4,0)
VAL ;Make sure the required field is present.
"RTN","PXAIIMMV",5,0)
 I '$D(PXAA("IMMUN")) D  Q:$G(STOP)=1
"RTN","PXAIIMMV",6,0)
 . S STOP=1
"RTN","PXAIIMMV",7,0)
 . S PXAERRF=1
"RTN","PXAIIMMV",8,0)
 . S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",9,0)
 . S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",10,0)
 . S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",11,0)
 . S PXAERR(11)=$G(PXAA("IMMUNIZATION"))
"RTN","PXAIIMMV",12,0)
 . S PXAERR(12)="You are missing the name of the immunization"
"RTN","PXAIIMMV",13,0)
 Q:$G(PXAA("DELETE"))=1  ; don't bother checking diagnoses if this is a deletion
"RTN","PXAIIMMV",14,0)
 ; confirm valid diagnosis pointers
"RTN","PXAIIMMV",15,0)
 N DIAGNUM,DIAGSTR,ICDDATA,PXDXDATE
"RTN","PXAIIMMV",16,0)
 S PXDXDATE=$$CSDATE^PXDXUTL(PXAVISIT)
"RTN","PXAIIMMV",17,0)
 F DIAGNUM=1:1:8 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",18,0)
 . S DIAGSTR="DIAGNOSIS"_$S(DIAGNUM>1:" "_DIAGNUM,1:"")
"RTN","PXAIIMMV",19,0)
 . I $G(PXAA(DIAGSTR))]"" D
"RTN","PXAIIMMV",20,0)
 .. S ICDDATA=$$ICDDATA^ICDXCODE("DIAG",$G(PXAA(DIAGSTR)),PXDXDATE,"I")
"RTN","PXAIIMMV",21,0)
 .. I $P(ICDDATA,"^",1)'>0 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",22,0)
 ... S STOP=1
"RTN","PXAIIMMV",23,0)
 ... S PXAERRF=1
"RTN","PXAIIMMV",24,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",25,0)
 ... S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",26,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",27,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAIIMMV",28,0)
 ... S PXAERR(12)="IMMUNIZATION DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT a valid pointer value to the ICD DIAGNOSIS FILE #80"
"RTN","PXAIIMMV",29,0)
 .. I $P(ICDDATA,"^",10)'=1 D  Q:$G(STOP)=1
"RTN","PXAIIMMV",30,0)
 ... S STOP=1
"RTN","PXAIIMMV",31,0)
 ... S PXAERRF=1
"RTN","PXAIIMMV",32,0)
 ... S PXADI("DIALOG")=8390001.001
"RTN","PXAIIMMV",33,0)
 ... S PXAERR(9)="IMMUNIZATION"
"RTN","PXAIIMMV",34,0)
 ... S PXAERR(10)="AFTER"
"RTN","PXAIIMMV",35,0)
 ... S PXAERR(11)=$G(PXAA(DIAGSTR))
"RTN","PXAIIMMV",36,0)
 ... S PXAERR(12)="IMMUNIZATION DIAGNOSIS #"_DIAGNUM_" ("_PXAERR(11)_") is NOT an Active ICD code"
"RTN","PXAIIMMV",37,0)
 ;
"RTN","PXAIIMMV",38,0)
 ; Validate VIMM 2.0 fields
"RTN","PXAIIMMV",39,0)
 N PXFLD,PXFLDNAME,PXFLDNUM,PXVAL,PXFILE,PXOK,PXNEWVAL
"RTN","PXAIIMMV",40,0)
 ;
"RTN","PXAIIMMV",41,0)
 F PXFLD="SERIES^.04","LOT NUM^1207","INFO SOURCE^1301","ADMIN ROUTE^1302","ANATOMIC LOC^1303" D
"RTN","PXAIIMMV",42,0)
 . ;
"RTN","PXAIIMMV",43,0)
 . S PXFLDNAME=$P(PXFLD,"^",1)
"RTN","PXAIIMMV",44,0)
 . S PXFLDNUM=$P(PXFLD,"^",2)
"RTN","PXAIIMMV",45,0)
 . ;
"RTN","PXAIIMMV",46,0)
 . S PXVAL=$G(PXAA(PXFLDNAME))
"RTN","PXAIIMMV",47,0)
 . I PXVAL="" Q
"RTN","PXAIIMMV",48,0)
 . ;
"RTN","PXAIIMMV",49,0)
 . S PXFILE=9000010.11
"RTN","PXAIIMMV",50,0)
 . S PXOK=$$VALFLD(PXFILE,PXFLDNUM,PXVAL)
"RTN","PXAIIMMV",51,0)
 . I PXOK D
"RTN","PXAIIMMV",52,0)
 . . S PXNEWVAL=$P(PXOK,"^",2)
"RTN","PXAIIMMV",53,0)
 . . I PXNEWVAL'="" S PXAA(PXFLDNAME)=PXNEWVAL
"RTN","PXAIIMMV",54,0)
 . I 'PXOK D
"RTN","PXAIIMMV",55,0)
 . . D ERRMSG(8390001.002,0,PXVAL,PXFLDNAME)
"RTN","PXAIIMMV",56,0)
 . . K PXAA(PXFLDNAME) ; Don't file this field, as it's invalid
"RTN","PXAIIMMV",57,0)
 ;
"RTN","PXAIIMMV",58,0)
 Q
"RTN","PXAIIMMV",59,0)
 ;
"RTN","PXAIIMMV",60,0)
VALFLD(PXFILE,PXFLDNUM,PXVAL) ;
"RTN","PXAIIMMV",61,0)
 ;
"RTN","PXAIIMMV",62,0)
 ; Validate field and return:
"RTN","PXAIIMMV",63,0)
 ;
"RTN","PXAIIMMV",64,0)
 ;    1   - Field is valid
"RTN","PXAIIMMV",65,0)
 ;    1^X - Field is valid, but was external value.
"RTN","PXAIIMMV",66,0)
 ;          The function will return the internal
"RTN","PXAIIMMV",67,0)
 ;          value in the 2nd piece (X).
"RTN","PXAIIMMV",68,0)
 ;    0   - Field is invalid
"RTN","PXAIIMMV",69,0)
 ;
"RTN","PXAIIMMV",70,0)
 N PXOK,PXEXT,PXCODES,PXI,PXX,PXCODE,PXCODEVAL,PXTEMP
"RTN","PXAIIMMV",71,0)
 ;
"RTN","PXAIIMMV",72,0)
 S PXOK=1
"RTN","PXAIIMMV",73,0)
 ;
"RTN","PXAIIMMV",74,0)
 I PXVAL="@" Q PXOK
"RTN","PXAIIMMV",75,0)
 ;
"RTN","PXAIIMMV",76,0)
 S PXEXT=$$EXTERNAL^DILFD(PXFILE,PXFLDNUM,,PXVAL,"PXERR")
"RTN","PXAIIMMV",77,0)
 S PXOK=(PXEXT'="")
"RTN","PXAIIMMV",78,0)
 ;
"RTN","PXAIIMMV",79,0)
 ; If value is not valid, and field is set-of-codes,
"RTN","PXAIIMMV",80,0)
 ; check to see if external value was passed in.
"RTN","PXAIIMMV",81,0)
 ; If that was the case, set PXOK to 1,
"RTN","PXAIIMMV",82,0)
 ; and return internal value in 2nd piece of PXOK
"RTN","PXAIIMMV",83,0)
 I 'PXOK,($$GET1^DID(PXFILE,PXFLDNUM,,"TYPE",,"PXERR")="SET") D
"RTN","PXAIIMMV",84,0)
 . S PXCODES=$$GET1^DID(PXFILE,PXFLDNUM,,"POINTER",,"PXERR")
"RTN","PXAIIMMV",85,0)
 . F PXI=1:1:$L(PXCODES,";") D
"RTN","PXAIIMMV",86,0)
 . . S PXX=$P(PXCODES,";",PXI)
"RTN","PXAIIMMV",87,0)
 . . S PXCODE=$P(PXX,":",1)
"RTN","PXAIIMMV",88,0)
 . . S PXCODEVAL=$P(PXX,":",2)
"RTN","PXAIIMMV",89,0)
 . . I PXCODE=""!(PXCODEVAL="") Q
"RTN","PXAIIMMV",90,0)
 . . S PXTEMP(PXCODEVAL)=PXCODE
"RTN","PXAIIMMV",91,0)
 . S PXCODE=$G(PXTEMP(PXVAL))
"RTN","PXAIIMMV",92,0)
 . I PXCODE'="" S PXOK="1^"_PXCODE
"RTN","PXAIIMMV",93,0)
 ;
"RTN","PXAIIMMV",94,0)
 Q PXOK
"RTN","PXAIIMMV",95,0)
 ;
"RTN","PXAIIMMV",96,0)
ERRMSG(PXDLG,PXSTOP,PXVAL,PXFLDNAME) ;
"RTN","PXAIIMMV",97,0)
 ;
"RTN","PXAIIMMV",98,0)
 S STOP=$G(PXSTOP,0)
"RTN","PXAIIMMV",99,0)
 S PXAERRF=1
"RTN","PXAIIMMV",100,0)
 S PXADI("DIALOG")=$G(PXDLG,"8390001.002")
"RTN","PXAIIMMV",101,0)
 I $G(PXAERR(9))'="" D
"RTN","PXAIIMMV",102,0)
 . S PXAERR(9)=PXAERR(9)_", "
"RTN","PXAIIMMV",103,0)
 . S PXAERR(11)=PXAERR(11)_", "
"RTN","PXAIIMMV",104,0)
 . S PXAERR(12)=PXAERR(12)_" "
"RTN","PXAIIMMV",105,0)
 S PXAERR(9)=$G(PXAERR(9))_PXFLDNAME
"RTN","PXAIIMMV",106,0)
 S PXAERR(11)=$G(PXAERR(11))_PXVAL
"RTN","PXAIIMMV",107,0)
 S PXAERR(12)=$G(PXAERR(12))_"'"_PXVAL_"' is not a valid value for field "_PXFLDNAME_"."
"RTN","PXAIIMMV",108,0)
 ;
"RTN","PXAIIMMV",109,0)
 Q
"RTN","PXKFCPT1")
0^1^B23838795^B23493411
"RTN","PXKFCPT1",1,0)
PXKFCPT1 ;ISL/JVS,SCK - PROCEDURES Routine #2 ;04/06/2015  13:15
"RTN","PXKFCPT1",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**11,73,124,194,209**;Aug 12, 1996;Build 4
"RTN","PXKFCPT1",3,0)
 ;
"RTN","PXKFCPT1",4,0)
 ;
"RTN","PXKFCPT1",5,0)
IMM ;
"RTN","PXKFCPT1",6,0)
 N PXKSEQ1
"RTN","PXKFCPT1",7,0)
 I PXKFGAD=1 D IMMADD
"RTN","PXKFCPT1",8,0)
 I PXKFGDE=1 D IMMDEL
"RTN","PXKFCPT1",9,0)
 Q
"RTN","PXKFCPT1",10,0)
IMMADD ;
"RTN","PXKFCPT1",11,0)
 S PXKKK=""
"RTN","PXKFCPT1",12,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",13,0)
 S PXKCPT=$P($P(PXKPXD(PXKX),"^",2),";")
"RTN","PXKFCPT1",14,0)
POVNAR ;
"RTN","PXKFCPT1",15,0)
 N PXK1
"RTN","PXKFCPT1",16,0)
 ;K ^UTILITY("DIQ1",$J) 
"RTN","PXKFCPT1",17,0)
 ;S DIC=81,DA=PXKCPT,DR=2 D EN^DIQ1
"RTN","PXKFCPT1",18,0)
 ;S PXKCPTN=$G(^UTILITY("DIQ1",$J,81,DA,2))
"RTN","PXKFCPT1",19,0)
 ;K ^UTILITY("DIQ1",$J),DIC,DA,DR D
"RTN","PXKFCPT1",20,0)
 S PXK1=$$CPT^ICPTCOD(PXKCPT)
"RTN","PXKFCPT1",21,0)
 S PXKCPTN=$P(PXK1,U,3) D
"RTN","PXKFCPT1",22,0)
 .Q:PXKCPTN=""  I $D(^AUTNPOV("B",PXKCPTN)) S PXKCPTN=$O(^AUTNPOV("B",PXKCPTN,0))
"RTN","PXKFCPT1",23,0)
 ;
"RTN","PXKFCPT1",24,0)
QUANTIT S PXKQUN=1,PXSTOP=0
"RTN","PXKFCPT1",25,0)
 S PXXX=0
"RTN","PXKFCPT1",26,0)
 F  S PXXX=$O(^AUPNVCPT("AD",PXKAV(0,3),PXXX)) Q:PXXX=""  D  Q:$G(PXSTOP)
"RTN","PXKFCPT1",27,0)
 .I +$P(^AUPNVCPT(PXXX,0),"^")=PXKCPT D
"RTN","PXKFCPT1",28,0)
 ..S PXKQUN=($P(^AUPNVCPT(PXXX,0),"^",16)+1)
"RTN","PXKFCPT1",29,0)
 ..S PXSTOP=1
"RTN","PXKFCPT1",30,0)
 ..S PXKKK=PXXX
"RTN","PXKFCPT1",31,0)
 ..S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(PXXX,0))
"RTN","PXKFCPT1",32,0)
 K PXSTOP
"RTN","PXKFCPT1",33,0)
CATEGOR ;
"RTN","PXKFCPT1",34,0)
 N PXKSEQ2,PXK1,PXK2
"RTN","PXKFCPT1",35,0)
 S PXKCPTT(1)=$P(PXKCPT,"^",1)
"RTN","PXKFCPT1",36,0)
 ;K ^UTILITY("DIQ1",$J)
"RTN","PXKFCPT1",37,0)
 ;S DIC=81,DA=PXKCPTT(1),DR=3 D EN^DIQ1
"RTN","PXKFCPT1",38,0)
 S PXK1=$P($$CPT^ICPTCOD(PXKCPTT(1)),U,4)
"RTN","PXKFCPT1",39,0)
 S PXK2=$$GET1^DIQ(81.1,PXK1,.01)
"RTN","PXKFCPT1",40,0)
 Q:PXK2=""
"RTN","PXKFCPT1",41,0)
 ;Q:$G(^UTILITY("DIQ1",$J,81,DA,3))=""
"RTN","PXKFCPT1",42,0)
 ;S PXKCPTT(4.1)=$G(^UTILITY("DIQ1",$J,81,DA,3))
"RTN","PXKFCPT1",43,0)
 S PXKCPTT(4.1)=PXK2
"RTN","PXKFCPT1",44,0)
 S PXKCPTT(5)=$E(PXKCPTT(4.1),1,30)
"RTN","PXKFCPT1",45,0)
 S PXKCPTT(6)=$O(^AUTNPOV("B",PXKCPTT(5),0))
"RTN","PXKFCPT1",46,0)
 S PXKPCA=$S(PXKCPTT(6)="":PXKCPTT(5),PXKCPTT(6)'="":PXKCPTT(6),1:"")
"RTN","PXKFCPT1",47,0)
 K PXKCPTT ;,^UTILITY("DIQ1",$J),DIC,DR,DA
"RTN","PXKFCPT1",48,0)
 ;PX*1*124
"RTN","PXKFCPT1",49,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(PXKCPT)_"^"_$G(PXKAV(0,2))_"^"_$G(PXKAV(0,3))_"^"_$G(PXKCPTN)_"^"_$G(PXKAV(0,8))_"^^^^"
"RTN","PXKFCPT1",50,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")_$G(PXKAV(0,9))_"^"_$G(PXKAV(0,10))_"^"_$G(PXKAV(0,11))_"^"_$G(PXKAV(0,12))_"^"_$G(PXKAV(0,13))_"^"_$G(PXKAV(0,14))_"^"_$G(PXKAV(0,15))_"^"_$G(PXKQUN)
"RTN","PXKFCPT1",51,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",52,0)
 F  S PXKSEQ2=$O(PXKAFT(1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",53,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"AFTER")=PXKAFT(1,PXKSEQ2)
"RTN","PXKFCPT1",54,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(PXKAV(12,1))_"^"_$G(PXKAV(12,2))_"^^"_$G(PXKAV(12,4))
"RTN","PXKFCPT1",55,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(PXKCA)
"RTN","PXKFCPT1",56,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(PXKAFT(812))
"RTN","PXKFCPT1",57,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=PXKKK
"RTN","PXKFCPT1",58,0)
 K PXKQUN,PXKCPTN,PXKCA,PXXX,PXKKK
"RTN","PXKFCPT1",59,0)
 Q
"RTN","PXKFCPT1",60,0)
IMMDEL ;Retrieve all CPT information for VISIT from V CPT file
"RTN","PXKFCPT1",61,0)
 S PXKSEQ1=PXKSEQ+PXKXX
"RTN","PXKFCPT1",62,0)
 S (XPFG,XP)=0 F  Q:XPFG  S XP=$O(^AUPNVCPT("AD",PXKVST,XP)) Q:XP=""  D
"RTN","PXKFCPT1",63,0)
 .I $P(^AUPNVCPT(XP,0),"^",1)=$P($P(PXKPXD(PXKX),"^",2),";") D  S XPFG=1
"RTN","PXKFCPT1",64,0)
 ..I $P($G(^AUPNVCPT(XP,0)),"^",16)=1 D IMMDEL1
"RTN","PXKFCPT1",65,0)
 ..I $D(XP),$P($G(^AUPNVCPT(XP,0)),"^",16)>1 D IMMDEL2
"RTN","PXKFCPT1",66,0)
 Q
"RTN","PXKFCPT1",67,0)
IMMDEL1 ;
"RTN","PXKFCPT1",68,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",69,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",70,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",71,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",72,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",73,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",74,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",75,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",76,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",77,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",78,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")="@"
"RTN","PXKFCPT1",79,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=""
"RTN","PXKFCPT1",80,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=""
"RTN","PXKFCPT1",81,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=""
"RTN","PXKFCPT1",82,0)
 K XPFG,XP
"RTN","PXKFCPT1",83,0)
 Q
"RTN","PXKFCPT1",84,0)
IMMDEL2 ;
"RTN","PXKFCPT1",85,0)
 N PXKSEQ2,PXKMOD
"RTN","PXKFCPT1",86,0)
 S PXTEMP=$P($G(^AUPNVCPT(XP,0)),"^",16)
"RTN","PXKFCPT1",87,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"BEFORE")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",88,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",89,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",90,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",91,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",92,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"BEFORE")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",93,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"BEFORE")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",94,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"BEFORE")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",95,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,"IEN")=XP
"RTN","PXKFCPT1",96,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER")=$G(^AUPNVCPT(XP,0))
"RTN","PXKFCPT1",97,0)
 S PXKSEQ2=0
"RTN","PXKFCPT1",98,0)
 F  S PXKSEQ2=$O(^AUPNVCPT(XP,1,PXKSEQ2)) Q:'PXKSEQ2  D
"RTN","PXKFCPT1",99,0)
 .S PXKMOD=^AUPNVCPT(XP,1,PXKSEQ2,0)
"RTN","PXKFCPT1",100,0)
 .S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,1,PXKSEQ2,"BEFORE")=PXKMOD
"RTN","PXKFCPT1",101,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,12,"AFTER")=$G(^AUPNVCPT(XP,12))
"RTN","PXKFCPT1",102,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,802,"AFTER")=$G(^AUPNVCPT(XP,802))
"RTN","PXKFCPT1",103,0)
 S ^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,812,"AFTER")=$G(^AUPNVCPT(XP,812))
"RTN","PXKFCPT1",104,0)
 S $P(^TMP("PXKSAVE",$J,"CPT",PXKSEQ1,0,"AFTER"),"^",16)=((PXTEMP)-(1))
"RTN","PXKFCPT1",105,0)
 K XPFG,XP,PXTEMP
"RTN","PXKFCPT1",106,0)
 Q
"RTN","PXKFCPT1",107,0)
SK ;--START OF SKIN TEST
"RTN","PXKFCPT1",108,0)
 D IMM
"RTN","PXKFCPT1",109,0)
 Q
"RTN","PXKFIMM")
0^3^B4311499^B2843857
"RTN","PXKFIMM",1,0)
PXKFIMM ;ISL/JVS,SLC/ajb - Fields for V IMMUNIZATIONS file ;05/20/15  12:52
"RTN","PXKFIMM",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**22,124,201,209**;Aug 12, 1996;Build 4
"RTN","PXKFIMM",3,0)
 ;
"RTN","PXKFIMM",4,0)
 ;  Adding or Editing of data in a particular field can be controlled
"RTN","PXKFIMM",5,0)
 ;by adding a ~ as a delimiter and the letters A and/or E to the
"RTN","PXKFIMM",6,0)
 ;end of the line of text which represents what could be added
"RTN","PXKFIMM",7,0)
 ;to the DR string in a DIE call.
"RTN","PXKFIMM",8,0)
 ; 1. If none or all three(~AE) of these characters are added then
"RTN","PXKFIMM",9,0)
 ;    the data in this field can be either added or edited.
"RTN","PXKFIMM",10,0)
 ; 2. If only the ~ is added then the data in this field can be
"RTN","PXKFIMM",11,0)
 ;    neither added or edited.
"RTN","PXKFIMM",12,0)
 ; 3. IF only the ~A is added then the data can only be added to
"RTN","PXKFIMM",13,0)
 ;    the file for this field but not edited.
"RTN","PXKFIMM",14,0)
 ; 4. If only the ~E is added the the data can only be edited in
"RTN","PXKFIMM",15,0)
 ;    this file for this field. (not a likely possibility)
"RTN","PXKFIMM",16,0)
 ;
"RTN","PXKFIMM",17,0)
 ; The word "OPTION" in front of the line of text below tells the 
"RTN","PXKFIMM",18,0)
 ;software to determine,based on the data, the appropriateness
"RTN","PXKFIMM",19,0)
 ;of using either a "///" or "////" stuff in a DIE call.
"RTN","PXKFIMM",20,0)
 ;
"RTN","PXKFIMM",21,0)
 ; The information on line tag 0 $P(,," * ",1) are the piece numbers
"RTN","PXKFIMM",22,0)
 ;of the fields on the zero node that are required by the data
"RTN","PXKFIMM",23,0)
 ;dictionary and are checked for to determine if enough data is present
"RTN","PXKFIMM",24,0)
 ;to proceed without any errors. $P(,," * ",2) are the nodes and
"RTN","PXKFIMM",25,0)
 ;piece numbers of the fields used to determine duplicates in the
"RTN","PXKFIMM",26,0)
 ;file (node+piece (eg. 12+4)). $P(,," * ",3) is a flag use to
"RTN","PXKFIMM",27,0)
 ;determine if duplicates are allowed in this visit file. 
"RTN","PXKFIMM",28,0)
 ;If it is set to 0 then no duplicate checks will occur. If it is
"RTN","PXKFIMM",29,0)
 ;set to 1 then the file will be checked for duplicates based on
"RTN","PXKFIMM",30,0)
 ;the information in $P 2.
"RTN","PXKFIMM",31,0)
 ;
"RTN","PXKFIMM",32,0)
 ; The following is the file's global name.  Each global must have a
"RTN","PXKFIMM",33,0)
 ;unique name and can not have any subscripts as part of the global root.
"RTN","PXKFIMM",34,0)
GLOBAL ;;^AUPNVIMM
"RTN","PXKFIMM",35,0)
 ;
"RTN","PXKFIMM",36,0)
EN1 ;
"RTN","PXKFIMM",37,0)
 S PXKER=""
"RTN","PXKFIMM",38,0)
 S PXKER=$P($T(@PXKNOD+PXKPCE),";;",2)
"RTN","PXKFIMM",39,0)
 Q
"RTN","PXKFIMM",40,0)
EN2 ;
"RTN","PXKFIMM",41,0)
 S PXKFD=""
"RTN","PXKFIMM",42,0)
 S PXKFD=$P($T(@PXKNOD+PXKPCE),";;",2) D
"RTN","PXKFIMM",43,0)
 .I PXKFD="" S PXKPCE=PXKPCE+1 D EN2
"RTN","PXKFIMM",44,0)
 Q
"RTN","PXKFIMM",45,0)
ADD ;Add an entry to the file
"RTN","PXKFIMM",46,0)
 ;Q
"RTN","PXKFIMM",47,0)
0 ;;1,2,3 * 0+1,0+3 * 1
"RTN","PXKFIMM",48,0)
 ;;.01////^S X=$G(
"RTN","PXKFIMM",49,0)
 ;;.02////^S X=$G(
"RTN","PXKFIMM",50,0)
 ;;.03////^S X=$G(
"RTN","PXKFIMM",51,0)
 ;;.04////^S X=$G(
"RTN","PXKFIMM",52,0)
 ;;
"RTN","PXKFIMM",53,0)
 ;;.06///^S X=$G(
"RTN","PXKFIMM",54,0)
 ;;.07///^S X=$G(
"RTN","PXKFIMM",55,0)
 ;;.08////^S X=$G(
"RTN","PXKFIMM",56,0)
 ;;.09////^S X=$G(
"RTN","PXKFIMM",57,0)
 ;;.1////^S X=$G(
"RTN","PXKFIMM",58,0)
 ;;.11////^S X=$G(
"RTN","PXKFIMM",59,0)
 ;;.12////^S X=$G(
"RTN","PXKFIMM",60,0)
 ;;.13////^S X=$G(
"RTN","PXKFIMM",61,0)
 ;;.14////^S X=$G(
"RTN","PXKFIMM",62,0)
 ;;.15////^S X=$G(
"RTN","PXKFIMM",63,0)
11 ;;
"RTN","PXKFIMM",64,0)
 ;;1101///^S X=$G(
"RTN","PXKFIMM",65,0)
12 ;;
"RTN","PXKFIMM",66,0)
 ;;1201///^S X=$G(
"RTN","PXKFIMM",67,0)
 ;;1202////^S X=$G(
"RTN","PXKFIMM",68,0)
 ;;
"RTN","PXKFIMM",69,0)
 ;;1204////^S X=$G(
"RTN","PXKFIMM",70,0)
 ;;1205////^S X=$G(
"RTN","PXKFIMM",71,0)
 ;;
"RTN","PXKFIMM",72,0)
 ;;1207////^S X=$G(
"RTN","PXKFIMM",73,0)
13 ;;
"RTN","PXKFIMM",74,0)
 ;;1301////^S X=$G(
"RTN","PXKFIMM",75,0)
 ;;1302////^S X=$G(
"RTN","PXKFIMM",76,0)
 ;;1303////^S X=$G(
"RTN","PXKFIMM",77,0)
 ;;1304////^S X=$G(
"RTN","PXKFIMM",78,0)
 ;;
"RTN","PXKFIMM",79,0)
 ;;
"RTN","PXKFIMM",80,0)
 ;;
"RTN","PXKFIMM",81,0)
 ;;
"RTN","PXKFIMM",82,0)
 ;;
"RTN","PXKFIMM",83,0)
 ;;
"RTN","PXKFIMM",84,0)
 ;;
"RTN","PXKFIMM",85,0)
 ;;1312////^S X=$G(
"RTN","PXKFIMM",86,0)
14 ;;
"RTN","PXKFIMM",87,0)
 ;;1401////^S X=$G(
"RTN","PXKFIMM",88,0)
 ;;1402///^S X=$G(
"RTN","PXKFIMM",89,0)
 ;;1403///^S X=$G(
"RTN","PXKFIMM",90,0)
 ;;1404////^S X=$G(
"RTN","PXKFIMM",91,0)
 ;;1405///^S X=$G(
"RTN","PXKFIMM",92,0)
 ;;1406///^S X=$G(
"RTN","PXKFIMM",93,0)
15 ;;
"RTN","PXKFIMM",94,0)
 ;;1501///^S X=$G(
"RTN","PXKFIMM",95,0)
801 ;;
"RTN","PXKFIMM",96,0)
 ;;80101///^S X=1;
"RTN","PXKFIMM",97,0)
 ;;80102///^S X=$G(PXKAUDIT);
"RTN","PXKFIMM",98,0)
811 ;;
"RTN","PXKFIMM",99,0)
 ;;81101///^S X=$G(
"RTN","PXKFIMM",100,0)
812 ;;
"RTN","PXKFIMM",101,0)
 ;;81201///^S X=$G(
"RTN","PXKFIMM",102,0)
 ;;81202////^S X=$G(
"RTN","PXKFIMM",103,0)
 ;;81203////^S X=$G(
"RTN","PXKFIMM",104,0)
SPEC ;
"RTN","PXKFIMM",105,0)
 Q
"RTN","PXRPC")
0^4^B64293018^B39810837
"RTN","PXRPC",1,0)
PXRPC ;ISL/JLC - PCE DATA2PCE RPC ; 07 Apr 2015  3:12 PM
"RTN","PXRPC",2,0)
 ;;1.0;PCE PATIENT CARE ENCOUNTER;**200,209**;Aug 12, 1996;Build 4
"RTN","PXRPC",3,0)
 ;
"RTN","PXRPC",4,0)
 ;
"RTN","PXRPC",5,0)
 ;
"RTN","PXRPC",6,0)
SAVE(OK,PCELIST,LOC,PKGNAME,SRC) ; save PCE information
"RTN","PXRPC",7,0)
 N VSTR
"RTN","PXRPC",8,0)
 I '$D(PCELIST(1)) S OK=-3 Q
"RTN","PXRPC",9,0)
 S VSTR=$P(PCELIST(1),U,4) K ^TMP("PXRPC",$J,VSTR)
"RTN","PXRPC",10,0)
 I $G(PKGNAME)="" S OK=-3 Q
"RTN","PXRPC",11,0)
 I $G(SRC)="" S OK=-3 Q
"RTN","PXRPC",12,0)
 M ^TMP("PXRPC",$J,VSTR)=PCELIST
"RTN","PXRPC",13,0)
DQSAVE ; 
"RTN","PXRPC",14,0)
 N PKG,TYP,CODE,IEN,I,X,PXAPI,PXDEL,ERROR
"RTN","PXRPC",15,0)
 N CAT,NARR,ROOT,ROOT2,PXAVST,LEXIEN
"RTN","PXRPC",16,0)
 N PRV,CPT,ICD,IMM,SK,PED,HF,XAM,TRT,MOD,MODCNT,MODIDX,MODS
"RTN","PXRPC",17,0)
 N COM,COMMENT,COMMENTS
"RTN","PXRPC",18,0)
 N DFN,PROBLEMS,PXAPREDT,ORCPTDEL
"RTN","PXRPC",19,0)
 ; Vars for Info Source (IMMIS) Imm. Admin Route (IMMRT), Body Site (IMMAL), Lot, Manufacturer, Exp. Date & Comments
"RTN","PXRPC",20,0)
 N IMMISNM,IMMISIEN,IMMRTNM,IMMRTIEN,IMMRTERR,IMMALNAME,IMMALIEN,IMMALERR,IMMLOT,IMMMANUF,IMMEXPDT,IMMCOMM,IMMCOMMS
"RTN","PXRPC",21,0)
 S PKG=$$PKG2IEN^VSIT(PKGNAME) I PKG=-1 S OK=-3 Q
"RTN","PXRPC",22,0)
 S (PRV,CPT,ICD,IMM,SK,PED,HF,XAM,TRT)=0
"RTN","PXRPC",23,0)
 S I="" F  S I=$O(PCELIST(I)) Q:'I  S X=PCELIST(I) D
"RTN","PXRPC",24,0)
 . S X=PCELIST(I),TYP=$P(X,U),CODE=$P(X,U,2),CAT=$P(X,U,3),NARR=$P(X,U,4)
"RTN","PXRPC",25,0)
 . I $E(TYP,1,3)="PRV" D  Q
"RTN","PXRPC",26,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",27,0)
 . . S PRV=PRV+1
"RTN","PXRPC",28,0)
 . . S ROOT="PXAPI(""PROVIDER"","_PRV_")"
"RTN","PXRPC",29,0)
 . . S ROOT2="PXDEL(""PROVIDER"","_PRV_")"
"RTN","PXRPC",30,0)
 . . I $E(TYP,4)'="-" D
"RTN","PXRPC",31,0)
 . . . S @ROOT@("NAME")=CODE
"RTN","PXRPC",32,0)
 . . . S @ROOT@("PRIMARY")=$P(X,U,6)
"RTN","PXRPC",33,0)
 . . S @ROOT2@("NAME")=CODE
"RTN","PXRPC",34,0)
 . . S @ROOT2@("DELETE")=1
"RTN","PXRPC",35,0)
 . . S PXAPREDT=1 ;Allow edit of primary flag
"RTN","PXRPC",36,0)
 . I TYP="VST" D  Q
"RTN","PXRPC",37,0)
 . . S ROOT="PXAPI(""ENCOUNTER"",1)"
"RTN","PXRPC",38,0)
 . . I CODE="DT" S @ROOT@("ENC D/T")=$P(X,U,3) Q
"RTN","PXRPC",39,0)
 . . I CODE="PT" S @ROOT@("PATIENT")=$P(X,U,3),DFN=$P(X,U,3) Q
"RTN","PXRPC",40,0)
 . . I CODE="HL" S @ROOT@("HOS LOC")=$P(X,U,3) Q
"RTN","PXRPC",41,0)
 . . I CODE="PR" S @ROOT@("PARENT")=$P(X,U,3) Q
"RTN","PXRPC",42,0)
 . . ;prevents checkout!
"RTN","PXRPC",43,0)
 . . I CODE="VC" S @ROOT@("SERVICE CATEGORY")=$P(X,U,3) Q
"RTN","PXRPC",44,0)
 . . I CODE="SC" S @ROOT@("SC")=$P(X,U,3) Q
"RTN","PXRPC",45,0)
 . . I CODE="AO" S @ROOT@("AO")=$P(X,U,3) Q
"RTN","PXRPC",46,0)
 . . I CODE="IR" S @ROOT@("IR")=$P(X,U,3) Q
"RTN","PXRPC",47,0)
 . . I CODE="EC" S @ROOT@("EC")=$P(X,U,3) Q
"RTN","PXRPC",48,0)
 . . I CODE="MST" S @ROOT@("MST")=$P(X,U,3) Q
"RTN","PXRPC",49,0)
 . . I CODE="HNC" S @ROOT@("HNC")=$P(X,U,3) Q
"RTN","PXRPC",50,0)
 . . I CODE="CV" S @ROOT@("CV")=$P(X,U,3) Q
"RTN","PXRPC",51,0)
 . . I CODE="SHD" S @ROOT@("SHAD")=$P(X,U,3) Q
"RTN","PXRPC",52,0)
 . . I CODE="OL" D  Q
"RTN","PXRPC",53,0)
 . . . I +$P(X,U,3) S @ROOT@("INSTITUTION")=$P(X,U,3)
"RTN","PXRPC",54,0)
 . . . E  I $P(X,U,4)'="",$P(X,U,4)'="0" D
"RTN","PXRPC",55,0)
 . . . . I $$PATCH^XPDUTL("PX*1.0*96") S @ROOT@("OUTSIDE LOCATION")=$P(X,U,4)
"RTN","PXRPC",56,0)
 . . . . E  S @ROOT@("COMMENT")="OUTSIDE LOCATION:  "_$P(X,U,4)
"RTN","PXRPC",57,0)
 . I $E(TYP,1,3)="CPT" D  Q
"RTN","PXRPC",58,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",59,0)
 . . S CPT=CPT+1,ROOT="PXAPI(""PROCEDURE"","_CPT_")"
"RTN","PXRPC",60,0)
 . . S IEN=$$CODEN^ICPTCOD(CODE) ;ICR #1995
"RTN","PXRPC",61,0)
 . . S @ROOT@("PROCEDURE")=IEN
"RTN","PXRPC",62,0)
 . . I +$P(X,U,9) D
"RTN","PXRPC",63,0)
 . . . S MODS=$P(X,U,9),MODCNT=+MODS
"RTN","PXRPC",64,0)
 . . . F MODIDX=1:1:MODCNT D
"RTN","PXRPC",65,0)
 . . . . S MOD=$P($P(MODS,";",MODIDX+1),"/")
"RTN","PXRPC",66,0)
 . . . . S @ROOT@("MODIFIERS",MOD)=""
"RTN","PXRPC",67,0)
 . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","PXRPC",68,0)
 . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","PXRPC",69,0)
 . . S:$L($P(X,U,5)) @ROOT@("QTY")=$P(X,U,5)
"RTN","PXRPC",70,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",71,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="PROCEDURE^"_CPT
"RTN","PXRPC",72,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1,@ROOT@("QTY")=0,ORCPTDEL=CPT
"RTN","PXRPC",73,0)
 . I $E(TYP,1,3)="POV" D  Q
"RTN","PXRPC",74,0)
 . . N PXDXI,PXDX
"RTN","PXRPC",75,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",76,0)
 . . F PXDXI=1:1:$L(CODE,"/") D
"RTN","PXRPC",77,0)
 . . . S PXDX=$P(CODE,"/",PXDXI)
"RTN","PXRPC",78,0)
 . . . S ICD=ICD+1,ROOT="PXAPI(""DX/PL"","_ICD_")"
"RTN","PXRPC",79,0)
 . . . S IEN=+$$CODEN^ICDCODE(PXDX,80) ;ICR #3990
"RTN","PXRPC",80,0)
 . . . S @ROOT@("DIAGNOSIS")=IEN
"RTN","PXRPC",81,0)
 . . . S @ROOT@("PRIMARY")=$S(PXDXI=1:$P(X,U,5),1:0)
"RTN","PXRPC",82,0)
 . . . S LEXIEN=$P($$EXP^LEXCODE(CODE,"ICD",DT),U),@ROOT@("LEXICON TERM")=$S(LEXIEN>0:LEXIEN,1:"")
"RTN","PXRPC",83,0)
 . . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","PXRPC",84,0)
 . . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","PXRPC",85,0)
 . . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",86,0)
 . . . I $L($P(X,U,7)),($P(X,U,7)=1),(PXDXI=1) S @ROOT@("PL ADD")=$P(X,U,7),PROBLEMS(ICD)=NARR_U_CODE
"RTN","PXRPC",87,0)
 . . . S:$L($P(X,U,10))>0&(PXDXI=1) COMMENT($P(X,U,10))="DX/PL^"_ICD
"RTN","PXRPC",88,0)
 . . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",89,0)
 . I $E(TYP,1,3)="IMM" D  Q
"RTN","PXRPC",90,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",91,0)
 . . S IMM=IMM+1,ROOT="PXAPI(""IMMUNIZATION"","_IMM_")"
"RTN","PXRPC",92,0)
 . . S @ROOT@("IMMUN")=CODE
"RTN","PXRPC",93,0)
 . . S:$L($P(X,U,5)) @ROOT@("SERIES")=$P(X,U,5)
"RTN","PXRPC",94,0)
 . . S:$L($P(X,U,7)) @ROOT@("REACTION")=$P(X,U,7)
"RTN","PXRPC",95,0)
 . . S:$L($P(X,U,8)) @ROOT@("CONTRAINDICATED")=$P(X,U,8)
"RTN","PXRPC",96,0)
 . . S:$L($P(X,U,9)) @ROOT@("REFUSED")=$P(X,U,9)
"RTN","PXRPC",97,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",98,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="IMMUNIZATION^"_IMM
"RTN","PXRPC",99,0)
 . . ; These are the additional fields being added by PX*1.0*209
"RTN","PXRPC",100,0)
 . . ;S:$L($P(X,U,11)) @ROOT@("CVX")=$P(X,U,11)
"RTN","PXRPC",101,0)
 . . S IMMISNM=$P(X,U,12)
"RTN","PXRPC",102,0)
 . . ; Look up the value in the "H" Cross-reference
"RTN","PXRPC",103,0)
 . . S IMMISIEN=$$FIND1^DIC(920.1,,,IMMISNM,"H",,"IMMISERR")
"RTN","PXRPC",104,0)
 . . S:IMMISIEN @ROOT@("INFO SOURCE")=IMMISIEN
"RTN","PXRPC",105,0)
 . . S:$L($P(X,U,13)) @ROOT@("DOSAGE")=$P(X,U,13)
"RTN","PXRPC",106,0)
 . . S IMMRTNM=$P(X,U,14)
"RTN","PXRPC",107,0)
 . . S IMMRTIEN=$$FIND1^DIC(920.2,,,IMMRTNM,,,"IMMRTERR")
"RTN","PXRPC",108,0)
 . . S:IMMRTIEN @ROOT@("ADMIN ROUTE")=IMMRTIEN
"RTN","PXRPC",109,0)
 . . S IMMALNAME=$P(X,U,15)
"RTN","PXRPC",110,0)
 . . S IMMALIEN=$$FIND1^DIC(920.3,,,IMMALNAME,,,"IMMALERR")
"RTN","PXRPC",111,0)
 . . S:IMMALIEN @ROOT@("ANATOMIC LOC")=IMMALIEN
"RTN","PXRPC",112,0)
 . . ;S:$L($P(X,U,16)) @ROOT@("LOT NUM")=$P(X,U,16)
"RTN","PXRPC",113,0)
 . . S IMMLOT=$P(X,U,16)
"RTN","PXRPC",114,0)
 . . S IMMMANUF=$P(X,U,17)
"RTN","PXRPC",115,0)
 . . S IMMEXPDT=$P(X,U,18)
"RTN","PXRPC",116,0)
 . . ; If the Lot Number, Manufacturer and Expiration Date are all specified,
"RTN","PXRPC",117,0)
 . . ; then find an entry matching all three values in File 9999999.41 (IMMUNIZATION LOT)
"RTN","PXRPC",118,0)
 . . ; If we don't find a match, then add the fields to the Comment.
"RTN","PXRPC",119,0)
 . . ; For now, we will not receive the Expiration Date from Walgreens, so we always update the Comment.
"RTN","PXRPC",120,0)
 . . S IMMCOMM=""
"RTN","PXRPC",121,0)
 . . S:IMMLOT'="" IMMCOMM=IMMCOMM_$S(IMMCOMM="":"",1:" ")_"Lot#: "_IMMLOT
"RTN","PXRPC",122,0)
 . . S:IMMMANUF'="" IMMCOMM=IMMCOMM_$S(IMMCOMM="":"",1:" ")_"Mfr: "_IMMMANUF
"RTN","PXRPC",123,0)
 . . S:IMMEXPDT'="" IMMCOMM=IMMCOMM_$S(IMMCOMM="":"",1:" ")_"Expiration Date: "_IMMEXPDT
"RTN","PXRPC",124,0)
 . . ; If we have something to add to the Imm comment, either add it to the existing comment
"RTN","PXRPC",125,0)
 . . ; (if one exists) or just set it in the COMMENT field.
"RTN","PXRPC",126,0)
 . . I IMMCOMM'="" D
"RTN","PXRPC",127,0)
 . . . I $L($P(X,U,10)) S IMMCOMMS($P(X,U,10))=IMMCOMM ; This will get added later to the existing comment
"RTN","PXRPC",128,0)
 . . . E  S @ROOT@("COMMENT")=IMMCOMM
"RTN","PXRPC",129,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",130,0)
 . I $E(TYP,1,2)="SK" D  Q
"RTN","PXRPC",131,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",132,0)
 . . S SK=SK+1,ROOT="PXAPI(""SKIN TEST"","_SK_")"
"RTN","PXRPC",133,0)
 . . S @ROOT@("TEST")=CODE
"RTN","PXRPC",134,0)
 . . S:$L($P(X,U,5)) @ROOT@("RESULT")=$P(X,U,5)
"RTN","PXRPC",135,0)
 . . S:$L($P(X,U,7)) @ROOT@("READING")=$P(X,U,7)
"RTN","PXRPC",136,0)
 . . S:$L($P(X,U,8)) @ROOT@("D/T READ")=$P(X,U,8)
"RTN","PXRPC",137,0)
 . . S:$L($P(X,U,9)) @ROOT@("EVENT D/T")=$P(X,U,9)
"RTN","PXRPC",138,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",139,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="SKIN TEST^"_SK
"RTN","PXRPC",140,0)
 . . I $E(TYP,3)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",141,0)
 . I $E(TYP,1,3)="PED" D  Q
"RTN","PXRPC",142,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",143,0)
 . . S PED=PED+1,ROOT="PXAPI(""PATIENT ED"","_PED_")"
"RTN","PXRPC",144,0)
 . . S @ROOT@("TOPIC")=CODE
"RTN","PXRPC",145,0)
 . . S:$L($P(X,U,5)) @ROOT@("UNDERSTANDING")=$P(X,U,5)
"RTN","PXRPC",146,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",147,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="PATIENT ED^"_PED
"RTN","PXRPC",148,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",149,0)
 . I $E(TYP,1,2)="HF" D  Q
"RTN","PXRPC",150,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",151,0)
 . . S HF=HF+1,ROOT="PXAPI(""HEALTH FACTOR"","_HF_")"
"RTN","PXRPC",152,0)
 . . S @ROOT@("HEALTH FACTOR")=CODE
"RTN","PXRPC",153,0)
 . . S:$L($P(X,U,5)) @ROOT@("LEVEL/SEVERITY")=$P(X,U,5)
"RTN","PXRPC",154,0)
 . . S:$P(X,U,6)'>0 $P(X,U,6)=$G(PXAPI("PROVIDER",1,"NAME"))
"RTN","PXRPC",155,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",156,0)
 . . S:$L($P(X,U,11)) @ROOT@("EVENT D/T")=$P($P(X,U,11),";",1)
"RTN","PXRPC",157,0)
 . . S:$L($P(X,U,11)) SRC=$P($P(X,U,11),";",2)
"RTN","PXRPC",158,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="HEALTH FACTOR^"_HF
"RTN","PXRPC",159,0)
 . . I $E(TYP,3)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",160,0)
 . I $E(TYP,1,3)="XAM" D  Q
"RTN","PXRPC",161,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",162,0)
 . . S XAM=XAM+1,ROOT="PXAPI(""EXAM"","_XAM_")"
"RTN","PXRPC",163,0)
 . . S @ROOT@("EXAM")=CODE
"RTN","PXRPC",164,0)
 . . S:$L($P(X,U,5)) @ROOT@("RESULT")=$P(X,U,5)
"RTN","PXRPC",165,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",166,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="EXAM^"_XAM
"RTN","PXRPC",167,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1
"RTN","PXRPC",168,0)
 . I $E(TYP,1,3)="TRT" D  Q
"RTN","PXRPC",169,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",170,0)
 . . S TRT=TRT+1,ROOT="PXAPI(""TREATMENT"","_TRT_")"
"RTN","PXRPC",171,0)
 . . S @ROOT@("IMMUN")=CODE
"RTN","PXRPC",172,0)
 . . S:$L(CAT) @ROOT@("CATEGORY")=CAT
"RTN","PXRPC",173,0)
 . . S:$L(NARR) @ROOT@("NARRATIVE")=NARR
"RTN","PXRPC",174,0)
 . . S:$L($P(X,U,5)) @ROOT@("QTY")=$P(X,U,5)
"RTN","PXRPC",175,0)
 . . S:$P(X,U,6)>0 @ROOT@("ENC PROVIDER")=$P(X,U,6)
"RTN","PXRPC",176,0)
 . . S:$L($P(X,U,10))>0 COMMENT($P(X,U,10))="TREATMENT^"_TRT
"RTN","PXRPC",177,0)
 . . I $E(TYP,4)="-" S @ROOT@("DELETE")=1,@ROOT@("QTY")=0
"RTN","PXRPC",178,0)
 . I $E(TYP,1,3)="COM" D  Q
"RTN","PXRPC",179,0)
 . . Q:'$L(CODE)
"RTN","PXRPC",180,0)
 . . Q:'$L(CAT)
"RTN","PXRPC",181,0)
 . . S COMMENTS(CODE)=$P(X,U,3,999)
"RTN","PXRPC",182,0)
 ;Store the comments
"RTN","PXRPC",183,0)
 S COM=""
"RTN","PXRPC",184,0)
 ;F  S COM=$O(COMMENT(COM)) Q:COM=""  S:$D(COMMENTS(COM)) PXAPI($P(COMMENT(COM),"^",1),$P(COMMENT(COM),"^",2),"COMMENT")=COMMENTS(COM)
"RTN","PXRPC",185,0)
 F  S COM=$O(COMMENT(COM)) Q:COM=""  D:$D(COMMENTS(COM))
"RTN","PXRPC",186,0)
 . I $G(IMMCOMMS(COM))'="" S COMMENTS(COM)=COMMENTS(COM)_$S(COMMENTS(COM)="":"",1:" ")_IMMCOMMS(COM)
"RTN","PXRPC",187,0)
 . S PXAPI($P(COMMENT(COM),"^",1),$P(COMMENT(COM),"^",2),"COMMENT")=COMMENTS(COM)
"RTN","PXRPC",188,0)
 ;
"RTN","PXRPC",189,0)
 S PXAPI("ENCOUNTER",1,"ENCOUNTER TYPE")="P"
"RTN","PXRPC",190,0)
DATA2PCE ; 
"RTN","PXRPC",191,0)
 I '$D(PXAPI)#10 S OK=-3 Q
"RTN","PXRPC",192,0)
 I '($D(PXAVST)#2) S PXAVST=""
"RTN","PXRPC",193,0)
 S OK=$$DATA2PCE^PXAI("PXAPI",PKG,SRC,.PXAVST,"","",.ERROR,"","","")
"RTN","PXRPC",194,0)
 Q
"VER")
8.0^22.0
"BLD",9185,6)
^159
**END**
**END**

