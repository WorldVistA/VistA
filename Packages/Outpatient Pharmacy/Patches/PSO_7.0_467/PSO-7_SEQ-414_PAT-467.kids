Released PSO*7*467 SEQ #414
Extracted from mail message
**KIDS**:PSO*7.0*467^

**INSTALL NAME**
PSO*7.0*467
"BLD",9579,0)
PSO*7.0*467^OUTPATIENT PHARMACY^0^3171024^y
"BLD",9579,1,0)
^^1^1^3171018^
"BLD",9579,1,1,0)
Inbound electronic prescribing enhancements.
"BLD",9579,4,0)
^9.64PA^59^7
"BLD",9579,4,50,0)
50
"BLD",9579,4,50,2,0)
^9.641^50^1
"BLD",9579,4,50,2,50,0)
DRUG  (File-top level)
"BLD",9579,4,50,2,50,1,0)
^9.6411^22^1
"BLD",9579,4,50,2,50,1,22,0)
PSNDF VA PRODUCT NAME ENTRY
"BLD",9579,4,50,222)
y^y^p^^^^n^^n
"BLD",9579,4,50,224)

"BLD",9579,4,52.45,0)
52.45
"BLD",9579,4,52.45,222)
y^y^f^^n^^y^o^n
"BLD",9579,4,52.46,0)
52.46
"BLD",9579,4,52.46,222)
y^y^f^^^^n
"BLD",9579,4,52.47,0)
52.47
"BLD",9579,4,52.47,222)
y^y^f^^^^n
"BLD",9579,4,52.48,0)
52.48
"BLD",9579,4,52.48,222)
y^y^f^^^^n
"BLD",9579,4,52.49,0)
52.49
"BLD",9579,4,52.49,222)
y^y^f^^^^n
"BLD",9579,4,59,0)
59
"BLD",9579,4,59,2,0)
^9.641^59^1
"BLD",9579,4,59,2,59,0)
OUTPATIENT SITE  (File-top level)
"BLD",9579,4,59,2,59,1,0)
^9.6411^10^1
"BLD",9579,4,59,2,59,1,10,0)
DEFAULT ERX CLINIC
"BLD",9579,4,59,222)
y^y^p^^^^n^^n
"BLD",9579,4,59,224)

"BLD",9579,4,"APDD",50,50)

"BLD",9579,4,"APDD",50,50,22)

"BLD",9579,4,"APDD",59,59)

"BLD",9579,4,"APDD",59,59,10)

"BLD",9579,4,"B",50,50)

"BLD",9579,4,"B",52.45,52.45)

"BLD",9579,4,"B",52.46,52.46)

"BLD",9579,4,"B",52.47,52.47)

"BLD",9579,4,"B",52.48,52.48)

"BLD",9579,4,"B",52.49,52.49)

"BLD",9579,4,"B",59,59)

"BLD",9579,6.3)
153
"BLD",9579,"ABPKG")
n
"BLD",9579,"INI")
PSO467PI
"BLD",9579,"INID")
^n^n
"BLD",9579,"INIT")
PSO467PO
"BLD",9579,"KRN",0)
^9.67PA^779.2^20
"BLD",9579,"KRN",.4,0)
.4
"BLD",9579,"KRN",.401,0)
.401
"BLD",9579,"KRN",.402,0)
.402
"BLD",9579,"KRN",.403,0)
.403
"BLD",9579,"KRN",.5,0)
.5
"BLD",9579,"KRN",.84,0)
.84
"BLD",9579,"KRN",3.6,0)
3.6
"BLD",9579,"KRN",3.8,0)
3.8
"BLD",9579,"KRN",9.2,0)
9.2
"BLD",9579,"KRN",9.2,"NM",0)
^9.68A^^
"BLD",9579,"KRN",9.8,0)
9.8
"BLD",9579,"KRN",9.8,"NM",0)
^9.68A^24^24
"BLD",9579,"KRN",9.8,"NM",1,0)
PSOERX^^0^B62148150
"BLD",9579,"KRN",9.8,"NM",2,0)
PSOERX1^^0^B73483713
"BLD",9579,"KRN",9.8,"NM",3,0)
PSOERX1A^^0^B116223189
"BLD",9579,"KRN",9.8,"NM",4,0)
PSOERXA0^^0^B33077655
"BLD",9579,"KRN",9.8,"NM",5,0)
PSOERXA1^^0^B228588207
"BLD",9579,"KRN",9.8,"NM",6,0)
PSOERXD1^^0^B120565051
"BLD",9579,"KRN",9.8,"NM",7,0)
PSOERXP1^^0^B23837983
"BLD",9579,"KRN",9.8,"NM",8,0)
PSOERXR1^^0^B24483319
"BLD",9579,"KRN",9.8,"NM",9,0)
PSOERXO1^^0^B57309099
"BLD",9579,"KRN",9.8,"NM",10,0)
PSOERXA2^^0^B75232526
"BLD",9579,"KRN",9.8,"NM",11,0)
PSOERXA3^^0^B37438894
"BLD",9579,"KRN",9.8,"NM",12,0)
PSOERX1B^^0^B200406933
"BLD",9579,"KRN",9.8,"NM",13,0)
PSOERXH1^^0^B14280628
"BLD",9579,"KRN",9.8,"NM",14,0)
PSOERXX1^^0^B44864162
"BLD",9579,"KRN",9.8,"NM",15,0)
PSOERXX2^^0^B181162473
"BLD",9579,"KRN",9.8,"NM",16,0)
PSOERXX3^^0^B81556769
"BLD",9579,"KRN",9.8,"NM",17,0)
PSOERXX4^^0^B86144240
"BLD",9579,"KRN",9.8,"NM",18,0)
PSOERXX5^^0^B181218192
"BLD",9579,"KRN",9.8,"NM",19,0)
PSOERXA4^^0^B86435195
"BLD",9579,"KRN",9.8,"NM",20,0)
PSOERX1C^^0^B35864468
"BLD",9579,"KRN",9.8,"NM",21,0)
PSOORFI1^^0^B82061614
"BLD",9579,"KRN",9.8,"NM",22,0)
PSOORNE2^^0^B111459106
"BLD",9579,"KRN",9.8,"NM",23,0)
PSOERXU1^^0^B72865919
"BLD",9579,"KRN",9.8,"NM",24,0)
PSOERXD2^^0^B205678720
"BLD",9579,"KRN",9.8,"NM","B","PSOERX",1)

"BLD",9579,"KRN",9.8,"NM","B","PSOERX1",2)

"BLD",9579,"KRN",9.8,"NM","B","PSOERX1A",3)

"BLD",9579,"KRN",9.8,"NM","B","PSOERX1B",12)

"BLD",9579,"KRN",9.8,"NM","B","PSOERX1C",20)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXA0",4)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXA1",5)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXA2",10)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXA3",11)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXA4",19)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXD1",6)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXD2",24)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXH1",13)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXO1",9)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXP1",7)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXR1",8)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXU1",23)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXX1",14)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXX2",15)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXX3",16)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXX4",17)

"BLD",9579,"KRN",9.8,"NM","B","PSOERXX5",18)

"BLD",9579,"KRN",9.8,"NM","B","PSOORFI1",21)

"BLD",9579,"KRN",9.8,"NM","B","PSOORNE2",22)

"BLD",9579,"KRN",19,0)
19
"BLD",9579,"KRN",19,"NM",0)
^9.68A^4^3
"BLD",9579,"KRN",19,"NM",1,0)
PSO WEB SERVICES OPTION^^0
"BLD",9579,"KRN",19,"NM",3,0)
PSO ERX FINISH^^0
"BLD",9579,"KRN",19,"NM",4,0)
PSO RX^^3
"BLD",9579,"KRN",19,"NM","B","PSO ERX FINISH",3)

"BLD",9579,"KRN",19,"NM","B","PSO RX",4)

"BLD",9579,"KRN",19,"NM","B","PSO WEB SERVICES OPTION",1)

"BLD",9579,"KRN",19.1,0)
19.1
"BLD",9579,"KRN",19.1,"NM",0)
^9.68A^3^3
"BLD",9579,"KRN",19.1,"NM",1,0)
PSO ERX ADV TECH^^0
"BLD",9579,"KRN",19.1,"NM",2,0)
PSO ERX TECH^^0
"BLD",9579,"KRN",19.1,"NM",3,0)
PSO ERX VIEW^^0
"BLD",9579,"KRN",19.1,"NM","B","PSO ERX ADV TECH",1)

"BLD",9579,"KRN",19.1,"NM","B","PSO ERX TECH",2)

"BLD",9579,"KRN",19.1,"NM","B","PSO ERX VIEW",3)

"BLD",9579,"KRN",101,0)
101
"BLD",9579,"KRN",101,"NM",0)
^9.68A^39^38
"BLD",9579,"KRN",101,"NM",1,0)
PSO ERX DISPLAY MENU^^0
"BLD",9579,"KRN",101,"NM",2,0)
PSO ERX HQ SEARCH^^0
"BLD",9579,"KRN",101,"NM",3,0)
PSO ERX HQ SORT^^0
"BLD",9579,"KRN",101,"NM",4,0)
PSO ERX HQ SELECT^^0
"BLD",9579,"KRN",101,"NM",6,0)
PSO ERX ACCEPT ERX^^0
"BLD",9579,"KRN",101,"NM",7,0)
PSO ERX ACCEPT VALIDATION^^0
"BLD",9579,"KRN",101,"NM",8,0)
PSO ERX EDIT^^0
"BLD",9579,"KRN",101,"NM",9,0)
PSO ERX HOLD^^0
"BLD",9579,"KRN",101,"NM",10,0)
PSO ERX HQ MENU^^0
"BLD",9579,"KRN",101,"NM",11,0)
PSO ERX PRINT^^0
"BLD",9579,"KRN",101,"NM",12,0)
PSO ERX REJECT^^0
"BLD",9579,"KRN",101,"NM",13,0)
PSO ERX UNHOLD^^0
"BLD",9579,"KRN",101,"NM",14,0)
PSO ERX VALIDATE DRUG^^0
"BLD",9579,"KRN",101,"NM",15,0)
PSO ERX VALIDATE PATIENT^^0
"BLD",9579,"KRN",101,"NM",16,0)
PSO ERX VALIDATE PROVIDER^^0
"BLD",9579,"KRN",101,"NM",17,0)
PSO ERX VALIDATION MENU^^0
"BLD",9579,"KRN",101,"NM",18,0)
PSO ERX SELECT BY NUMBER^^0
"BLD",9579,"KRN",101,"NM",19,0)
PSO ERX REMOVE^^0
"BLD",9579,"KRN",101,"NM",20,0)
PSO ERX HIDDEN ACTIONS^^0
"BLD",9579,"KRN",101,"NM",21,0)
PSO ERX RENEW REQUEST^^0
"BLD",9579,"KRN",101,"NM",22,0)
VALM NEXT SCREEN^^4^
"BLD",9579,"KRN",101,"NM",23,0)
VALM PREVIOUS SCREEN^^4^
"BLD",9579,"KRN",101,"NM",24,0)
VALM UP ONE LINE^^4^
"BLD",9579,"KRN",101,"NM",25,0)
VALM DOWN A LINE^^4^
"BLD",9579,"KRN",101,"NM",26,0)
VALM REFRESH^^4^
"BLD",9579,"KRN",101,"NM",27,0)
VALM PRINT SCREEN^^4^
"BLD",9579,"KRN",101,"NM",28,0)
VALM PRINT LIST^^4^
"BLD",9579,"KRN",101,"NM",29,0)
VALM RIGHT^^4^
"BLD",9579,"KRN",101,"NM",30,0)
VALM LEFT^^4^
"BLD",9579,"KRN",101,"NM",31,0)
VALM TURN ON/OFF MENUS^^4^
"BLD",9579,"KRN",101,"NM",32,0)
VALM SEARCH LIST^^4^
"BLD",9579,"KRN",101,"NM",33,0)
VALM QUIT^^4^
"BLD",9579,"KRN",101,"NM",34,0)
VALM LAST SCREEN^^4^
"BLD",9579,"KRN",101,"NM",35,0)
VALM FIRST SCREEN^^4^
"BLD",9579,"KRN",101,"NM",36,0)
VALM GOTO PAGE^^4^
"BLD",9579,"KRN",101,"NM",37,0)
PSO HIDDEN ACTIONS^^3
"BLD",9579,"KRN",101,"NM",38,0)
PSO HIDDEN ACTIONS #3^^3
"BLD",9579,"KRN",101,"NM",39,0)
PSO ERX OP PRINT^^0
"BLD",9579,"KRN",101,"NM","B","PSO ERX ACCEPT ERX",6)

"BLD",9579,"KRN",101,"NM","B","PSO ERX ACCEPT VALIDATION",7)

"BLD",9579,"KRN",101,"NM","B","PSO ERX DISPLAY MENU",1)

"BLD",9579,"KRN",101,"NM","B","PSO ERX EDIT",8)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HIDDEN ACTIONS",20)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HOLD",9)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HQ MENU",10)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HQ SEARCH",2)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HQ SELECT",4)

"BLD",9579,"KRN",101,"NM","B","PSO ERX HQ SORT",3)

"BLD",9579,"KRN",101,"NM","B","PSO ERX OP PRINT",39)

"BLD",9579,"KRN",101,"NM","B","PSO ERX PRINT",11)

"BLD",9579,"KRN",101,"NM","B","PSO ERX REJECT",12)

"BLD",9579,"KRN",101,"NM","B","PSO ERX REMOVE",19)

"BLD",9579,"KRN",101,"NM","B","PSO ERX RENEW REQUEST",21)

"BLD",9579,"KRN",101,"NM","B","PSO ERX SELECT BY NUMBER",18)

"BLD",9579,"KRN",101,"NM","B","PSO ERX UNHOLD",13)

"BLD",9579,"KRN",101,"NM","B","PSO ERX VALIDATE DRUG",14)

"BLD",9579,"KRN",101,"NM","B","PSO ERX VALIDATE PATIENT",15)

"BLD",9579,"KRN",101,"NM","B","PSO ERX VALIDATE PROVIDER",16)

"BLD",9579,"KRN",101,"NM","B","PSO ERX VALIDATION MENU",17)

"BLD",9579,"KRN",101,"NM","B","PSO HIDDEN ACTIONS",37)

"BLD",9579,"KRN",101,"NM","B","PSO HIDDEN ACTIONS #3",38)

"BLD",9579,"KRN",101,"NM","B","VALM DOWN A LINE",25)

"BLD",9579,"KRN",101,"NM","B","VALM FIRST SCREEN",35)

"BLD",9579,"KRN",101,"NM","B","VALM GOTO PAGE",36)

"BLD",9579,"KRN",101,"NM","B","VALM LAST SCREEN",34)

"BLD",9579,"KRN",101,"NM","B","VALM LEFT",30)

"BLD",9579,"KRN",101,"NM","B","VALM NEXT SCREEN",22)

"BLD",9579,"KRN",101,"NM","B","VALM PREVIOUS SCREEN",23)

"BLD",9579,"KRN",101,"NM","B","VALM PRINT LIST",28)

"BLD",9579,"KRN",101,"NM","B","VALM PRINT SCREEN",27)

"BLD",9579,"KRN",101,"NM","B","VALM QUIT",33)

"BLD",9579,"KRN",101,"NM","B","VALM REFRESH",26)

"BLD",9579,"KRN",101,"NM","B","VALM RIGHT",29)

"BLD",9579,"KRN",101,"NM","B","VALM SEARCH LIST",32)

"BLD",9579,"KRN",101,"NM","B","VALM TURN ON/OFF MENUS",31)

"BLD",9579,"KRN",101,"NM","B","VALM UP ONE LINE",24)

"BLD",9579,"KRN",409.61,0)
409.61
"BLD",9579,"KRN",409.61,"NM",0)
^9.68A^5^5
"BLD",9579,"KRN",409.61,"NM",1,0)
PSO ERX HOLDING QUEUE^^0
"BLD",9579,"KRN",409.61,"NM",2,0)
PSO ERX HQ DISPLAY^^0
"BLD",9579,"KRN",409.61,"NM",3,0)
PSO ERX DRUG VALIDATION^^0
"BLD",9579,"KRN",409.61,"NM",4,0)
PSO ERX PATIENT VALIDATION^^0
"BLD",9579,"KRN",409.61,"NM",5,0)
PSO ERX PROVIDER VALIDATION^^0
"BLD",9579,"KRN",409.61,"NM","B","PSO ERX DRUG VALIDATION",3)

"BLD",9579,"KRN",409.61,"NM","B","PSO ERX HOLDING QUEUE",1)

"BLD",9579,"KRN",409.61,"NM","B","PSO ERX HQ DISPLAY",2)

"BLD",9579,"KRN",409.61,"NM","B","PSO ERX PATIENT VALIDATION",4)

"BLD",9579,"KRN",409.61,"NM","B","PSO ERX PROVIDER VALIDATION",5)

"BLD",9579,"KRN",771,0)
771
"BLD",9579,"KRN",779.2,0)
779.2
"BLD",9579,"KRN",870,0)
870
"BLD",9579,"KRN",8989.51,0)
8989.51
"BLD",9579,"KRN",8989.52,0)
8989.52
"BLD",9579,"KRN",8994,0)
8994
"BLD",9579,"KRN",8994,"NM",0)
^9.68A^3^3
"BLD",9579,"KRN",8994,"NM",1,0)
PSOERXA0 DRGMTCH^^0
"BLD",9579,"KRN",8994,"NM",2,0)
PSOERXA0 PRVMTCH^^0
"BLD",9579,"KRN",8994,"NM",3,0)
PSOERXA1 INCERX^^0
"BLD",9579,"KRN",8994,"NM","B","PSOERXA0 DRGMTCH",1)

"BLD",9579,"KRN",8994,"NM","B","PSOERXA0 PRVMTCH",2)

"BLD",9579,"KRN",8994,"NM","B","PSOERXA1 INCERX",3)

"BLD",9579,"KRN","B",.4,.4)

"BLD",9579,"KRN","B",.401,.401)

"BLD",9579,"KRN","B",.402,.402)

"BLD",9579,"KRN","B",.403,.403)

"BLD",9579,"KRN","B",.5,.5)

"BLD",9579,"KRN","B",.84,.84)

"BLD",9579,"KRN","B",3.6,3.6)

"BLD",9579,"KRN","B",3.8,3.8)

"BLD",9579,"KRN","B",9.2,9.2)

"BLD",9579,"KRN","B",9.8,9.8)

"BLD",9579,"KRN","B",19,19)

"BLD",9579,"KRN","B",19.1,19.1)

"BLD",9579,"KRN","B",101,101)

"BLD",9579,"KRN","B",409.61,409.61)

"BLD",9579,"KRN","B",771,771)

"BLD",9579,"KRN","B",779.2,779.2)

"BLD",9579,"KRN","B",870,870)

"BLD",9579,"KRN","B",8989.51,8989.51)

"BLD",9579,"KRN","B",8989.52,8989.52)

"BLD",9579,"KRN","B",8994,8994)

"BLD",9579,"PRET")

"BLD",9579,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",9579,"QUES",0)
^9.62^^
"BLD",9579,"REQB",0)
^9.611^3^3
"BLD",9579,"REQB",1,0)
PSO*7.0*444^2
"BLD",9579,"REQB",2,0)
PSO*7.0*454^2
"BLD",9579,"REQB",3,0)
PSO*7.0*446^2
"BLD",9579,"REQB","B","PSO*7.0*444",1)

"BLD",9579,"REQB","B","PSO*7.0*446",3)

"BLD",9579,"REQB","B","PSO*7.0*454",2)

"DATA",52.45,1,0)
AD^Additional Drug Needed^REA
"DATA",52.45,1,1,0)
^^2^2^3170427
"DATA",52.45,1,1,1,0)
Code indicating optimal treatment of the patient's condition requiring the
"DATA",52.45,1,1,2,0)
addition of a new drug to the existing drug therapy.
"DATA",52.45,2,0)
AN^Prescription Authentication^REA
"DATA",52.45,2,1,0)
^^2^2^3170427
"DATA",52.45,2,1,1,0)
Code indicating that circumstances required the pharmacist to verify the validity
"DATA",52.45,2,1,2,0)
and/or authenticity of the prescription.
"DATA",52.45,3,0)
AR^Adverse Drug Reaction^REA
"DATA",52.45,3,1,0)
^^1^1^3170427
"DATA",52.45,3,1,1,0)
Code indicating an adverse reaction by a patient to a drug.
"DATA",52.45,4,0)
AT^Additive Toxicity^REA
"DATA",52.45,4,1,0)
^^2^2^3170427
"DATA",52.45,4,1,1,0)
Code indicating a detection of drugs with similar side effects when used in
"DATA",52.45,4,1,2,0)
combination could exhibit a toxic potential greater than either agent by itself.
"DATA",52.45,5,0)
CD^Chronic Disease Management^REA
"DATA",52.45,5,1,0)
^^1^1^3170427
"DATA",52.45,5,1,1,0)
The patient is participating in a coordinated health care intervention program.
"DATA",52.45,6,0)
CH^Call Help Desk^REA
"DATA",52.45,6,1,0)
^^1^1^3170427
"DATA",52.45,6,1,1,0)
Processor message to recommend the receiver contact the processor/plan.
"DATA",52.45,7,0)
CS^Patient Complaint/Symptom^REA
"DATA",52.45,7,1,0)
^^4^4^3170427
"DATA",52.45,7,1,1,0)
Code indicating that in the course of assessment or discussion with the patient,
"DATA",52.45,7,1,2,0)
the pharmacist identified an actual or potential problem when the patient
"DATA",52.45,7,1,3,0)
presented to the pharmacist complaints or symptoms suggestive of illness
"DATA",52.45,7,1,4,0)
requesting evaluation and treatment.
"DATA",52.45,8,0)
DA^Drug-Allergy^REA
"DATA",52.45,8,1,0)
^^2^2^3170427
"DATA",52.45,8,1,1,0)
Indicates that an adverse immune event may occur due to the patient's previously
"DATA",52.45,8,1,2,0)
demonstrated heightened allergic response to the drug product in question.
"DATA",52.45,9,0)
DC^Drug-Disease (Inferred)^REA
"DATA",52.45,9,1,0)
^^3^3^3170427
"DATA",52.45,9,1,1,0)
Indicates that the use of the drug may be inappropriate in light of a specific
"DATA",52.45,9,1,2,0)
medical condition that the patient has. The existence of the specific medical
"DATA",52.45,9,1,3,0)
condition is inferred from drugs in the patient's medication history.
"DATA",52.45,10,0)
DD^Drug-Drug Interaction^REA
"DATA",52.45,10,1,0)
^^2^2^3170427
"DATA",52.45,10,1,1,0)
Indicates that drug combinations in which the net pharmacologic response may be
"DATA",52.45,10,1,2,0)
different from the result expected when each drug is given separately.
"DATA",52.45,11,0)
DF^Drug-Food interaction^REA
"DATA",52.45,11,1,0)
^^1^1^3170427
"DATA",52.45,11,1,1,0)
Indicates interactions between a drug and certain foods.
"DATA",52.45,12,0)
DI^Drug Incompatibility^REA
"DATA",52.45,12,1,0)
^^1^1^3170427
"DATA",52.45,12,1,1,0)
Indicates physical and chemical incompatibilities between two or more drugs.
"DATA",52.45,13,0)
DL^Drug-Lab Conflict^REA
"DATA",52.45,13,1,0)
^^3^3^3170427
"DATA",52.45,13,1,1,0)
Indicates that laboratory values may be altered due to the use of the drug, or
"DATA",52.45,13,1,2,0)
that the patient's response to the drug may be altered due to a condition that is
"DATA",52.45,13,1,3,0)
identified by a certain laboratory value.
"DATA",52.45,14,0)
DM^Apparent Drug Misuse^REA
"DATA",52.45,14,1,0)
^^2^2^3170427
"DATA",52.45,14,1,1,0)
Code indicating a pattern of drug use by a patient in a manner that is
"DATA",52.45,14,1,2,0)
significantly different than that prescribed by the prescriber.
"DATA",52.45,15,0)
DR^Dose Range Conflict^REA
"DATA",52.45,15,1,0)
^^2^2^3170427
"DATA",52.45,15,1,1,0)
Code indicating that the prescription does not follow recommended medication
"DATA",52.45,15,1,2,0)
dosage.
"DATA",52.45,16,0)
DS^Tobacco Use^REA
"DATA",52.45,16,1,0)
^^2^2^3170427
"DATA",52.45,16,1,1,0)
Code indicating that a conflict was detected when a prescribed drug is
"DATA",52.45,16,1,2,0)
contraindicated or might conflict with the use of tobacco products.
"DATA",52.45,17,0)
ED^Patient Education/Instruction^REA
"DATA",52.45,17,1,0)
^^4^4^3170427
"DATA",52.45,17,1,1,0)
Code indicating that a cognitive service whereby the pharmacist performed a
"DATA",52.45,17,1,2,0)
patient care activity by providing additional instructions or education to the
"DATA",52.45,17,1,3,0)
patient beyond the simple task of explaining the prescriber's instructions on the
"DATA",52.45,17,1,4,0)
prescription.
"DATA",52.45,18,0)
ER^Overuse^REA
"DATA",52.45,18,1,0)
^^2^2^3170427
"DATA",52.45,18,1,1,0)
Code indicating that the current prescription refill is occurring before the days
"DATA",52.45,18,1,2,0)
supply of the previous filling should have been exhausted.
"DATA",52.45,19,0)
EX^Excessive Quantity^REA
"DATA",52.45,19,1,0)
^^2^2^3170427
"DATA",52.45,19,1,1,0)
Code that documents the quantity is excessive for the single time period for
"DATA",52.45,19,1,2,0)
which the drug is being prescribed.
"DATA",52.45,20,0)
HD^High Dose^REA
"DATA",52.45,20,1,0)
^^1^1^3170427
"DATA",52.45,20,1,1,0)
Detects drug doses that fall above the standard dosing range.
"DATA",52.45,21,0)
IC^Iatrogenic Condition^REA
"DATA",52.45,21,1,0)
^^2^2^3170427
"DATA",52.45,21,1,1,0)
Code indicating that a possible inappropriate use of drugs that are designed to
"DATA",52.45,21,1,2,0)
amerliorate complications caused by another medication has been detected.
"DATA",52.45,22,0)
ID^Ingredient Duplication^REA
"DATA",52.45,22,1,0)
^^2^2^3170427
"DATA",52.45,22,1,1,0)
Code indicating that simultaneous use of drug products containing one or more
"DATA",52.45,22,1,2,0)
identical generic chemical entities has been detected.
"DATA",52.45,23,0)
LD^Low Dose^REA
"DATA",52.45,23,1,0)
^^2^2^3170427
"DATA",52.45,23,1,1,0)
Code indicating that the submitted drug doses fall below the standard dosing
"DATA",52.45,23,1,2,0)
range.
"DATA",52.45,24,0)
LK^Lock In Recipient^REA
"DATA",52.45,24,1,0)
^^4^4^3170427
"DATA",52.45,24,1,1,0)
Code indicating that the professional service was related to a plan/payer
"DATA",52.45,24,1,2,0)
constraint on the member whereby the member is required to obtain services from
"DATA",52.45,24,1,3,0)
only one specified pharmacy or other provider type, hence the member is "locked
"DATA",52.45,24,1,4,0)
in" to using only those providers or pharmacies.
"DATA",52.45,25,0)
LR^Underuse^REA
"DATA",52.45,25,1,0)
^^2^2^3170427
"DATA",52.45,25,1,1,0)
Code indicating that a prescription refill that occurred after the days supply of
"DATA",52.45,25,1,2,0)
the previous filling should have been exhausted.
"DATA",52.45,26,0)
MC^Drug-Disease (Reported)^REA
"DATA",52.45,26,1,0)
^^3^3^3170427
"DATA",52.45,26,1,1,0)
Indicates that the use of the drug may be inappropriate in light of a specific
"DATA",52.45,26,1,2,0)
medical condition that the patient has. Information about the specific medical
"DATA",52.45,26,1,3,0)
condition was provided by the prescriber, patient or pharmacist.
"DATA",52.45,27,0)
MN^Insufficient Duration^REA
"DATA",52.45,27,1,0)
^^2^2^3170427
"DATA",52.45,27,1,1,0)
Code indicating that regimens shorter than the minimal limit of therapy for the
"DATA",52.45,27,1,2,0)
drug product, based on the product's common uses, has been detected.
"DATA",52.45,28,0)
MS^Missing Information/Clarification^REA
"DATA",52.45,28,1,0)
^^2^2^3170427
"DATA",52.45,28,1,1,0)
Code indicating that the prescription order is unclear, incomplete, or illegible
"DATA",52.45,28,1,2,0)
with respect to essential information.
"DATA",52.45,29,0)
MX^Excessive Duration^REA
"DATA",52.45,29,1,0)
^^2^2^3170427
"DATA",52.45,29,1,1,0)
Detects regimens that are longer than the maximal limit of therapy for a drug
"DATA",52.45,29,1,2,0)
product based on the product's common uses.
"DATA",52.45,30,0)
NA^Drug Not Available^REA
"DATA",52.45,30,1,0)
^^1^1^3170427
"DATA",52.45,30,1,1,0)
Indicates the drug is not currently available from any source.
"DATA",52.45,31,0)
NC^Non-covered Drug Purchase^REA
"DATA",52.45,31,1,0)
^^3^3^3170427
"DATA",52.45,31,1,1,0)
Code indicating a cognitive service whereby a patient is counseled, the
"DATA",52.45,31,1,2,0)
pharmacist's recommendation is accepted and a claim is submitted to the processor
"DATA",52.45,31,1,3,0)
requesting payment for the professional pharmacy service only, not the drug.
"DATA",52.45,32,0)
ND^New Disease/Diagnosis^REA
"DATA",52.45,32,1,0)
^^2^2^3170427
"DATA",52.45,32,1,1,0)
Code indicating that a professional pharmacy service has been performed for a
"DATA",52.45,32,1,2,0)
patient who has a newly diagnosed condition or disease.
"DATA",52.45,33,0)
NF^Non-Formulary Drug^REA
"DATA",52.45,33,1,0)
^^3^3^3170427
"DATA",52.45,33,1,1,0)
Code indicating that mandatory formulary enforcement activities have been
"DATA",52.45,33,1,2,0)
performed by the pharmacist when the drug is not included on the formulary of the
"DATA",52.45,33,1,3,0)
patient's pharmacy benefit plan.
"DATA",52.45,34,0)
NN^Unnecessary Drug^REA
"DATA",52.45,34,1,0)
^^1^1^3170427
"DATA",52.45,34,1,1,0)
Code indicating that the drug is no longer needed by the patient.
"DATA",52.45,35,0)
NP^New Patient Processing^REA
"DATA",52.45,35,1,0)
^^2^2^3170427
"DATA",52.45,35,1,1,0)
Code indicating that a pharmacist has performed the initial interview and
"DATA",52.45,35,1,2,0)
medication history of a new patient.
"DATA",52.45,36,0)
NR^Lactation/Nursing Interaction^REA
"DATA",52.45,36,1,0)
^^2^2^3170427
"DATA",52.45,36,1,1,0)
Code indicating that the drug is excreted in breast milk and may represent a
"DATA",52.45,36,1,2,0)
danger to a nursing infant.
"DATA",52.45,37,0)
NS^Insufficient Quantity^REA
"DATA",52.45,37,1,0)
^^1^1^3170427
"DATA",52.45,37,1,1,0)
Code indicating that the quantity of dosage units prescribed is insufficient.
"DATA",52.45,38,0)
OH^Alcohol Conflict^REA
"DATA",52.45,38,1,0)
^^2^2^3170427
"DATA",52.45,38,1,1,0)
Detects when a prescribed drug is contraindicated or might conflict with the use
"DATA",52.45,38,1,2,0)
of alcoholic beverages.
"DATA",52.45,39,0)
PA^Drug-Age^REA
"DATA",52.45,39,1,0)
^^1^1^3170427
"DATA",52.45,39,1,1,0)
Indicates age
"DATA",52.45,40,0)
PC^Patient Question/Concern^REA
"DATA",52.45,40,1,0)
^^2^2^3170427
"DATA",52.45,40,1,1,0)
Code indicating that a request for information/concern was expressed by the
"DATA",52.45,40,1,2,0)
patient, with respect to patient care.
"DATA",52.45,41,0)
PG^Drug-Pregnancy^REA
"DATA",52.45,41,1,0)
^^3^3^3170427
"DATA",52.45,41,1,1,0)
Indicates pregnancy related drug problems. This information is intended to assist
"DATA",52.45,41,1,2,0)
the healthcare professional in weighing the therapeutic value of a drug against
"DATA",52.45,41,1,3,0)
possible adverse effects on the fetus.
"DATA",52.45,42,0)
PH^Preventive Health Care^REA
"DATA",52.45,42,1,0)
^^4^4^3170427
"DATA",52.45,42,1,1,0)
Code indicating that the provided professional service was to educate the patient
"DATA",52.45,42,1,2,0)
regarding measures mitigating possible adverse effects or maximizing the benefits
"DATA",52.45,42,1,3,0)
of the product(s) dispensed; or measures to optimize health status, prevent
"DATA",52.45,42,1,4,0)
recurrence or exacerbation of problems.
"DATA",52.45,43,0)
PN^Prescriber Consultation^REA
"DATA",52.45,43,1,0)
^^2^2^3170427
"DATA",52.45,43,1,1,0)
Code indicating that a prescriber has requested information or a recommendation
"DATA",52.45,43,1,2,0)
related to the care of a patient.
"DATA",52.45,44,0)
PP^Plan Protocol^REA
"DATA",52.45,44,1,0)
^^4^4^3170427
"DATA",52.45,44,1,1,0)
Code indicating that a cognitive service whereby a pharmacist, in consultation
"DATA",52.45,44,1,2,0)
with the prescriber or using professional judgment, recommends a course of
"DATA",52.45,44,1,3,0)
therapy as outlined in the patient's plan and submits a claim for the
"DATA",52.45,44,1,4,0)
professional service provided.
"DATA",52.45,45,0)
PR^Prior Adverse Reaction^REA
"DATA",52.45,45,1,0)
^^1^1^3170427
"DATA",52.45,45,1,1,0)
Code identifying the patient has had a previous atypical reaction to drugs.
"DATA",52.45,46,0)
PS^Product Selection Opportunity^REA
"DATA",52.45,46,1,0)
^^3^3^3170427
"DATA",52.45,46,1,1,0)
Code indicating that an acceptable generic substitute or a therapeutic equivalent
"DATA",52.45,46,1,2,0)
exists for the drug. This code is intended to support discretionary drug product
"DATA",52.45,46,1,3,0)
selection activities by pharmacists.
"DATA",52.45,47,0)
RE^Suspected Environmental Risk^REA
"DATA",52.45,47,1,0)
^^2^2^3170427
"DATA",52.45,47,1,1,0)
Code indicating that the professional service was provided to obtain information
"DATA",52.45,47,1,2,0)
from the patient regarding suspected environmental factors.
"DATA",52.45,48,0)
RF^Health Provider Referral^REA
"DATA",52.45,48,1,0)
^^2^2^3170427
"DATA",52.45,48,1,1,0)
Patient referred to the pharmacist by another health care provider for disease
"DATA",52.45,48,1,2,0)
specific or general purposes.
"DATA",52.45,49,0)
SC^Suboptimal Compliance^REA
"DATA",52.45,49,1,0)
^^4^4^3170427
"DATA",52.45,49,1,1,0)
Code indicating that professional service was provided to counsel the patient
"DATA",52.45,49,1,2,0)
regarding the importance of adherence to the provided instructions and of
"DATA",52.45,49,1,3,0)
consistent use of the prescribed product including any ill effects anticipated as
"DATA",52.45,49,1,4,0)
a result of non-compliance.
"DATA",52.45,50,0)
SD^Suboptimal Drug/Indication^REA
"DATA",52.45,50,1,0)
^^2^2^3170427
"DATA",52.45,50,1,1,0)
Code indicating incorrect, inappropriate, or less than optimal drug prescribed
"DATA",52.45,50,1,2,0)
for the patient's condition.
"DATA",52.45,51,0)
SE^Side Effect^REA
"DATA",52.45,51,1,0)
^^1^1^3170427
"DATA",52.45,51,1,1,0)
Code reporting possible major side effects of the prescribed drug.
"DATA",52.45,52,0)
SF^Suboptimal Dosage Form^REA
"DATA",52.45,52,1,0)
^^2^2^3170427
"DATA",52.45,52,1,1,0)
Code indicating incorrect, inappropriate, or less than optimal dosage form for
"DATA",52.45,52,1,2,0)
the drug.
"DATA",52.45,53,0)
SR^Suboptimal Regimen^REA
"DATA",52.45,53,1,0)
^^2^2^3170427
"DATA",52.45,53,1,1,0)
Code indicating incorrect, inappropriate, or less than optimal dosage regimen
"DATA",52.45,53,1,2,0)
specified for the drug in question.
"DATA",52.45,54,0)
SX^Drug-Gender^REA
"DATA",52.45,54,1,0)
^^2^2^3170427
"DATA",52.45,54,1,1,0)
Indicates the therapy is inappropriate or contraindicated in either males or
"DATA",52.45,54,1,2,0)
females.
"DATA",52.45,55,0)
TD^Therapeutic^REA
"DATA",52.45,55,1,0)
^^2^2^3170427
"DATA",52.45,55,1,1,0)
Code indicating that a simultaneous use of different primary generic chemical
"DATA",52.45,55,1,2,0)
entities that have the same therapeutic effect was detected.
"DATA",52.45,56,0)
TN^Laboratory Test Needed^REA
"DATA",52.45,56,1,0)
^^2^2^3170427
"DATA",52.45,56,1,1,0)
Code indicating that an assessment of the patient suggests that a laboratory test
"DATA",52.45,56,1,2,0)
is needed to optimally manage a therapy.
"DATA",52.45,57,0)
TP^Payer/Processor^REA
"DATA",52.45,57,1,0)
^^2^2^3170427
"DATA",52.45,57,1,1,0)
Question Code indicating that a payer or processor requested information related
"DATA",52.45,57,1,2,0)
to the care of a patient.
"DATA",52.45,58,0)
UD^Duplicate Drug^REA
"DATA",52.45,58,1,0)
^^2^2^3170427
"DATA",52.45,58,1,1,0)
Code indicating that multiple prescriptions of the same drug formulation are
"DATA",52.45,58,1,2,0)
present in the patient's current medication profile.
"DATA",52.45,59,0)
00^Not Specified^RES
"DATA",52.45,60,0)
1A^Filled As Is, False Positive^RES
"DATA",52.45,60,1,0)
^^3^3^3170427
"DATA",52.45,60,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,60,1,2,0)
issue (alert) and determines the alert is incorrect for that prescription for
"DATA",52.45,60,1,3,0)
that patient and fills the prescription as originally written.
"DATA",52.45,61,0)
1B^Filled Prescription As Is^RES
"DATA",52.45,61,1,0)
^^3^3^3170427
"DATA",52.45,61,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,61,1,2,0)
issue (alert) and determines the alert is not relevant for that prescription for
"DATA",52.45,61,1,3,0)
that patient and fills the prescription as originally written.
"DATA",52.45,62,0)
1C^Filled, With Different Dose^RES
"DATA",52.45,62,1,0)
^^3^3^3170427
"DATA",52.45,62,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,62,1,2,0)
issue (alert) and fills the prescription with a different dose than was
"DATA",52.45,62,1,3,0)
originally prescribed.
"DATA",52.45,63,0)
1D^Filled, With Different Directions^RES
"DATA",52.45,63,1,0)
^^3^3^3170427
"DATA",52.45,63,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,63,1,2,0)
issue (alert) and fills the prescription with different directions than were
"DATA",52.45,63,1,3,0)
originally prescribed.
"DATA",52.45,64,0)
1E^Filled, With Different Drug^RES
"DATA",52.45,64,1,0)
^^3^3^3170427
"DATA",52.45,64,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,64,1,2,0)
issue (alert) and fills the prescription with a different drug than was
"DATA",52.45,64,1,3,0)
originally prescribed.
"DATA",52.45,65,0)
1F^Filled, With Different Quantity^RES
"DATA",52.45,65,1,0)
^^3^3^3170427
"DATA",52.45,65,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,65,1,2,0)
issue (alert) and fills the prescription with a different quantity than was
"DATA",52.45,65,1,3,0)
originally prescribed.
"DATA",52.45,66,0)
1G^Filled, With Prescriber Approval^RES
"DATA",52.45,66,1,0)
^^3^3^3170427
"DATA",52.45,66,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,66,1,2,0)
issue (alert) and fills the prescription after consulting with or obtaining
"DATA",52.45,66,1,3,0)
approval from the prescriber.
"DATA",52.45,67,0)
1H^Brand-to-Generic Change^RES
"DATA",52.45,67,1,0)
^^3^3^3170427
"DATA",52.45,67,1,1,0)
Action whereby a pharmacist dispenses the generic formulation of an originally
"DATA",52.45,67,1,2,0)
prescribed branded product. Allowed, often mandated, unless the prescriber
"DATA",52.45,67,1,3,0)
indicates "Do Not Substitute" on the prescription
"DATA",52.45,68,0)
1J^Rx-to-OTC Change^RES
"DATA",52.45,68,1,0)
^^3^3^3170427
"DATA",52.45,68,1,1,0)
Code indicating a cognitive service. The pharmacist reviews and evaluates a
"DATA",52.45,68,1,2,0)
therapeutic issue (alert) fills the prescription with an over-the-counter product
"DATA",52.45,68,1,3,0)
in lieu of the originally prescribed prescription-only product.
"DATA",52.45,69,0)
1K^Filled with Different Dosage Form^RES
"DATA",52.45,69,1,0)
^^3^3^3170427
"DATA",52.45,69,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,69,1,2,0)
issue (alert) and fills the prescription with a different dosage form than was
"DATA",52.45,69,1,3,0)
originally prescribed.
"DATA",52.45,70,0)
2A^Prescription Not Filled^RES
"DATA",52.45,70,1,0)
^^3^3^3170427
"DATA",52.45,70,1,1,0)
Code indicating a cognitive service. The pharmacist reviews and evaluates a
"DATA",52.45,70,1,2,0)
therapeutic issue (alert) and determines that the prescription should not be
"DATA",52.45,70,1,3,0)
filled as written.
"DATA",52.45,71,0)
2B^Not Filled, Directions Clarified^RES
"DATA",52.45,71,1,0)
^^4^4^3170427
"DATA",52.45,71,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,71,1,2,0)
issue (alert), consults with the prescriber or using professional judgment, does
"DATA",52.45,71,1,3,0)
not fill the prescription and counsels the patient as to the prescriber's
"DATA",52.45,71,1,4,0)
instructions.
"DATA",52.45,72,0)
3A^Recommendation Accepted^RES
"DATA",52.45,72,1,0)
^^3^3^3170427
"DATA",52.45,72,1,1,0)
Code indicating a cognitive service. The pharmacist reviews and evaluates a
"DATA",52.45,72,1,2,0)
therapeutic issue (alert), recommends a more appropriate product or regimen then
"DATA",52.45,72,1,3,0)
dispenses the alternative after consultation with the prescriber.
"DATA",52.45,73,0)
3B^Recommendation Not Accepted^RES
"DATA",52.45,73,1,0)
^^3^3^3170427
"DATA",52.45,73,1,1,0)
Code indicating a cognitive service. The pharmacist reviews and evaluates a
"DATA",52.45,73,1,2,0)
therapeutic issue (alert), recommends a more appropriate product or regimen but
"DATA",52.45,73,1,3,0)
the prescriber does not concur.
"DATA",52.45,74,0)
3C^Discontinued Drug^RES
"DATA",52.45,74,1,0)
^^2^2^3170427
"DATA",52.45,74,1,1,0)
Cognitive service involving the pharmacist's review of drug therapy that results
"DATA",52.45,74,1,2,0)
in the removal of a medication from the therapeutic regimen.
"DATA",52.45,75,0)
3D^Regimen Changed^RES
"DATA",52.45,75,1,0)
^^3^3^3170427
"DATA",52.45,75,1,1,0)
The pharmacist reviews and evaluates a therapeutic issue (alert), recommends a
"DATA",52.45,75,1,2,0)
more appropriate regimen then dispenses the recommended medication(s) after
"DATA",52.45,75,1,3,0)
consultation with the prescriber.
"DATA",52.45,76,0)
3E^Therapy Changed^RES
"DATA",52.45,76,1,0)
^^3^3^3170427
"DATA",52.45,76,1,1,0)
The pharmacist reviews and evaluates a therapeutic issue (alert), recommends a
"DATA",52.45,76,1,2,0)
more appropriate product or regimen then dispenses the alternative after
"DATA",52.45,76,1,3,0)
consultation with the prescriber.
"DATA",52.45,77,0)
3F^Therapy Changed^RES
"DATA",52.45,77,1,0)
^^3^3^3170427
"DATA",52.45,77,1,1,0)
The pharmacist reviews and evaluates a therapeutic issue (alert), recommends a
"DATA",52.45,77,1,2,0)
more appropriate product or regimen acknowledging that a cost increase will be
"DATA",52.45,77,1,3,0)
incurred, then dispenses the alternative after consultation with the prescriber.
"DATA",52.45,78,0)
3G^Drug Therapy Unchanged^RES
"DATA",52.45,78,1,0)
^^3^3^3170427
"DATA",52.45,78,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates a therapeutic
"DATA",52.45,78,1,2,0)
issue (alert), consults with the prescriber or uses professional judgment and
"DATA",52.45,78,1,3,0)
subsequently fills the prescription as originally written.
"DATA",52.45,79,0)
3H^Follow-Up/Report^RES
"DATA",52.45,79,1,0)
^^1^1^3170427
"DATA",52.45,79,1,1,0)
Code indicating that additional follow through by the pharmacist is required
"DATA",52.45,80,0)
3J^Patient Referral^RES
"DATA",52.45,80,1,0)
^^2^2^3170427
"DATA",52.45,80,1,1,0)
Code indicating the referral of a patient to another health care provider
"DATA",52.45,80,1,2,0)
following evaluation by the pharmacist.
"DATA",52.45,81,0)
3K^Instructions Understood^RES
"DATA",52.45,81,1,0)
^^3^3^3170427
"DATA",52.45,81,1,1,0)
Indicator used to convey that the patient affirmed understanding of the
"DATA",52.45,81,1,2,0)
instructions provided by the pharmacist regarding the use and handling of the
"DATA",52.45,81,1,3,0)
medication dispensed.
"DATA",52.45,82,0)
3M^Compliance Aid Provided^RES
"DATA",52.45,82,1,0)
^^2^2^3170427
"DATA",52.45,82,1,1,0)
Cognitive service whereby the pharmacist supplies a product that assists the
"DATA",52.45,82,1,2,0)
patient in complying with instructions for taking medications.
"DATA",52.45,83,0)
3N^Medication Administered^RES
"DATA",52.45,83,1,0)
^^2^2^3170427
"DATA",52.45,83,1,1,0)
Cognitive service whereby the pharmacist performs a patient care activity by
"DATA",52.45,83,1,2,0)
personally administering the medication.
"DATA",52.45,84,0)
4A^Prescribed with acknowledgements^RES
"DATA",52.45,84,1,0)
^^2^2^3170427
"DATA",52.45,84,1,1,0)
Physician is prescribing this medication with knowledge of the potential
"DATA",52.45,84,1,2,0)
conflict.
"DATA",52.45,85,0)
00^No intervention^PSC
"DATA",52.45,86,0)
AS^Patient assessment^PSC
"DATA",52.45,86,1,0)
^^2^2^3170427
"DATA",52.45,86,1,1,0)
Code indicating that an initial evaluation of a patient or complaint/symptom for
"DATA",52.45,86,1,2,0)
the purpose of developing a therapeutic plan.
"DATA",52.45,87,0)
CC^Coordination of care^PSC
"DATA",52.45,87,1,0)
^^2^2^3170427
"DATA",52.45,87,1,1,0)
Case management activities of a pharmacist related to the care being delivered by
"DATA",52.45,87,1,2,0)
multiple providers.
"DATA",52.45,88,0)
DE^Dosing evaluation/determination^PSC
"DATA",52.45,88,1,0)
^^3^3^3170427
"DATA",52.45,88,1,1,0)
Cognitive service whereby the pharmacist reviews and evaluates the
"DATA",52.45,88,1,2,0)
appropriateness of a prescribed medication's dose, interval, frequency and/or
"DATA",52.45,88,1,3,0)
formulation.
"DATA",52.45,89,0)
VDP^Dosage evaluated^PSC
"DATA",52.45,89,1,0)
^^2^2^3170427
"DATA",52.45,89,1,1,0)
Code indicating that dosage has been evaluated with respect to risk for the
"DATA",52.45,89,1,2,0)
patient.
"DATA",52.45,90,0)
VFE^Formulary enforcement^PSC
"DATA",52.45,90,1,0)
^^4^4^3170427
"DATA",52.45,90,1,1,0)
Code indicating that activities including interventions with prescribers and
"DATA",52.45,90,1,2,0)
patients related to the enforcement of a pharmacy benefit plan formulary have
"DATA",52.45,90,1,3,0)
occurred. Comment: Use this code for cross-licensed brand products or generic to
"DATA",52.45,90,1,4,0)
brand interchange.
"DATA",52.45,91,0)
GP^Generic product selection^PSC
"DATA",52.45,91,1,0)
^^3^3^3170427
"DATA",52.45,91,1,1,0)
The selection of a chemically and therapeutically identical product to that
"DATA",52.45,91,1,2,0)
specified by the prescriber for the purpose of achieving cost savings for the
"DATA",52.45,91,1,3,0)
payer.
"DATA",52.45,92,0)
MA^Medication administration^PSC
"DATA",52.45,92,1,0)
^^2^2^3170427
"DATA",52.45,92,1,1,0)
Code indicating an action of supplying a medication to a patient through any of
"DATA",52.45,92,1,2,0)
several routes-oral, topical, intravenous, intramuscular, intranasal, etc.
"DATA",52.45,93,0)
MB^Overriding benefit^PSC
"DATA",52.45,93,1,0)
^^1^1^3170427
"DATA",52.45,93,1,1,0)
Benefits of the prescribed medication outweigh the risks.
"DATA",52.45,94,0)
MP^Patient will be monitored^PSC
"DATA",52.45,94,1,0)
^^1^1^3170427
"DATA",52.45,94,1,1,0)
Prescriber is aware of the risk and will be monitoring the patient.
"DATA",52.45,95,0)
M0^Prescriber consulted^PSC
"DATA",52.45,95,1,0)
^^2^2^3170427
"DATA",52.45,95,1,1,0)
Code indicating prescriber communication related to collection of information or
"DATA",52.45,95,1,2,0)
clarification of a specific limited problem.
"DATA",52.45,96,0)
MR^Medication review^PSC
"DATA",52.45,96,1,0)
^^2^2^3170427
"DATA",52.45,96,1,1,0)
Code indicating comprehensive review and evaluation of a patient's entire
"DATA",52.45,96,1,2,0)
medication regimen.
"DATA",52.45,97,0)
PA^Previous patient tolerance^PSC
"DATA",52.45,97,1,0)
^^1^1^3170427
"DATA",52.45,97,1,1,0)
Patient has taken medication previously without issue.
"DATA",52.45,98,0)
PE^Patient education/instruction^PSC
"DATA",52.45,98,1,0)
^^3^3^3170427
"DATA",52.45,98,1,1,0)
Code indicating verbal and/or written communication by a pharmacist to enhance
"DATA",52.45,98,1,2,0)
the patient's knowledge about the condition under treatment or to develop skills
"DATA",52.45,98,1,3,0)
and competencies related to its management.
"DATA",52.45,99,0)
PH^Patient medication history^PSC
"DATA",52.45,99,1,0)
^^2^2^3170427
"DATA",52.45,99,1,1,0)
Code indicating the establishment of a medication history database on a patient
"DATA",52.45,99,1,2,0)
to serve as the foundation for the ongoing maintenance of a medication profile.
"DATA",52.45,100,0)
PM^Patient monitoring^PSC
"DATA",52.45,100,1,0)
^^2^2^3170427
"DATA",52.45,100,1,1,0)
Code indicating the evaluation of established therapy for the purpose of
"DATA",52.45,100,1,2,0)
determining whether an existing therapeutic plan should be altered.
"DATA",52.45,101,0)
P0^Patient consulted^PSC
"DATA",52.45,101,1,0)
^^2^2^3170427
"DATA",52.45,101,1,1,0)
Code indicating patient communication related to collection of information or
"DATA",52.45,101,1,2,0)
clarification of a specific limited problem.
"DATA",52.45,102,0)
PT^Perform laboratory test^PSC
"DATA",52.45,102,1,0)
^^2^2^3170427
"DATA",52.45,102,1,1,0)
Code indicating that the pharmacist performed a clinical laboratory test on a
"DATA",52.45,102,1,2,0)
patient.
"DATA",52.45,103,0)
R0^Pharmacist consulted other source^PSC
"DATA",52.45,103,1,0)
^^2^2^3170427
"DATA",52.45,103,1,1,0)
Code indicating communication related to collection of information or
"DATA",52.45,103,1,2,0)
clarification of a specific limited problem.
"DATA",52.45,104,0)
RT^Recommend laboratory test^PSC
"DATA",52.45,104,1,0)
^^2^2^3170427
"DATA",52.45,104,1,1,0)
Code indicating that the pharmacist recommends the performance of a clinical
"DATA",52.45,104,1,2,0)
laboratory test on a patient.
"DATA",52.45,105,0)
SC^Self-care consultation^PSC
"DATA",52.45,105,1,0)
^^3^3^3170427
"DATA",52.45,105,1,1,0)
Code indicating activities performed by a pharmacist on behalf of a patient
"DATA",52.45,105,1,2,0)
intended to allow the patient to function more effectively on his or her own
"DATA",52.45,105,1,3,0)
behalf in health promotion and disease prevention, detection, or treatment.
"DATA",52.45,106,0)
SW^Literature search/review^PSC
"DATA",52.45,106,1,0)
^^2^2^3170427
"DATA",52.45,106,1,1,0)
Code indicating that the pharmacist searches or reviews the pharmaceutical and/or
"DATA",52.45,106,1,2,0)
medical literature for information related to the care of a patient.
"DATA",52.45,107,0)
TC^Payer/processor consulted^PSC
"DATA",52.45,107,1,0)
^^2^2^3170427
"DATA",52.45,107,1,1,0)
Code indicating communication by a pharmacist to a processor or payer related to
"DATA",52.45,107,1,2,0)
the care of the patient.
"DATA",52.45,108,0)
TH^Therapeutic product interchange^PSC
"DATA",52.45,108,1,0)
^^3^3^3170427
"DATA",52.45,108,1,1,0)
Code indicating that the selection of a therapeutically equivalent product to
"DATA",52.45,108,1,2,0)
that specified by the prescriber for the purpose of achieving cost savings for
"DATA",52.45,108,1,3,0)
the payer.
"DATA",52.45,109,0)
ZZ^Other Acknowledgement^PSC
"DATA",52.45,109,1,0)
^^2^2^3170427
"DATA",52.45,109,1,1,0)
When ZZ is used, the textual DUE Acknowledgment Reason must be used to provide
"DATA",52.45,109,1,2,0)
additional detail.
"DATA",52.45,110,0)
DP^Dosage evaluated^PSC
"DATA",52.45,110,1,0)
^^2^2^3170427
"DATA",52.45,110,1,1,0)
Code indicating that dosage has been evaluated with respect to risk for the
"DATA",52.45,110,1,2,0)
patient.
"DATA",52.45,111,0)
FE^Formulary enforcement^PSC
"DATA",52.45,111,1,0)
^^4^4^3170427
"DATA",52.45,111,1,1,0)
Code indicating that activities including interventions with prescribers and
"DATA",52.45,111,1,2,0)
patients related to the enforcement of a pharmacy benefit plan formulary have
"DATA",52.45,111,1,3,0)
occurred. Comment: Use this code for cross-licensed brand products or generic to
"DATA",52.45,111,1,4,0)
brand interchange.
"DATA",52.45,112,0)
P^PENDING^ERX
"DATA",52.45,113,0)
A^APPROVED^ERX
"DATA",52.45,114,0)
PR^PROCESSED^ERX
"DATA",52.45,115,0)
E^ERROR^ERX
"DATA",52.45,116,0)
N^NEW RX^ERX
"DATA",52.45,117,0)
I^IN PROCESS^ERX
"DATA",52.45,118,0)
HPT^PATIENT NOT FOUND^ERX
"DATA",52.45,119,0)
HPD^PROVIDER NOT FOUND^ERX
"DATA",52.45,120,0)
HNF^NON-FORMULARY DRUG THAT NEEDS APPROVAL^ERX
"DATA",52.45,121,0)
HSO^INSUFFICIENT STOCK^ERX
"DATA",52.45,122,0)
HDI^DRUG-DRUG INTERACTION^ERX
"DATA",52.45,123,0)
HAD^ADVERSE DRUG INTERACTION^ERX
"DATA",52.45,124,0)
HBA^BAD ADDRESS^ERX
"DATA",52.45,125,0)
HPC^PROVIDER CONTACTED^ERX
"DATA",52.45,126,0)
HPA^PRIOR APPROVAL NEEDED^ERX
"DATA",52.45,127,0)
HOR^OTHER REASON^ERX
"DATA",52.45,128,0)
HPP^PATIENT CONTACTED^ERX
"DATA",52.45,129,0)
HPR^HOLD DUE TO PATIENT REQUEST^ERX
"DATA",52.45,130,0)
HQY^QUANTITY OR REFILL ISSUE^ERX
"DATA",52.45,131,0)
RJ^REJECTED^ERX
"DATA",52.45,132,0)
RM^REMOVED^ERX
"DATA",52.45,133,0)
PR^Preferred^DCS
"DATA",52.45,133,1,0)
^^3^3^3170427
"DATA",52.45,133,1,1,0)
Preferred means available on a pharmaceutical formulary in a manner such that the
"DATA",52.45,133,1,2,0)
product is given preference in dispensing decisions over competing products in a
"DATA",52.45,133,1,3,0)
therapeutic class or therapeutic use.
"DATA",52.45,134,0)
AP^Approved^DCS
"DATA",52.45,134,1,0)
^^1^1^3170427
"DATA",52.45,134,1,1,0)
The product is included in the plan formulary.
"DATA",52.45,135,0)
PA^Prior Authorization Required - A prior authorization is required before the prescription can be dispensed.^DCS
"DATA",52.45,136,0)
NF^Non-Formulary^DCS
"DATA",52.45,136,1,0)
^^1^1^3170427
"DATA",52.45,136,1,1,0)
The product is not included in the plan formulary.
"DATA",52.45,137,0)
NR^Not Reimbursed^DCS
"DATA",52.45,137,1,0)
^^1^1^3170427
"DATA",52.45,137,1,1,0)
The product is not reimbursable in the plan formulary.
"DATA",52.45,138,0)
DC^Differential Co-Pay^DCS
"DATA",52.45,138,1,0)
^^1^1^3170427
"DATA",52.45,138,1,1,0)
The product may be subject to potentially higher copay.
"DATA",52.45,139,0)
UN^Unknown^DCS
"DATA",52.45,139,1,0)
^^1^1^3170427
"DATA",52.45,139,1,1,0)
The coverage status code is not discernible.
"DATA",52.45,140,0)
ST^Step Therapy Required^DCS
"DATA",52.45,140,1,0)
^^2^2^3170427
"DATA",52.45,140,1,1,0)
The plan formulary requires that medication in a specific drug class be tried
"DATA",52.45,140,1,2,0)
prior to the requested medication.
"DATA",52.45,141,0)
SI^Signed Prescriptio^DCS
"DATA",52.45,141,1,0)
^^2^2^3170427
"DATA",52.45,141,1,1,0)
This indicates the prescription has been signed according to the DEA requirements
"DATA",52.45,141,1,2,0)
for electronic prescribing of controlled substances.
"DATA",52.45,142,0)
CP^Compund^DCS
"DATA",52.45,142,1,0)
^^1^1^3170427
"DATA",52.45,142,1,1,0)
Compound as per Change Healthcare
"DATA",52.45,143,0)
SP^Supplies^DCS
"DATA",52.45,143,1,0)
^^1^1^3170427
"DATA",52.45,143,1,1,0)
Supplies as per Change Healthcare
"DATA",52.45,144,0)
01^UPC^CAQ
"DATA",52.45,144,1,0)
^^1^1^3170427
"DATA",52.45,144,1,1,0)
Universal Product Code (UPC)
"DATA",52.45,145,0)
02^HRI^CAQ
"DATA",52.45,145,1,0)
^^1^1^3170427
"DATA",52.45,145,1,1,0)
Health Related Item (HRI)
"DATA",52.45,146,0)
03^NDC^CAQ
"DATA",52.45,146,1,0)
^^1^1^3170427
"DATA",52.45,146,1,1,0)
National Drug Code (NDC)
"DATA",52.45,147,0)
04^HIBCC^CAQ
"DATA",52.45,147,1,0)
^^1^1^3170427
"DATA",52.45,147,1,1,0)
Health Industry Business Communications Council (HIBCC)
"DATA",52.45,148,0)
06^DUR/PPS^CAQ
"DATA",52.45,148,1,0)
^^1^1^3170427
"DATA",52.45,148,1,1,0)
Drug Use Review/Professional Pharmacy Service (DUR/PPS)
"DATA",52.45,149,0)
07^CPT4^CAQ
"DATA",52.45,149,1,0)
^^1^1^3170427
"DATA",52.45,149,1,1,0)
Common Procedure Terminology (CPT4)
"DATA",52.45,150,0)
08^CPT5^CAQ
"DATA",52.45,150,1,0)
^^1^1^3170427
"DATA",52.45,150,1,1,0)
Common Procidure Terminology (CPT5)
"DATA",52.45,151,0)
09^HCPCS^CAQ
"DATA",52.45,151,1,0)
^^1^1^3170427
"DATA",52.45,151,1,1,0)
Health Care Financing Administration Common Procedural Coding System (HCPCS)
"DATA",52.45,152,0)
10^PPAC^CAQ
"DATA",52.45,152,1,0)
^^1^1^3170427
"DATA",52.45,152,1,1,0)
Pharmacy Practice Activity Classification (PPAC)
"DATA",52.45,153,0)
11^NAPPI^CAQ
"DATA",52.45,153,1,0)
^^1^1^3170427
"DATA",52.45,153,1,1,0)
National Pharmaceutical Product Interface Code (NAPPI)
"DATA",52.45,154,0)
12^GTIN^CAQ
"DATA",52.45,154,1,0)
^^1^1^3170427
"DATA",52.45,154,1,1,0)
Global Trade Identification Number (GTIN)
"DATA",52.45,155,0)
14^GPI^CAQ
"DATA",52.45,155,1,0)
^^1^1^3170427
"DATA",52.45,155,1,1,0)
Medi-span Product Line Generic Product Identifier (GPI)
"DATA",52.45,156,0)
15^GCN^CAQ
"DATA",52.45,156,1,0)
^^1^1^3170427
"DATA",52.45,156,1,1,0)
First DataBank Formulation ID (GCN)
"DATA",52.45,157,0)
16^GFC^CAQ
"DATA",52.45,157,1,0)
^^1^1^3170427
"DATA",52.45,157,1,1,0)
Micromedex/Medical Economics Generic Formulation Code (GFC)
"DATA",52.45,158,0)
17^DDID^CAQ
"DATA",52.45,158,1,0)
^^1^1^3170427
"DATA",52.45,158,1,1,0)
Medi-Span Product Line Drug Descriptor ID (DDID)
"DATA",52.45,159,0)
18^First DataBank SmartKey^CAQ
"DATA",52.45,159,1,0)
^^1^1^3170427
"DATA",52.45,159,1,1,0)
First DataBank SmartKey
"DATA",52.45,160,0)
19^GM^CAQ
"DATA",52.45,160,1,0)
^^1^1^3170427
"DATA",52.45,160,1,1,0)
Micromedex/Medical Economics Generic Master (GM)
"DATA",52.45,161,0)
20^ICD9^CAQ
"DATA",52.45,161,1,0)
^^1^1^3170427
"DATA",52.45,161,1,1,0)
International Classification of Diseases (ICD9)
"DATA",52.45,162,0)
21^ICD-10-CM^CAQ
"DATA",52.45,162,1,0)
^^1^1^3170427
"DATA",52.45,162,1,1,0)
International Classification of Diseases-1Ø-Clinical Modifications (ICD-1Ø-CM)
"DATA",52.45,163,0)
22^Medi-Span Product Line Diagnosis Code^CAQ
"DATA",52.45,163,1,0)
^^1^1^3170427
"DATA",52.45,163,1,1,0)
Medi-Span Product Line Diagnosis Code
"DATA",52.45,164,0)
23^NCCI^CAQ
"DATA",52.45,164,1,0)
^^1^1^3170427
"DATA",52.45,164,1,1,0)
National Criteria Care Institute (NCCI)
"DATA",52.45,165,0)
24^SNOMED^CAQ
"DATA",52.45,165,1,0)
^^1^1^3170427
"DATA",52.45,165,1,1,0)
The Systematized Nomenclature of Human and Veterinary Medicine (SNOMED)
"DATA",52.45,166,0)
25^CDT^CAQ
"DATA",52.45,166,1,0)
^^1^1^3170427
"DATA",52.45,166,1,1,0)
Common Dental Terminology (CDT)
"DATA",52.45,167,0)
26^DSM IV^CAQ
"DATA",52.45,167,1,0)
^^2^2^3170427
"DATA",52.45,167,1,1,0)
American Psychiatric Association Diagnostic Statistical Manual of Mental
"DATA",52.45,167,1,2,0)
Disorders (DSM IV)
"DATA",52.45,168,0)
27^ICD-10-PCS^CAQ
"DATA",52.45,168,1,0)
^^1^1^3170427
"DATA",52.45,168,1,1,0)
International Classification of Diseases-1Ø-Procedure Coding System (ICD-1Ø-PCS)
"DATA",52.45,169,0)
28^FDB Med Name ID^CAQ
"DATA",52.45,169,1,0)
^^1^1^3170427
"DATA",52.45,169,1,1,0)
First DataBank Medication Name ID (FDB Med Name ID)
"DATA",52.45,170,0)
29^FDB Routed Med ID^CAQ
"DATA",52.45,170,1,0)
^^1^1^3170427
"DATA",52.45,170,1,1,0)
First DataBank Routed Medication ID (FDB Routed Med ID)
"DATA",52.45,171,0)
30^FDB Routed Dosage Form Med ID^CAQ
"DATA",52.45,171,1,0)
^^1^1^3170427
"DATA",52.45,171,1,1,0)
First DataBank Routed Dosage Form ID (FDB Routed Dosage Form Med ID)
"DATA",52.45,172,0)
31^FDB MedID^CAQ
"DATA",52.45,172,1,0)
^^1^1^3170427
"DATA",52.45,172,1,1,0)
First DataBank Medication ID (FDB MedID)
"DATA",52.45,173,0)
32^GCN_SEQ_NO^CAQ
"DATA",52.45,173,1,0)
^^1^1^3170427
"DATA",52.45,173,1,1,0)
First DataBank Clinical Formulation ID Sequence Number (GCN_SEQ_NO)
"DATA",52.45,174,0)
33^HICL_SEQ_NO^CAQ
"DATA",52.45,174,1,0)
^^1^1^3170427
"DATA",52.45,174,1,1,0)
First DataBank Ingredient List ID (HICL_SEQ_NO)
"DATA",52.45,175,0)
34^UPN^CAQ
"DATA",52.45,175,1,0)
^^1^1^3170427
"DATA",52.45,175,1,1,0)
Universal Product Number (UPN)
"DATA",52.45,176,0)
35^LOINC^CAQ
"DATA",52.45,176,1,0)
^^1^1^3170427
"DATA",52.45,176,1,1,0)
Logical Observation Identifier Names and Codes (LOINC)
"DATA",52.45,177,0)
36^NDC^CAQ
"DATA",52.45,177,1,0)
^^1^1^3170427
"DATA",52.45,177,1,1,0)
Representative National Drug Code (NDC)
"DATA",52.45,178,0)
37^AHFS^CAQ
"DATA",52.45,178,1,0)
^^1^1^3170427
"DATA",52.45,178,1,1,0)
American Hospital Formulary Service (AHFS)
"DATA",52.45,179,0)
38^SCD^CAQ
"DATA",52.45,179,1,0)
^^1^1^3170427
"DATA",52.45,179,1,1,0)
RxNorm Semantic Clinical Drug (SCD)
"DATA",52.45,180,0)
39^SBD^CAQ
"DATA",52.45,180,1,0)
^^1^1^3170427
"DATA",52.45,180,1,1,0)
Semantic Branded Drug (SBD)
"DATA",52.45,181,0)
40^GPCK^CAQ
"DATA",52.45,181,1,0)
^^1^1^3170427
"DATA",52.45,181,1,1,0)
RxNorm Generic Package (GPCK)
"DATA",52.45,182,0)
41^BPCK^CAQ
"DATA",52.45,182,1,0)
^^1^1^3170427
"DATA",52.45,182,1,1,0)
RxNorm Branded Package (BPCK)
"DATA",52.45,183,0)
99^Other^CAQ
"DATA",52.45,183,1,0)
^^1^1^3170427
"DATA",52.45,183,1,1,0)
Other
"DATA",52.45,184,0)
G1^Prior Authorization^PAV
"DATA",52.45,185,0)
PD^Promotion Number (Sample RX)^PAV
"DATA",52.45,186,0)
D3^NCPDP Provider ID Number^PAV
"DATA",52.45,187,0)
94^Pharmacy or Prescriber File ID^PAV
"DATA",52.45,188,0)
0B^State License Number^PAV
"DATA",52.45,189,0)
1C^Medicare Number^PAV
"DATA",52.45,190,0)
1D^Medicaid Number^PAV
"DATA",52.45,191,0)
1E^Dentist License Number^PAV
"DATA",52.45,192,0)
1G^UPIN^PAV
"DATA",52.45,193,0)
1M^PPO Number^PAV
"DATA",52.45,194,0)
2U^Payer Identification Number^PAV
"DATA",52.45,195,0)
BO^BIN Location Number^PAV
"DATA",52.45,196,0)
DH^DEA Number^PAV
"DATA",52.45,197,0)
HI^HIN^PAV
"DATA",52.45,198,0)
NC^Secondary Coverage Company Number^PAV
"DATA",52.45,199,0)
NF^National Association of Insurance Commissioner's Code^PAV
"DATA",52.45,200,0)
SY^Social Security Number^PAV
"DATA",52.45,201,0)
HPI^National Provider ID^PAV
"DATA",52.45,202,0)
ZZ^Mutually Defined^PAV
"DATA",52.45,203,0)
PTT01^Patient not eligible^REJ
"DATA",52.45,204,0)
PTT02^Cannot resolve Patient^REJ
"DATA",52.45,205,0)
PVD01^Provider not eligible^REJ
"DATA",52.45,206,0)
PVD02^Cannot resolve Provider^REJ
"DATA",52.45,207,0)
DRU01^Not eligible for refills^REJ
"DATA",52.45,208,0)
DRU02^Non-formulary drug/Non-formulary drug^REJ
"DATA",52.45,209,0)
DRU03^Duplicate Prescription found for this Patient^REJ
"DATA",52.45,210,0)
DRU04^Invalid Quantity^REJ
"DATA",52.45,211,0)
DRU05^Duplicate therapeutic class^REJ
"DATA",52.45,212,0)
DRU06^Controlled Substances are disallowed^REJ
"DATA",52.45,213,0)
ERR01^Multiple errors, please contact the Pharmacy ^REJ
"DATA",52.45,214,0)
ERR02^Incorrect Pharmacy^REJ
"DATA",52.45,215,0)
ERR03^Issues with prescription, please contact the pharmacy^REJ
"DATA",52.45,216,0)
REM01^Drug out of stock or on backorder and unavailable for processing^REM
"DATA",52.45,217,0)
REM02^Patient was not able to pick up^REM
"DATA",52.45,218,0)
REM03^Prescription canceled by Provider^REM
"DATA",52.45,219,0)
REM04^Prescription processed manually^REM
"DATA",52.45,220,0)
REM05^Provider will cancel this eRx and submit another^REM
"DATA",52.45,221,0)
REM06^Unable to mail prescription and patient unable to pick up^REM
"DATA",52.45,222,0)
REM07^Unable to contact patient^REM
"DATA",52.45,223,0)
REM08^Unable to contact provider^REM
"DATA",52.45,224,0)
REM91^Undefined system error^REM
"DATA",52.45,225,0)
REM92^Other^REM
"DATA",52.45,226,0)
E^Truven/Micromedex Generic Formulation Code (GFC)^DDB
"DATA",52.45,227,0)
G^Truven/Micromedex Generic Master (GM)^DDB
"DATA",52.45,228,0)
AF^American Hospital Formulary Service (AHFS)^DDB
"DATA",52.45,229,0)
FD^First DataBank Routed Dosage Form ID (FDB Routed Dosage Form Med ID)^DDB
"DATA",52.45,230,0)
FG^First DataBank Clinical Formulation ID Sequence Number (GCN_SEQNO)^DDB
"DATA",52.45,231,0)
FI^First DataBank Medication ID (FDB MedID)^DDB
"DATA",52.45,232,0)
FL^First DataBank Ingredient List ID (HICL_SEQNO)^DDB
"DATA",52.45,233,0)
FM^First DataBank Medication ID (FDB MedID)^DDB
"DATA",52.45,234,0)
FN^First DataBank Medication Name ID (FDB Med Name ID)^DDB
"DATA",52.45,235,0)
FS^First Databank Smartkey^DDB
"DATA",52.45,236,0)
MC^Multum Drug ID^DDB
"DATA",52.45,237,0)
MD^Medi Span's Drug Descriptor ID (DDID)^DDB
"DATA",52.45,238,0)
MG^Medi-Span's Generic Product Identifier (GPI)^DDB
"DATA",52.45,239,0)
MM^Multum MMDC^DDB
"DATA",52.45,240,0)
BPK^RxNorm Branded Package (BPCK)^DDB
"DATA",52.45,241,0)
GPK^RxNorm Generic Package (GPCK)^DDB
"DATA",52.45,242,0)
SBD^RxNorm Semantic Branded Drug (SBD)^DDB
"DATA",52.45,243,0)
SCD^RxNorm Semantic Clinical Drug (SCD)^DDB
"FIA",50)
DRUG
"FIA",50,0)
^PSDRUG(
"FIA",50,0,0)
50I
"FIA",50,0,1)
y^y^p^^^^n^^n
"FIA",50,0,10)

"FIA",50,0,11)

"FIA",50,0,"RLRO")

"FIA",50,0,"VR")
7.0^PSO
"FIA",50,50)
1
"FIA",50,50,22)

"FIA",52.45)
ERX SERVICE REASON CODES
"FIA",52.45,0)
^PS(52.45,
"FIA",52.45,0,0)
52.45I
"FIA",52.45,0,1)
y^y^f^^n^^y^o^n
"FIA",52.45,0,10)

"FIA",52.45,0,11)

"FIA",52.45,0,"RLRO")

"FIA",52.45,0,"VR")
7.0^PSO
"FIA",52.45,52.45)
0
"FIA",52.45,52.451)
0
"FIA",52.46)
ERX EXTERNAL PATIENT
"FIA",52.46,0)
^PS(52.46,
"FIA",52.46,0,0)
52.46I
"FIA",52.46,0,1)
y^y^f^^^^n
"FIA",52.46,0,10)

"FIA",52.46,0,11)

"FIA",52.46,0,"RLRO")

"FIA",52.46,0,"VR")
7.0^PSO
"FIA",52.46,52.46)
0
"FIA",52.46,52.462)
0
"FIA",52.46,52.465)
0
"FIA",52.47)
ERX EXTERNAL PHARMACY
"FIA",52.47,0)
^PS(52.47,
"FIA",52.47,0,0)
52.47
"FIA",52.47,0,1)
y^y^f^^^^n
"FIA",52.47,0,10)

"FIA",52.47,0,11)

"FIA",52.47,0,"RLRO")

"FIA",52.47,0,"VR")
7.0^PSO
"FIA",52.47,52.47)
0
"FIA",52.47,52.472)
0
"FIA",52.47,52.473)
0
"FIA",52.48)
ERX EXTERNAL PERSON
"FIA",52.48,0)
^PS(52.48,
"FIA",52.48,0,0)
52.48I
"FIA",52.48,0,1)
y^y^f^^^^n
"FIA",52.48,0,10)

"FIA",52.48,0,11)

"FIA",52.48,0,"RLRO")

"FIA",52.48,0,"VR")
7.0^PSO
"FIA",52.48,52.48)
0
"FIA",52.48,52.483)
0
"FIA",52.48,52.486)
0
"FIA",52.49)
ERX HOLDING QUEUE
"FIA",52.49,0)
^PS(52.49,
"FIA",52.49,0,0)
52.49
"FIA",52.49,0,1)
y^y^f^^^^n
"FIA",52.49,0,10)

"FIA",52.49,0,11)

"FIA",52.49,0,"RLRO")

"FIA",52.49,0,"VR")
7.0^PSO
"FIA",52.49,52.49)
0
"FIA",52.49,52.49101)
0
"FIA",52.49,52.4911)
0
"FIA",52.49,52.4912)
0
"FIA",52.49,52.49122)
0
"FIA",52.49,52.4914)
0
"FIA",52.49,52.4916)
0
"FIA",52.49,52.4918)
0
"FIA",52.49,52.49186)
0
"FIA",52.49,52.4919)
0
"FIA",52.49,52.4921)
0
"FIA",52.49,52.4926)
0
"FIA",52.49,52.4928)
0
"FIA",52.49,52.4931)
0
"FIA",52.49,52.499)
0
"FIA",59)
OUTPATIENT SITE
"FIA",59,0)
^PS(59,
"FIA",59,0,0)
59I
"FIA",59,0,1)
y^y^p^^^^n^^n
"FIA",59,0,10)

"FIA",59,0,11)

"FIA",59,0,"RLRO")

"FIA",59,0,"VR")
7.0^PSO
"FIA",59,59)
1
"FIA",59,59,10)

"INI")
PSO467PI
"INIT")
PSO467PO
"IX",52.45,52.45,"C",0)
52.45^C^Index of the code type and the code identifier.^R^^R^IR^I^52.45^^^^^LS
"IX",52.45,52.45,"C",.1,0)
^^3^3^3161207^
"IX",52.45,52.45,"C",.1,1,0)
This index creates a relationship between the code type and the codes 
"IX",52.45,52.45,"C",.1,2,0)
associated with that type. This will be used to screen the codes when 
"IX",52.45,52.45,"C",.1,3,0)
choosing or looking for a code type.
"IX",52.45,52.45,"C",1)
S ^PS(52.45,"C",X(1),$E(X(2),1,30),DA)=""
"IX",52.45,52.45,"C",2)
K ^PS(52.45,"C",X(1),$E(X(2),1,30),DA)
"IX",52.45,52.45,"C",2.5)
K ^PS(52.45,"C")
"IX",52.45,52.45,"C",11.1,0)
^.114IA^2^2
"IX",52.45,52.45,"C",11.1,1,0)
1^F^52.45^.03^^1^F
"IX",52.45,52.45,"C",11.1,1,3)

"IX",52.45,52.45,"C",11.1,2,0)
2^F^52.45^.01^30^2^F
"IX",52.45,52.45,"C",11.1,2,3)

"IX",52.46,52.46,"BN",0)
52.46^BN^Full patient name index^R^^F^IR^I^52.46^^^^^LS
"IX",52.46,52.46,"BN",.1,0)
^^1^1^3170711^
"IX",52.46,52.46,"BN",.1,1,0)
This indexes the full patient name as received for an eRx prescription.
"IX",52.46,52.46,"BN",1)
S ^PS(52.46,"BN",$E(X,1,135),DA)=""
"IX",52.46,52.46,"BN",2)
K ^PS(52.46,"BN",$E(X,1,135),DA)
"IX",52.46,52.46,"BN",2.5)
K ^PS(52.46,"BN")
"IX",52.46,52.46,"BN",11.1,0)
^.114IA^1^1
"IX",52.46,52.46,"BN",11.1,1,0)
1^F^52.46^.01^135^1^F
"IX",52.46,52.46,"BN",11.1,1,3)

"IX",52.47,52.47,"B",0)
52.47^B^Index on full external pharmacy name.^R^^F^IR^I^52.47^^^^^LS
"IX",52.47,52.47,"B",.1,0)
^^2^2^3170814^
"IX",52.47,52.47,"B",.1,1,0)
Since the external pharmacy can be 35 characters, this cross reference is 
"IX",52.47,52.47,"B",.1,2,0)
created to index the full name.
"IX",52.47,52.47,"B",1)
S ^PS(52.47,"B",$E(X,1,35),DA)=""
"IX",52.47,52.47,"B",2)
K ^PS(52.47,"B",$E(X,1,35),DA)
"IX",52.47,52.47,"B",2.5)
K ^PS(52.47,"B")
"IX",52.47,52.47,"B",11.1,0)
^.114IA^1^1
"IX",52.47,52.47,"B",11.1,1,0)
1^F^52.47^.01^35^1^F
"IX",52.48,52.48,"BN",0)
52.48^BN^Index on full patient name.^R^^F^IR^I^52.48^^^^^LS
"IX",52.48,52.48,"BN",.1,0)
^^1^1^3170706^
"IX",52.48,52.48,"BN",.1,1,0)
This index provides an index on the full name of the eRx external person.
"IX",52.48,52.48,"BN",1)
S ^PS(52.48,"BN",$E(X,1,125),DA)=""
"IX",52.48,52.48,"BN",2)
K ^PS(52.48,"BN",$E(X,1,125),DA)
"IX",52.48,52.48,"BN",2.5)
K ^PS(52.48,"BN")
"IX",52.48,52.48,"BN",11.1,0)
^.114IA^1^1
"IX",52.48,52.48,"BN",11.1,1,0)
1^F^52.48^.01^125^1^F
"IX",52.48,52.48,"BN",11.1,1,3)

"IX",52.49,52.49,"E",0)
52.49^E^Indexes the institution and eRx status^R^^R^IR^I^52.49^^^^^LS
"IX",52.49,52.49,"E",.1,0)
^^3^3^3170626^
"IX",52.49,52.49,"E",.1,1,0)
This index groups the eRx entries by institution and status. This allows 
"IX",52.49,52.49,"E",.1,2,0)
the Finish Orders From eRx option to quickly find the eRx entries 
"IX",52.49,52.49,"E",.1,3,0)
associated with the users DUZ(2).
"IX",52.49,52.49,"E",1)
S ^PS(52.49,"E",X(1),X(2),X(3),DA)=""
"IX",52.49,52.49,"E",2)
K ^PS(52.49,"E",X(1),X(2),X(3),DA)
"IX",52.49,52.49,"E",2.5)
K ^PS(52.49,"E")
"IX",52.49,52.49,"E",11.1,0)
^.114IA^3^3
"IX",52.49,52.49,"E",11.1,1,0)
1^F^52.49^24.1^^1^F
"IX",52.49,52.49,"E",11.1,2,0)
2^F^52.49^1^^2^F
"IX",52.49,52.49,"E",11.1,3,0)
3^F^52.49^.03^^3^F
"IX",52.49,52.49,"F",0)
52.49^F^Index by institution, date/time, and order status^R^^R^IR^I^52.49^^^^^LS
"IX",52.49,52.49,"F",.1,0)
^^2^2^3170726^
"IX",52.49,52.49,"F",.1,1,0)
This provides an index by related institution, message date/time, and erx 
"IX",52.49,52.49,"F",.1,2,0)
order status.
"IX",52.49,52.49,"F",1)
S ^PS(52.49,"F",X(1),X(2),X(3),DA)=""
"IX",52.49,52.49,"F",2)
K ^PS(52.49,"F",X(1),X(2),X(3),DA)
"IX",52.49,52.49,"F",2.5)
K ^PS(52.49,"F")
"IX",52.49,52.49,"F",11.1,0)
^.114IA^3^3
"IX",52.49,52.49,"F",11.1,1,0)
1^F^52.49^24.1^^1^F
"IX",52.49,52.49,"F",11.1,1,3)

"IX",52.49,52.49,"F",11.1,2,0)
2^F^52.49^.03^^2^F
"IX",52.49,52.49,"F",11.1,2,3)

"IX",52.49,52.49,"F",11.1,3,0)
3^F^52.49^1^^3^F
"IX",52.49,52.49,"F",11.1,3,3)

"IX",52.49,52.49,"FMID",0)
52.49^FMID^This indexes the full message ID.^R^^F^IR^I^52.49^^^^^LS
"IX",52.49,52.49,"FMID",.1,0)
^^2^2^3170711^
"IX",52.49,52.49,"FMID",.1,1,0)
This index provides access to the full message ID as received from the 
"IX",52.49,52.49,"FMID",.1,2,0)
eRx processing hub.
"IX",52.49,52.49,"FMID",1)
S ^PS(52.49,"FMID",$E(X,1,50),DA)=""
"IX",52.49,52.49,"FMID",2)
K ^PS(52.49,"FMID",$E(X,1,50),DA)
"IX",52.49,52.49,"FMID",2.5)
K ^PS(52.49,"FMID")
"IX",52.49,52.49,"FMID",11.1,0)
^.114IA^1^1
"IX",52.49,52.49,"FMID",11.1,1,0)
1^F^52.49^.01^50^1^F
"IX",52.49,52.49,"FMID",11.1,1,3)

"IX",52.49,52.49,"PAT",0)
52.49^PAT^Patient and Date Time index^R^^R^IR^I^52.49^^^^^LS
"IX",52.49,52.49,"PAT",.1,0)
^^2^2^3170610^
"IX",52.49,52.49,"PAT",.1,1,0)
This index provides a quick reference to patient, date, and site. Used 
"IX",52.49,52.49,"PAT",.1,2,0)
for bulk validation.
"IX",52.49,52.49,"PAT",1)
S ^PS(52.49,"PAT",X(1),X(2),X(3),X(4),DA)=""
"IX",52.49,52.49,"PAT",2)
K ^PS(52.49,"PAT",X(1),X(2),X(3),X(4),DA)
"IX",52.49,52.49,"PAT",2.5)
K ^PS(52.49,"PAT")
"IX",52.49,52.49,"PAT",11.1,0)
^.114IA^4^4
"IX",52.49,52.49,"PAT",11.1,1,0)
1^F^52.49^24.1^^1^F
"IX",52.49,52.49,"PAT",11.1,1,3)

"IX",52.49,52.49,"PAT",11.1,2,0)
2^F^52.49^1^^2^F
"IX",52.49,52.49,"PAT",11.1,2,3)

"IX",52.49,52.49,"PAT",11.1,3,0)
3^F^52.49^.04^^3^F
"IX",52.49,52.49,"PAT",11.1,3,3)

"IX",52.49,52.49,"PAT",11.1,4,0)
4^F^52.49^.03^^4^F
"IX",52.49,52.49,"PAT",11.1,4,3)

"KRN",19,248,-1)
3^4
"KRN",19,248,0)
PSO RX^Rx (Prescriptions)^^M^^^^^^^^OUTPATIENT PHARMACY^^1^
"KRN",19,248,1,0)
^19.06^1^1^3060322^^^^
"KRN",19,248,1,1,0)
This menu gives access to all prescription functions.
"KRN",19,248,10,0)
^19.01IP^25^25
"KRN",19,248,10,24,0)
14309^FERX
"KRN",19,248,10,24,"^")
PSO ERX FINISH
"KRN",19,248,10,"A6359",1)
New Prescription Entry^449^^
"KRN",19,248,10,"A6359",2)
Refill Prescriptions^459^^
"KRN",19,248,10,"A6359",3)
Edit Prescriptions^469^^
"KRN",19,248,10,"A6359",4)
Reprint An Outpatient Label^470^^
"KRN",19,248,10,"A6359",5)
View Prescriptions^475^^
"KRN",19,248,10,"A6359",6)
Cancel Prescription^476^^
"KRN",19,248,10,"A6359",7)
Hold/Remove from Hold^479^^
"KRN",19,248,10,"A6359",8)
Partial Prescription^478^^
"KRN",19,248,15)

"KRN",19,248,20)
D ^PSOLSET:'$D(PSOPAR) D CHK^PSOORFIN
"KRN",19,248,99)
64447,43263
"KRN",19,248,99.1)
60633,14411
"KRN",19,248,"U")
RX (PRESCRIPTIONS)
"KRN",19,14307,-1)
0^1
"KRN",19,14307,0)
PSO WEB SERVICES OPTION^Inbound eRx Web Services Option^^B^^^^^^^^
"KRN",19,14307,1,0)
^^2^2^3160818^
"KRN",19,14307,1,1,0)
This option is required by the Kernel Broker to give access to the RPC's 
"KRN",19,14307,1,2,0)
used by the Inbound eRx team.
"KRN",19,14307,99.1)
64148,38450
"KRN",19,14307,"RPC",0)
^19.05P^4^3
"KRN",19,14307,"RPC",1,0)
PSOERXA0 DRGMTCH
"KRN",19,14307,"RPC",3,0)
PSOERXA0 PRVMTCH
"KRN",19,14307,"RPC",4,0)
PSOERXA1 INCERX
"KRN",19,14307,"U")
INBOUND ERX WEB SERVICES OPTIO
"KRN",19,14309,-1)
0^3
"KRN",19,14309,0)
PSO ERX FINISH^Complete Orders from eRx^^A^^^^^^^^OUTPATIENT PHARMACY^^1^
"KRN",19,14309,1,0)
^19.06^1^1^3170511^^
"KRN",19,14309,1,1,0)
This menu option allows users to complete incoming eRx prescriptions.
"KRN",19,14309,15)

"KRN",19,14309,20)
D EN^PSOERX
"KRN",19,14309,"U")
COMPLETE ORDERS FROM ERX
"KRN",19.1,711,-1)
0^2
"KRN",19.1,711,0)
PSO ERX TECH^eRx Technician
"KRN",19.1,711,1,0)
^19.11^3^3^3171017^^
"KRN",19.1,711,1,1,0)
This key was introduced by patch PSO*7*467 for the Inbound eRx Holding 
"KRN",19.1,711,1,2,0)
Queue functionality. The key allows users to Validate 
"KRN",19.1,711,1,3,0)
Patient/Provider/Drug/SIG, Hold/Un Hold, Search, Sort, and Print.   
"KRN",19.1,712,-1)
0^1
"KRN",19.1,712,0)
PSO ERX ADV TECH^eRx Advanced Technician
"KRN",19.1,712,1,0)
^19.11^4^4^3171017^^
"KRN",19.1,712,1,1,0)
This key was introduced by patch PSO*7*467 for the Inbound eRx Holding 
"KRN",19.1,712,1,2,0)
Queue. The key allows users to Validate Patient/Provider/Drug/SIG, Accept 
"KRN",19.1,712,1,3,0)
Patient/Provider/Drug Validations, Reject, Hold/Un Hold, Search, Sort, 
"KRN",19.1,712,1,4,0)
Remove/UnRemove, and Print.
"KRN",19.1,713,-1)
0^3
"KRN",19.1,713,0)
PSO ERX VIEW^View only access to eRx.
"KRN",19.1,713,1,0)
^19.11^3^3^3171017^^
"KRN",19.1,713,1,1,0)
This key was introduced by patch PSO*7*467 for the Inbound eRx Holding 
"KRN",19.1,713,1,2,0)
Queue functionality. The key allows users to Search, Sort, and View an 
"KRN",19.1,713,1,3,0)
eRx only.
"KRN",101,1803,-1)
4^22
"KRN",101,1803,0)
VALM NEXT SCREEN
"KRN",101,1804,-1)
4^23
"KRN",101,1804,0)
VALM PREVIOUS SCREEN
"KRN",101,1805,-1)
4^26
"KRN",101,1805,0)
VALM REFRESH
"KRN",101,1806,-1)
4^34
"KRN",101,1806,0)
VALM LAST SCREEN
"KRN",101,1807,-1)
4^35
"KRN",101,1807,0)
VALM FIRST SCREEN
"KRN",101,1808,-1)
4^24
"KRN",101,1808,0)
VALM UP ONE LINE
"KRN",101,1809,-1)
4^25
"KRN",101,1809,0)
VALM DOWN A LINE
"KRN",101,1811,-1)
4^33
"KRN",101,1811,0)
VALM QUIT
"KRN",101,1812,-1)
4^27
"KRN",101,1812,0)
VALM PRINT SCREEN
"KRN",101,1813,-1)
4^28
"KRN",101,1813,0)
VALM PRINT LIST
"KRN",101,1815,-1)
4^31
"KRN",101,1815,0)
VALM TURN ON/OFF MENUS
"KRN",101,1817,-1)
4^32
"KRN",101,1817,0)
VALM SEARCH LIST
"KRN",101,1824,-1)
4^29
"KRN",101,1824,0)
VALM RIGHT
"KRN",101,1825,-1)
4^30
"KRN",101,1825,0)
VALM LEFT
"KRN",101,1827,-1)
4^36
"KRN",101,1827,0)
VALM GOTO PAGE
"KRN",101,3816,-1)
3^37
"KRN",101,3816,0)
PSO HIDDEN ACTIONS^Outpatient Pharmacy Hidden Actions^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3816,1,0)
^101.06^1^1^3001004^^^^
"KRN",101,3816,1,1,0)
This hidden menu is attached to the the active order list.
"KRN",101,3816,4)
26
"KRN",101,3816,10,0)
^101.01PA^37^37
"KRN",101,3816,10,1,0)
1803^+^^
"KRN",101,3816,10,1,"^")
VALM NEXT SCREEN
"KRN",101,3816,10,2,0)
1804^-^^
"KRN",101,3816,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,3816,10,3,0)
1808^UP^^
"KRN",101,3816,10,3,"^")
VALM UP ONE LINE
"KRN",101,3816,10,4,0)
1809^DN^^
"KRN",101,3816,10,4,"^")
VALM DOWN A LINE
"KRN",101,3816,10,5,0)
1805^RD^^
"KRN",101,3816,10,5,"^")
VALM REFRESH
"KRN",101,3816,10,6,0)
1812^PS^^
"KRN",101,3816,10,6,"^")
VALM PRINT SCREEN
"KRN",101,3816,10,7,0)
1813^PT^^
"KRN",101,3816,10,7,"^")
VALM PRINT LIST
"KRN",101,3816,10,8,0)
1824^>^^
"KRN",101,3816,10,8,"^")
VALM RIGHT
"KRN",101,3816,10,9,0)
1825^<^^
"KRN",101,3816,10,9,"^")
VALM LEFT
"KRN",101,3816,10,10,0)
1817^SL^^
"KRN",101,3816,10,10,"^")
VALM SEARCH LIST
"KRN",101,3816,10,11,0)
1811^QU^^
"KRN",101,3816,10,11,1)
^
"KRN",101,3816,10,11,"^")
VALM QUIT
"KRN",101,3816,10,12,0)
1806^LS^^
"KRN",101,3816,10,12,"^")
VALM LAST SCREEN
"KRN",101,3816,10,13,0)
1807^FS^^
"KRN",101,3816,10,13,"^")
VALM FIRST SCREEN
"KRN",101,3816,10,14,0)
1827^GO^^
"KRN",101,3816,10,14,"^")
VALM GOTO PAGE
"KRN",101,3816,10,30,0)
1815^ADPL^^
"KRN",101,3816,10,30,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3816,10,37,0)
6220^EP^67^
"KRN",101,3816,10,37,"^")
PSO ERX OP PRINT
"KRN",101,3816,24)
I $$ACTIONS^PSOLMUTL
"KRN",101,3816,99)
64453,39218
"KRN",101,3832,-1)
3^38
"KRN",101,3832,0)
PSO HIDDEN ACTIONS #3^Outpatient Pharmacy Hidden Actions #3^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,3832,1,0)
^^1^1^3001004^
"KRN",101,3832,1,1,0)
This hidden action is attached to the finish orders from CPRS screen.
"KRN",101,3832,4)
26^2
"KRN",101,3832,10,0)
^101.01PA^24^24
"KRN",101,3832,10,2,0)
1803^+^^
"KRN",101,3832,10,2,"^")
VALM NEXT SCREEN
"KRN",101,3832,10,3,0)
1804^-^^
"KRN",101,3832,10,3,"^")
VALM PREVIOUS SCREEN
"KRN",101,3832,10,4,0)
1808^UP^^
"KRN",101,3832,10,4,"^")
VALM UP ONE LINE
"KRN",101,3832,10,5,0)
1809^DN^^
"KRN",101,3832,10,5,"^")
VALM DOWN A LINE
"KRN",101,3832,10,6,0)
1805^RD^^
"KRN",101,3832,10,6,"^")
VALM REFRESH
"KRN",101,3832,10,7,0)
1813^PT^^
"KRN",101,3832,10,7,"^")
VALM PRINT LIST
"KRN",101,3832,10,8,0)
1812^PS^^
"KRN",101,3832,10,8,"^")
VALM PRINT SCREEN
"KRN",101,3832,10,9,0)
1824^>^^
"KRN",101,3832,10,9,"^")
VALM RIGHT
"KRN",101,3832,10,10,0)
1825^<^^
"KRN",101,3832,10,10,"^")
VALM LEFT
"KRN",101,3832,10,11,0)
1817^SL^^
"KRN",101,3832,10,11,"^")
VALM SEARCH LIST
"KRN",101,3832,10,12,0)
1811^QT^^
"KRN",101,3832,10,12,"^")
VALM QUIT
"KRN",101,3832,10,13,0)
1806^LS^^
"KRN",101,3832,10,13,"^")
VALM LAST SCREEN
"KRN",101,3832,10,14,0)
1807^FS^^
"KRN",101,3832,10,14,"^")
VALM FIRST SCREEN
"KRN",101,3832,10,15,0)
1827^GO^^
"KRN",101,3832,10,15,"^")
VALM GOTO PAGE
"KRN",101,3832,10,21,0)
1815^ADPL^^
"KRN",101,3832,10,21,"^")
VALM TURN ON/OFF MENUS
"KRN",101,3832,10,24,0)
6220^EP^14^
"KRN",101,3832,10,24,"^")
PSO ERX OP PRINT
"KRN",101,3832,99)
64454,46638
"KRN",101,6189,-1)
0^10
"KRN",101,6189,0)
PSO ERX HQ MENU^ERX QUEUE MENU^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6189,1,0)
^101.06^1^1^3170422^^^
"KRN",101,6189,1,1,0)
This is the eRx holding queue menu.
"KRN",101,6189,10,0)
^101.01PA^3^3
"KRN",101,6189,10,1,0)
6190^SI^1^
"KRN",101,6189,10,1,"^")
PSO ERX HQ SELECT
"KRN",101,6189,10,2,0)
6193^SR^2^
"KRN",101,6189,10,2,"^")
PSO ERX HQ SEARCH
"KRN",101,6189,10,3,0)
6194^SO^3^
"KRN",101,6189,10,3,"^")
PSO ERX HQ SORT
"KRN",101,6189,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"""^""",1),24)) ^(24)
"KRN",101,6189,26)
D SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","PSO ERX SELECT BY NUMBER",0))_"^1:"_VALMCNT
"KRN",101,6189,28)
Select Action:
"KRN",101,6189,99)
64252,51791
"KRN",101,6190,-1)
0^4
"KRN",101,6190,0)
PSO ERX HQ SELECT^Select Item^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6190,20)
D SI^PSOERX1A
"KRN",101,6190,99)
64243,56281
"KRN",101,6191,-1)
0^1
"KRN",101,6191,0)
PSO ERX DISPLAY MENU^eRx Display^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6191,4)
26^3
"KRN",101,6191,10,0)
^101.01PA^9^9
"KRN",101,6191,10,1,0)
6192^VP^1^
"KRN",101,6191,10,1,"^")
PSO ERX VALIDATE PATIENT
"KRN",101,6191,10,2,0)
6195^VM^4^
"KRN",101,6191,10,2,"^")
PSO ERX VALIDATE PROVIDER
"KRN",101,6191,10,3,0)
6196^VD^7^
"KRN",101,6191,10,3,"^")
PSO ERX VALIDATE DRUG
"KRN",101,6191,10,4,0)
6198^P^2^
"KRN",101,6191,10,4,"^")
PSO ERX PRINT
"KRN",101,6191,10,5,0)
6199^RJ^5^
"KRN",101,6191,10,5,"^")
PSO ERX REJECT
"KRN",101,6191,10,6,0)
6200^AC^8^
"KRN",101,6191,10,6,"^")
PSO ERX ACCEPT ERX
"KRN",101,6191,10,7,0)
6201^H^3^
"KRN",101,6191,10,7,"^")
PSO ERX HOLD
"KRN",101,6191,10,8,0)
6202^UH^6^
"KRN",101,6191,10,8,"^")
PSO ERX UNHOLD
"KRN",101,6191,10,9,0)
6206^RM^9^
"KRN",101,6191,10,9,"^")
PSO ERX REMOVE
"KRN",101,6191,20)

"KRN",101,6191,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"""^""",1),24)) ^(24)
"KRN",101,6191,26)
D SHOW^VALM W ""
"KRN",101,6191,99)
64426,41054
"KRN",101,6192,-1)
0^15
"KRN",101,6192,0)
PSO ERX VALIDATE PATIENT^VALIDATE PATIENT^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6192,1,0)
^101.06^3^3^3161201^^
"KRN",101,6192,1,1,0)
This protocol hangs off of the PSO ERX HQ DISPLAY PROTOCOL as an action. 
"KRN",101,6192,1,2,0)
This protocol allows the user to manually validate the patient for a 
"KRN",101,6192,1,3,0)
given eRx prescription.
"KRN",101,6192,20)
D PAT^PSOERX1A
"KRN",101,6192,24)
I $$OPACCESS^PSOERXU1("PSO ERX VALIDATE PATIENT",DUZ)
"KRN",101,6192,99)
64268,42503
"KRN",101,6193,-1)
0^2
"KRN",101,6193,0)
PSO ERX HQ SEARCH^Search Queue^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6193,1,0)
^101.06^1^1^3161201^^
"KRN",101,6193,1,1,0)
This protocol allows a user to search the eRx holding queue.
"KRN",101,6193,15)

"KRN",101,6193,20)
D SEARCH^PSOERX
"KRN",101,6193,24)
I '$D(PSOSRCH(VALMEVL))
"KRN",101,6193,99)
64252,43719
"KRN",101,6194,-1)
0^3
"KRN",101,6194,0)
PSO ERX HQ SORT^Sort Entries^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6194,1,0)
^^1^1^3161130^
"KRN",101,6194,1,1,0)
This action protocol allows a user to sort the eRx entries.
"KRN",101,6194,20)
D SORT^PSOERX
"KRN",101,6194,24)
I '$D(PSOSRT(VALMEVL))
"KRN",101,6194,99)
64252,51622
"KRN",101,6195,-1)
0^16
"KRN",101,6195,0)
PSO ERX VALIDATE PROVIDER^VALIDATE PROVIDER^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6195,20)
D PROV^PSOERX1A
"KRN",101,6195,24)
I $$OPACCESS^PSOERXU1("PSO ERX VALIDATE PROVIDER",DUZ)
"KRN",101,6195,99)
64268,42540
"KRN",101,6196,-1)
0^14
"KRN",101,6196,0)
PSO ERX VALIDATE DRUG^VALIDATE DRUG/SIG^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6196,20)
D DRUG^PSOERX1A
"KRN",101,6196,24)
I $$OPACCESS^PSOERXU1("PSO ERX VALIDATE DRUG",DUZ),$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"KRN",101,6196,99)
64426,41047
"KRN",101,6197,-1)
0^17
"KRN",101,6197,0)
PSO ERX VALIDATION MENU^Validation Menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6197,4)
26^3
"KRN",101,6197,10,0)
^101.01PA^6^6
"KRN",101,6197,10,1,0)
6198^P^1^
"KRN",101,6197,10,1,"^")
PSO ERX PRINT
"KRN",101,6197,10,2,0)
6199^RJ^^
"KRN",101,6197,10,2,"^")
PSO ERX REJECT
"KRN",101,6197,10,3,0)
6203^AV^7^
"KRN",101,6197,10,3,"^")
PSO ERX ACCEPT VALIDATION
"KRN",101,6197,10,4,0)
6204^E^2^
"KRN",101,6197,10,4,"^")
PSO ERX EDIT
"KRN",101,6197,10,5,0)
6201^H^5^
"KRN",101,6197,10,5,"^")
PSO ERX HOLD
"KRN",101,6197,10,6,0)
6202^UH^8^
"KRN",101,6197,10,6,"^")
PSO ERX UNHOLD
"KRN",101,6197,24)
I 1 X:$D(^ORD(101,+$P(^ORD(101,DA(1),10,DA,0),"""^""",1),24)) ^(24)
"KRN",101,6197,26)
D SHOW^VALM S XQORM("#")=$O(^ORD(101,"B","PSO ERX VD SBN",0))_"^1:10"
"KRN",101,6197,99)
64384,54033
"KRN",101,6198,-1)
0^11
"KRN",101,6198,0)
PSO ERX PRINT^Print^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6198,20)
D PRINT^PSOERX1C(PSOIEN)
"KRN",101,6198,99)
64271,46874
"KRN",101,6199,-1)
0^12
"KRN",101,6199,0)
PSO ERX REJECT^Reject^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6199,20)
D REJ^PSOERX1B
"KRN",101,6199,24)
I $$OPACCESS^PSOERXU1("PSO ERX REJECT",DUZ)
"KRN",101,6199,99)
64271,46903
"KRN",101,6200,-1)
0^6
"KRN",101,6200,0)
PSO ERX ACCEPT ERX^Accept eRx^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6200,20)
D SETUP^PSOERX1B
"KRN",101,6200,24)
I $$OPACCESS^PSOERXU1("PSO ERX ACCEPT ERX",DUZ)
"KRN",101,6200,99)
64271,51006
"KRN",101,6201,-1)
0^9
"KRN",101,6201,0)
PSO ERX HOLD^Hold^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6201,15)

"KRN",101,6201,20)
D HOLD^PSOERXH1
"KRN",101,6201,24)
I $$OPACCESS^PSOERXU1("PSO ERX HOLD",DUZ)
"KRN",101,6201,99)
64271,46958
"KRN",101,6202,-1)
0^13
"KRN",101,6202,0)
PSO ERX UNHOLD^Un-Hold^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6202,20)
D UNHOLD^PSOERXH1
"KRN",101,6202,24)
I $$OPACCESS^PSOERXU1("PSO ERX UNHOLD",DUZ)
"KRN",101,6202,99)
64271,46989
"KRN",101,6203,-1)
0^7
"KRN",101,6203,0)
PSO ERX ACCEPT VALIDATION^Accept Validation^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6203,20)
D ACVAL^PSOERX1B(PSOIEN,EDTYP)
"KRN",101,6203,24)
I $$OPACCESS^PSOERXU1("PSO ERX ACCEPT VALIDATION",DUZ)
"KRN",101,6203,99)
64271,51020
"KRN",101,6204,-1)
0^8
"KRN",101,6204,0)
PSO ERX EDIT^Edit^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6204,20)
D EDIT^PSOERX1A(EDTYP)
"KRN",101,6204,99)
64271,51071
"KRN",101,6205,-1)
0^18
"KRN",101,6205,0)
PSO ERX SELECT BY NUMBER^^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6205,20)
D SBN^PSOERX1A
"KRN",101,6206,-1)
0^19
"KRN",101,6206,0)
PSO ERX REMOVE^Remove eRx^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6206,20)
D REM^PSOERX1B
"KRN",101,6206,24)
I $$OPACCESS^PSOERXU1("PSO ERX REMOVE",DUZ)
"KRN",101,6206,99)
64360,42319
"KRN",101,6207,-1)
0^20
"KRN",101,6207,0)
PSO ERX HIDDEN ACTIONS^eRx Hidden actions menu^^M^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6207,1,0)
^101.06^1^1^3170422^^^^
"KRN",101,6207,1,1,0)
Hidden actions for the eRx holding queue.
"KRN",101,6207,4)
26^
"KRN",101,6207,10,0)
^101.01PA^16^16
"KRN",101,6207,10,1,0)
1803^+^11^
"KRN",101,6207,10,1,"^")
VALM NEXT SCREEN
"KRN",101,6207,10,2,0)
1804^-^12^
"KRN",101,6207,10,2,"^")
VALM PREVIOUS SCREEN
"KRN",101,6207,10,3,0)
1808^UP^13^
"KRN",101,6207,10,3,"^")
VALM UP ONE LINE
"KRN",101,6207,10,4,0)
1809^DN^14^
"KRN",101,6207,10,4,"^")
VALM DOWN A LINE
"KRN",101,6207,10,5,0)
1805^RD^24^
"KRN",101,6207,10,5,"^")
VALM REFRESH
"KRN",101,6207,10,6,0)
1812^PS^25^
"KRN",101,6207,10,6,"^")
VALM PRINT SCREEN
"KRN",101,6207,10,7,0)
1813^PL^26^
"KRN",101,6207,10,7,"^")
VALM PRINT LIST
"KRN",101,6207,10,8,0)
1824^>^15^
"KRN",101,6207,10,8,"^")
VALM RIGHT
"KRN",101,6207,10,9,0)
1825^<^16^
"KRN",101,6207,10,9,"^")
VALM LEFT
"KRN",101,6207,10,10,0)
1815^ADPL^32^
"KRN",101,6207,10,10,"^")
VALM TURN ON/OFF MENUS
"KRN",101,6207,10,11,0)
1817^SL^31^
"KRN",101,6207,10,11,"^")
VALM SEARCH LIST
"KRN",101,6207,10,12,0)
1811^Q^33^
"KRN",101,6207,10,12,"^")
VALM QUIT
"KRN",101,6207,10,13,0)
1806^LS^22^
"KRN",101,6207,10,13,"^")
VALM LAST SCREEN
"KRN",101,6207,10,14,0)
1807^FS^21^
"KRN",101,6207,10,14,"^")
VALM FIRST SCREEN
"KRN",101,6207,10,15,0)
1827^GO^23^
"KRN",101,6207,10,15,"^")
VALM GOTO PAGE
"KRN",101,6207,10,16,0)
6208^RR^35^
"KRN",101,6207,10,16,"^")
PSO ERX RENEW REQUEST
"KRN",101,6207,20)

"KRN",101,6207,99)
64395,38255
"KRN",101,6208,-1)
0^21
"KRN",101,6208,0)
PSO ERX RENEW REQUEST^eRx Renew Requst^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6208,1,0)
^101.06^1^1^3170422^^^^
"KRN",101,6208,1,1,0)
This initiates a rxRefillRequest (renew).
"KRN",101,6208,20)
D RREQHQ^PSOERXX1(PSOIEN,PSOSITE)
"KRN",101,6208,99)
64395,35467
"KRN",101,6220,-1)
0^39
"KRN",101,6220,0)
PSO ERX OP PRINT^Print eRx^^A^^^^^^^^OUTPATIENT PHARMACY
"KRN",101,6220,1,0)
^101.06^2^2^3170615^^
"KRN",101,6220,1,1,0)
Physical printing of an eRx from pending outpatient orders and backdoor 
"KRN",101,6220,1,2,0)
orders
"KRN",101,6220,15)
W ""
"KRN",101,6220,20)
D PRINT^PSOERX1C("",1)
"KRN",101,6220,24)
I $$CHKERX^PSOERXU1($P($G(RXOR),U,2))!($$CHKERX^PSOERXU1($G(OR0)))
"KRN",101,6220,99)
64449,37162
"KRN",409.61,826,-1)
0^1
"KRN",409.61,826,0)
PSO ERX HOLDING QUEUE^1^^80^5^19^0^1^^PSO ERX HQ MENU^PSO ERX HOLDING QUEUE^1^^1
"KRN",409.61,826,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,826,"ARRAY")

"KRN",409.61,826,"COL",0)
^409.621^8^7
"KRN",409.61,826,"COL",1,0)
#^1^4^#
"KRN",409.61,826,"COL",2,0)
PATIENT NAME^6^19^Patient
"KRN",409.61,826,"COL",3,0)
DOB^26^9^DOB
"KRN",409.61,826,"COL",4,0)
DRUG^35^21^Drug
"KRN",409.61,826,"COL",5,0)
PROVIDER^57^11^Provider
"KRN",409.61,826,"COL",6,0)
STA^69^3^STA
"KRN",409.61,826,"COL",8,0)
RECORD DATE^73^10^Rec Date
"KRN",409.61,826,"COL","B","#",1)

"KRN",409.61,826,"COL","B","DOB",3)

"KRN",409.61,826,"COL","B","DRUG",4)

"KRN",409.61,826,"COL","B","PATIENT NAME",2)

"KRN",409.61,826,"COL","B","PROVIDER",5)

"KRN",409.61,826,"COL","B","RECORD DATE",8)

"KRN",409.61,826,"COL","B","STA",6)

"KRN",409.61,826,"FNL")
D EXIT^PSOERX
"KRN",409.61,826,"HDR")
D HDR^PSOERX
"KRN",409.61,826,"HLP")
D HELP^PSOERX
"KRN",409.61,826,"INIT")
D INIT^PSOERX
"KRN",409.61,827,-1)
0^2
"KRN",409.61,827,0)
PSO ERX HQ DISPLAY^1^^80^5^19^1^1^^PSO ERX DISPLAY MENU^eRx Holding Queue Display^1^^1
"KRN",409.61,827,1)
^PSO ERX HIDDEN ACTIONS
"KRN",409.61,827,"EXP")
D EXPND^PSOERX1
"KRN",409.61,827,"FNL")
D EXIT^PSOERX1
"KRN",409.61,827,"HDR")
D HDR^PSOERX1
"KRN",409.61,827,"HLP")
D HELP^PSOERX1
"KRN",409.61,827,"INIT")
D INIT^PSOERX1
"KRN",409.61,828,-1)
0^4
"KRN",409.61,828,0)
PSO ERX PATIENT VALIDATION^1^^80^5^20^1^1^^PSO ERX VALIDATION MENU^^1^^1
"KRN",409.61,828,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,828,"EXP")
D EXPND^PSOERXP1
"KRN",409.61,828,"FNL")
D EXIT^PSOERXP1
"KRN",409.61,828,"HDR")
D HDR^PSOERXP1
"KRN",409.61,828,"HLP")
D HELP^PSOERXP1
"KRN",409.61,828,"INIT")
D INIT^PSOERXP1
"KRN",409.61,829,-1)
0^3
"KRN",409.61,829,0)
PSO ERX DRUG VALIDATION^1^^^5^19^1^1^^PSO ERX VALIDATION MENU^^1^^1
"KRN",409.61,829,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,829,"EXP")
D EXPND^PSOERXD1
"KRN",409.61,829,"FNL")
D EXIT^PSOERXD1
"KRN",409.61,829,"HDR")
D HDR^PSOERXD1
"KRN",409.61,829,"HLP")
D HELP^PSOERXD1
"KRN",409.61,829,"INIT")
D INIT^PSOERXD1
"KRN",409.61,830,-1)
0^5
"KRN",409.61,830,0)
PSO ERX PROVIDER VALIDATION^1^^80^5^19^1^1^^PSO ERX VALIDATION MENU^^1^^1
"KRN",409.61,830,1)
^VALM HIDDEN ACTIONS
"KRN",409.61,830,"EXP")
D EXPND^PSOERXR1
"KRN",409.61,830,"FNL")
D EXIT^PSOERXR1
"KRN",409.61,830,"HDR")
D HDR^PSOERXR1
"KRN",409.61,830,"HLP")
D HELP^PSOERXR1
"KRN",409.61,830,"INIT")
D INIT^PSOERXR1
"KRN",8994,3623,-1)
0^1
"KRN",8994,3623,0)
PSOERXA0 DRGMTCH^DRGMTCH^PSOERXA0^1^^^^1^^^1
"KRN",8994,3623,1,0)
^^14^14^3160818^
"KRN",8994,3623,1,1,0)
This RPC is used to match incoming eRx drugs/supply items to the VistA 
"KRN",8994,3623,1,2,0)
equivalent drug/supply items.
"KRN",8994,3623,1,3,0)
 
"KRN",8994,3623,1,4,0)
Input:
"KRN",8994,3623,1,5,0)
 
"KRN",8994,3623,1,6,0)
  Both parameters are 'optional', but to receive any legitimate 
"KRN",8994,3623,1,7,0)
  results, at least one of the two must be passed in.
"KRN",8994,3623,1,8,0)
 
"KRN",8994,3623,1,9,0)
  NDCUPN - NDC or UPN value to be match to the NDC/UPN file (#50.67).
"KRN",8994,3623,1,10,0)
           If NDC, pass "N^ndc value"
"KRN",8994,3623,1,11,0)
           If UPN, pass "U^upn value"
"KRN",8994,3623,1,12,0)
 
"KRN",8994,3623,1,13,0)
  DGDESC - Textual drug description. Pass in the drug description or 
"KRN",8994,3623,1,14,0)
           'drug name'. (ex. ACETAMINOPHEN 400 MG TABLET).
"KRN",8994,3623,2,0)
^8994.02A^2^2
"KRN",8994,3623,2,1,0)
NDCUPN^1^^0^1
"KRN",8994,3623,2,1,1,0)
^^2^2^3160818^
"KRN",8994,3623,2,1,1,1,0)
This is the NDC/UPN of the drug:
"KRN",8994,3623,2,1,1,2,0)
"N^ndc value" or "U^upn value".
"KRN",8994,3623,2,2,0)
DGDESC^1^^0^2
"KRN",8994,3623,2,2,1,0)
^^1^1^3160818^
"KRN",8994,3623,2,2,1,1,0)
This is the drug name or drug description, such as IBUPROFEN 200 MG CAP.
"KRN",8994,3623,2,"B","DGDESC",2)

"KRN",8994,3623,2,"B","NDCUPN",1)

"KRN",8994,3623,2,"PARAMSEQ",1,1)

"KRN",8994,3623,2,"PARAMSEQ",2,2)

"KRN",8994,3624,-1)
0^2
"KRN",8994,3624,0)
PSOERXA0 PRVMTCH^PRVMTCH^PSOERXA0^1^R^^^1^^^1
"KRN",8994,3624,1,0)
^^2^2^3160912^
"KRN",8994,3624,1,1,0)
Provides logic for matching a provider identified for an incoming eRx 
"KRN",8994,3624,1,2,0)
prescription.
"KRN",8994,3624,2,0)
^8994.02A^4^3
"KRN",8994,3624,2,1,0)
NPI^1^15^0^1
"KRN",8994,3624,2,1,1,0)
^^1^1^3160912^
"KRN",8994,3624,2,1,1,1,0)
The NPI values for the provider being matched.
"KRN",8994,3624,2,2,0)
DEA^1^15^0^2
"KRN",8994,3624,2,2,1,0)
^^1^1^3160912^
"KRN",8994,3624,2,2,1,1,0)
The DEA number associated with the provider being matched.
"KRN",8994,3624,2,4,0)
CSUB^1^1^0^3
"KRN",8994,3624,2,4,1,0)
^8994.021^6^6^3161013^^
"KRN",8994,3624,2,4,1,1,0)
This is the controlled substance flag.
"KRN",8994,3624,2,4,1,2,0)
1 - yes (controlled substance)
"KRN",8994,3624,2,4,1,3,0)
0 or null (not a controlled substance).
"KRN",8994,3624,2,4,1,4,0)
 
"KRN",8994,3624,2,4,1,5,0)
If a match is occuring for a controlled substance, an additional check 
"KRN",8994,3624,2,4,1,6,0)
will occur to ensure the DEA # matches the provider.
"KRN",8994,3624,2,"B","CSUB",4)

"KRN",8994,3624,2,"B","DEA",2)

"KRN",8994,3624,2,"B","NPI",1)

"KRN",8994,3624,2,"PARAMSEQ",1,1)

"KRN",8994,3624,2,"PARAMSEQ",2,2)

"KRN",8994,3624,2,"PARAMSEQ",3,4)

"KRN",8994,3624,3,0)
^^2^2^3160912^
"KRN",8994,3624,3,1,0)
PSORES=IEN^PROVIDER NAME (#200, .01) - successful match
"KRN",8994,3624,3,2,0)
PSORES=0^MESSAGE - failure to match or multiple matches found)
"KRN",8994,3626,-1)
0^3
"KRN",8994,3626,0)
PSOERXA1 INCERX^INCERX^PSOERXA1^1^^^^1^^^1
"KRN",8994,3626,1,0)
^8994.01^2^2^3170612^^^^
"KRN",8994,3626,1,1,0)
This RPC receives and processes an incoming ERX XML message, provider 
"KRN",8994,3626,1,2,0)
check information, and patient check information.
"KRN",8994,3626,2,0)
^8994.02A^9^9
"KRN",8994,3626,2,1,0)
XML^1^^1^1
"KRN",8994,3626,2,1,1,0)
^8994.021^1^1^3170825^^
"KRN",8994,3626,2,1,1,1,0)
The full XML text, as a 'stream' or 'literal'.
"KRN",8994,3626,2,2,0)
PRCHK^2^^0^2
"KRN",8994,3626,2,2,1,0)
^8994.021^1^1^3170308^^
"KRN",8994,3626,2,2,1,1,0)
This is the provider check results from the eRx middleware.
"KRN",8994,3626,2,3,0)
PACHK^2^^0^3
"KRN",8994,3626,2,3,1,0)
^8994.021^1^1^3170308^^^
"KRN",8994,3626,2,3,1,1,0)
This is the patient check information from the eRx middleware.
"KRN",8994,3626,2,4,0)
DACHK^2^^0^4
"KRN",8994,3626,2,4,1,0)
^8994.021^1^1^3170612^^
"KRN",8994,3626,2,4,1,1,0)
This is the drug autocheck information from the eRx processing hub.
"KRN",8994,3626,2,5,0)
STATION^1^^^5
"KRN",8994,3626,2,5,1,0)
^^1^1^3170612^
"KRN",8994,3626,2,5,1,1,0)
This is the station number the prescription is being sent to.
"KRN",8994,3626,2,6,0)
DIV^1^^^6
"KRN",8994,3626,2,6,1,0)
^^1^1^3170612^
"KRN",8994,3626,2,6,1,1,0)
The division associated with the incomine eRx.
"KRN",8994,3626,2,7,0)
ERXHID^1^^^7
"KRN",8994,3626,2,7,1,0)
^^1^1^3170612^
"KRN",8994,3626,2,7,1,1,0)
This is the eRx processing HUB identification number.
"KRN",8994,3626,2,8,0)
ERXVALS^2^^^8
"KRN",8994,3626,2,8,1,0)
^^2^2^3170612^
"KRN",8994,3626,2,8,1,1,0)
These are the code values, human readable associated with the erx NCLT 
"KRN",8994,3626,2,8,1,2,0)
codes.
"KRN",8994,3626,2,9,0)
XML2^1^^0^9
"KRN",8994,3626,2,"B","DACHK",4)

"KRN",8994,3626,2,"B","DIV",6)

"KRN",8994,3626,2,"B","ERXHID",7)

"KRN",8994,3626,2,"B","ERXVALS",8)

"KRN",8994,3626,2,"B","PACHK",3)

"KRN",8994,3626,2,"B","PRCHK",2)

"KRN",8994,3626,2,"B","STATION",5)

"KRN",8994,3626,2,"B","XML",1)

"KRN",8994,3626,2,"B","XML2",9)

"KRN",8994,3626,2,"PARAMSEQ",1,1)

"KRN",8994,3626,2,"PARAMSEQ",2,2)

"KRN",8994,3626,2,"PARAMSEQ",3,3)

"KRN",8994,3626,2,"PARAMSEQ",4,4)

"KRN",8994,3626,2,"PARAMSEQ",5,5)

"KRN",8994,3626,2,"PARAMSEQ",6,6)

"KRN",8994,3626,2,"PARAMSEQ",7,7)

"KRN",8994,3626,2,"PARAMSEQ",8,8)

"KRN",8994,3626,2,"PARAMSEQ",9,9)

"KRN",8994,3626,3,0)
^^3^3^3161011^
"KRN",8994,3626,3,1,0)
Return value(s):
"KRN",8994,3626,3,2,0)
 0^Error message
"KRN",8994,3626,3,3,0)
 1^Erx received
"MBREQ")
0
"ORD",3,19.1)
19.1;3;;;KEY^XPDTA1;KEYF1^XPDIA1;KEYE1^XPDIA1;KEYF2^XPDIA1;;KEYDEL^XPDIA1
"ORD",3,19.1,0)
SECURITY KEY
"ORD",15,101)
101;15;;;PRO^XPDTA;PROF1^XPDIA;PROE1^XPDIA;PROF2^XPDIA;;PRODEL^XPDIA
"ORD",15,101,0)
PROTOCOL
"ORD",16,8994)
8994;16;1;;;;;;;RPCDEL^XPDIA1
"ORD",16,8994,0)
REMOTE PROCEDURE
"ORD",17,409.61)
409.61;17;1;;;;LME1^XPDIA1;;;LMDEL^XPDIA1
"ORD",17,409.61,0)
LIST TEMPLATE
"ORD",18,19)
19;18;;;OPT^XPDTA;OPTF1^XPDIA;OPTE1^XPDIA;OPTF2^XPDIA;;OPTDEL^XPDIA
"ORD",18,19,0)
OPTION
"PKG",141,-1)
1^1
"PKG",141,0)
OUTPATIENT PHARMACY^PSO^OUTPATIENT LABELS, PROFILE, INVENTORY, PRESCRIPTIONS
"PKG",141,20,0)
^9.402P^^
"PKG",141,22,0)
^9.49I^1^1
"PKG",141,22,1,0)
7.0^2971216^2980917^11712
"PKG",141,22,1,"PAH",1,0)
467^3171024
"PKG",141,22,1,"PAH",1,1,0)
^^1^1^3171024
"PKG",141,22,1,"PAH",1,1,1,0)
Inbound electronic prescribing enhancements.
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
26
"RTN","PSO467PI")
0^^B851231^n/a
"RTN","PSO467PI",1,0)
PSO467PI ;ALB/BWF - patch 467 pre-install ; 10/09/2016 10:43am
"RTN","PSO467PI",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSO467PI",3,0)
 ;
"RTN","PSO467PI",4,0)
PRE ;
"RTN","PSO467PI",5,0)
 I '$D(^XUSEC("XUMGR",DUZ)) D
"RTN","PSO467PI",6,0)
 .D EN^DDIOL("The user installing this patch must hold the 'XUMGR' security key.")
"RTN","PSO467PI",7,0)
 .D EN^DDIOL("Install Aborted. Please have someone who holds the 'XUMGR' security")
"RTN","PSO467PI",8,0)
 .D EN^DDIOL("install this patch.") S XPDABORT=1
"RTN","PSO467PI",9,0)
 Q
"RTN","PSO467PO")
0^^B15790041^n/a
"RTN","PSO467PO",1,0)
PSO467PO ;ALB/BWF - patch 467 post-install ; 8/17/2016 1:14pm
"RTN","PSO467PO",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSO467PO",3,0)
 ;
"RTN","PSO467PO",4,0)
 ; ICR #4677 = $$CREATE^XUSAP (API for Application Proxy)
"RTN","PSO467PO",5,0)
 ; ICR #10141 = BMES^XPDUTL & MES^XPDUTL
"RTN","PSO467PO",6,0)
 ; 
"RTN","PSO467PO",7,0)
 ; Application Proxy name = "PSOAPPLICATIONPROXY,PSO"
"RTN","PSO467PO",8,0)
 ; Secondary Menu Option name = "PSO WEB SERVICES OPTION"
"RTN","PSO467PO",9,0)
 ;
"RTN","PSO467PO",10,0)
RUNALL ; Entry point in the (Patch - PSO*7.0*467)
"RTN","PSO467PO",11,0)
 D BMSG("Starting Post-Init")
"RTN","PSO467PO",12,0)
 D PROXY
"RTN","PSO467PO",13,0)
 D MSG("Post-Init Complete")
"RTN","PSO467PO",14,0)
 D APRIND
"RTN","PSO467PO",15,0)
 D WSERV
"RTN","PSO467PO",16,0)
 D PAYMIG
"RTN","PSO467PO",17,0)
 D INDEX
"RTN","PSO467PO",18,0)
 Q
"RTN","PSO467PO",19,0)
 ;
"RTN","PSO467PO",20,0)
PROXY ; Create an Application Proxy for PSO application
"RTN","PSO467PO",21,0)
 N X
"RTN","PSO467PO",22,0)
 S X=$$CREATE^XUSAP("PSOAPPLICATIONPROXY,PSO","","PSO WEB SERVICES OPTION")
"RTN","PSO467PO",23,0)
 ;
"RTN","PSO467PO",24,0)
 I +X=0 D  Q
"RTN","PSO467PO",25,0)
 .D BMSG("   Application Proxy User - 'PSOAPPLICATIONPROXY,PSO'")
"RTN","PSO467PO",26,0)
 .D MSG("   already exists in the NEW PERSON file (#200)"),MSG("")
"RTN","PSO467PO",27,0)
 ;
"RTN","PSO467PO",28,0)
 I +X=-1 D  Q
"RTN","PSO467PO",29,0)
 .D BMSG("   Application Proxy User - 'PSOAPPLICATIONPROXY,PSO'")
"RTN","PSO467PO",30,0)
 .D MSG("   Unsuccessful; could not create Application Proxy User")
"RTN","PSO467PO",31,0)
 .D MSG("   OR error in call to UPDATE^DIE)"),MSG("")
"RTN","PSO467PO",32,0)
 ;
"RTN","PSO467PO",33,0)
 D BMSG("   *****************************************************************")
"RTN","PSO467PO",34,0)
 D MSG("   ** Application Proxy User - 'PSOAPPLICATIONPROXY,PSO' = created **")
"RTN","PSO467PO",35,0)
 D MSG("   ** Secondary Menu Option - 'PSO WEB SERVICES OPTION' = linked   **")
"RTN","PSO467PO",36,0)
 D MSG("   **                         to the Application Proxy.            **")
"RTN","PSO467PO",37,0)
 D MSG("   ******************************************************************")
"RTN","PSO467PO",38,0)
 D MSG("")
"RTN","PSO467PO",39,0)
 Q
"RTN","PSO467PO",40,0)
 ;
"RTN","PSO467PO",41,0)
 ; A message is also recorded in INSTALL file
"RTN","PSO467PO",42,0)
 ; (#9.7) entry for the installation.
"RTN","PSO467PO",43,0)
 ;
"RTN","PSO467PO",44,0)
 ; Output a message.
"RTN","PSO467PO",45,0)
MSG(MSG) ; Integration Agreement #10141
"RTN","PSO467PO",46,0)
 D MES^XPDUTL(MSG)
"RTN","PSO467PO",47,0)
 Q
"RTN","PSO467PO",48,0)
 ;
"RTN","PSO467PO",49,0)
 ; Output a message with a blank line added.
"RTN","PSO467PO",50,0)
BMSG(MSG) ; Integration Agreement #10141
"RTN","PSO467PO",51,0)
 D BMES^XPDUTL(MSG)
"RTN","PSO467PO",52,0)
 Q
"RTN","PSO467PO",53,0)
 ; create the APR index
"RTN","PSO467PO",54,0)
APRIND ;
"RTN","PSO467PO",55,0)
 N DIK,DA
"RTN","PSO467PO",56,0)
 S DIK="^PSDRUG(",DIK(1)="22^APR"
"RTN","PSO467PO",57,0)
 D ENALL^DIK
"RTN","PSO467PO",58,0)
 Q
"RTN","PSO467PO",59,0)
 ; create web server and service
"RTN","PSO467PO",60,0)
WSERV ;
"RTN","PSO467PO",61,0)
 N FDA,WSIEN,NWSIEN,WSERVIEN,WSRVIEN
"RTN","PSO467PO",62,0)
 ; if the web service already exists, this has been configured
"RTN","PSO467PO",63,0)
 I $$FIND1^DIC(18.02,,"B","PSO ERX WEB SERVICE") Q
"RTN","PSO467PO",64,0)
 ; set up the web service
"RTN","PSO467PO",65,0)
 S FDA(18.02,"+1,",.01)="PSO ERX WEB SERVICE"
"RTN","PSO467PO",66,0)
 S FDA(18.02,"+1,",.02)=2
"RTN","PSO467PO",67,0)
 S FDA(18.02,"+1,",200)="/INB-ERX/"
"RTN","PSO467PO",68,0)
 D UPDATE^DIE(,"FDA","WSIEN") K FDA
"RTN","PSO467PO",69,0)
 S NWSIEN=$O(WSIEN(0)),NWSIEN=$G(WSIEN(NWSIEN)) Q:'NWSIEN
"RTN","PSO467PO",70,0)
 S FDA(18.12,"+1,",.01)="PSO WEB SERVER"
"RTN","PSO467PO",71,0)
 S FDA(18.12,"+1,",.03)=80
"RTN","PSO467PO",72,0)
 ;S FDA(18.12,"+1,",.04)="vaauserxappdev1.aac.domain.ext"
"RTN","PSO467PO",73,0)
 S FDA(18.12,"+1,",.06)=1
"RTN","PSO467PO",74,0)
 S FDA(18.12,"+1,",.07)=30
"RTN","PSO467PO",75,0)
 S FDA(18.12,"+1,",1.01)=0
"RTN","PSO467PO",76,0)
 D UPDATE^DIE(,"FDA","WSERVIEN") K FDA
"RTN","PSO467PO",77,0)
 S WSRVIEN=$O(WSERVIEN(0)) Q:'WSRVIEN
"RTN","PSO467PO",78,0)
 S WSRVIEN=$G(WSERVIEN(WSRVIEN)) Q:'WSRVIEN
"RTN","PSO467PO",79,0)
 S FDA(18.121,"+1,"_WSRVIEN_",",.01)=NWSIEN
"RTN","PSO467PO",80,0)
 S FDA(18.121,"+1,"_WSRVIEN_",",.06)=1
"RTN","PSO467PO",81,0)
 D UPDATE^DIE(,"FDA",,"ERR") K FDA
"RTN","PSO467PO",82,0)
 Q
"RTN","PSO467PO",83,0)
CALL ;
"RTN","PSO467PO",84,0)
 N I,X
"RTN","PSO467PO",85,0)
 F I=52.46,52.47,52.48,52.49 D
"RTN","PSO467PO",86,0)
 .S X=0 F  S X=$O(^PS(I,X)) Q:'X  D
"RTN","PSO467PO",87,0)
 ..S FDA(I,X_",",.01)="@"
"RTN","PSO467PO",88,0)
 D FILE^DIE(,"FDA","FERR") K FDA
"RTN","PSO467PO",89,0)
 Q
"RTN","PSO467PO",90,0)
 ; migrate payer fields for new cardholder and sequence structure
"RTN","PSO467PO",91,0)
PAYMIG ;
"RTN","PSO467PO",92,0)
 N ERXIEN,BFCIEN,CHID,BIENS,FDA,DA,DR
"RTN","PSO467PO",93,0)
 ; no need to reindex if there is no data
"RTN","PSO467PO",94,0)
 I '$O(^PS(52.49,0)) Q
"RTN","PSO467PO",95,0)
 S ERXIEN=0 F  S ERXIEN=$O(^PS(52.49,ERXIEN)) Q:'ERXIEN  D
"RTN","PSO467PO",96,0)
 .; do not process entries that have already been converted
"RTN","PSO467PO",97,0)
 .Q:$$GET1^DIQ(52.49,ERXIEN,44,"I")=1
"RTN","PSO467PO",98,0)
 .S BFCIEN=0 F  S BFCIEN=$O(^PS(52.49,ERXIEN,18,BFCIEN)) Q:'BFCIEN  D
"RTN","PSO467PO",99,0)
 ..S BIENS=BFCIEN_","_ERXIEN_","
"RTN","PSO467PO",100,0)
 ..S CHID=$$GET1^DIQ(52.4918,BIENS,.01,"E")
"RTN","PSO467PO",101,0)
 ..; move the cardholder id to field 7 and change the .01 field to the IEN (as a sequence)
"RTN","PSO467PO",102,0)
 ..S FDA(52.4918,BIENS,7)=CHID
"RTN","PSO467PO",103,0)
 ..S FDA(52.4918,BIENS,.01)=BFCIEN
"RTN","PSO467PO",104,0)
 ..D FILE^DIE(,"FDA") K FDA
"RTN","PSO467PO",105,0)
 .; set the conversion flag so this conversion will not run again for this entry.
"RTN","PSO467PO",106,0)
 .S DIE="^PS(52.49,",DA=ERXIEN,DR="44///1" D ^DIE K DIE
"RTN","PSO467PO",107,0)
 Q
"RTN","PSO467PO",108,0)
 ; reindex all files
"RTN","PSO467PO",109,0)
INDEX ;
"RTN","PSO467PO",110,0)
 N DIK,FILE
"RTN","PSO467PO",111,0)
 ; no need to reindex if there is no data
"RTN","PSO467PO",112,0)
 I '$O(^PS(52.49,0)) Q
"RTN","PSO467PO",113,0)
 F FILE="52.45","52.46","52.47","52.48","52.49" D
"RTN","PSO467PO",114,0)
 .S DIK="^PS("_FILE_"," D IXALL2^DIK,IXALL^DIK
"RTN","PSO467PO",115,0)
 Q
"RTN","PSOERX")
0^1^B62148150^n/a
"RTN","PSOERX",1,0)
PSOERX ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERX",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERX",3,0)
 ;
"RTN","PSOERX",4,0)
EN(SRCH,SORTT) ; -- main entry point for PSO ERX HOLDING QUEUE
"RTN","PSOERX",5,0)
 N PSNPINST
"RTN","PSOERX",6,0)
 I '$$CHKKEY(DUZ) D  Q
"RTN","PSOERX",7,0)
 .W !,"You do not have the appropriate key to access this option." S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERX",8,0)
 D:'$D(PSOPAR) ^PSOLSET I '$D(PSOPAR) D MSG^PSODPT G EX
"RTN","PSOERX",9,0)
 D:'$D(PSOPINST) INST^PSOORFI2 I $G(PSOIQUIT) K PSOIQUIT G EX
"RTN","PSOERX",10,0)
 S PSNPINST=$$GET1^DIQ(59,PSOSITE,101,"I")
"RTN","PSOERX",11,0)
 I 'PSNPINST W !,"NPI Institution must be defined to continue." S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX",12,0)
 D EN^VALM("PSO ERX HOLDING QUEUE")
"RTN","PSOERX",13,0)
 Q
"RTN","PSOERX",14,0)
 ;
"RTN","PSOERX",15,0)
HDR ; -- header code
"RTN","PSOERX",16,0)
 S VALMHDR(1)="PSO ERX HOLDING QUEUE"
"RTN","PSOERX",17,0)
 I VALMBCK="R" K @VALMAR S VALMBCK="" D INIT
"RTN","PSOERX",18,0)
 Q
"RTN","PSOERX",19,0)
 ;
"RTN","PSOERX",20,0)
INIT ; -- init variables and list array
"RTN","PSOERX",21,0)
 N LINE,LINEVAR,X,SGLOB,RXSTAT,ERXIEN,PATIEN,PATNM,PTDOB,EXDS,EXPRIEN,EXPRNM,AUTOST,MANST,PTLOOP,ERXDAT,CNT
"RTN","PSOERX",22,0)
 N DEASCH,ERX,ERXDT,ERXEDT,ERXPR,PTDOBE,ERXSTAT,ERXISTAT,EF,ERXIENS,RXSTATN,EBDATE,EEDATE,DTLOOP,ERXDB,ERXDS
"RTN","PSOERX",23,0)
 S EF=52.49
"RTN","PSOERX",24,0)
 S SGLOB=$NA(^TMP("PSOERX",$J)) K @SGLOB
"RTN","PSOERX",25,0)
 S PSOSRCH=$S($D(SRCH):1,1:0) I PSOSRCH S PSOSRCH(VALMEVL)=""
"RTN","PSOERX",26,0)
 S PSOSRT=$S($D(SORTT):1,1:0) I PSOSRT S PSOSRT(VALMEVL)=""
"RTN","PSOERX",27,0)
 ; initialize LINE
"RTN","PSOERX",28,0)
 I '$G(PSOPINST) Q
"RTN","PSOERX",29,0)
 S (LINE,CNT)=0
"RTN","PSOERX",30,0)
 ; Look back 18 months.
"RTN","PSOERX",31,0)
 S EBDATE=$S($D(SRCH(3)):$P(SRCH(3),U),1:$$FMADD^XLFDT(DT,-550)),EEDATE=$S($D(SRCH(3)):$P(SRCH(3),U,2),1:DT_".9999")
"RTN","PSOERX",32,0)
 F  S EBDATE=$O(^PS(52.49,"F",PSNPINST,EBDATE)) Q:'EBDATE!(EBDATE>EEDATE)  D
"RTN","PSOERX",33,0)
 .S RXSTAT=0 F  S RXSTAT=$O(^PS(52.49,"F",PSNPINST,EBDATE,RXSTAT)) Q:'RXSTAT  D
"RTN","PSOERX",34,0)
 ..S RXSTATN=$$GET1^DIQ(52.45,RXSTAT,.01,"E")
"RTN","PSOERX",35,0)
 ..; do not show reject, remove, or processed prescriptions. Do not filter out when a search is occuring.
"RTN","PSOERX",36,0)
 ..I '$D(SRCH),((RXSTATN="RJ")!(RXSTATN="RM")!(RXSTATN="PR")) Q
"RTN","PSOERX",37,0)
 ..S ERXIEN=0 F  S ERXIEN=$O(^PS(52.49,"F",PSNPINST,EBDATE,RXSTAT,ERXIEN)) Q:'ERXIEN!(CNT>998)  D
"RTN","PSOERX",38,0)
 ...S ERXIENS=ERXIEN_","
"RTN","PSOERX",39,0)
 ...K ERXDAT D GETS^DIQ(52.49,ERXIENS,".03;.04;4.9;3.1;2.1;1;1.2;1.3","IE","ERXDAT")
"RTN","PSOERX",40,0)
 ...S PATIEN=$G(ERXDAT(EF,ERXIENS,.04,"I"))
"RTN","PSOERX",41,0)
 ...I $D(SRCH(1)),PATIEN'=$P($G(SRCH(1)),U) Q
"RTN","PSOERX",42,0)
 ...; patient ien missing, do not process
"RTN","PSOERX",43,0)
 ...Q:'PATIEN
"RTN","PSOERX",44,0)
 ...; patient name/dob
"RTN","PSOERX",45,0)
 ...S PATNM=$G(ERXDAT(EF,ERXIENS,.04,"E"))
"RTN","PSOERX",46,0)
 ...S PTDOBE=""
"RTN","PSOERX",47,0)
 ...S PTDOB=$$GET1^DIQ(52.46,PATIEN,.08,"I")
"RTN","PSOERX",48,0)
 ...I PTDOB]"" S PTDOBE=$$FMTE^XLFDT(PTDOB,"2D")
"RTN","PSOERX",49,0)
 ...I 'PTDOB S PTDOB="N/A"
"RTN","PSOERX",50,0)
 ...I $D(SRCH(2)),PTDOB'=$G(SRCH(2)) Q
"RTN","PSOERX",51,0)
 ...; external drug/supply
"RTN","PSOERX",52,0)
 ...S EXDS=$G(ERXDAT(EF,ERXIENS,3.1,"E"))
"RTN","PSOERX",53,0)
 ...I $D(SRCH(6)),EXDS'[$P($G(SRCH(6)),U) Q
"RTN","PSOERX",54,0)
 ...; external provider ien and name
"RTN","PSOERX",55,0)
 ...S EXPRIEN=$G(ERXDAT(EF,ERXIENS,2.1,"I"))
"RTN","PSOERX",56,0)
 ...I $D(SRCH(4)),EXPRIEN'=$P($G(SRCH(4)),U,1) Q
"RTN","PSOERX",57,0)
 ...; if there is no external provider, quit - FUTURE ENHANCEMENT - may need to find a way to log, view, and deal with these instances.
"RTN","PSOERX",58,0)
 ...S EXPRNM=$G(ERXDAT(EF,ERXIENS,2.1,"E")) Q:'$L(EXPRNM)
"RTN","PSOERX",59,0)
 ...; auto and manual validation status
"RTN","PSOERX",60,0)
 ...S AUTOST=$G(ERXDAT(EF,ERXIENS,1.2,"E"))
"RTN","PSOERX",61,0)
 ...S MANST=$G(ERXDAT(EF,ERXIENS,1.3,"E"))
"RTN","PSOERX",62,0)
 ...S ERXSTAT=$G(ERXDAT(EF,ERXIENS,1,"E"))
"RTN","PSOERX",63,0)
 ...S ERXISTAT=$G(ERXDAT(EF,ERXIENS,1,"I"))
"RTN","PSOERX",64,0)
 ...I $D(SRCH(5)),ERXSTAT'=$P(SRCH(5),U,2) Q
"RTN","PSOERX",65,0)
 ...; date ERX was received
"RTN","PSOERX",66,0)
 ...S ERXDT=$G(ERXDAT(EF,ERXIENS,.03,"I")),ERXEDT=$$FMTE^XLFDT($P(ERXDT,"."),"2D")
"RTN","PSOERX",67,0)
 ...I $D(SRCH(3)),(ERXDT<$P($G(SRCH(3)),U,1))!(ERXDT>$P($G(SRCH(3)),U,2)) Q
"RTN","PSOERX",68,0)
 ...S CNT=CNT+1
"RTN","PSOERX",69,0)
 ...I $G(SORTT) D  Q
"RTN","PSOERX",70,0)
 ....I SORTT=1 S @SGLOB@(1,PATNM,ERXDT-9999999,EXPRNM,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",71,0)
 ....I SORTT=2 S @SGLOB@(1,PTDOB,ERXDT-9999999,PATNM,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",72,0)
 ....I SORTT=3 S @SGLOB@(1,ERXDT-9999999,PATNM,EXPRNM,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",73,0)
 ....I SORTT=4 S @SGLOB@(1,EXPRNM,ERXDT,PATNM,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",74,0)
 ....I SORTT=5 S @SGLOB@(1,ERXSTAT,PATNM,ERXDT-9999999,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",75,0)
 ....I SORTT=6 S @SGLOB@(1,EXDS,PATNM,ERXDT-9999999,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",76,0)
 ...;S @SGLOB@(ERXDT,PATNM,EXPRNM,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",77,0)
 ...S @SGLOB@(ERXDT,PATNM,PTDOB,EXDS,ERXIEN)=PATNM_U_PTDOBE_U_EXDS_U_EXPRNM_U_AUTOST_U_MANST_U_ERXEDT_U_ERXSTAT
"RTN","PSOERX",78,0)
 S DTLOOP=0 F  S DTLOOP=$O(@SGLOB@(DTLOOP)) Q:'DTLOOP  D
"RTN","PSOERX",79,0)
 .S PTLOOP="" F  S PTLOOP=$O(@SGLOB@(DTLOOP,PTLOOP)) Q:PTLOOP=""  D
"RTN","PSOERX",80,0)
 ..S ERXDB="" F  S ERXDB=$O(@SGLOB@(DTLOOP,PTLOOP,ERXDB)) Q:ERXDB=""  D
"RTN","PSOERX",81,0)
 ...S ERXDS="" F  S ERXDS=$O(@SGLOB@(DTLOOP,PTLOOP,ERXDB,ERXDS)) Q:ERXDS=""  D
"RTN","PSOERX",82,0)
 ....S ERX=0 F  S ERX=$O(@SGLOB@(DTLOOP,PTLOOP,ERXDB,ERXDS,ERX)) Q:'ERX  D
"RTN","PSOERX",83,0)
 .....S LINE=LINE+1,LINEVAR=""
"RTN","PSOERX",84,0)
 .....S ERXDAT=$G(@SGLOB@(DTLOOP,PTLOOP,ERXDB,ERXDS,ERX))
"RTN","PSOERX",85,0)
 .....S LINEVAR=$$SETFLD^VALM1(LINE_".",LINEVAR,"#")
"RTN","PSOERX",86,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U),LINEVAR,"PATIENT NAME")
"RTN","PSOERX",87,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U,2),LINEVAR,"DOB")
"RTN","PSOERX",88,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U,3),LINEVAR,"DRUG")
"RTN","PSOERX",89,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U,4),LINEVAR,"PROVIDER")
"RTN","PSOERX",90,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U,8),LINEVAR,"STA")
"RTN","PSOERX",91,0)
 .....S LINEVAR=$$SETFLD^VALM1($P(ERXDAT,U,7),LINEVAR,"RECORD DATE")
"RTN","PSOERX",92,0)
 .....D SET^VALM10(LINE,LINEVAR,ERX)
"RTN","PSOERX",93,0)
 I LINE=0 S LINE=LINE+1 D SET^VALM10(LINE,"No results for current query.")
"RTN","PSOERX",94,0)
 S VALMCNT=LINE
"RTN","PSOERX",95,0)
 Q
"RTN","PSOERX",96,0)
 ;
"RTN","PSOERX",97,0)
HELP ; -- help code
"RTN","PSOERX",98,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOERX",99,0)
 Q
"RTN","PSOERX",100,0)
 ;
"RTN","PSOERX",101,0)
EXIT ; -- exit code
"RTN","PSOERX",102,0)
 S VALMBCK="R"
"RTN","PSOERX",103,0)
 K PSOSRCH(VALMEVL),PSOSRT(VALMEVL),@VALMAR
"RTN","PSOERX",104,0)
 I VALMEVL=0 K PSOSRCH,PSOSRT
"RTN","PSOERX",105,0)
 D FULL^VALM1
"RTN","PSOERX",106,0)
 Q
"RTN","PSOERX",107,0)
 ;
"RTN","PSOERX",108,0)
EX ; early exit logic
"RTN","PSOERX",109,0)
 K PSOSRCH,PSOSRT,SRCH,SORTT
"RTN","PSOERX",110,0)
 ;K PSOSRCH,PSOSRT,PSOPAR,PSOPINST
"RTN","PSOERX",111,0)
 D EX^PSOORFI1
"RTN","PSOERX",112,0)
 Q
"RTN","PSOERX",113,0)
EXPND ; -- expand code
"RTN","PSOERX",114,0)
 Q
"RTN","PSOERX",115,0)
 ;
"RTN","PSOERX",116,0)
 ; search list and display results
"RTN","PSOERX",117,0)
SEARCH ;
"RTN","PSOERX",118,0)
 N RES,SVAL,I,DONE,SRCHARY
"RTN","PSOERX",119,0)
 D FULL^VALM1
"RTN","PSOERX",120,0)
 S DONE=0
"RTN","PSOERX",121,0)
 F I=1:1 D  Q:DONE
"RTN","PSOERX",122,0)
 .S RES=$$DIR(,I,.SRCHARY)
"RTN","PSOERX",123,0)
 .I '+RES S DONE=1 Q
"RTN","PSOERX",124,0)
 .S SRCHARY(+RES)=$P(RES,U,2,99)
"RTN","PSOERX",125,0)
 I $D(STYP) D EN(.SRCHARY,STYP) Q
"RTN","PSOERX",126,0)
 D EN(.SRCHARY)
"RTN","PSOERX",127,0)
 ;S VALMBCK="R"
"RTN","PSOERX",128,0)
 Q
"RTN","PSOERX",129,0)
 ; sort target list
"RTN","PSOERX",130,0)
SORT ;
"RTN","PSOERX",131,0)
 N RES,STYP,SVAL
"RTN","PSOERX",132,0)
 D FULL^VALM1
"RTN","PSOERX",133,0)
 S RES=$$DIR(1,0)
"RTN","PSOERX",134,0)
 I '+$P(RES,U) Q
"RTN","PSOERX",135,0)
 S STYP=$P(RES,U)
"RTN","PSOERX",136,0)
 I $D(SRCHARY) D EN(.SRCHARY,STYP) Q
"RTN","PSOERX",137,0)
 D EN(,STYP)
"RTN","PSOERX",138,0)
 Q
"RTN","PSOERX",139,0)
DIR(SORT,CNT,SLIST) ;
"RTN","PSOERX",140,0)
 N DIR,Y,RLINE,STAG,SVAL
"RTN","PSOERX",141,0)
 K DIR
"RTN","PSOERX",142,0)
 S DIR(0)="SO^1:PATIENT NAME;2:DATE OF BIRTH;3:RECEIVED DATE RANGE;4:PROVIDER NAME;5:ERX STATUS;6:DRUG NAME"
"RTN","PSOERX",143,0)
 I CNT<2 S DIR("L")="Select one of the following "_$S($G(SORT):"sort",1:"search")_" criteria:"
"RTN","PSOERX",144,0)
 I CNT>1 D
"RTN","PSOERX",145,0)
 .S DIR("L")=""
"RTN","PSOERX",146,0)
 .S DIR("L",11)="Select another search criteria or '^' to exit. Press enter to use the currently"
"RTN","PSOERX",147,0)
 .S DIR("L",12)="selected search criteria."
"RTN","PSOERX",148,0)
 S DIR("L",2)=""
"RTN","PSOERX",149,0)
 S DIR("L",3)=" "_$S($D(SLIST(1)):"*",1:"")_"1.) PATIENT NAME"
"RTN","PSOERX",150,0)
 S DIR("L",4)=" "_$S($D(SLIST(2)):"*",1:"")_"2.) DATE OF BIRTH"
"RTN","PSOERX",151,0)
 S DIR("L",5)=" "_$S($D(SLIST(3)):"*",1:"")_"3.) RECEIVED DATE"_$S('$G(SORT):" RANGE",1:"")
"RTN","PSOERX",152,0)
 S DIR("L",6)=" "_$S($D(SLIST(4)):"*",1:"")_"4.) PROVIDER NAME"
"RTN","PSOERX",153,0)
 S DIR("L",7)=" "_$S($D(SLIST(5)):"*",1:"")_"5.) ERX STATUS"
"RTN","PSOERX",154,0)
 S DIR("L",8)=" "_$S($D(SLIST(6)):"*",1:"")_"6.) DRUG NAME"
"RTN","PSOERX",155,0)
 S DIR("L",9)=""
"RTN","PSOERX",156,0)
 S DIR("L",10)=$S($D(SLIST):" * - indicates selected criteria.",1:"")
"RTN","PSOERX",157,0)
 D ^DIR K DIR Q:'Y 0
"RTN","PSOERX",158,0)
 S RES=Y I $G(SORT) Q RES
"RTN","PSOERX",159,0)
 S RLINE=$S(RES=1:"PAT",RES=2:"DOB",RES=3:"RDT",RES=4:"PRVNM",RES=5:"ESTAT",RES=6:"DNAME",1:"")
"RTN","PSOERX",160,0)
 I RLINE']"" Q 0
"RTN","PSOERX",161,0)
 S STAG=RLINE
"RTN","PSOERX",162,0)
 S SVAL=$$@STAG I SVAL="" Q 0
"RTN","PSOERX",163,0)
 Q RES_U_SVAL
"RTN","PSOERX",164,0)
PAT() ;
"RTN","PSOERX",165,0)
 N Y,DIC
"RTN","PSOERX",166,0)
 S DIC=52.46,DIC(0)="AEMQ" D ^DIC
"RTN","PSOERX",167,0)
 I Y<1 Q ""
"RTN","PSOERX",168,0)
 Q Y
"RTN","PSOERX",169,0)
DOB() ;
"RTN","PSOERX",170,0)
 N %DT,Y
"RTN","PSOERX",171,0)
 S %DT="A"
"RTN","PSOERX",172,0)
 S %DT("A")="Enter the Date of Birth (DOB): "
"RTN","PSOERX",173,0)
 D ^%DT
"RTN","PSOERX",174,0)
 I Y<1 Q ""
"RTN","PSOERX",175,0)
 Q Y
"RTN","PSOERX",176,0)
RDT() ;
"RTN","PSOERX",177,0)
 N BDATE,EDATE,%DT,Y
"RTN","PSOERX",178,0)
 S %DT="A"
"RTN","PSOERX",179,0)
 S %DT("A")="Enter the beginning date: "
"RTN","PSOERX",180,0)
 D ^%DT
"RTN","PSOERX",181,0)
 I Y<0 Q ""
"RTN","PSOERX",182,0)
 S BDATE=Y K Y,%DT
"RTN","PSOERX",183,0)
 S %DT="A"
"RTN","PSOERX",184,0)
 S %DT("A")="Enter the ending date: "
"RTN","PSOERX",185,0)
 S %DT("B")="T"
"RTN","PSOERX",186,0)
 D ^%DT
"RTN","PSOERX",187,0)
 I Y<0 Q ""
"RTN","PSOERX",188,0)
 S EDATE=Y_".999999"
"RTN","PSOERX",189,0)
 Q BDATE_U_EDATE
"RTN","PSOERX",190,0)
PRVNM() ;
"RTN","PSOERX",191,0)
 N Y,DIC
"RTN","PSOERX",192,0)
 S DIC("A")="Select PROVIDER: "
"RTN","PSOERX",193,0)
 S DIC=52.48,DIC(0)="AEQ" D ^DIC
"RTN","PSOERX",194,0)
 I Y<1 Q ""
"RTN","PSOERX",195,0)
 Q Y
"RTN","PSOERX",196,0)
ESTAT() ;
"RTN","PSOERX",197,0)
 ; prompt for erx status
"RTN","PSOERX",198,0)
 N Y,DIC
"RTN","PSOERX",199,0)
 S DIC("A")="Select eRx Status: "
"RTN","PSOERX",200,0)
 S DIC=52.45,DIC(0)="AEQ",DIC("S")="I $D(^PS(52.45,""TYPE"",""ERX"",Y))" D ^DIC
"RTN","PSOERX",201,0)
 I Y<1 Q ""
"RTN","PSOERX",202,0)
 Q Y
"RTN","PSOERX",203,0)
DNAME() ;
"RTN","PSOERX",204,0)
 N DIR,Y
"RTN","PSOERX",205,0)
 S DIR(0)="FO"
"RTN","PSOERX",206,0)
 S DIR("A")="Enter the name or partial name of the incoming eRx drug"
"RTN","PSOERX",207,0)
 D ^DIR
"RTN","PSOERX",208,0)
 I Y=""!(Y="^") Q ""
"RTN","PSOERX",209,0)
 Q $$UP^XLFSTR(Y)
"RTN","PSOERX",210,0)
CHKKEY(DUZ) ;
"RTN","PSOERX",211,0)
 I $D(^XUSEC("PSDRPH",DUZ))!($D(^XUSEC("PSO ERX ADV TECH",DUZ)))!($D(^XUSEC("PSO ERX TECH",DUZ)))!($D(^XUSEC("PSO ERX VIEW",DUZ))) Q 1
"RTN","PSOERX",212,0)
 Q 0
"RTN","PSOERX1")
0^2^B73483713^n/a
"RTN","PSOERX1",1,0)
PSOERX1 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERX1",3,0)
 ;
"RTN","PSOERX1",4,0)
EN(PSOIEN) ; -- main entry point for PSO ERX HOLDING QUEUE
"RTN","PSOERX1",5,0)
 D EN^VALM("PSO ERX HQ DISPLAY")
"RTN","PSOERX1",6,0)
 Q
"RTN","PSOERX1",7,0)
 ;
"RTN","PSOERX1",8,0)
HDR ; -- header code
"RTN","PSOERX1",9,0)
 S VALMHDR(1)="eRx Patient: "_$$GET1^DIQ(52.49,PSOIEN,.04,"E")
"RTN","PSOERX1",10,0)
 S VALMHDR(2)="eRx Reference #: "_$$GET1^DIQ(52.49,PSOIEN,.01,"E")
"RTN","PSOERX1",11,0)
 I VALMBCK="R" K @VALMAR S VALMBCK="" D INIT
"RTN","PSOERX1",12,0)
 Q
"RTN","PSOERX1",13,0)
 ;
"RTN","PSOERX1",14,0)
INIT ;
"RTN","PSOERX1",15,0)
 Q:'$G(PSOIEN)
"RTN","PSOERX1",16,0)
 N PATIEN,PHARMIEN,PRVIEN,PHDAT,PATDAT,SUPDAT,PRVDAT,LINE,PRVLNM,PRVMI,PRVFN,EPAT,EPATDOB,VPATIEN
"RTN","PSOERX1",17,0)
 N VPATNM,VPATDOB,EPRVIEN,EPRVNM,EPRVNPI,VAPRVIEN,VAPRVNM,VAPRVNPI,SUPIEN,ERXDRUG,ERXQTY,ERXFLS
"RTN","PSOERX1",18,0)
 N ERXDS,ERXDT,VADRG,LINETXT,ERXCOMM,ERXRFLS,PATIENS,VAHREA,VAQTY,VAREF,VASIG,PATDAT,CURSTATE,CURSTATI
"RTN","PSOERX1",19,0)
 N LHFOUND,LHMATCH,LHSTATI,VAPDEAEX,ERXCOMM,COMFRST,COMARY,SIGDATA,SIGLOOP,SFIRST,SGLOOP,SIGARY,VADAYS
"RTN","PSOERX1",20,0)
 N SLOOP,VASIG,VASARY,FSSIG,VAHSTA,EDIRECT,VAHPER,PAMANVAL,DRMANVAL,PRMANVAL,VPATINST,VAPIARY,VLOOP,FSVPIN
"RTN","PSOERX1",21,0)
 N DRGARY,DLP
"RTN","PSOERX1",22,0)
 S LINE=0
"RTN","PSOERX1",23,0)
 S PATIEN=$$GET1^DIQ(52.49,PSOIEN,.04,"I"),PATIENS=PATIEN_","
"RTN","PSOERX1",24,0)
 D GETS^DIQ(52.46,PATIENS,"**","IE","PATDAT")
"RTN","PSOERX1",25,0)
 S EPAT=$G(PATDAT(52.46,PATIENS,.01,"E"))
"RTN","PSOERX1",26,0)
 S EPATDOB=$G(PATDAT(52.46,PATIENS,.08,"I")),EPATDOB=$$FMTE^XLFDT(EPATDOB,"2D")
"RTN","PSOERX1",27,0)
 ; Future enhancement - if 52.46 is linked to the patient in the patient file, use it. for now use 52.49
"RTN","PSOERX1",28,0)
 ;S VPATIEN=$G(PATDAT(52.46,PATIENS,1.5,"I"))
"RTN","PSOERX1",29,0)
 S VPATIEN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERX1",30,0)
 S VPATNM=$S(VPATIEN:$$GET1^DIQ(2,VPATIEN,.01,"E"),1:"NOT LINKED")
"RTN","PSOERX1",31,0)
 S VPATDOB=$S(VPATIEN:$$GET1^DIQ(2,VPATIEN,.03,"I"),1:"N/A")
"RTN","PSOERX1",32,0)
 I VPATDOB S VPATDOB=$$FMTE^XLFDT(VPATDOB,"2D")
"RTN","PSOERX1",33,0)
 S PHARMIEN=$$GET1^DIQ(52.49,PSOIEN,2.5,"I")
"RTN","PSOERX1",34,0)
 D GETS^DIQ(52.47,PHARMIEN,"**","E","PHDAT")
"RTN","PSOERX1",35,0)
 S EPRVIEN=$$GET1^DIQ(52.49,PSOIEN,2.1,"I")
"RTN","PSOERX1",36,0)
 S EPRVNM=$$GET1^DIQ(52.48,EPRVIEN,.01,"E")
"RTN","PSOERX1",37,0)
 S EPRVNPI=$$GET1^DIQ(52.48,EPRVIEN,1.5,"E")
"RTN","PSOERX1",38,0)
 S VAPRVIEN=$$GET1^DIQ(52.49,PSOIEN,2.3,"I")
"RTN","PSOERX1",39,0)
 S EDIRECT=$$GET1^DIQ(52.49,PSOIEN,7,"E")
"RTN","PSOERX1",40,0)
 S VAPRVNM=$S(VAPRVIEN:$$GET1^DIQ(200,VAPRVIEN,.01,"E"),1:"NOT LINKED")
"RTN","PSOERX1",41,0)
 S VAPRVNPI=$S(VAPRVIEN:$$GET1^DIQ(200,VAPRVIEN,41.99,"E"),1:"N/A")
"RTN","PSOERX1",42,0)
 D GETS^DIQ(52.48,EPRVIEN,"**","E","PRVDAT")
"RTN","PSOERX1",43,0)
 S SUPIEN=$$GET1^DIQ(52.49,PSOIEN,2.6,"I")
"RTN","PSOERX1",44,0)
 D GETS^DIQ(52.48,SUPIEN,"**","E","SUPDAT")
"RTN","PSOERX1",45,0)
 S PAMANVAL=$$GET1^DIQ(52.49,PSOIEN,1.7,"I")
"RTN","PSOERX1",46,0)
 S PRMANVAL=$$GET1^DIQ(52.49,PSOIEN,1.3,"I")
"RTN","PSOERX1",47,0)
 S DRMANVAL=$$GET1^DIQ(52.49,PSOIEN,1.5,"I")
"RTN","PSOERX1",48,0)
 S LINETXT=""
"RTN","PSOERX1",49,0)
 S LINE=LINE+1
"RTN","PSOERX1",50,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Patient: ",$E(EPAT,1,55),1,55)
"RTN","PSOERX1",51,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",EPATDOB,57,20)
"RTN","PSOERX1",52,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",53,0)
 I $L(EPAT)>55 D
"RTN","PSOERX1",54,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"             "_$E(EPAT,56,97))
"RTN","PSOERX1",55,0)
 I $L(EPAT)>97 D
"RTN","PSOERX1",56,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"             "_$E(EPAT,98,135))
"RTN","PSOERX1",57,0)
 S LINETXT=""
"RTN","PSOERX1",58,0)
 S LINE=LINE+1
"RTN","PSOERX1",59,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Vista Patient"_$S(PAMANVAL:"[v]",1:"")_": ",$E(VPATNM,1,55),1,55)
"RTN","PSOERX1",60,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",VPATDOB,57,20)
"RTN","PSOERX1",61,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",62,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",63,0)
 S LINE=LINE+1
"RTN","PSOERX1",64,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Provider: ",$E(EPRVNM,1,55),1,55)
"RTN","PSOERX1",65,0)
 D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",EPRVNPI,57,20)
"RTN","PSOERX1",66,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",67,0)
 I $L(EPRVNM)>55 D
"RTN","PSOERX1",68,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"              "_$E(EPRVNM,56,96))
"RTN","PSOERX1",69,0)
 I $L(EPRVNM)>96 D
"RTN","PSOERX1",70,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"              "_$E(EPRVNM,97,135))
"RTN","PSOERX1",71,0)
 S LINE=LINE+1
"RTN","PSOERX1",72,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Vista Provider"_$S(PRMANVAL:"[v]",1:"")_": ",$E(VAPRVNM,1,55),1,55)
"RTN","PSOERX1",73,0)
 D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",VAPRVNPI,57,20)
"RTN","PSOERX1",74,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",75,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",76,0)
 S ERXDRUG=$$GET1^DIQ(52.49,PSOIEN,3.1,"E")
"RTN","PSOERX1",77,0)
 S ERXQTY=$$GET1^DIQ(52.49,PSOIEN,5.1,"E")
"RTN","PSOERX1",78,0)
 S ERXRFLS=$$GET1^DIQ(52.49,PSOIEN,5.6,"E")
"RTN","PSOERX1",79,0)
 S ERXDS=$$GET1^DIQ(52.49,PSOIEN,5.5,"E")
"RTN","PSOERX1",80,0)
 S ERXDT=$$GET1^DIQ(52.49,PSOIEN,.03,"E")
"RTN","PSOERX1",81,0)
 S VADRG=$$GET1^DIQ(52.49,PSOIEN,3.2,"E")
"RTN","PSOERX1",82,0)
 S VAREF=$$GET1^DIQ(52.49,PSOIEN,20.5,"E")
"RTN","PSOERX1",83,0)
 S VAQTY=$$GET1^DIQ(52.49,PSOIEN,20.1,"E")
"RTN","PSOERX1",84,0)
 S VADAYS=$$GET1^DIQ(52.49,PSOIEN,20.2,"E")
"RTN","PSOERX1",85,0)
 ; only set the hold reason if the eRx has a hold status
"RTN","PSOERX1",86,0)
 S CURSTATE=$$GET1^DIQ(52.49,PSOIEN,1,"E")
"RTN","PSOERX1",87,0)
 S VAHREA=""
"RTN","PSOERX1",88,0)
 I $E(CURSTATE,1)="H" D
"RTN","PSOERX1",89,0)
 .S CURSTATI=$$GET1^DIQ(52.49,PSOIEN,1,"I")
"RTN","PSOERX1",90,0)
 .S LHMATCH=999999,LHFOUND=0 F  S LHMATCH=$O(^PS(52.49,PSOIEN,19,LHMATCH),-1) Q:'LHMATCH!(LHFOUND)  D
"RTN","PSOERX1",91,0)
 ..S LHSTATI=$$GET1^DIQ(52.4919,LHMATCH_","_PSOIEN_",",.02,"I") I LHSTATI=CURSTATI D  S LHFOUND=LHMATCH Q
"RTN","PSOERX1",92,0)
 ...S VAHREA=$$GET1^DIQ(52.4919,LHMATCH_","_PSOIEN_",",1)
"RTN","PSOERX1",93,0)
 ...S VAHSTA=$$GET1^DIQ(52.45,LHSTATI,.01,"E")_" - "_$$GET1^DIQ(52.45,LHSTATI,.02,"E")
"RTN","PSOERX1",94,0)
 ...S VAHPER=$$GET1^DIQ(52.4919,LHMATCH_","_PSOIEN_",",.03,"E")
"RTN","PSOERX1",95,0)
 I VADRG']"" S VADRG="NOT LINKED"
"RTN","PSOERX1",96,0)
 D TXT2ARY^PSOERXD1(.DRGARY,ERXDRUG,,70)
"RTN","PSOERX1",97,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"eRx Drug: "_$G(DRGARY(1)))
"RTN","PSOERX1",98,0)
 S DLP=1
"RTN","PSOERX1",99,0)
 F  S DLP=$O(DRGARY(DLP)) Q:'DLP  D
"RTN","PSOERX1",100,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"          "_$G(DRGARY(DLP)))
"RTN","PSOERX1",101,0)
 S LINE=LINE+1
"RTN","PSOERX1",102,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Qty: ",ERXQTY,1,19)
"RTN","PSOERX1",103,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Refills: ",ERXRFLS,21,15)
"RTN","PSOERX1",104,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Days Supply: ",ERXDS,37,20)
"RTN","PSOERX1",105,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Date: ",$P(ERXDT,"@"),58,22)
"RTN","PSOERX1",106,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",107,0)
 D TXT2ARY^PSOERXD1(.SIGARY,EDIRECT,,70)
"RTN","PSOERX1",108,0)
 S SFIRST=$O(SIGARY(0))
"RTN","PSOERX1",109,0)
 S SGLOOP=0 F  S SGLOOP=$O(SIGARY(SGLOOP)) Q:'SGLOOP  D
"RTN","PSOERX1",110,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,$S(SGLOOP=SFIRST:"eRx Sig: ",1:"         ")_$G(SIGARY(SGLOOP)))
"RTN","PSOERX1",111,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",112,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Vista Drug"_$S(DRMANVAL:"[v]",1:"")_": "_VADRG)
"RTN","PSOERX1",113,0)
 S LINE=LINE+1
"RTN","PSOERX1",114,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Vista Qty: ",$G(VAQTY),1,25)
"RTN","PSOERX1",115,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Vista Refills: ",$G(VAREF),27,18)
"RTN","PSOERX1",116,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Vista Days Supply: ",$G(VADAYS),54,22)
"RTN","PSOERX1",117,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERX1",118,0)
 S VASIG=""
"RTN","PSOERX1",119,0)
 S SLOOP=0 F  S SLOOP=$O(^PS(52.49,PSOIEN,"SIG",SLOOP)) Q:'SLOOP  D
"RTN","PSOERX1",120,0)
 .I '$L($G(VASIG)) S VASIG=$G(^PS(52.49,PSOIEN,"SIG",SLOOP,0)) Q
"RTN","PSOERX1",121,0)
 .S VASIG=$G(VASIG)_" "_$G(^PS(52.49,PSOIEN,"SIG",SLOOP,0))
"RTN","PSOERX1",122,0)
 D TXT2ARY^PSOERXD1(.VASARY,VASIG,,68)
"RTN","PSOERX1",123,0)
 S FSSIG=$O(VASARY(0))
"RTN","PSOERX1",124,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Vista Sig: "_$S(FSSIG:$G(VASARY(FSSIG)),1:""))
"RTN","PSOERX1",125,0)
 S SLOOP=1 F  S SLOOP=$O(VASARY(SLOOP)) Q:'SLOOP  D
"RTN","PSOERX1",126,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"                        "_VASARY(SLOOP))
"RTN","PSOERX1",127,0)
 S VPATINST=$$GET1^DIQ(52.49,PSOIEN,27,"E")
"RTN","PSOERX1",128,0)
 I VPATINST]"" S VPATINST=$$LSIG^PSOQUTIL(VPATINST)
"RTN","PSOERX1",129,0)
 D TXT2ARY^PSOERXD1(.VAPIARY,VPATINST,68)
"RTN","PSOERX1",130,0)
 S FSVPIN=$O(VAPIARY(0))
"RTN","PSOERX1",131,0)
 S LINE=LINE+1 D SET^VALM10(LINE," Pat Inst: "_$S(FSVPIN:$G(VAPIARY(FSVPIN)),1:""))
"RTN","PSOERX1",132,0)
 S VLOOP=1 F  S VLOOP=$O(VAPIARY(VLOOP)) Q:'VLOOP  D
"RTN","PSOERX1",133,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"                        "_VAPIARY(VLOOP))
"RTN","PSOERX1",134,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Hold Status: "_$G(VAHSTA))
"RTN","PSOERX1",135,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Hold Reason: "_$G(VAHREA))
"RTN","PSOERX1",136,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Placed on hold by: "_$G(VAHPER))
"RTN","PSOERX1",137,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",138,0)
 S ERXCOMM=$$GET1^DIQ(52.49,PSOIEN,8,"E")
"RTN","PSOERX1",139,0)
 D TXT2ARY^PSOERXD1(.COMARY,ERXCOMM," ",68)
"RTN","PSOERX1",140,0)
 S COMFRST=$O(COMARY(0)) S LINE=LINE+1 D SET^VALM10(LINE,"eRx Notes: "_$G(ERXCOMM))
"RTN","PSOERX1",141,0)
 F  S COMFRST=$O(COMARY(COMFRST)) Q:'COMFRST  D
"RTN","PSOERX1",142,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"          "_$G(COMARY(COMFRST)))
"RTN","PSOERX1",143,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",144,0)
 N DIAGIEN,DIAGDAT,DIAGSEQ,PDIAGQ,PDIAGV,SDIAGQ,SDIAGV,DIAGDAT,DIACIC,DRES,SDRES
"RTN","PSOERX1",145,0)
 N SDRESL,SDRESDAT,DRESL,DRESDAT,PDIAGARY,SDIAGARY,PDFRST,SDFRST,PDLOOP,SDLOOP,DIENS
"RTN","PSOERX1",146,0)
 S DIAGIEN=0 F  S DIAGIEN=$O(^PS(52.49,PSOIEN,9,DIAGIEN)) Q:'DIAGIEN  D
"RTN","PSOERX1",147,0)
 .S DIENS=DIAGIEN_","_PSOIEN_"," K PDIAGARY,SDIAGARY,DIAGDAT
"RTN","PSOERX1",148,0)
 .D GETS^DIQ(52.499,DIENS,".01:.06","IE","DIAGDAT")
"RTN","PSOERX1",149,0)
 .S DIAGSEQ=$G(DIAGDAT(52.499,DIENS,.01,"E"))
"RTN","PSOERX1",150,0)
 .S DIACIC=$G(DIAGDAT(52.499,DIENS,.02,"E"))
"RTN","PSOERX1",151,0)
 .S PDIAGQ=$G(DIAGDAT(52.499,DIENS,.03,"E"))
"RTN","PSOERX1",152,0)
 .S PDIAGV=$G(DIAGDAT(52.499,DIENS,.04,"E"))
"RTN","PSOERX1",153,0)
 .I PDIAGQ="ICD-10-CM"!(PDIAGQ="ICD-9-CM") D
"RTN","PSOERX1",154,0)
 ..K DRES,PDIAGARY
"RTN","PSOERX1",155,0)
 ..D ICDDESC^ICDXCODE(PDIAGQ,PDIAGV,,.DRES)
"RTN","PSOERX1",156,0)
 ..I '$O(DRES(0)) D TXT2ARY^PSOERXD1(.PDIAGARY,PDIAGV," ",62) Q
"RTN","PSOERX1",157,0)
 ..S DRESL=0 F  S DRESL=$O(DRES(DRESL)) Q:'DRESL  D
"RTN","PSOERX1",158,0)
 ...S DRESDAT=$G(DRES(DRESL)) Q:DRESDAT=""
"RTN","PSOERX1",159,0)
 ...I DRESL=1 S PDIAGV=PDIAGV_" - "_DRESDAT Q
"RTN","PSOERX1",160,0)
 ...S PDIAGV=PDIAGV_" "_DRESDAT
"RTN","PSOERX1",161,0)
 ..D TXT2ARY^PSOERXD1(.PDIAGARY,PDIAGV," ",62)
"RTN","PSOERX1",162,0)
 .S SDIAGQ=$G(DIAGDAT(52.499,DIENS,.05,"E"))
"RTN","PSOERX1",163,0)
 .S SDIAGV=$G(DIAGDAT(52.499,DIENS,.06,"E"))
"RTN","PSOERX1",164,0)
 .I SDIAGQ="ICD-10-CM"!(SDIAGQ="ICD-9-CM") D
"RTN","PSOERX1",165,0)
 ..K SDRES,SDIAGARY
"RTN","PSOERX1",166,0)
 ..D ICDDESC^ICDXCODE(SDIAGQ,SDIAGV,,.SDRES)
"RTN","PSOERX1",167,0)
 ..I '$O(DRES(0)) D TXT2ARY^PSOERXD1(.SDIAGARY,SDIAGV," ",62) Q
"RTN","PSOERX1",168,0)
 ..S SDRESL=0 F  S SDRESL=$O(SDRES(SDRESL)) Q:'SDRESL  D
"RTN","PSOERX1",169,0)
 ...S SDRESDAT=$G(SDRES(SDRESL)) Q:SDRESDAT=""
"RTN","PSOERX1",170,0)
 ...I SDRESL=1 S SDIAGV=SDIAGV_" - "_SDRESDAT Q
"RTN","PSOERX1",171,0)
 ...S SDIAGV=SDIAGV_" "_SDRESDAT
"RTN","PSOERX1",172,0)
 ..D TXT2ARY^PSOERXD1(.SDIAGARY,SDIAGV," ",62)
"RTN","PSOERX1",173,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Diagnosis Sequence: "_DIAGSEQ)
"RTN","PSOERX1",174,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Primary DX Qualifier: "_PDIAGQ)
"RTN","PSOERX1",175,0)
 .S PDFRST=$O(PDIAGARY(0))
"RTN","PSOERX1",176,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Primary Dx Value: "_$S(PDFRST:$G(PDIAGARY(PDFRST)),1:PDIAGV))
"RTN","PSOERX1",177,0)
 .S PDLOOP=PDFRST F  S PDLOOP=$O(PDIAGARY(PDLOOP)) Q:'PDLOOP  D
"RTN","PSOERX1",178,0)
 ..S LINE=LINE+1 D SET^VALM10(LINE,"                  "_$G(PDIAGARY(PDLOOP)))
"RTN","PSOERX1",179,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",180,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Secondary DX Qualifier: "_SDIAGQ)
"RTN","PSOERX1",181,0)
 .S SDFRST=$O(SDIAGARY(0))
"RTN","PSOERX1",182,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Secondary Dx Value: "_$S(SDFRST:$G(SDIAGARY(SDFRST)),1:SDIAGV))
"RTN","PSOERX1",183,0)
 .S SDLOOP=SDFRST F  S SDLOOP=$O(SDIAGARY(SDLOOP)) Q:'SDLOOP  D
"RTN","PSOERX1",184,0)
 ..S LINE=LINE+1 D SET^VALM10(LINE,"                    "_$G(SDIAGARY(SDLOOP)))
"RTN","PSOERX1",185,0)
 .I $O(^PS(52.49,PSOIEN,9,DIAGIEN)) S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERX1",186,0)
 S VALMCNT=LINE
"RTN","PSOERX1",187,0)
 Q
"RTN","PSOERX1",188,0)
 ;
"RTN","PSOERX1",189,0)
HELP ; -- help code
"RTN","PSOERX1",190,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOERX1",191,0)
 Q
"RTN","PSOERX1",192,0)
 ;
"RTN","PSOERX1",193,0)
EXIT ; -- exit code
"RTN","PSOERX1",194,0)
 K @VALMAR
"RTN","PSOERX1",195,0)
 ;D INIT^PSOERX
"RTN","PSOERX1",196,0)
 Q
"RTN","PSOERX1",197,0)
 ;
"RTN","PSOERX1",198,0)
EXPND ; -- expand code
"RTN","PSOERX1",199,0)
 Q
"RTN","PSOERX1A")
0^3^B116223189^n/a
"RTN","PSOERX1A",1,0)
PSOERX1A ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERX1A",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERX1A",3,0)
 ;
"RTN","PSOERX1A",4,0)
 Q
"RTN","PSOERX1A",5,0)
 ; select an item
"RTN","PSOERX1A",6,0)
SI ;
"RTN","PSOERX1A",7,0)
 N RESP,ERXIEN,ERXDAT,LINE,LINEVAR,ERXPAT,ERXLOCK
"RTN","PSOERX1A",8,0)
 S DIR(0)="N^"_VALMBG_":"_VALMLST_":0" D ^DIR
"RTN","PSOERX1A",9,0)
 I 'Y S VALMBCK="R" Q
"RTN","PSOERX1A",10,0)
 S RESP=Y
"RTN","PSOERX1A",11,0)
 S ERXIEN=$O(@VALMAR@("IDX",RESP,"")) Q:'ERXIEN
"RTN","PSOERX1A",12,0)
 ; Get the patient IEN
"RTN","PSOERX1A",13,0)
 S ERXPAT=$$GET1^DIQ(52.49,ERXIEN,.04,"I")
"RTN","PSOERX1A",14,0)
 S ERXLOCK=$$L(ERXPAT,1)
"RTN","PSOERX1A",15,0)
 I 'ERXLOCK S DIR(0)="E" D ^DIR K DIR S VALMBCK="R" Q
"RTN","PSOERX1A",16,0)
 D EN^PSOERX1(ERXIEN)
"RTN","PSOERX1A",17,0)
 D UL(ERXPAT)
"RTN","PSOERX1A",18,0)
 K %
"RTN","PSOERX1A",19,0)
 S VALMBCK="R"
"RTN","PSOERX1A",20,0)
 Q
"RTN","PSOERX1A",21,0)
SBN ;
"RTN","PSOERX1A",22,0)
 N Y,ERXIEN
"RTN","PSOERX1A",23,0)
 S Y=+$P(XQORNOD(0),"=",2)
"RTN","PSOERX1A",24,0)
 I 'Y S VALMBCK="R" Q
"RTN","PSOERX1A",25,0)
 S ERXIEN=$O(@VALMAR@("IDX",Y,"")) Q:'ERXIEN
"RTN","PSOERX1A",26,0)
 S ERXPAT=$$GET1^DIQ(52.49,ERXIEN,.04,"I")
"RTN","PSOERX1A",27,0)
 S ERXLOCK=$$L(ERXPAT,1)
"RTN","PSOERX1A",28,0)
 I 'ERXLOCK S DIR(0)="E" D ^DIR K DIR S VALMBCK="R" Q
"RTN","PSOERX1A",29,0)
 D EN^PSOERX1(ERXIEN)
"RTN","PSOERX1A",30,0)
 D UL(ERXPAT)
"RTN","PSOERX1A",31,0)
 S VALMBCK="R"
"RTN","PSOERX1A",32,0)
 K %
"RTN","PSOERX1A",33,0)
 Q
"RTN","PSOERX1A",34,0)
L(DFN,DIS) ; 
"RTN","PSOERX1A",35,0)
 I $G(PSONOLCK) Q 1
"RTN","PSOERX1A",36,0)
 N FLAG S ^XTMP("PSOERXLOCK",0)=$$PDATE
"RTN","PSOERX1A",37,0)
 I '$D(^XTMP("PSOERXLOCK",DFN)) D  Q FLAG
"RTN","PSOERX1A",38,0)
 . D NOW^%DTC S ^XTMP("PSOERXLOCK",DFN)=DUZ_"^"_%
"RTN","PSOERX1A",39,0)
 . L +^XTMP("PSOERXLOCK",DFN):$S($G(DILOCKTM)>0:DILOCKTM,1:3) S FLAG=$S($T=1:$T,1:0)
"RTN","PSOERX1A",40,0)
 I $D(^XTMP("PSOERXLOCK",DFN)) Q $$R
"RTN","PSOERX1A",41,0)
UL(DFN) ; unlock
"RTN","PSOERX1A",42,0)
 I $G(PSONOLCK) Q
"RTN","PSOERX1A",43,0)
 L -^XTMP("PSOERXLOCK",DFN) K ^XTMP("PSOERXLOCK",DFN)
"RTN","PSOERX1A",44,0)
 Q
"RTN","PSOERX1A",45,0)
 ;
"RTN","PSOERX1A",46,0)
R() ; check lock on node
"RTN","PSOERX1A",47,0)
 ;if user has same patient already locked, Q 1, will only lock once
"RTN","PSOERX1A",48,0)
 I $P($G(^XTMP("PSOERXLOCK",DFN)),"^")=DUZ Q 1
"RTN","PSOERX1A",49,0)
 L +^XTMP("PSOERXLOCK",DFN):$S($G(DILOCKTM)>0:DILOCKTM,1:3)
"RTN","PSOERX1A",50,0)
 I $T=1 D NOW^%DTC S ^XTMP("PSOERXLOCK",DFN)=DUZ_"^"_% Q 1
"RTN","PSOERX1A",51,0)
 I $T=0 W:DIS=1 !,$$WHO(DFN) S Y=$P($G(^XTMP("PSOERXLOCK",DFN)),"^",2) X ^DD("DD") Q $S(DIS=0:0_"^"_$P($G(^VA(200,+$P($G(^XTMP("PSOERXLOCK",DFN)),"^"),0)),"^")_"^"_Y,1:0)
"RTN","PSOERX1A",52,0)
 ;
"RTN","PSOERX1A",53,0)
PDATE() ;
"RTN","PSOERX1A",54,0)
 N X1,X2 S X1=DT,X2=+14 D C^%DTC
"RTN","PSOERX1A",55,0)
 Q X_"^"_DT_"^eRx Pharmacy patient locks"
"RTN","PSOERX1A",56,0)
 ;
"RTN","PSOERX1A",57,0)
WHO(DFN) ;
"RTN","PSOERX1A",58,0)
 S Y=$P($G(^XTMP("PSOERXLOCK",DFN)),"^",2) X ^DD("DD")
"RTN","PSOERX1A",59,0)
 Q $P($G(^VA(200,+$P($G(^XTMP("PSOERXLOCK",DFN)),"^"),0)),"^")_" is editing orders for this patient ("_Y_")"
"RTN","PSOERX1A",60,0)
 ;
"RTN","PSOERX1A",61,0)
 ;
"RTN","PSOERX1A",62,0)
 ; TEXT - variable where text is stored (passed by reference)
"RTN","PSOERX1A",63,0)
 ; HDR - header text
"RTN","PSOERX1A",64,0)
 ; DATA - data associated with the header
"RTN","PSOERX1A",65,0)
 ; STRT - start location (column)
"RTN","PSOERX1A",66,0)
 ; LEN - total length for header and data
"RTN","PSOERX1A",67,0)
ADDITEM(TEXT,HDR,DATA,STRT,LEN) ;
"RTN","PSOERX1A",68,0)
 N LLEN,FULLDAT,L
"RTN","PSOERX1A",69,0)
 S FULLDAT=$G(HDR)_$G(DATA)
"RTN","PSOERX1A",70,0)
 S TEXT=$G(TEXT,"") I STRT=1 S TEXT=TEXT_$E(FULLDAT,1,LEN) Q
"RTN","PSOERX1A",71,0)
 S LLEN=$L(TEXT)
"RTN","PSOERX1A",72,0)
 I LLEN<STRT D
"RTN","PSOERX1A",73,0)
 .F L=$L(TEXT):1:STRT-1 D
"RTN","PSOERX1A",74,0)
 ..S TEXT=TEXT_" "
"RTN","PSOERX1A",75,0)
 S TEXT=TEXT_$E(FULLDAT,1,LEN)
"RTN","PSOERX1A",76,0)
 Q
"RTN","PSOERX1A",77,0)
 ; provider information display
"RTN","PSOERX1A",78,0)
PROV ;
"RTN","PSOERX1A",79,0)
 I '$$GET1^DIQ(52.49,PSOIEN,2.3,"I") S XQORM("B")="Edit"
"RTN","PSOERX1A",80,0)
 D EN^PSOERXR1
"RTN","PSOERX1A",81,0)
 Q
"RTN","PSOERX1A",82,0)
 ; patient information display
"RTN","PSOERX1A",83,0)
PAT ;
"RTN","PSOERX1A",84,0)
 I '$$GET1^DIQ(52.49,PSOIEN,.05,"I") S XQORM("B")="Edit"
"RTN","PSOERX1A",85,0)
 D EN^PSOERXP1
"RTN","PSOERX1A",86,0)
 Q
"RTN","PSOERX1A",87,0)
 ; drug information display
"RTN","PSOERX1A",88,0)
DRUG ;
"RTN","PSOERX1A",89,0)
 I '$$GET1^DIQ(52.49,PSOIEN,3.2,"I") S XQORM("B")="Edit"
"RTN","PSOERX1A",90,0)
 D EN^PSOERXD1
"RTN","PSOERX1A",91,0)
 Q
"RTN","PSOERX1A",92,0)
 ; edit validation
"RTN","PSOERX1A",93,0)
 ; EDTYPE - D=drug, P=patient, PR=provider
"RTN","PSOERX1A",94,0)
EDIT(EDTYP,SBN) ;
"RTN","PSOERX1A",95,0)
 N DIR,Y,ITEM,RES,TAG,PQUIT,RXSTAT
"RTN","PSOERX1A",96,0)
 D FULL^VALM1
"RTN","PSOERX1A",97,0)
 S SBN=$G(SBN,"")
"RTN","PSOERX1A",98,0)
 S VALMBCK="R"
"RTN","PSOERX1A",99,0)
 Q:'$G(PSOIEN)
"RTN","PSOERX1A",100,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERX1A",101,0)
 .W !!,"Cannot edit a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERX1A",102,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1A",103,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1A",104,0)
 Q:'$D(EDTYP)
"RTN","PSOERX1A",105,0)
 I EDTYP="D" D  Q
"RTN","PSOERX1A",106,0)
 .D PLSTRNG(1,10,.RES,SBN)
"RTN","PSOERX1A",107,0)
 .I '$O(RES(0)) Q
"RTN","PSOERX1A",108,0)
 .D DERX1^PSOERXD2(PSOIEN,PSOIENS)
"RTN","PSOERX1A",109,0)
 .S (ITEM,PQUIT)=0 F  S ITEM=$O(RES(ITEM)) Q:'ITEM!(PQUIT)  D
"RTN","PSOERX1A",110,0)
 ..S TAG="VDRG"_ITEM_"^PSOERXD2(PSOIEN,PSOIENS)" D @TAG
"RTN","PSOERX1A",111,0)
 .K @VALMAR D INIT^PSOERXD1
"RTN","PSOERX1A",112,0)
 I EDTYP="P" D VPAT K @VALMAR D INIT^PSOERXP1 Q
"RTN","PSOERX1A",113,0)
 I EDTYP="PR" D VPROV K @VALMAR D INIT^PSOERXR1 Q
"RTN","PSOERX1A",114,0)
 Q
"RTN","PSOERX1A",115,0)
 ; edit provider
"RTN","PSOERX1A",116,0)
VPROV ;
"RTN","PSOERX1A",117,0)
 N EXPRVIEN,VAPRVIEN,MANVAL,PRVDAT,EXPRNAME,EXPRLNAM,EXPRFNAM,PSOIENS
"RTN","PSOERX1A",118,0)
 N EXPRIENS,SELPRV,QUIT,VAPNM,NEWPIEN,VANPI
"RTN","PSOERX1A",119,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1A",120,0)
 S VAPNM=$$GET1^DIQ(52.49,PSOIEN,2.3,"E")
"RTN","PSOERX1A",121,0)
 S EXPRVIEN=$$GET1^DIQ(52.49,PSOIEN,2.1,"I")
"RTN","PSOERX1A",122,0)
 S EXPRIENS=EXPRVIEN_","
"RTN","PSOERX1A",123,0)
 D GETS^DIQ(52.48,EXPRIENS,".01;.02;.03;1.5;1.6","E","PRVDAT")
"RTN","PSOERX1A",124,0)
 S EXPRNAME=$G(PRVDAT(52.48,EXPRIENS,.01,"E"))
"RTN","PSOERX1A",125,0)
 S EXPRLNAM=$G(PRVDAT(52.48,EXPRIENS,.02,"E"))
"RTN","PSOERX1A",126,0)
 S EXPRFNAM=$G(PRVDAT(52.48,EXPRIENS,.03,"E"))
"RTN","PSOERX1A",127,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.3,"I")
"RTN","PSOERX1A",128,0)
 S VAPIEN=$$GET1^DIQ(52.49,PSOIEN,2.3,"I")
"RTN","PSOERX1A",129,0)
 I VAPIEN D  Q
"RTN","PSOERX1A",130,0)
 .W !,"Current Vista provider: "_VAPNM,!
"RTN","PSOERX1A",131,0)
 .S DIR(0)="YO",DIR("A")="Would you like to modify the current provider"
"RTN","PSOERX1A",132,0)
 .I MANVAL S DIR("A",1)="This provider has already been validated."
"RTN","PSOERX1A",133,0)
 .S DIR("B")="NO" D ^DIR
"RTN","PSOERX1A",134,0)
 .Q:'Y
"RTN","PSOERX1A",135,0)
 .S DIC=200,DIC("A")="Select PROVIDER NAME: ",DIC(0)="AEMQ",DIC("S")="I $$CHKPRV2^PSOERX1A(Y)" D ^DIC
"RTN","PSOERX1A",136,0)
 .Q:Y<1
"RTN","PSOERX1A",137,0)
 .S NEWPIEN=$P(Y,U) K Y
"RTN","PSOERX1A",138,0)
 .S ERXMMFLG=$$PRVWARN(PSOIEN,VAPIEN)
"RTN","PSOERX1A",139,0)
 .S DIR(0)="Y",DIR("A")="Would you like to use this provider"
"RTN","PSOERX1A",140,0)
 .S DIR("A",1)="You have selected provider: "_$$GET1^DIQ(200,NEWPIEN,.01,"E")
"RTN","PSOERX1A",141,0)
 .S DIR("B")=$S(ERXMMFLG:"NO",1:"YES") D ^DIR
"RTN","PSOERX1A",142,0)
 .I Y<1 S QUIT=1 Q
"RTN","PSOERX1A",143,0)
 .; change existing entry
"RTN","PSOERX1A",144,0)
 .S FDA(52.49,PSOIENS,2.3)=NEWPIEN
"RTN","PSOERX1A",145,0)
 .; if the provider is different, clear manual validation
"RTN","PSOERX1A",146,0)
 .I VAPIEN'=NEWPIEN S FDA(52.49,PSOIENS,1.3)="",FDA(52.49,PSOIENS,1.8)="",FDA(52.49,PSOIENS,1.9)=""
"RTN","PSOERX1A",147,0)
 .D FILE^DIE(,"FDA") K FDA
"RTN","PSOERX1A",148,0)
 .I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERX1A",149,0)
 ; for now, only list providers that are authorized to write med orders and whose dea is not expired
"RTN","PSOERX1A",150,0)
 S DIC=200,DIC("A")="Select PROVIDER NAME: ",DIC(0)="AEMQ",DIC("S")="I $$CHKPRV2^PSOERX1A(Y)" D ^DIC
"RTN","PSOERX1A",151,0)
 Q:Y<1
"RTN","PSOERX1A",152,0)
 S SELPRV=$P(Y,U)
"RTN","PSOERX1A",153,0)
 S ERXMMFLG=$$PRVWARN(PSOIEN,SELPRV)
"RTN","PSOERX1A",154,0)
 S DIR(0)="Y",DIR("A")="Would you like to use this provider"
"RTN","PSOERX1A",155,0)
 S DIR("A",1)="You have selected provider: "_$$GET1^DIQ(200,SELPRV,.01,"E")
"RTN","PSOERX1A",156,0)
 S DIR("B")=$S(ERXMMFLG:"NO",1:"YES") D ^DIR
"RTN","PSOERX1A",157,0)
 Q:Y<1
"RTN","PSOERX1A",158,0)
 S FDA(52.49,PSOIENS,2.3)=$P(SELPRV,U)
"RTN","PSOERX1A",159,0)
 D FILE^DIE(,"FDA","ERR") K FDA
"RTN","PSOERX1A",160,0)
 I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERX1A",161,0)
 Q
"RTN","PSOERX1A",162,0)
PRVWARN(PSOIEN,VAPIEN) ;
"RTN","PSOERX1A",163,0)
 N EXPRVNPI,VANPI,ERXDEA,VADEA,ERXMMFLG,I,ERXMSG,ERXPIEN,EXPRVDEA
"RTN","PSOERX1A",164,0)
 S ERXMMFLG=0
"RTN","PSOERX1A",165,0)
 S ERXPIEN=$$GET1^DIQ(52.49,PSOIEN,2.1,"I")
"RTN","PSOERX1A",166,0)
 S EXPRVNPI=$$GET1^DIQ(52.48,ERXPIEN,1.5,"E")
"RTN","PSOERX1A",167,0)
 S EXPRVDEA=$$GET1^DIQ(52.48,ERXPIEN,1.6,"E")
"RTN","PSOERX1A",168,0)
 I '$G(VAPIEN) S VAPIEN=$$GET1^DIQ(52.49,PSOIEN,2.3,"I") I '$G(VAPIEN) Q 0
"RTN","PSOERX1A",169,0)
 I EXPRVNPI]"",'$D(^VA(200,"ANPI",EXPRVNPI,VAPIEN)) S ERXMMFLG=1,ERXMSG(1)="Provider NPI Mismatch."
"RTN","PSOERX1A",170,0)
 I EXPRVDEA]"",'$D(^VA(200,"PS1",EXPRVDEA,VAPIEN)) S ERXMMFLG=1,ERXMSG(2)="Provider DEA Mismatch."
"RTN","PSOERX1A",171,0)
 I 'ERXMMFLG Q ERXMMFLG
"RTN","PSOERX1A",172,0)
 W !!,"******************************WARNING********************************"
"RTN","PSOERX1A",173,0)
 S I=0 F  S I=$O(ERXMSG(I)) Q:'I  D
"RTN","PSOERX1A",174,0)
 .W !,$G(ERXMSG(I))
"RTN","PSOERX1A",175,0)
 W !,"*********************************************************************"
"RTN","PSOERX1A",176,0)
 Q ERXMMFLG
"RTN","PSOERX1A",177,0)
CHKPRV2(Y) ;
"RTN","PSOERX1A",178,0)
 ;Ref. to ^VA(200 supp. by IA 224
"RTN","PSOERX1A",179,0)
 I '$P($G(^VA(200,Y,"PS")),U) Q 0
"RTN","PSOERX1A",180,0)
 Q 1
"RTN","PSOERX1A",181,0)
 ; validate drug
"RTN","PSOERX1A",182,0)
 ; prompt list or range
"RTN","PSOERX1A",183,0)
 ; LOW - lowest number to prompt for
"RTN","PSOERX1A",184,0)
 ; HIGH - highest number to prompt for
"RTN","PSOERX1A",185,0)
 ; EDIT - returned list of selected values
"RTN","PSOERX1A",186,0)
 ;        EDIT(n1)=""
"RTN","PSOERX1A",187,0)
 ;        EDIT(n2)=""
"RTN","PSOERX1A",188,0)
 ;        EDIT(n3)=""
"RTN","PSOERX1A",189,0)
PLSTRNG(LOW,HIGH,EDIT,SBN) ;
"RTN","PSOERX1A",190,0)
 N DIR,DONE,DONE2,Y,NUMCHK,NUM,VAL,I,LIST
"RTN","PSOERX1A",191,0)
 I '$G(LOW)!'$G(HIGH) S LIST=0 Q
"RTN","PSOERX1A",192,0)
 S DONE=0
"RTN","PSOERX1A",193,0)
 F  D  Q:DONE
"RTN","PSOERX1A",194,0)
 .I $$GET1^DIQ(52.49,PSOIEN,3.2,"I")="" S Y="A"
"RTN","PSOERX1A",195,0)
 .I '$D(Y),'$O(^PS(52.49,PSOIEN,21,0)) S Y="A"
"RTN","PSOERX1A",196,0)
 .I SBN']"",'$D(Y) D
"RTN","PSOERX1A",197,0)
 ..S DIR(0)="FO^",DIR("A")="Which field(s) would you like to edit? ("_LOW_"-"_HIGH_") or 'A'll"
"RTN","PSOERX1A",198,0)
 ..S DIR("?")="Enter a number, range, or a list of numbers (i.e. 3, 1-5, 3,7,9, or 'A'll)"
"RTN","PSOERX1A",199,0)
 ..S DIR("B")="A"
"RTN","PSOERX1A",200,0)
 ..D ^DIR K DIR
"RTN","PSOERX1A",201,0)
 ..I Y="^" S DONE=1 Q
"RTN","PSOERX1A",202,0)
 .I SBN]"",'$D(Y) S Y=SBN
"RTN","PSOERX1A",203,0)
 .Q:Y["."
"RTN","PSOERX1A",204,0)
 .I Y="^" S DONE=1 Q
"RTN","PSOERX1A",205,0)
 .S Y=$$UP^XLFSTR(Y)
"RTN","PSOERX1A",206,0)
 .I Y="A"!(Y="ALL") D  Q
"RTN","PSOERX1A",207,0)
 ..F I=LOW:1:HIGH D
"RTN","PSOERX1A",208,0)
 ...S EDIT(I)=""
"RTN","PSOERX1A",209,0)
 ..S DONE=1
"RTN","PSOERX1A",210,0)
 .; check for a range or list of numbers
"RTN","PSOERX1A",211,0)
 .I Y'["-",Y'[",",Y'<LOW,Y'>HIGH S EDIT(+Y)="" S DONE=1 Q
"RTN","PSOERX1A",212,0)
 .I Y?1.2N1"-"1.2N D
"RTN","PSOERX1A",213,0)
 ..F I=$P(Y,"-"):1:$P(Y,"-",2) D
"RTN","PSOERX1A",214,0)
 ...Q:I<LOW!(I>HIGH)
"RTN","PSOERX1A",215,0)
 ...S EDIT(I)=""
"RTN","PSOERX1A",216,0)
 .I $D(EDIT) S DONE=1 Q
"RTN","PSOERX1A",217,0)
 .I Y["," D
"RTN","PSOERX1A",218,0)
 ..; check to see if there are alpha-numerics if there are, quit and reprompt
"RTN","PSOERX1A",219,0)
 ..S NUMCHK=$TR(Y,",","") I 'NUMCHK W !,"Invalid response." Q
"RTN","PSOERX1A",220,0)
 ..S DONE2=0
"RTN","PSOERX1A",221,0)
 ..F NUM=1:1 D  Q:DONE2
"RTN","PSOERX1A",222,0)
 ...S VAL=$P(Y,",",NUM)
"RTN","PSOERX1A",223,0)
 ...I 'VAL S DONE2=1 Q
"RTN","PSOERX1A",224,0)
 ...I VAL<LOW!(VAL>HIGH) Q
"RTN","PSOERX1A",225,0)
 ...S EDIT(VAL)=""
"RTN","PSOERX1A",226,0)
 .I $D(EDIT) S DONE=1 Q
"RTN","PSOERX1A",227,0)
 .W !,"Invalid Response."
"RTN","PSOERX1A",228,0)
 .W !,"Answer must be numeric (1-10), a series of numbers (3,5,7), 'A' or 'ALL'."
"RTN","PSOERX1A",229,0)
 .S DIR(0)="E" D ^DIR K Y,DIR
"RTN","PSOERX1A",230,0)
 .;S DONE=1
"RTN","PSOERX1A",231,0)
 Q
"RTN","PSOERX1A",232,0)
 ; validate patient
"RTN","PSOERX1A",233,0)
VPAT ;
"RTN","PSOERX1A",234,0)
 N ERXPIEN,VAPIEN,MANVAL,ERXLNAME,ERXFNAME,DIR,Y,PSOIENS,VAPIEN,MANVAL,DIR,DIC,SELPAT,PDONE,DFN,I
"RTN","PSOERX1A",235,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1A",236,0)
 S ERXPIEN=$$GET1^DIQ(52.49,PSOIEN,.04,"I")
"RTN","PSOERX1A",237,0)
 S ERXLNAME=$$GET1^DIQ(52.46,ERXPIEN,.02,"E")
"RTN","PSOERX1A",238,0)
 S ERXFNAME=$$GET1^DIQ(52.46,ERXPIEN,.03,"E")
"RTN","PSOERX1A",239,0)
 S VAPIEN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERX1A",240,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.7,"I")
"RTN","PSOERX1A",241,0)
 ; if there is a patient currently defined
"RTN","PSOERX1A",242,0)
 I VAPIEN D  Q
"RTN","PSOERX1A",243,0)
 .W !,"Current Vista patient: "_$$GET1^DIQ(2,VAPIEN,.01,"E"),!
"RTN","PSOERX1A",244,0)
 .S DIR(0)="YO",DIR("A")="Would you like to edit the patient"
"RTN","PSOERX1A",245,0)
 .S DIR("A",1)="A patient has already matched to a vista patient."
"RTN","PSOERX1A",246,0)
 .S DIR("B")="NO" D ^DIR
"RTN","PSOERX1A",247,0)
 .Q:Y'=1
"RTN","PSOERX1A",248,0)
 .S SELPAT=$$PATPRMT() K DUOUT Q:'SELPAT
"RTN","PSOERX1A",249,0)
 .S DFN=SELPAT D DEM^VADPT
"RTN","PSOERX1A",250,0)
 .I $P($G(VADM(6)),U)]"" W "[PATIENT DIED ON "_$P($G(VADM(6)),U,2)_"]" Q
"RTN","PSOERX1A",251,0)
 .S ERXMMFLG=$$PATWARN(PSOIEN,SELPAT)
"RTN","PSOERX1A",252,0)
 .S DIR(0)="Y",DIR("A")="Would you like to use this patient"
"RTN","PSOERX1A",253,0)
 .S DIR("A",1)="You have selected patient: "_$$GET1^DIQ(2,SELPAT,.01,"E")
"RTN","PSOERX1A",254,0)
 .S DIR("B")=$S($G(ERXMMFLG):"NO",1:"YES") D ^DIR
"RTN","PSOERX1A",255,0)
 .Q:Y'=1
"RTN","PSOERX1A",256,0)
 .; change existing entry
"RTN","PSOERX1A",257,0)
 .S FDA(52.49,PSOIENS,.05)=SELPAT
"RTN","PSOERX1A",258,0)
 .I SELPAT'=VAPIEN S FDA(52.49,PSOIENS,1.7)="",FDA(52.49,PSOIENS,1.13)="",FDA(52.49,PSOIENS,1.14)=""
"RTN","PSOERX1A",259,0)
 .D FILE^DIE(,"FDA") K FDA
"RTN","PSOERX1A",260,0)
 .I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERX1A",261,0)
 S SELPAT=$$PATPRMT() K DUOUT I 'SELPAT S XQORM("B")="Edit" Q
"RTN","PSOERX1A",262,0)
 S DFN=SELPAT D DEM^VADPT
"RTN","PSOERX1A",263,0)
 I $P($G(VADM(6)),U)]"" W "[PATIENT DIED ON "_$P($G(VADM(6)),U,2)_"]" S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1A",264,0)
 S ERXMMFLG=$$PATWARN(PSOIEN,SELPAT)
"RTN","PSOERX1A",265,0)
 S DIR(0)="Y",DIR("A")="Would you like to use this patient"
"RTN","PSOERX1A",266,0)
 S DIR("A",1)="You have selected patient: "_$$GET1^DIQ(2,SELPAT,.01,"E")
"RTN","PSOERX1A",267,0)
 S DIR("B")=$S($G(ERXMMFLG):"NO",1:"YES") D ^DIR
"RTN","PSOERX1A",268,0)
 I Y'=1 S XQORM("B")="Edit" Q
"RTN","PSOERX1A",269,0)
 S FDA(52.49,PSOIENS,.05)=SELPAT
"RTN","PSOERX1A",270,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSOERX1A",271,0)
 I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERX1A",272,0)
 Q
"RTN","PSOERX1A",273,0)
PATWARN(PSOIEN,SELPAT) ;
"RTN","PSOERX1A",274,0)
 N ERXPIEN,ERXSSN,ERXDOB,ERXGEN,ERXMMFLG,ERXMSG,EXPRVDEA
"RTN","PSOERX1A",275,0)
 S ERXMMFLG=0
"RTN","PSOERX1A",276,0)
 S ERXPIEN=$$GET1^DIQ(52.49,PSOIEN,.04,"I")
"RTN","PSOERX1A",277,0)
 S ERXSSN=$$GET1^DIQ(52.46,ERXPIEN,1.4,"E"),ERXSSN=$TR(ERXSSN,"-","")
"RTN","PSOERX1A",278,0)
 S ERXDOB=$$GET1^DIQ(52.46,ERXPIEN,.08,"I")
"RTN","PSOERX1A",279,0)
 S ERXGEN=$$GET1^DIQ(52.46,ERXPIEN,.07,"I")
"RTN","PSOERX1A",280,0)
 ; if the selected patient is not defined, use the va matched patient because we are doing this check
"RTN","PSOERX1A",281,0)
 ; during accept validation
"RTN","PSOERX1A",282,0)
 I '$G(SELPAT) S SELPAT=$$GET1^DIQ(52.49,PSOIEN,.05,"I") Q:'$G(SELPAT) 0
"RTN","PSOERX1A",283,0)
 I '$D(VADM) S DFN=SELPAT D DEM^VADPT
"RTN","PSOERX1A",284,0)
 I ERXSSN,'$D(^DPT("SSN",ERXSSN,SELPAT)) S ERXMMFLG=1,ERXMSG(1)="SSN mismatch."
"RTN","PSOERX1A",285,0)
 I ERXDOB,'$D(^DPT("ADOB",ERXDOB,SELPAT)) S ERXMMFLG=1,ERXMSG(2)="Date of Birth mismatch."
"RTN","PSOERX1A",286,0)
 I ERXGEN]"",$P($G(VADM(5)),U)'=ERXGEN S ERXMMFLG=1,ERXMSG(3)="Gender mismatch."
"RTN","PSOERX1A",287,0)
 Q:'ERXMMFLG 0
"RTN","PSOERX1A",288,0)
 W !!,"******************************WARNING********************************"
"RTN","PSOERX1A",289,0)
 S I=0 F  S I=$O(ERXMSG(I)) Q:'I  D
"RTN","PSOERX1A",290,0)
 .W !,$G(ERXMSG(I))
"RTN","PSOERX1A",291,0)
 W !,"*********************************************************************"
"RTN","PSOERX1A",292,0)
 Q 1
"RTN","PSOERX1A",293,0)
PATPRMT() ;
"RTN","PSOERX1A",294,0)
 N Y
"RTN","PSOERX1A",295,0)
 D ^DPTLK
"RTN","PSOERX1A",296,0)
 I $P(Y,U)<1 Q 0
"RTN","PSOERX1A",297,0)
 Q $P(Y,U)
"RTN","PSOERX1B")
0^12^B200406933^n/a
"RTN","PSOERX1B",1,0)
PSOERX1B ;ALB/BWF - Accept eRx function ; 8/3/2016 5:14pm
"RTN","PSOERX1B",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERX1B",3,0)
 ;
"RTN","PSOERX1B",4,0)
 Q
"RTN","PSOERX1B",5,0)
ACVAL(PSOIEN,TYPE) ;
"RTN","PSOERX1B",6,0)
 N F,VBFLD,VBDTTMF,DIR,TAG,VALPAR,VAL,CURVAL,MVFLD,VBFLD,VBDTTMF,PSOIENS,RXSTAT,QFLG,VDTTM,ERXMMFLG
"RTN","PSOERX1B",7,0)
 S F=52.49,PSOIENS=PSOIEN_","
"RTN","PSOERX1B",8,0)
 D FULL^VALM1
"RTN","PSOERX1B",9,0)
 S VALMBCK="R"
"RTN","PSOERX1B",10,0)
 ; first check to see if the entry exists. cannot validate something that has no value
"RTN","PSOERX1B",11,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERX1B",12,0)
 .W !!,"Cannot accept validation for a prescription with a status of 'Rejected',",!,"'Removed',or 'Processed",!
"RTN","PSOERX1B",13,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",14,0)
 Q:TYPE']""
"RTN","PSOERX1B",15,0)
 S TAG=$S(TYPE="P":"patient",TYPE="PR":"provider",TYPE="D":"drug",1:"")
"RTN","PSOERX1B",16,0)
 S VALPAR=$S(TYPE="P":.05,TYPE="PR":2.3,TYPE="D":3.2,1:"") Q:VALPAR=""
"RTN","PSOERX1B",17,0)
 S VAL=$$GET1^DIQ(F,PSOIEN,VALPAR,"I") I 'VAL D  Q
"RTN","PSOERX1B",18,0)
 .W !,"Vista "_TAG_" has not been matched. Cannot manually validate."
"RTN","PSOERX1B",19,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",20,0)
 S MVFLD=$S(TYPE="P":1.7,TYPE="PR":1.3,TYPE="D":1.5,1:"")
"RTN","PSOERX1B",21,0)
 S VBFLD=$S(TYPE="P":1.13,TYPE="PR":1.8,TYPE="D":1.11,1:"")
"RTN","PSOERX1B",22,0)
 S VBDTTMF=$S(TYPE="P":1.14,TYPE="PR":1.9,TYPE="D":1.12,1:"")
"RTN","PSOERX1B",23,0)
 ; check to see if this is already validated
"RTN","PSOERX1B",24,0)
 I MVFLD S CURVAL=$$GET1^DIQ(F,PSOIEN,MVFLD,"I")
"RTN","PSOERX1B",25,0)
 I CURVAL D  Q
"RTN","PSOERX1B",26,0)
 .W !!,"This "_TAG_" has already been manually validated."
"RTN","PSOERX1B",27,0)
 .W !,"Validated By: "_$$GET1^DIQ(F,PSOIEN,VBFLD,"E")
"RTN","PSOERX1B",28,0)
 .W !,"Validated Date/Time: "_$$GET1^DIQ(F,PSOIEN,VBDTTMF,"E"),!
"RTN","PSOERX1B",29,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",30,0)
 S QFLG=0
"RTN","PSOERX1B",31,0)
 I TYPE="D" D
"RTN","PSOERX1B",32,0)
 .W !
"RTN","PSOERX1B",33,0)
 .I '$O(^PS(52.49,PSOIEN,21,0)) W !,"Dosing information missing." S QFLG=1
"RTN","PSOERX1B",34,0)
 .I $$GET1^DIQ(52.49,PSOIEN,20.1,"E")="" W !,"Quantity missing." S QFLG=1
"RTN","PSOERX1B",35,0)
 .I $$GET1^DIQ(52.49,PSOIEN,20.2,"E")="" W !,"Days supply missing." S QFLG=1
"RTN","PSOERX1B",36,0)
 .;I $$GET1^DIQ(52.49,PSOIEN,20.5,"E")="" W !,"Refills missing."  S QFLG=1
"RTN","PSOERX1B",37,0)
 .I QFLG=1 D
"RTN","PSOERX1B",38,0)
 ..W !!,"Cannot validate drug information."
"RTN","PSOERX1B",39,0)
 ..S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERX1B",40,0)
 Q:QFLG
"RTN","PSOERX1B",41,0)
 I TYPE="P" S ERXMMFLG=$$PATWARN^PSOERX1A(PSOIEN)
"RTN","PSOERX1B",42,0)
 I TYPE="PR" S ERXMMFLG=$$PRVWARN^PSOERX1A(PSOIEN)
"RTN","PSOERX1B",43,0)
 W !,"Would you like to mark this "_TAG_" as VALIDATED?"
"RTN","PSOERX1B",44,0)
 S DIR(0)="Y",DIR("B")=$S($G(ERXMMFLG):"NO",1:"YES") D ^DIR Q:Y'=1
"RTN","PSOERX1B",45,0)
 K FDA,DIR
"RTN","PSOERX1B",46,0)
 S VDTTM=$$NOW^XLFDT
"RTN","PSOERX1B",47,0)
 I MVFLD S FDA(F,PSOIENS,MVFLD)=1
"RTN","PSOERX1B",48,0)
 I VBFLD S FDA(F,PSOIENS,VBFLD)=$G(DUZ)
"RTN","PSOERX1B",49,0)
 I VBDTTMF S FDA(F,PSOIENS,VBDTTMF)=VDTTM
"RTN","PSOERX1B",50,0)
 I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERX1B",51,0)
 I $D(FDA) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERX1B",52,0)
 W !,"Validation Updated!!" S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",53,0)
 I TYPE="P" D BPROC(PSOIEN,"PA",MVFLD,VBFLD,VBDTTMF,VDTTM) K @VALMAR D INIT^PSOERXP1
"RTN","PSOERX1B",54,0)
 I TYPE="PR" D BPROC(PSOIEN,"PR",MVFLD,VBFLD,VBDTTMF,VDTTM) K @VALMAR D INIT^PSOERXR1
"RTN","PSOERX1B",55,0)
 I TYPE="D" K @VALMAR D INIT^PSOERXD1
"RTN","PSOERX1B",56,0)
 Q
"RTN","PSOERX1B",57,0)
BPROC(PSOIEN,BTYPE,MVFLD,VBFLD,VBDTTMF,VDTTM) ;
"RTN","PSOERX1B",58,0)
 N ERXPAT,ERXSTAT,ERESTAT,ERXDT,ERXIEN,ERXARY,DIR,Y,L,LINE,CNT,EHID,EDRUG,EPROV,EPAT,ERXRDT,ERXRECDT,ERXEDT,I
"RTN","PSOERX1B",59,0)
 N REXEDT,EEPROV,ERXPROV,EXARY
"RTN","PSOERX1B",60,0)
 S ERXPAT=$$GET1^DIQ(52.49,PSOIEN,.04,"I") Q:'ERXPAT
"RTN","PSOERX1B",61,0)
 S ERXPROV=$$GET1^DIQ(52.49,PSOIEN,2.1,"I")
"RTN","PSOERX1B",62,0)
 S ERXRECDT=$P($$GET1^DIQ(52.49,PSOIEN,.03,"I"),".")
"RTN","PSOERX1B",63,0)
 S ERXEDT=ERXRECDT_".2359"
"RTN","PSOERX1B",64,0)
 S ERXSTAT=0 F  S ERXSTAT=$O(^PS(52.49,"PAT",PSNPINST,ERXSTAT)) Q:'ERXSTAT  D
"RTN","PSOERX1B",65,0)
 .S ERESTAT=$$GET1^DIQ(52.45,ERXSTAT,.01,"E")
"RTN","PSOERX1B",66,0)
 .; do not consider rx's that are rejected, removed, processed.
"RTN","PSOERX1B",67,0)
 .I ERESTAT="PR"!(ERESTAT="RM")!(ERESTAT="RJ") Q
"RTN","PSOERX1B",68,0)
 .S ERXDT=ERXRECDT-.0001 F  S ERXDT=$O(^PS(52.49,"PAT",PSNPINST,ERXSTAT,ERXPAT,ERXDT)) Q:ERXDT>ERXEDT!(ERXDT="")  D
"RTN","PSOERX1B",69,0)
 ..S ERXIEN=0 F  S ERXIEN=$O(^PS(52.49,"PAT",PSNPINST,ERXSTAT,ERXPAT,ERXDT,ERXIEN)) Q:'ERXIEN  D
"RTN","PSOERX1B",70,0)
 ...I BTYPE="PR",$$GET1^DIQ(52.49,ERXIEN,2.1,"I")'=ERXPROV Q
"RTN","PSOERX1B",71,0)
 ...S EXARY(ERXIEN)=""
"RTN","PSOERX1B",72,0)
 I '$O(EXARY(0)) Q
"RTN","PSOERX1B",73,0)
 W !!
"RTN","PSOERX1B",74,0)
 I BTYPE="PA" D
"RTN","PSOERX1B",75,0)
 .W !,"This patient has other prescriptions for: "_$$FMTE^XLFDT(ERXRECDT)
"RTN","PSOERX1B",76,0)
 .W !,"Patient: "_$$GET1^DIQ(52.46,ERXPAT,.01,"E")
"RTN","PSOERX1B",77,0)
 I BTYPE="PR" D
"RTN","PSOERX1B",78,0)
 .W !,"There are other prescriptions for this patient, written by this provider on"
"RTN","PSOERX1B",79,0)
 .W !,$$FMTE^XLFDT(ERXRECDT)
"RTN","PSOERX1B",80,0)
 .W !,"Provider: "_$$GET1^DIQ(52.48,ERXPROV,.01,"E")
"RTN","PSOERX1B",81,0)
 .W !,"Patient: "_$$GET1^DIQ(52.46,ERXPAT,.01,"E")
"RTN","PSOERX1B",82,0)
 W !!,?4,"DRUG",?30,"PROVIDER",?60,"REC DATE"
"RTN","PSOERX1B",83,0)
 S $P(LINE,"-",80)="" W !,LINE
"RTN","PSOERX1B",84,0)
 S L=0,CNT=0 F  S L=$O(EXARY(L)) Q:'L  D
"RTN","PSOERX1B",85,0)
 .S CNT=CNT+1
"RTN","PSOERX1B",86,0)
 .S EHID=$$GET1^DIQ(52.49,L,.01,"E")
"RTN","PSOERX1B",87,0)
 .S EDRUG=$$GET1^DIQ(52.49,L,3.1,"E")
"RTN","PSOERX1B",88,0)
 .S EEPROV=$$GET1^DIQ(52.49,L,2.1,"I")
"RTN","PSOERX1B",89,0)
 .S EPROV=$$GET1^DIQ(52.48,EEPROV,.01,"E")
"RTN","PSOERX1B",90,0)
 .S EPAT=$$GET1^DIQ(52.46,ERXPAT,.01,"E")
"RTN","PSOERX1B",91,0)
 .S ERXRDT=$P($$GET1^DIQ(52.49,L,.03,"E"),"@")
"RTN","PSOERX1B",92,0)
 .W !,CNT_".) "_$E(EDRUG,1,28),?30,$E(EPROV,1,28),?60,ERXRDT
"RTN","PSOERX1B",93,0)
 W !!,"Would you like apply the above validation to these prescriptions?"
"RTN","PSOERX1B",94,0)
 K Y S DIR(0)="YO"
"RTN","PSOERX1B",95,0)
 S DIR("B")="N" D ^DIR K DIR
"RTN","PSOERX1B",96,0)
 I Y="^"!(Y=0) Q
"RTN","PSOERX1B",97,0)
 S I=0 F  S I=$O(EXARY(I)) Q:'I  D
"RTN","PSOERX1B",98,0)
 .I BTYPE="PA" S FDA(52.49,I_",",.05)=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERX1B",99,0)
 .I BTYPE="PR" S FDA(52.49,I_",",2.3)=$$GET1^DIQ(52.49,PSOIEN,2.3,"I")
"RTN","PSOERX1B",100,0)
 .S FDA(52.49,I_",",MVFLD)=1,FDA(52.49,I_",",VBFLD)=$G(DUZ),FDA(52.49,I_",",VBDTTMF)=VDTTM
"RTN","PSOERX1B",101,0)
 .D FILE^DIE(,"FDA") K FDA
"RTN","PSOERX1B",102,0)
 .I $$GET1^DIQ(52.49,I,1,"E")="N" D UPDSTAT^PSOERXU1(I,"I")
"RTN","PSOERX1B",103,0)
 Q
"RTN","PSOERX1B",104,0)
 ;PSOHY("LOC")=IEN of hospital location file (#44) - NOT USED, 
"RTN","PSOERX1B",105,0)
 ;PSOHY("CHNUM")=EXTERNAL PLACER ORDER NUMBER (NEED TO FIND OUT HOW WE SHOULD SET THIS) (25)
"RTN","PSOERX1B",106,0)
 ;PSOHY("PICK")=MAIL/WINDOW (20.4) 
"RTN","PSOERX1B",107,0)
 ;PSOHY("ENTER")=ENTERED BY IEN (2.1)
"RTN","PSOERX1B",108,0)
 ;PSOHY("PROV")=PROVIDER IEN (2.3)
"RTN","PSOERX1B",109,0)
 ;PSOHY("SDT")=EFFECTIVE DATE (6.3)
"RTN","PSOERX1B",110,0)
 ;PSOHY("ITEM")=PHARMACY ORDERABLE ITEM (DERIVED FROM THE DRUG IEN) - NO MAPPING TO 52.49
"RTN","PSOERX1B",111,0)
 ;PSOHY("DRUG")=DRUG IEN (3.2)
"RTN","PSOERX1B",112,0)
 ;PSOHY("QTY")=QUANTITY (20.1)
"RTN","PSOERX1B",113,0)
 ;PSOHY("REF")=# OF REFILLS (20.5)
"RTN","PSOERX1B",114,0)
 ;PSOHY("PAT")=PATIENT IEN (.05)
"RTN","PSOERX1B",115,0)
 ;PSOHY("OCC")=ORDER TYPE (ALWAYS 'NW') - NO MAPPING TO 52.49
"RTN","PSOERX1B",116,0)
 ;PSOHY("EDT")=LOGIN DATE (TODAYS DATE) - NO MAPPING TO 52.49
"RTN","PSOERX1B",117,0)
 ;PSOHY("PRIOR")=PRIORITY (SET OF CODES, 52.41,25 - STAT, EMERGENCY, ROUTINE)
"RTN","PSOERX1B",118,0)
 ;PSOHY("EXAPP")=EXTERNAL APPLICATION (FREE TEXT), LIKELY "PSO" - NO MAPPING TO 52.49
"RTN","PSOERX1B",119,0)
 ;PSOHY("PRCOM",#)=PROVIDER COMMENTS (8- NOTES)
"RTN","PSOERX1B",120,0)
 ;PSOHY("SIG",#)=SIG (52.4911 (STRUCTURED SIG), FIELD 1 (SIG FREE TEXT)
"RTN","PSOERX1B",121,0)
 ;PSOHY("QTSUB",CNT)=QUANTITY TIMING SUBFILE DATA. MERGED IN, FULL SUBFILE DATA
"RTN","PSOERX1B",122,0)
 ; QUANTITY/TIMING MAPS DIRECTLY TO QUANTITY TIMING IN 52.41
"RTN","PSOERX1B",123,0)
SETUP ;
"RTN","PSOERX1B",124,0)
 N PSOIENS,PSODAT,F,PATIEN,PROVIEN,OC,VQTY,EFFDT,VADRUG,VAOI,VAREF,VAROUT,VAPRIOR,PSOHY,LOC,ERXNUM,PRVARY,PRVCOMM
"RTN","PSOERX1B",125,0)
 N PLOOP,PCNT,QTLOOP,QTCNT,PSOEXMS,DIR,ORDERTYP,PSOEXCNT,SCNT,SIGDAT,SLOOP,POORD,PMVAL,PRMVAL,DMVAL,PATINST,RXSTAT
"RTN","PSOERX1B",126,0)
 N VADAYS,UNEXPI,PINARY,WRITDT,SLOOP2
"RTN","PSOERX1B",127,0)
 S F=52.49
"RTN","PSOERX1B",128,0)
 Q:'$G(PSOIEN)
"RTN","PSOERX1B",129,0)
 D FULL^VALM1
"RTN","PSOERX1B",130,0)
 S VALMBCK="R"
"RTN","PSOERX1B",131,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERX1B",132,0)
 .W !!,"Cannot accept a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERX1B",133,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",134,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1B",135,0)
 D GETS^DIQ(F,PSOIENS,".01;.05;.07;1;1.3;1.5;1.7;2.1;2.3;3.2;5.9;6.2;6.3;8;20.1;20.2;20.4;20.5;20.6;25;25.2;27;30","IE","PSODAT")
"RTN","PSOERX1B",136,0)
 S PSOEXCNT=0
"RTN","PSOERX1B",137,0)
 S ERXSTA=$G(PSODAT(F,PSOIENS,1,"E")) I ERXSTA="E"!($E(ERXSTA)="H") S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="eRx is in a 'Hold' status." D MSGDIR^PSOERXU1(.PSOEXMS) Q
"RTN","PSOERX1B",138,0)
 S PMVAL=$G(PSODAT(F,PSOIENS,1.7,"I")) I 'PMVAL S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Patient has not been manually validated."
"RTN","PSOERX1B",139,0)
 S PRMVAL=$G(PSODAT(F,PSOIENS,1.3,"I")) I 'PRMVAL S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Provider has not been manually validated."
"RTN","PSOERX1B",140,0)
 S DMVAL=$G(PSODAT(F,PSOIENS,1.5,"I")) I 'DMVAL S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Drug has not been manually validated."
"RTN","PSOERX1B",141,0)
 ; for now, if validations have not occured, do not check the other fields.
"RTN","PSOERX1B",142,0)
 I $O(PSOEXMS(0)) D MSGDIR^PSOERXU1(.PSOEXMS) Q
"RTN","PSOERX1B",143,0)
 S POORD=$G(PSODAT(F,PSOIENS,25.2,"I")) I POORD S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Pending outpatient order already exists."
"RTN","PSOERX1B",144,0)
 S PATIEN=$G(PSODAT(F,PSOIENS,.05,"I")) I 'PATIEN S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="No matched vista patient."
"RTN","PSOERX1B",145,0)
 S PROVIEN=$G(PSODAT(F,PSOIENS,2.3,"I")) I 'PROVIEN S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Provider not matched to a vista provider."
"RTN","PSOERX1B",146,0)
 S VADRUG=$G(PSODAT(F,PSOIENS,3.2,"I")) I 'VADRUG S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Drug not matched to a vista drug."
"RTN","PSOERX1B",147,0)
 S LOC=$G(PSODAT(F,PSOIENS,20.6,"I"))
"RTN","PSOERX1B",148,0)
 S ERXNUM=$G(PSODAT(F,PSOIENS,.01,"E")) I 'ERXNUM S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="eRx number missing."
"RTN","PSOERX1B",149,0)
 S VQTY=$G(PSODAT(F,PSOIENS,20.1,"E")) I 'VQTY S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Quantity missing."
"RTN","PSOERX1B",150,0)
 S EFFDT=$G(PSODAT(F,PSOIENS,6.3,"I")),WRITDT=$G(PSODAT(F,PSOIENS,5.9,"I"))
"RTN","PSOERX1B",151,0)
 ; if the effective date is passed in and there is no time, add .000001 to the date
"RTN","PSOERX1B",152,0)
 I EFFDT]"" S EFFDT=$P(EFFDT,".")
"RTN","PSOERX1B",153,0)
 I '$L(EFFDT) S EFFDT=WRITDT
"RTN","PSOERX1B",154,0)
 S VADAYS=$G(PSODAT(F,PSOIENS,20.2,"E"))
"RTN","PSOERX1B",155,0)
 S VAOI=$$GET1^DIQ(50,VADRUG,2.1,"I") I 'VAOI S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Orderable item not associated with drug."
"RTN","PSOERX1B",156,0)
 S VAREF=$G(PSODAT(F,PSOIENS,20.5,"E"))
"RTN","PSOERX1B",157,0)
 S VAROUT=$G(PSODAT(F,PSOIENS,20.4,"I")) I '$L(VAROUT) S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Pickup routing missing."
"RTN","PSOERX1B",158,0)
 S PATINST=$G(PSODAT(F,PSOIENS,27,"E"))
"RTN","PSOERX1B",159,0)
 D TXT2ARY^PSOERXD1(.PINARY,$$LSIG^PSOQUTIL(PATINST))
"RTN","PSOERX1B",160,0)
 ; get provider comments from VA PROVIDER COMMENTS field
"RTN","PSOERX1B",161,0)
 S PRVCOMM=$G(PSODAT(F,PSOIENS,30,"E"))
"RTN","PSOERX1B",162,0)
 D TXT2ARY^PSOERXD1(.PRVARY,$$LSIG^PSOQUTIL(PRVCOMM))
"RTN","PSOERX1B",163,0)
 S (PLOOP,PCNT)=0 F  S PLOOP=$O(PRVARY(PLOOP)) Q:'PLOOP  D
"RTN","PSOERX1B",164,0)
 .S PCNT=PCNT+1,PSOHY("PRCOM",PCNT)=$G(PRVARY(PLOOP))
"RTN","PSOERX1B",165,0)
 I '$O(^PS(52.49,PSOIEN,21,0)) S PSOEXCNT=PSOEXCNT+1,PSOEXMS(PSOEXCNT)="Dosing information missing."
"RTN","PSOERX1B",166,0)
 S (QTLOOP,QTCNT)=0 F  S QTLOOP=$O(^PS(52.49,PSOIEN,21,QTLOOP)) Q:'QTLOOP  D
"RTN","PSOERX1B",167,0)
 .S QTCNT=QTCNT+1 M PSOHY("QTSUB",QTCNT)=^PS(52.49,PSOIEN,21,QTLOOP)
"RTN","PSOERX1B",168,0)
 ; always 'routine' for now
"RTN","PSOERX1B",169,0)
 S VAPRIOR="R"
"RTN","PSOERX1B",170,0)
 ; always 'new' for this version
"RTN","PSOERX1B",171,0)
 S ORDERTYP="NW"
"RTN","PSOERX1B",172,0)
 S PSOHY("LOC")=LOC,PSOHY("CHNUM")=$G(ERXNUM)
"RTN","PSOERX1B",173,0)
 S PSOHY("PICK")=VAROUT,PSOHY("ENTER")=PROVIEN
"RTN","PSOERX1B",174,0)
 S PSOHY("PROV")=PROVIEN,PSOHY("SDT")=EFFDT
"RTN","PSOERX1B",175,0)
 S PSOHY("ITEM")=VAOI,PSOHY("DRUG")=VADRUG
"RTN","PSOERX1B",176,0)
 S PSOHY("QTY")=VQTY,PSOHY("REF")=VAREF
"RTN","PSOERX1B",177,0)
 S (PSOHY("PAT"),DFN)=PATIEN,PSOHY("OCC")=ORDERTYP
"RTN","PSOERX1B",178,0)
 ; login date will always be the written date. if there is no written date by chance, use the received date
"RTN","PSOERX1B",179,0)
 ;S PSOHY("EDT")=$S(WRITDT'="":$P(WRITDT,"."),1:$P($$GET1^DIQ(52.49,PSOIEN,.03,"I"),"."))
"RTN","PSOERX1B",180,0)
 S PSOHY("EDT")=DT,PSOHY("PRIOR")=VAPRIOR
"RTN","PSOERX1B",181,0)
 ; ALWAYS PSO as the external application
"RTN","PSOERX1B",182,0)
 S PSOHY("EXAPP")="PHARMACY"
"RTN","PSOERX1B",183,0)
 S PSOHY("DAYS")=VADAYS
"RTN","PSOERX1B",184,0)
 ; sig from eRx
"RTN","PSOERX1B",185,0)
 S (SLOOP,SCNT)=0 F  S SLOOP=$O(^PS(52.49,PSOIEN,"SIG",SLOOP)) Q:'SLOOP  D
"RTN","PSOERX1B",186,0)
 .S SIGDAT=$G(^PS(52.49,PSOIEN,"SIG",SLOOP,0))
"RTN","PSOERX1B",187,0)
 .S SCNT=SCNT+1,PSOHY("SIG",SCNT)=SIGDAT
"RTN","PSOERX1B",188,0)
 S SLOOP2=0 F  S SLOOP2=$O(PINARY(SLOOP2)) Q:'SLOOP2  D
"RTN","PSOERX1B",189,0)
 .S SCNT=SCNT+1,PSOHY("SIG",SCNT)=$G(PINARY(SLOOP2))
"RTN","PSOERX1B",190,0)
 ; if provider, patient or drug is missing, no need to continue.
"RTN","PSOERX1B",191,0)
 ; future consideration - do we need to check more fields?
"RTN","PSOERX1B",192,0)
 I $D(PSOEXMS) D MSGDIR^PSOERXU1(.PSOEXMS) Q
"RTN","PSOERX1B",193,0)
 D ADD
"RTN","PSOERX1B",194,0)
 I $G(PSOEXMS)]"" W !,PSOEXMS S DIR(0)="E" D ^DIE
"RTN","PSOERX1B",195,0)
 K DFN
"RTN","PSOERX1B",196,0)
 Q
"RTN","PSOERX1B",197,0)
ADD ;Add CHCS message to Outpatient Pending Orders file
"RTN","PSOERX1B",198,0)
 N PSOHQ,PSOHQT,PSOCPEND,PSOHINI,PSOHINLO,ERXSTA,ORDNUM,ILOOP,IARY
"RTN","PSOERX1B",199,0)
 S (PSOHINI,PSOHINLO)=0 D
"RTN","PSOERX1B",200,0)
 .I $G(PSOHY("LOC")) S PSOHINLO=$P($G(^SC(PSOHY("LOC"),0)),"^",4) I PSOHINLO Q
"RTN","PSOERX1B",201,0)
 .; FUTURE - consider enabling further institution checks. For now the institution is being pulled from either
"RTN","PSOERX1B",202,0)
 .; the institution associated with the hospital location, or below, from the eRx.
"RTN","PSOERX1B",203,0)
 .;I $G(PSOHY("LOC")) S PSOHINI=$P($G(^SC(PSOHY("LOC"),0)),"^",15)
"RTN","PSOERX1B",204,0)
 .;I '$G(PSOHINI) S PSOHINI=$O(^DG(40.8,0))
"RTN","PSOERX1B",205,0)
 .;S PSOHINLO=+$$SITE^VASITE(PSOHINI)
"RTN","PSOERX1B",206,0)
 ; get institution from 52.49 if clinic was not passed in
"RTN","PSOERX1B",207,0)
 I $G(PSOHINLO)<1 S PSOHINLO=$$GET1^DIQ(52.49,PSOIEN,24.1,"I")
"RTN","PSOERX1B",208,0)
 I +$G(PSOHINLO)<1 S PSOEXMS="Unable to derive Institution from Clinic." Q
"RTN","PSOERX1B",209,0)
 K DD,DO,DIC S X=PSOHY("CHNUM"),DIC="^PS(52.41,",DIC(0)="L"
"RTN","PSOERX1B",210,0)
 S:$G(PSOHY("PICK"))="" PSOHY("PICK")="M"
"RTN","PSOERX1B",211,0)
 S DIC("DR")="4////"_$G(PSOHY("ENTER"))_";5////"_PSOHY("PROV")_";6////"_$G(PSOHY("SDT"))_";8////"_PSOHY("ITEM")_";11////"_PSOHY("DRUG")_";12////"_$G(PSOHY("QTY"))_";13////"_$G(PSOHY("REF"))_";101////"_$G(PSOHY("DAYS"))
"RTN","PSOERX1B",212,0)
 D FILE^DICN K DD,DIC,DO I Y<0 S PSOEXMS="Unable to add order to Pending file." Q
"RTN","PSOERX1B",213,0)
 S PSOCPEND=+Y
"RTN","PSOERX1B",214,0)
 S $P(^PS(52.41,PSOCPEND,0),"^",2)=PSOHY("PAT"),$P(^(0),"^",3)=PSOHY("OCC"),$P(^(0),"^",12)=$G(PSOHY("EDT")),$P(^(0),"^",13)=$G(PSOHY("LOC"))
"RTN","PSOERX1B",215,0)
 S $P(^PS(52.41,PSOCPEND,0),"^",14)=$G(PSOHY("PRIOR")),$P(^(0),"^",17)=$G(PSOHY("PICK"))
"RTN","PSOERX1B",216,0)
 S $P(^PS(52.41,PSOCPEND,"EXT"),"^")=PSOHY("CHNUM"),$P(^("EXT"),"^",2)=0,$P(^("EXT"),"^",3)=PSOHY("EXAPP")
"RTN","PSOERX1B",217,0)
 S DIE="^PS(52.41,",DA=PSOCPEND,DR="104///"_PATINST_";104.1///1" D ^DIE K DIE,DA,DR
"RTN","PSOERX1B",218,0)
 N DA,DIK S DA=PSOCPEND,DIK="^PS(52.41,",DIK(1)="114^C" D EN1^DIK
"RTN","PSOERX1B",219,0)
 I $O(PSOHY("PRCOM",0)) D  I PSOHQT S ^PS(52.41,PSOCPEND,3,0)="^^"_PSOHQT_"^"_PSOHQT_"^"_DT_"^"
"RTN","PSOERX1B",220,0)
 .S PSOHQ="",PSOHQT=0 F  S PSOHQ=$O(PSOHY("PRCOM",PSOHQ)) Q:PSOHQ=""  I $G(PSOHY("PRCOM",PSOHQ))'="" S PSOHQT=PSOHQT+1,^PS(52.41,PSOCPEND,3,PSOHQT,0)=$G(PSOHY("PRCOM",PSOHQ))
"RTN","PSOERX1B",221,0)
 I $O(PSOHY("SIG",0)) D  I PSOHQT S ^PS(52.41,PSOCPEND,"SIG",0)="^52.4124A^"_PSOHQT_"^"_PSOHQT
"RTN","PSOERX1B",222,0)
 .S PSOHQ="",PSOHQT=0 F  S PSOHQ=$O(PSOHY("SIG",PSOHQ)) Q:PSOHQ=""  I $G(PSOHY("SIG",PSOHQ))'="" S PSOHQT=PSOHQT+1,^PS(52.41,PSOCPEND,"SIG",PSOHQT,0)=$G(PSOHY("SIG",PSOHQ))
"RTN","PSOERX1B",223,0)
 S $P(^PS(52.41,PSOCPEND,"INI"),"^")=$G(PSOHINLO)
"RTN","PSOERX1B",224,0)
 ; add quantity/timing subfile information
"RTN","PSOERX1B",225,0)
 I $O(PSOHY("QTSUB",0)) D  I PSOHQT S ^PS(52.41,PSOCPEND,1,0)="^52.413^"_PSOHQT_"^"_PSOHQT
"RTN","PSOERX1B",226,0)
 .S PSOHQ="",PSOHQT=0 F  S PSOHQ=$O(PSOHY("QTSUB",PSOHQ)) Q:PSOHQ=""  D
"RTN","PSOERX1B",227,0)
 ..I $O(PSOHY("QTSUB",PSOHQ,0)) S PSOHQT=PSOHQT+1
"RTN","PSOERX1B",228,0)
 ..S ^PS(52.41,PSOCPEND,1,PSOHQT,0)=PSOHY("QTSUB",PSOHQ,0)
"RTN","PSOERX1B",229,0)
 ..S ^PS(52.41,PSOCPEND,1,PSOHQT,1)=PSOHY("QTSUB",PSOHQ,1)
"RTN","PSOERX1B",230,0)
 ..S ^PS(52.41,PSOCPEND,1,PSOHQT,2)=PSOHY("QTSUB",PSOHQ,2)
"RTN","PSOERX1B",231,0)
 I $O(PINARY(0)) D WP^DIE(52.41,PSOCPEND_",",105,"K","PINARY")
"RTN","PSOERX1B",232,0)
 ;Cross references not set yet preventing Pharmacy from finishing order
"RTN","PSOERX1B",233,0)
 D EN^PSOHLSNC(PSOCPEND,"SN","IP")
"RTN","PSOERX1B",234,0)
 D FULL^VALM1
"RTN","PSOERX1B",235,0)
 ;Just set to DC, don't delete because 52.41 entry would be re-used
"RTN","PSOERX1B",236,0)
 ;I '$P($G(^PS(52.41,PSOCPEND,"EXT")),"^",2) S DA=PSOCPEND,DIK="^PS(52.41," D ^DIK K DIK,DA S PSOEXMS="Unable to send CHCS order to CPRS." D NAK^PSOHLEXC Q
"RTN","PSOERX1B",237,0)
 I '$P($G(^PS(52.41,PSOCPEND,"EXT")),"^",2) D  S $P(^PS(52.41,PSOCPEND,0),"^",3)="DC" S PSOEXMS="Unable to send CHCS order to CPRS." Q
"RTN","PSOERX1B",238,0)
 .;x-ref shouldn't be set, but we'll kill them just in case
"RTN","PSOERX1B",239,0)
 .K ^PS(52.41,"AOR",$P(^PS(52.41,PSOCPEND,0),"^",2),+$P($G(^("INI")),"^"),PSOCPEND),^PS(52.41,"AD",$P(^PS(52.41,PSOCPEND,0),"^",12),+$P($G(^("INI")),"^"),PSOCPEND)
"RTN","PSOERX1B",240,0)
 .K ^PS(52.41,"ACL",+$P(^PS(52.41,PSOCPEND,0),"^",13),$P(^(0),"^",12),PSOCPEND),^PS(52.41,"AQ",+$P($G(^PS(52.41,PSOCPEND,0)),"^",21),PSOCPEND)
"RTN","PSOERX1B",241,0)
 .S $P(^PS(52.41,PSOCPEND,4),"^")="External order, unable to successfully transmit to CPRS."
"RTN","PSOERX1B",242,0)
 .W !!,"External order, unable to successfully transmit to CPRS."
"RTN","PSOERX1B",243,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",244,0)
 ;Successful transmission to CPRS
"RTN","PSOERX1B",245,0)
 S DA=PSOCPEND,DIK="^PS(52.41," D IX^DIK
"RTN","PSOERX1B",246,0)
 ; add the pending outpatient order number to 52.49 and update status of eRx to PR (Processed)
"RTN","PSOERX1B",247,0)
 S ERXSTA=$O(^PS(52.45,"C","ERX","PR",0))
"RTN","PSOERX1B",248,0)
 S ORDNUM=$P($G(^PS(52.41,PSOCPEND,0)),U)
"RTN","PSOERX1B",249,0)
 S DIE="^PS(52.49,",DR="25.2///"_PSOCPEND_";.12///"_ORDNUM,DA=PSOIEN D ^DIE K DIE,DA,DR
"RTN","PSOERX1B",250,0)
 ; add activity to status history
"RTN","PSOERX1B",251,0)
 D UPDSTAT^PSOERXU1(PSOIEN,"PR")
"RTN","PSOERX1B",252,0)
 ; gather the unexpanded sig and file in 52.41
"RTN","PSOERX1B",253,0)
 S ILOOP=0 F  S ILOOP=$O(^PS(52.49,PSOIEN,31,ILOOP)) Q:'ILOOP  D
"RTN","PSOERX1B",254,0)
 .S IARY(ILOOP)=$G(^PS(52.49,PSOIEN,31,ILOOP,0))
"RTN","PSOERX1B",255,0)
 I $D(IARY) D WP^DIE(52.41,PSOCPEND_",",9,"K","IARY","IERR")
"RTN","PSOERX1B",256,0)
 W !!,"eRx #"_PSOHY("CHNUM")_" sent to PENDING OUTPATIENT ORDERS!"
"RTN","PSOERX1B",257,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERX1B",258,0)
 Q
"RTN","PSOERX1B",259,0)
 ; remove eRx from holding queue
"RTN","PSOERX1B",260,0)
REM ;
"RTN","PSOERX1B",261,0)
 N DIR,Y,PSSRET,PSOIENS,REMIEN,REMSTA,REMTXT,ERXRMIEN,DIC,X,RXSTAT
"RTN","PSOERX1B",262,0)
 D FULL^VALM1
"RTN","PSOERX1B",263,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1B",264,0)
 S VALMBCK="R"
"RTN","PSOERX1B",265,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERX1B",266,0)
 .W !!,"Cannot remove a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERX1B",267,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",268,0)
 S DIR(0)="YO",DIR("A")="Would you like to 'Remove' eRx #"_$$GET1^DIQ(52.49,PSOIEN,.01,"E"),DIR("B")="Y" D ^DIR K DIR
"RTN","PSOERX1B",269,0)
 Q:'Y
"RTN","PSOERX1B",270,0)
 S DIC="^PS(52.45,",DIC(0)="AEMQ",DIC("S")="I $D(^PS(52.45,""TYPE"",""REM"",Y))",DIC("A")="Select REMOVAL reason code: "
"RTN","PSOERX1B",271,0)
 D ^DIC K DIC
"RTN","PSOERX1B",272,0)
 I $P(Y,U)<1 W !,"Removal reason code required!" S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1B",273,0)
 S REMIEN=$P(Y,U),REMSTA=$P(Y,U,2)
"RTN","PSOERX1B",274,0)
 K X,Y S DIR(0)="FO^1:70",DIR("A")="Additional Comments (Optional)" D ^DIR K DIR
"RTN","PSOERX1B",275,0)
 Q:Y="^"
"RTN","PSOERX1B",276,0)
 S REMTXT=Y
"RTN","PSOERX1B",277,0)
 S FDA(52.4919,"+1,"_PSOIENS,.01)=$$NOW^XLFDT,FDA(52.4919,"+1,"_PSOIENS,.02)=REMIEN
"RTN","PSOERX1B",278,0)
 S FDA(52.4919,"+1,"_PSOIENS,.03)=DUZ,FDA(52.4919,"+1,"_PSOIENS,1)=REMTXT
"RTN","PSOERX1B",279,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERX1B",280,0)
 ; SET THE ERX STATUS TO THE REMOVAL REASON
"RTN","PSOERX1B",281,0)
 S ERXRMIEN=$O(^PS(52.45,"C","ERX","RM",0))
"RTN","PSOERX1B",282,0)
 S DIE="^PS(52.49,",DR="1///"_ERXRMIEN,DA=PSOIEN D ^DIE
"RTN","PSOERX1B",283,0)
 K DIE,DA,DR
"RTN","PSOERX1B",284,0)
 Q
"RTN","PSOERX1B",285,0)
 ; reject eRx
"RTN","PSOERX1B",286,0)
REJ ;
"RTN","PSOERX1B",287,0)
 N DIR,DIC,Y,PSSRET,PSOIENS,REMTXT,REJSTA,FULLTXT,ERXRJIEN,REJDESC,REJIEN,REJTXT,X,RXSTAT
"RTN","PSOERX1B",288,0)
 D FULL^VALM1
"RTN","PSOERX1B",289,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1B",290,0)
 S VALMBCK="R"
"RTN","PSOERX1B",291,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERX1B",292,0)
 .W !!,"Cannot reject a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERX1B",293,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERX1B",294,0)
 S DIR(0)="YO",DIR("A")="Would you like to 'Reject' eRx #"_$$GET1^DIQ(52.49,PSOIEN,.01,"E"),DIR("B")="Y" D ^DIR K DIR
"RTN","PSOERX1B",295,0)
 Q:'Y
"RTN","PSOERX1B",296,0)
 S DIC="^PS(52.45,",DIC(0)="AEMQ",DIC("S")="I $D(^PS(52.45,""TYPE"",""REJ"",Y))",DIC("A")="Select REJECT reason code: "
"RTN","PSOERX1B",297,0)
 D ^DIC K DIC
"RTN","PSOERX1B",298,0)
 I $P(Y,U)<1 W !,"Reject reason required! eRx NOT rejected." S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1B",299,0)
 S REJIEN=$P(Y,U),REJSTA=$P(Y,U,2)
"RTN","PSOERX1B",300,0)
 K X,Y,DIR
"RTN","PSOERX1B",301,0)
 S DIR(0)="FO^1:70",DIR("A")="Additional Comments (Optional)" D ^DIR K DIR
"RTN","PSOERX1B",302,0)
 Q:Y="^"
"RTN","PSOERX1B",303,0)
 ;I '$L(Y)!(Y="^") W !,"Reject reason text required. eRx NOT rejected." S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1B",304,0)
 ; if reject reason was entered, log the activity.
"RTN","PSOERX1B",305,0)
 S REJTXT=Y
"RTN","PSOERX1B",306,0)
 S REJDESC=$$GET1^DIQ(52.45,REJIEN,.02,"E")
"RTN","PSOERX1B",307,0)
 S FULLTXT=REJSTA_"-"_REJDESC
"RTN","PSOERX1B",308,0)
 D POST^PSOERXO1(PSOIEN,.PSSRET,900,"",$E(FULLTXT,1,70))
"RTN","PSOERX1B",309,0)
 ; if the post was unsuccessful, inform the user and quit.
"RTN","PSOERX1B",310,0)
 I $P(PSSRET(0),U)<1 W !,$P(PSSRET(0),U,2) S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1B",311,0)
 I $D(PSSRET("errorMessage")) W !,PSSRET("errorMessage") S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERX1B",312,0)
 W !!,"Rejection message sent." S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERX1B",313,0)
 ; if post is successful, change the eRx status and log the status activity.
"RTN","PSOERX1B",314,0)
 S FDA(52.4919,"+1,"_PSOIENS,.01)=$$NOW^XLFDT
"RTN","PSOERX1B",315,0)
 S FDA(52.4919,"+1,"_PSOIENS,.02)=REJIEN
"RTN","PSOERX1B",316,0)
 S FDA(52.4919,"+1,"_PSOIENS,.03)=DUZ
"RTN","PSOERX1B",317,0)
 S FDA(52.4919,"+1,"_PSOIENS,1)=REJTXT
"RTN","PSOERX1B",318,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERX1B",319,0)
 ; SET THE ERX STATUS TO THE REJECT REASON
"RTN","PSOERX1B",320,0)
 S ERXRJIEN=$O(^PS(52.45,"C","ERX","RJ",0))
"RTN","PSOERX1B",321,0)
 S DIE="^PS(52.49,",DR="1///"_ERXRJIEN,DA=PSOIEN D ^DIE
"RTN","PSOERX1B",322,0)
 K DIE,DR,DA
"RTN","PSOERX1B",323,0)
 Q
"RTN","PSOERX1C")
0^20^B35864468^n/a
"RTN","PSOERX1C",1,0)
PSOERX1C ;ALB/BWF - eRx Utilities ; 8/3/2016 5:14pm
"RTN","PSOERX1C",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERX1C",3,0)
 ;
"RTN","PSOERX1C",4,0)
 Q
"RTN","PSOERX1C",5,0)
 ; select an item
"RTN","PSOERX1C",6,0)
PRINT(PSOIEN,OP) ;
"RTN","PSOERX1C",7,0)
 N %ZIS,POP
"RTN","PSOERX1C",8,0)
 S OP=$G(OP)
"RTN","PSOERX1C",9,0)
 D FULL^VALM1
"RTN","PSOERX1C",10,0)
 S VALMBCK="R"
"RTN","PSOERX1C",11,0)
 S %ZIS="Q",%ZIS("B")=$G(PSOPROP) D ^%ZIS Q:POP
"RTN","PSOERX1C",12,0)
 ; if queuing, queue it and quit.
"RTN","PSOERX1C",13,0)
 I $D(IO("Q")) D  Q
"RTN","PSOERX1C",14,0)
 .S ZTSAVE("PSOIEN")="",ZTSAVE("OP")=""
"RTN","PSOERX1C",15,0)
 .S ZTRTN="PRINTQ^PSOERX1C(PSOIEN,OP)",ZTDESC="eRx Print" D ^%ZTLOAD
"RTN","PSOERX1C",16,0)
 .K ZTSAVE,ZTRTN
"RTN","PSOERX1C",17,0)
 .D INIT^PSOERX1
"RTN","PSOERX1C",18,0)
 .D TERM^VALM0
"RTN","PSOERX1C",19,0)
 D PRINTQ(PSOIEN,OP)
"RTN","PSOERX1C",20,0)
 D TERM^VALM0
"RTN","PSOERX1C",21,0)
 D INIT^PSOERX1
"RTN","PSOERX1C",22,0)
 Q
"RTN","PSOERX1C",23,0)
 ; fallthrough if no queueing
"RTN","PSOERX1C",24,0)
PRINTQ(PSOIEN,OP) ;
"RTN","PSOERX1C",25,0)
 N %ZIS,POP,RXDAT,PHARIEN,PRVIEN,PATIEN,PHARDAT,PRVDAT,PATDAT,PSOIENS,PHNM,PHAD1,PHAD2,PHCTY
"RTN","PSOERX1C",26,0)
 N PHST,PHZIP,PHNCP,PHTEL,PRFNM,PRLNM,PRMNM,PRAD1,PRAD2,PRCTY,PRST,PRZIP,PRNPI,PRDEA,PRSTL,LTXT
"RTN","PSOERX1C",27,0)
 N PRTEL,PRFAX,PRSUPER,PRAGNT,PTLNM,PTFNM,PTMNM,PTAD1,PTAD2,PTCTY,PTST,PTZIP,PTDOB,PTGEN,PTHPHON,PTPLANID
"RTN","PSOERX1C",28,0)
 N PHARIENS,PATIENS,PRVIENS,PTSSN
"RTN","PSOERX1C",29,0)
 S OP=$G(OP,"")
"RTN","PSOERX1C",30,0)
 S PSOIEN=$G(PSOIEN)
"RTN","PSOERX1C",31,0)
 I '$G(PSOIEN) D
"RTN","PSOERX1C",32,0)
 .I $D(RXOR) S PSOIEN=$$CHKERX^PSOERXU1($P(RXOR,U,2)) Q:PSOIEN
"RTN","PSOERX1C",33,0)
 .I $D(OR0) S PSOIEN=$$CHKERX^PSOERXU1(OR0)
"RTN","PSOERX1C",34,0)
 Q:'$G(PSOIEN)
"RTN","PSOERX1C",35,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERX1C",36,0)
 I $D(ZTQUEUED) S ZTREQ="@"
"RTN","PSOERX1C",37,0)
 U IO
"RTN","PSOERX1C",38,0)
 D GETS^DIQ(52.49,PSOIENS,".04;2.1;2.5","I","RXDAT")
"RTN","PSOERX1C",39,0)
 S PHARIEN=$G(RXDAT(52.49,PSOIENS,2.5,"I")) I PHARIEN S PHARIENS=PHARIEN_","
"RTN","PSOERX1C",40,0)
 S PRVIEN=$G(RXDAT(52.49,PSOIENS,2.1,"I")) I PRVIEN S PRVIENS=PRVIEN_","
"RTN","PSOERX1C",41,0)
 S PATIEN=$G(RXDAT(52.49,PSOIENS,.04,"I")) I PATIEN S PATIENS=PATIEN_","
"RTN","PSOERX1C",42,0)
 D GETS^DIQ(52.47,PHARIENS,"**","E","PHARDAT")
"RTN","PSOERX1C",43,0)
 D GETS^DIQ(52.48,PRVIENS,"**","E","PRVDAT")
"RTN","PSOERX1C",44,0)
 D GETS^DIQ(52.46,PATIENS,"**","E","PATDAT")
"RTN","PSOERX1C",45,0)
 ; pharmacy information
"RTN","PSOERX1C",46,0)
 S PHNM=$G(PHARDAT(52.47,PHARIENS,.05,"E"))
"RTN","PSOERX1C",47,0)
 S PHAD1=$G(PHARDAT(52.47,PHARIENS,1.1,"E"))
"RTN","PSOERX1C",48,0)
 S PHAD2=$G(PHARDAT(52.47,PHARIENS,1.2,"E"))
"RTN","PSOERX1C",49,0)
 S PHCTY=$G(PHARDAT(52.47,PHARIENS,1.3,"E"))
"RTN","PSOERX1C",50,0)
 S PHST=$G(PHARDAT(52.47,PHARIENS,1.4,"E"))
"RTN","PSOERX1C",51,0)
 S PHZIP=$G(PHARDAT(52.47,PHARIENS,1.5,"E"))
"RTN","PSOERX1C",52,0)
 S PHNCP=$G(PHARDAT(52.47,PHARIENS,.02,"E"))
"RTN","PSOERX1C",53,0)
 ; todo - get telephone
"RTN","PSOERX1C",54,0)
 S PHTEL=""
"RTN","PSOERX1C",55,0)
 ; provider information
"RTN","PSOERX1C",56,0)
 S PRFNM=$G(PRVDAT(52.48,PRVIENS,.03,"E"))
"RTN","PSOERX1C",57,0)
 S PRMNM=$G(PRVDAT(52.48,PRVIENS,.04,"E"))
"RTN","PSOERX1C",58,0)
 S PRLNM=$G(PRVDAT(52.48,PRVIENS,.02,"E"))
"RTN","PSOERX1C",59,0)
 S PRAD1=$G(PRVDAT(52.48,PRVIENS,4.1,"E"))
"RTN","PSOERX1C",60,0)
 S PRAD2=$G(PRVDAT(52.48,PRVIENS,4.2,"E"))
"RTN","PSOERX1C",61,0)
 S PRCTY=$G(PRVDAT(52.48,PRVIENS,4.3,"E"))
"RTN","PSOERX1C",62,0)
 S PRST=$G(PRVDAT(52.48,PRVIENS,4.4,"E"))
"RTN","PSOERX1C",63,0)
 S PRZIP=$G(PRVDAT(52.48,PRVIENS,4.5,"E"))
"RTN","PSOERX1C",64,0)
 S PRNPI=$G(PRVDAT(52.48,PRVIENS,1.5,"E"))
"RTN","PSOERX1C",65,0)
 S PRDEA=$G(PRVDAT(52.48,PRVIENS,1.6,"E"))
"RTN","PSOERX1C",66,0)
 S PRSTL=$G(PRVDAT(52.48,PRVIENS,1.8,"E"))
"RTN","PSOERX1C",67,0)
 S PRTEL=""
"RTN","PSOERX1C",68,0)
 S PRFAX=""
"RTN","PSOERX1C",69,0)
 S PRSUPER=""
"RTN","PSOERX1C",70,0)
 S PRAGNT=""
"RTN","PSOERX1C",71,0)
 ; patient information
"RTN","PSOERX1C",72,0)
 S PTLNM=$G(PATDAT(52.46,PATIENS,.02,"E"))
"RTN","PSOERX1C",73,0)
 S PTMNM=$G(PATDAT(52.46,PATIENS,.04,"E"))
"RTN","PSOERX1C",74,0)
 S PTFNM=$G(PATDAT(52.46,PATIENS,.03,"E"))
"RTN","PSOERX1C",75,0)
 S PTAD1=$G(PATDAT(52.46,PATIENS,3.1,"E"))
"RTN","PSOERX1C",76,0)
 S PTAD2=$G(PATDAT(52.46,PATIENS,3.2,"E"))
"RTN","PSOERX1C",77,0)
 S PTCTY=$G(PATDAT(52.46,PATIENS,3.3,"E"))
"RTN","PSOERX1C",78,0)
 S PTST=$G(PATDAT(52.46,PATIENS,3.4,"E"))
"RTN","PSOERX1C",79,0)
 S PTZIP=$G(PATDAT(52.46,PATIENS,3.5,"E"))
"RTN","PSOERX1C",80,0)
 S PTDOB=$G(PATDAT(52.46,PATIENS,.08,"E"))
"RTN","PSOERX1C",81,0)
 S PTGEN=$G(PATDAT(52.46,PATIENS,.07,"E"))
"RTN","PSOERX1C",82,0)
 S PTSSN=$G(PATDAT(52.46,PATIENS,1.4,"E"))
"RTN","PSOERX1C",83,0)
 S PTHPHON=""
"RTN","PSOERX1C",84,0)
 S PTPLANID=""
"RTN","PSOERX1C",85,0)
 W !,"*************************PHARMACY INFORMATION****************************"
"RTN","PSOERX1C",86,0)
 W !,$$UP^XLFSTR(PHNM)
"RTN","PSOERX1C",87,0)
 W !,"Address: "_PHAD1
"RTN","PSOERX1C",88,0)
 I $L(PHAD2) W !,"         "_PHAD2
"RTN","PSOERX1C",89,0)
 W !,!,"         "_PHCTY_", "_PHST_" "_PHZIP
"RTN","PSOERX1C",90,0)
 S LTXT=""
"RTN","PSOERX1C",91,0)
 D ADDITEM^PSOERX1A(.LTXT,"Tel: ",PHTEL,1,26)
"RTN","PSOERX1C",92,0)
 D ADDITEM^PSOERX1A(.LTXT,"NCPDP: ",PHNCP,28,26)
"RTN","PSOERX1C",93,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",94,0)
 W !,"******************PRESCRIBER INFORMATION*********************************"
"RTN","PSOERX1C",95,0)
 W !,"First: "_PRFNM
"RTN","PSOERX1C",96,0)
 W !,"Mid: "_PRMNM
"RTN","PSOERX1C",97,0)
 W !,"Last: "_PRLNM
"RTN","PSOERX1C",98,0)
 W !,"Address: "_PRAD1
"RTN","PSOERX1C",99,0)
 I $L(PHAD2) W !,"         "_PRAD2
"RTN","PSOERX1C",100,0)
 W !,"         "_PRCTY_", "_PRST_" "_PRZIP
"RTN","PSOERX1C",101,0)
 S LTXT=""
"RTN","PSOERX1C",102,0)
 D ADDITEM^PSOERX1A(.LTXT,"NPI: ",PRNPI,1,26)
"RTN","PSOERX1C",103,0)
 D ADDITEM^PSOERX1A(.LTXT,"DEA: ",PRDEA,28,26)
"RTN","PSOERX1C",104,0)
 D ADDITEM^PSOERX1A(.LTXT,"State Lic: ",PRSTL,54,26)
"RTN","PSOERX1C",105,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",106,0)
 D ADDITEM^PSOERX1A(.LTXT,"Tel: ",PRTEL,1,26)
"RTN","PSOERX1C",107,0)
 D ADDITEM^PSOERX1A(.LTXT,"Fax: ",PRFAX,28,26)
"RTN","PSOERX1C",108,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",109,0)
 W !,"Supervisor: "_PRSUPER
"RTN","PSOERX1C",110,0)
 W !,"Agent: "_PRAGNT
"RTN","PSOERX1C",111,0)
 W !,"******************PATIENT INFORMATION************************************"
"RTN","PSOERX1C",112,0)
 S LTXT=""
"RTN","PSOERX1C",113,0)
 D ADDITEM^PSOERX1A(.LTXT,"Last: ",PTLNM,1,28)
"RTN","PSOERX1C",114,0)
 D ADDITEM^PSOERX1A(.LTXT,"First: ",PTFNM,30,28)
"RTN","PSOERX1C",115,0)
 D ADDITEM^PSOERX1A(.LTXT,"Mid: ",PTMNM,60,15)
"RTN","PSOERX1C",116,0)
 W !,LTXT
"RTN","PSOERX1C",117,0)
 S LTXT=""
"RTN","PSOERX1C",118,0)
 D ADDITEM^PSOERX1A(.LTXT,"SSN: ",PTSSN,1,28)
"RTN","PSOERX1C",119,0)
 D ADDITEM^PSOERX1A(.LTXT,"Sex: ",PTGEN,30,20) W !,LTXT S LTXT=""
"RTN","PSOERX1C",120,0)
 W !,"Address: "_PTAD1
"RTN","PSOERX1C",121,0)
 I $L(PTAD2) W !,"         "_PTAD2
"RTN","PSOERX1C",122,0)
 W !,"         "_PTCTY_", "_PTST_" "_PTZIP
"RTN","PSOERX1C",123,0)
 S LTXT=""
"RTN","PSOERX1C",124,0)
 D ADDITEM^PSOERX1A(.LTXT,"DOB: ",PTDOB,1,26)
"RTN","PSOERX1C",125,0)
 D ADDITEM^PSOERX1A(.LTXT,"Home: ",PTHPHON,28,16)
"RTN","PSOERX1C",126,0)
 D ADDITEM^PSOERX1A(.LTXT,"Plan ID: ",PTPLANID,52,27)
"RTN","PSOERX1C",127,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",128,0)
 W !,"******************PRESCRIPTION INFORMATION*******************************"
"RTN","PSOERX1C",129,0)
 W !,"eRx Drug: "_$$GET1^DIQ(52.49,PSOIEN,3.1,"E")
"RTN","PSOERX1C",130,0)
 S LTXT=""
"RTN","PSOERX1C",131,0)
 D ADDITEM^PSOERX1A(.LTXT,"Qty: ",$$GET1^DIQ(52.49,PSOIEN,5.1,"E"),1,26)
"RTN","PSOERX1C",132,0)
 D ADDITEM^PSOERX1A(.LTXT,"Days Supply: ",$$GET1^DIQ(52.49,PSOIEN,5.5,"E"),28,16)
"RTN","PSOERX1C",133,0)
 D ADDITEM^PSOERX1A(.LTXT,"Date Written: ",$$FMTE^XLFDT($$GET1^DIQ(52.49,PSOIEN,5.9,"E"),"2D"),52,27)
"RTN","PSOERX1C",134,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",135,0)
 D ADDITEM^PSOERX1A(.LTXT,"Qty Qualifier: ",$$GET1^DIQ(52.49,PSOIEN,5.2,"E"),1,26)
"RTN","PSOERX1C",136,0)
 D ADDITEM^PSOERX1A(.LTXT,"Drug Form: ",$$GET1^DIQ(52.49,PSOIEN,41,"E"),28,26)
"RTN","PSOERX1C",137,0)
 D ADDITEM^PSOERX1A(.LTXT,"Strength: ",$$GET1^DIQ(52.49,PSOIEN,43,"E"),52,26)
"RTN","PSOERX1C",138,0)
 W !,LTXT S LTXT=""
"RTN","PSOERX1C",139,0)
 W !,"Refills: "_$$GET1^DIQ(52.49,PSOIEN,5.6,"E")
"RTN","PSOERX1C",140,0)
 W !,"SIG: "_$$GET1^DIQ(52.49,PSOIEN,7,"E")
"RTN","PSOERX1C",141,0)
 D ADDITEM^PSOERX1A(.LTXT,"eRx Reference #: ",$$GET1^DIQ(52.49,PSOIEN,.01,"E"),1,40)
"RTN","PSOERX1C",142,0)
 D ADDITEM^PSOERX1A(.LTXT,"Message ID: ",$$GET1^DIQ(52.49,PSOIEN,25,"E"),42,35)
"RTN","PSOERX1C",143,0)
 W !!,LTXT S LTXT=""
"RTN","PSOERX1C",144,0)
 W !,"Dispense Notes: "_$$GET1^DIQ(52.49,PSOIEN,5.8,"E")
"RTN","PSOERX1C",145,0)
 W !,"Comments: "_$$GET1^DIQ(52.49,PSOIEN,8,"E")
"RTN","PSOERX1C",146,0)
 W !,"******************END OF eRx*********************************************"
"RTN","PSOERX1C",147,0)
 D:'$D(ZTQUEUED) ^%ZISC
"RTN","PSOERX1C",148,0)
 Q
"RTN","PSOERXA0")
0^4^B33077655^n/a
"RTN","PSOERXA0",1,0)
PSOERXA0 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXA0",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXA0",3,0)
 ;
"RTN","PSOERXA0",4,0)
 Q
"RTN","PSOERXA0",5,0)
 ; All parameters are optional, however at least one needs to be passed in for processing to be sucessful.
"RTN","PSOERXA0",6,0)
 ; NDCUPN - This is the NDC/UPN for the drug (optional)
"RTN","PSOERXA0",7,0)
 ; DGDESC - Drug description (optional)
"RTN","PSOERXA0",8,0)
DRGMTCH(PSORES,NDCUPN,DGDESC) ;
"RTN","PSOERXA0",9,0)
 N VAPRID,NDCUPNT,NDCUPNV,NDCUXREF,NUIEN,NDCERR,PSMIEN,NDCERR,PSDRG,PSDRGCNT,PSDGLST,I
"RTN","PSOERXA0",10,0)
 S (PSORES,NDCERR)=0
"RTN","PSOERXA0",11,0)
 I $G(DGDESC)]"" D
"RTN","PSOERXA0",12,0)
 .S DGDESC=$$UP^XLFSTR(DGDESC)
"RTN","PSOERXA0",13,0)
 .I $D(^PSDRUG("B",DGDESC)) D
"RTN","PSOERXA0",14,0)
 ..S (PSDRG,PSDRGCNT)=0 F  S PSDRG=$O(^PSDRUG("B",DGDESC,PSDRG)) Q:'PSDRG  D
"RTN","PSOERXA0",15,0)
 ...I '$$ACTIVE(PSDRG)!('$$OUTPAT(PSDRG))!($$INVCOMP(PSDRG))!($$CS(PSDRG)) Q
"RTN","PSOERXA0",16,0)
 ...S PSDRGCNT=PSDRGCNT+1,PSDGLST(PSDRG)=""
"RTN","PSOERXA0",17,0)
 ..I PSDRGCNT>1 S PSORES="0^More than one possible drug match found. Pharmacist review required."
"RTN","PSOERXA0",18,0)
 ..I PSDRGCNT=1 S PSMIEN=$O(^PSDRUG("B",DGDESC,0)),PSORES=PSMIEN_U_$$GET1^DIQ(50,PSMIEN,.01,"E") Q
"RTN","PSOERXA0",19,0)
 .I $D(^PSNDF(50.68,"B",DGDESC)) S VAPRID=$O(^PSNDF(50.68,"B",DGDESC,0)) Q
"RTN","PSOERXA0",20,0)
 .; is it possible to have more than one drug or va product match here? .01 fields are unique!
"RTN","PSOERXA0",21,0)
 ; direct match in DRUG file
"RTN","PSOERXA0",22,0)
 I $P(PSORES,U)>1 Q
"RTN","PSOERXA0",23,0)
 ; direct match in VA PRODUCT file
"RTN","PSOERXA0",24,0)
 I $G(VAPRID) D VAPRID(.PSORES,VAPRID) I $P(PSORES,U) Q
"RTN","PSOERXA0",25,0)
 I $G(NDCUPN)']"",$P(PSORES,U,2)]"" Q
"RTN","PSOERXA0",26,0)
 ; check the NDC/UPN if passed in
"RTN","PSOERXA0",27,0)
 I $G(NDCUPN)]"" D
"RTN","PSOERXA0",28,0)
 .S NDCUPNT=$P(NDCUPN,U),NDCUPNV=$P(NDCUPN,U,2),NDCUXREF=$S(NDCUPNT="N":"NDC",NDCUPNT="U":"UPN",1:"")
"RTN","PSOERXA0",29,0)
 .; if NDC is less than 12 in length, pad front with zeros until a length of 12 is achieved.
"RTN","PSOERXA0",30,0)
 .I NDCUPNT="N",$L(NDCUPNV)<12 D
"RTN","PSOERXA0",31,0)
 ..F I=1:1:12-$L(NDCUPNV) S NDCUPNV=0_NDCUPNV
"RTN","PSOERXA0",32,0)
 .S NUIEN=$O(^PSNDF(50.67,NDCUXREF,NDCUPNV,0)) I 'NUIEN S NDCERR=1 Q
"RTN","PSOERXA0",33,0)
 .S VAPRID=$$GET1^DIQ(50.67,NUIEN,5,"I")
"RTN","PSOERXA0",34,0)
 .I VAPRID D VAPRID(.PSORES,VAPRID)
"RTN","PSOERXA0",35,0)
 I $P(PSORES,U) Q
"RTN","PSOERXA0",36,0)
 I $G(NDCERR) S PSORES="0^NDC/UPN match not found." Q
"RTN","PSOERXA0",37,0)
 I $P(PSORES,U)=0 S PSORES="0^No matches found."
"RTN","PSOERXA0",38,0)
 Q
"RTN","PSOERXA0",39,0)
VAPRID(PSORES,VAPID) I '$G(VAPRID) S PSORES="0^No VA PRODUCT associated with this NDC/UPN." Q
"RTN","PSOERXA0",40,0)
 N VAPMTCH,VAPCNT,VAPDRG,PSODRG
"RTN","PSOERXA0",41,0)
 S (VAPMTCH,VAPCNT)=0 F  S VAPMTCH=$O(^PSDRUG("APR",VAPRID,VAPMTCH)) Q:'VAPMTCH  D
"RTN","PSOERXA0",42,0)
 .; ONLY GET MEDICATIONS FOR OUTPATIENT USE, AND ARE NOT MARKED INACTIVE
"RTN","PSOERXA0",43,0)
 .I '$$OUTPAT(VAPMTCH)!('$$ACTIVE(VAPMTCH))!($$INVCOMP(VAPMTCH))!($$CS(VAPMTCH)) Q
"RTN","PSOERXA0",44,0)
 .S VAPDRG(VAPMTCH)="",VAPCNT=VAPCNT+1
"RTN","PSOERXA0",45,0)
 I VAPCNT=1 S PSODRG=$O(VAPDRG(0)),PSORES=PSODRG_U_$$GET1^DIQ(50,PSODRG,.01,"E") Q
"RTN","PSOERXA0",46,0)
 I VAPCNT>1 S PSORES="0^Multiple matched drugs found. Pharmacist review required." Q
"RTN","PSOERXA0",47,0)
 Q
"RTN","PSOERXA0",48,0)
 ; active drug check
"RTN","PSOERXA0",49,0)
ACTIVE(DIEN) ;
"RTN","PSOERXA0",50,0)
 N INACTDT
"RTN","PSOERXA0",51,0)
 S INACTDT=$P($G(^PSDRUG(DIEN,"I")),U) I INACTDT,INACTDT<DT Q 0
"RTN","PSOERXA0",52,0)
 Q 1
"RTN","PSOERXA0",53,0)
 ; check to see if this is drug is marked for outpatient use
"RTN","PSOERXA0",54,0)
OUTPAT(DIEN) ;
"RTN","PSOERXA0",55,0)
 I $P($G(^PSDRUG(DIEN,2)),U,3)["O" Q 1
"RTN","PSOERXA0",56,0)
 Q 0
"RTN","PSOERXA0",57,0)
 ; check to see if the drug is investigational or compond
"RTN","PSOERXA0",58,0)
INVCOMP(DIEN) ;
"RTN","PSOERXA0",59,0)
 N X
"RTN","PSOERXA0",60,0)
 S X=$P($G(^PSDRUG(DIEN,0)),U,3)
"RTN","PSOERXA0",61,0)
 ; if a supply, not controlled substance
"RTN","PSOERXA0",62,0)
 I X="S" Q 0
"RTN","PSOERXA0",63,0)
 I X["I"!(X["0")!(X["M") Q 1
"RTN","PSOERXA0",64,0)
 Q 0
"RTN","PSOERXA0",65,0)
CS(DIEN) ;
"RTN","PSOERXA0",66,0)
 N X
"RTN","PSOERXA0",67,0)
 S X=$P($G(^PSDRUG(DIEN,0)),U,3)
"RTN","PSOERXA0",68,0)
 I X["S" Q 0
"RTN","PSOERXA0",69,0)
 I X]"",+X<6 Q 1
"RTN","PSOERXA0",70,0)
 Q 0
"RTN","PSOERXA0",71,0)
CHKSTR() ;
"RTN","PSOERXA0",72,0)
 Q
"RTN","PSOERXA0",73,0)
TPRVMTCH ;
"RTN","PSOERXA0",74,0)
 N X,Y,TRES
"RTN","PSOERXA0",75,0)
 S X="" F  S X=$O(^VA(200,"PS1",X)) Q:X=""  D
"RTN","PSOERXA0",76,0)
 .S Y=0 F  S Y=$O(^VA(200,"PS1",X,Y)) Q:'Y  D
"RTN","PSOERXA0",77,0)
 ..K TRES D PRVMTCH(.TRES,"",X) I $P(TRES,U)=0 W !,TRES_" "_X Q
"RTN","PSOERXA0",78,0)
 ..I $P(TRES,U) W !,X,?20,$$GET1^DIQ(200,Y,.01,"E")
"RTN","PSOERXA0",79,0)
 Q
"RTN","PSOERXA0",80,0)
 ; Match provider given NPI, DEA, or provider name.
"RTN","PSOERXA0",81,0)
 ; NPI - NPI value for the provider
"RTN","PSOERXA0",82,0)
 ; DEA - Providers' DEA number
"RTN","PSOERXA0",83,0)
 ; CS - controlled substance (1-yes, 0 or "" - no)
"RTN","PSOERXA0",84,0)
PRVMTCH(PSORES,NPI,DEA,CS) ;
"RTN","PSOERXA0",85,0)
 N NPIEN,MATCH,VAL,NVAL,INDEX,NPCNT,NPLIST,DEACNT,SRCH,DEACNT,DEAMTCH,NDMTCH,DEAIEN
"RTN","PSOERXA0",86,0)
 N DEACHK
"RTN","PSOERXA0",87,0)
 S (PSORES,MATCH)=0
"RTN","PSOERXA0",88,0)
 S NPI=$G(NPI,""),DEA=$G(DEA,"")
"RTN","PSOERXA0",89,0)
 I NPI="",DEA="" S PSORES="0^NPI and DEA# missing." Q
"RTN","PSOERXA0",90,0)
 I $G(CS),DEA="" S PSORES="0^DEA # must be provided with controlled substances." Q
"RTN","PSOERXA0",91,0)
 I $G(CS),NPI="" S PSORES="0^NPI must be provided with controlled substances." Q
"RTN","PSOERXA0",92,0)
 I $G(CS),'$D(^VA(200,"ANPI",NPI)) S PSORES="0^NPI# does not exist in this system." Q
"RTN","PSOERXA0",93,0)
 I $G(CS),'$D(^VA(200,"PS1",DEA)) S PSORES="0^DEA# does not exist in this system." Q
"RTN","PSOERXA0",94,0)
 I '$G(CS),NPI="" D  Q
"RTN","PSOERXA0",95,0)
 .I DEA="" S PSORES="0^Missing DEA number." Q
"RTN","PSOERXA0",96,0)
 .I '$D(^VA(200,"PS1",DEA)) S PSORES="0^DEA# does not exist at this location." Q
"RTN","PSOERXA0",97,0)
 .S (DEACHK,DEACNT)=0 F  S DEACHK=$O(^VA(200,"PS1",DEA,DEACHK)) Q:'DEACHK  D
"RTN","PSOERXA0",98,0)
 ..S DEACNT=$G(DEACNT)+1
"RTN","PSOERXA0",99,0)
 .I DEACNT>1 S PSORES="0^Multiple DEA matches found." Q
"RTN","PSOERXA0",100,0)
 .I DEACNT=1 S DEAIEN=$O(^VA(200,"PS1",DEA,0))
"RTN","PSOERXA0",101,0)
 .I '$$MEDAUTH(DEAIEN) S PSORES="0^DEA match, not authorized to write medication orders." Q
"RTN","PSOERXA0",102,0)
 .S PSORES=DEAIEN_U_$$GET1^DIQ(200,DEAIEN,.01,"E")
"RTN","PSOERXA0",103,0)
 I '$D(^VA(200,"ANPI",NPI)) S PSORES="0^No matching NPI." Q
"RTN","PSOERXA0",104,0)
 ; get a list of providers that match the NPI#
"RTN","PSOERXA0",105,0)
 S (NPIEN,NPCNT)=0 F  S NPIEN=$O(^VA(200,"ANPI",NPI,NPIEN)) Q:'NPIEN  D
"RTN","PSOERXA0",106,0)
 .S NPLIST(NPIEN)="",NPCNT=$G(NPCNT)+1
"RTN","PSOERXA0",107,0)
 ; no matches
"RTN","PSOERXA0",108,0)
 I '$D(NPLIST) S PSORES="0^Could not match provided NPI." Q
"RTN","PSOERXA0",109,0)
 I '$G(CS),NPCNT>1 S PSORES="0^Multiple provider matches found." Q
"RTN","PSOERXA0",110,0)
 I NPCNT=0 S PSORES="0^No NPI match found." Q
"RTN","PSOERXA0",111,0)
 I '$G(CS),NPCNT=1 D  Q
"RTN","PSOERXA0",112,0)
 .S NDMTCH=$O(NPLIST(0))
"RTN","PSOERXA0",113,0)
 .I '$$MEDAUTH(NDMTCH) S PSORES="0^NPI match found, not authorized to write medication orders." Q
"RTN","PSOERXA0",114,0)
 .S PSORES=NDMTCH_U_$$GET1^DIQ(200,$O(NPLIST(0)),.01,"E")
"RTN","PSOERXA0",115,0)
 ; if this is a controlled substance, we must match both the NPI and the DEA#
"RTN","PSOERXA0",116,0)
 S (SRCH,DEACNT)=0 F  S SRCH=$O(NPLIST(SRCH)) Q:'SRCH  D
"RTN","PSOERXA0",117,0)
 .I '$D(^VA(200,"PS1",DEA,SRCH)) Q
"RTN","PSOERXA0",118,0)
 .S DEAMTCH(SRCH)="",DEACNT=$G(DEACNT)+1
"RTN","PSOERXA0",119,0)
 I DEACNT>1 S PSORES="0^Multiple DEA matches found." Q
"RTN","PSOERXA0",120,0)
 I DEACNT=0 S PSORES="0^NPI match, DEA mismatch." Q
"RTN","PSOERXA0",121,0)
 S NDMTCH=$O(DEAMTCH(0))
"RTN","PSOERXA0",122,0)
 I '$$MEDAUTH(NDMTCH) S PSORES="0^NPI/DEA match, not authorized to write medication orders." Q
"RTN","PSOERXA0",123,0)
 I NDMTCH S PSORES=NDMTCH_U_$$GET1^DIQ(200,NDMTCH,.01,"E") Q
"RTN","PSOERXA0",124,0)
 S PSORES="0^Matching procedure completed with no results."
"RTN","PSOERXA0",125,0)
 Q
"RTN","PSOERXA0",126,0)
 ; ensure the dea# is active
"RTN","PSOERXA0",127,0)
DEACTIVE(USER) ;
"RTN","PSOERXA0",128,0)
 N EXPDT
"RTN","PSOERXA0",129,0)
 S EXPDT=$$GET1^DIQ(200,USER,747.44,"I")
"RTN","PSOERXA0",130,0)
 I EXPDT,EXPDT<DT Q 0
"RTN","PSOERXA0",131,0)
 Q 1
"RTN","PSOERXA0",132,0)
 ; check to ensure the provider is authorized to write med orders
"RTN","PSOERXA0",133,0)
MEDAUTH(USER) ;
"RTN","PSOERXA0",134,0)
 Q $$GET1^DIQ(200,USER,53.1,"I")
"RTN","PSOERXA1")
0^5^B228588207^n/a
"RTN","PSOERXA1",1,0)
PSOERXA1 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXA1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXA1",3,0)
 ;
"RTN","PSOERXA1",4,0)
 Q
"RTN","PSOERXA1",5,0)
 ; File incoming XML into appropriate file
"RTN","PSOERXA1",6,0)
 ; XML - xml text
"RTN","PSOERXA1",7,0)
 ; PRCHK - provider check information
"RTN","PSOERXA1",8,0)
 ; PACHK - patient check information
"RTN","PSOERXA1",9,0)
 ; DACHK - drug auto check
"RTN","PSOERXA1",10,0)
 ; STATION - station #
"RTN","PSOERXA1",11,0)
 ; DIV - division
"RTN","PSOERXA1",12,0)
 ; ERXHID - eRx processing hub id
"RTN","PSOERXA1",13,0)
 ; ERXVALS - code values for NCit codes
"RTN","PSOERXA1",14,0)
INCERX(RES,XML,PRCHK,PACHK,DACHK,STATION,DIV,ERXHID,ERXVALS,XML2) ;
"RTN","PSOERXA1",15,0)
 N CURREC,FDA,EIEN,ERRTXT,ERRSEQ,PACNT,PASCNT,PAICN,PAIEN,VAINST,NPI,VAOI,VPATINST
"RTN","PSOERXA1",16,0)
 ; meds by mail modification. Same institution pointed to by multiple outpatient pharmacy systems.
"RTN","PSOERXA1",17,0)
 ; additionally, 741CHEY and 741DUB are not associated with an institution in file 4.
"RTN","PSOERXA1",18,0)
 S NPI=$P($G(DIV),U,2)
"RTN","PSOERXA1",19,0)
 S CURREC=$$PARSE(.XML,.ERXVALS,NPI,.XML2)
"RTN","PSOERXA1",20,0)
 I $P(CURREC,U)<1 D  Q
"RTN","PSOERXA1",21,0)
 .I $L($P(CURREC,U,2)) S RES=CURREC Q
"RTN","PSOERXA1",22,0)
 .S RES="0^XML received. Error creating or finding associated record in the ERX Holding queue." Q
"RTN","PSOERXA1",23,0)
 S EIEN=CURREC
"RTN","PSOERXA1",24,0)
 S CURREC=CURREC_","
"RTN","PSOERXA1",25,0)
 ; Process auto-validation results. only log positive results for now - bwf 2/1/2017
"RTN","PSOERXA1",26,0)
 K FDA
"RTN","PSOERXA1",27,0)
 I DACHK("success")="true" D
"RTN","PSOERXA1",28,0)
 .I $G(DACHK("IEN")) D
"RTN","PSOERXA1",29,0)
 ..S FDA(52.49,CURREC,1.4)=1
"RTN","PSOERXA1",30,0)
 ..S FDA(52.49,CURREC,3.2)=DACHK("IEN")
"RTN","PSOERXA1",31,0)
 ..S FDA(52.49,CURREC,44)=1
"RTN","PSOERXA1",32,0)
 ..S VAOI=$$GET1^DIQ(50,DACHK("IEN"),2.1,"I")
"RTN","PSOERXA1",33,0)
 ..S VPATINST=$$GET1^DIQ(50.7,VAOI,7,"E")
"RTN","PSOERXA1",34,0)
 ..I $L(VPATINST) S FDA(52.49,CURREC,27)=VPATINST
"RTN","PSOERXA1",35,0)
 I DACHK("success")="false" D
"RTN","PSOERXA1",36,0)
 .S ERRTXT=$G(DACHK("error"))
"RTN","PSOERXA1",37,0)
 .S ERRSEQ=$$ERRSEQ^PSOERXU1() Q:'ERRSEQ
"RTN","PSOERXA1",38,0)
 .D FILERR^PSOERXU1(CURREC,ERRSEQ,"D","E",ERRTXT)
"RTN","PSOERXA1",39,0)
 I $G(PRCHK("success"))="true" D
"RTN","PSOERXA1",40,0)
 .I PRCHK("IEN") D
"RTN","PSOERXA1",41,0)
 ..S FDA(52.49,CURREC,1.2)=1
"RTN","PSOERXA1",42,0)
 ..S FDA(52.49,CURREC,2.3)=PRCHK("IEN")
"RTN","PSOERXA1",43,0)
 I $G(PRCHK("success"))="false" D
"RTN","PSOERXA1",44,0)
 .S ERRTXT=$G(PRCHK("error"))
"RTN","PSOERXA1",45,0)
 .S ERRSEQ=$$ERRSEQ^PSOERXU1() Q:'ERRSEQ
"RTN","PSOERXA1",46,0)
 .D FILERR^PSOERXU1(CURREC,ERRSEQ,"PR","E",ERRTXT)
"RTN","PSOERXA1",47,0)
 ; replacing below line with the one that follows for patient matching
"RTN","PSOERXA1",48,0)
 ; if there is no MVIerror, the MVI check was successful, so we need to try to auto-match the patient
"RTN","PSOERXA1",49,0)
 ;I PACHK("success")="true" D
"RTN","PSOERXA1",50,0)
 I $G(PACHK("MVIerror"))']"" D
"RTN","PSOERXA1",51,0)
 .S PAICN=+$P($G(PACHK("ICN")),"V")
"RTN","PSOERXA1",52,0)
 .I PAICN D
"RTN","PSOERXA1",53,0)
 ..S (PAIEN,PACNT)=0 F  S PAIEN=$O(^DPT("AICN",PAICN,PAIEN)) Q:'PAIEN  D
"RTN","PSOERXA1",54,0)
 ...S PACNT=PACNT+1
"RTN","PSOERXA1",55,0)
 ...; revisit in future build - if we find more than one match in the local system, do we log some sort of an error?
"RTN","PSOERXA1",56,0)
 .I $G(PACNT)=1 D  Q
"RTN","PSOERXA1",57,0)
 ..S FDA(52.49,CURREC,1.6)=1
"RTN","PSOERXA1",58,0)
 ..S FDA(52.49,CURREC,.05)=$O(^DPT("AICN",PAICN,0))
"RTN","PSOERXA1",59,0)
 .I $L(PACHK("ssn")) D
"RTN","PSOERXA1",60,0)
 ..S (PASCNT,PAIEN)=0 F  S PAIEN=$O(^DPT("SSN",$TR(PACHK("ssn"),"-",""),PAIEN)) Q:'PAIEN  D
"RTN","PSOERXA1",61,0)
 ...S PASCNT=PASCNT+1
"RTN","PSOERXA1",62,0)
 .I $G(PASCNT)=1 D  Q
"RTN","PSOERXA1",63,0)
 ..S FDA(52.49,CURREC,1.6)=1
"RTN","PSOERXA1",64,0)
 ..S FDA(52.49,CURREC,.05)=$O(^DPT("SSN",$TR(PACHK("ssn"),"-",""),0))
"RTN","PSOERXA1",65,0)
 I $D(FDA) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",66,0)
 I $G(PACHK("success"))="false" D
"RTN","PSOERXA1",67,0)
 .; file e&e error
"RTN","PSOERXA1",68,0)
 .S ERRTXT=$G(PACHK("EandEerror")) I ERRTXT]"" D
"RTN","PSOERXA1",69,0)
 ..S ERRSEQ=$$ERRSEQ^PSOERXU1() Q:'ERRSEQ
"RTN","PSOERXA1",70,0)
 ..D FILERR^PSOERXU1(CURREC,ERRSEQ,"PA","E",ERRTXT)
"RTN","PSOERXA1",71,0)
 .; file mvi error
"RTN","PSOERXA1",72,0)
 .S ERRTXT=$G(PACHK("MVIerror")) I ERRTXT]"" D
"RTN","PSOERXA1",73,0)
 ..S ERRSEQ=$$ERRSEQ^PSOERXU1() Q:'ERRSEQ
"RTN","PSOERXA1",74,0)
 ..D FILERR^PSOERXU1(CURREC,ERRSEQ,"PA","E",ERRTXT)
"RTN","PSOERXA1",75,0)
 S RES="1^Erx Received."
"RTN","PSOERXA1",76,0)
 Q
"RTN","PSOERXA1",77,0)
PARSE(STREAM,ERXVALS,NPI,STREAM2) ;
"RTN","PSOERXA1",78,0)
 N %XML,GL,VAINST
"RTN","PSOERXA1",79,0)
 S GL=$NA(^TMP($J,"PSOERXO1"))
"RTN","PSOERXA1",80,0)
 K @GL
"RTN","PSOERXA1",81,0)
 N STATUS,READER,XOBERR,S,ATTR,READER2,XOBERR2,STATUS2
"RTN","PSOERXA1",82,0)
 S STREAM=$TR(STREAM,"^","")
"RTN","PSOERXA1",83,0)
 I $L(STREAM2) S STREAM2=$TR(STREAM2,"^","")
"RTN","PSOERXA1",84,0)
 S STATUS=##class(%XML.TextReader).ParseStream(STREAM,.READER,,,,,1)
"RTN","PSOERXA1",85,0)
 I $L(STREAM2) S STATUS2=##class(%XML.TextReader).ParseStream(STREAM2,.READER2,,,,,1)
"RTN","PSOERXA1",86,0)
 I $$STATCHK^XOBWLIB(STATUS,.XOBERR,1) D
"RTN","PSOERXA1",87,0)
 .N BREAK
"RTN","PSOERXA1",88,0)
 .S BREAK=0 F  Q:BREAK||READER.EOF||'READER.Read()  D
"RTN","PSOERXA1",89,0)
 ..N X,PUSHED,PARENT
"RTN","PSOERXA1",90,0)
 ..I READER.AttributeCount D
"RTN","PSOERXA1",91,0)
 ...S PARENT=READER.LocalName
"RTN","PSOERXA1",92,0)
 ...D SPUSH(.S,PARENT) S PUSHED=1
"RTN","PSOERXA1",93,0)
 ...F ATTR=1:1:READER.AttributeCount D
"RTN","PSOERXA1",94,0)
 ....D READER.MoveToAttributeIndex(ATTR)
"RTN","PSOERXA1",95,0)
 ....I READER.NodeType="attribute" D APUT(.S,READER.Value,READER.LocalName)
"RTN","PSOERXA1",96,0)
 ..I READER.NodeType="element",'$G(PUSHED) D SPUSH(.S,READER.LocalName)
"RTN","PSOERXA1",97,0)
 ..I READER.NodeType="endelement" D SPOP(.S,.X)
"RTN","PSOERXA1",98,0)
 ..I READER.NodeType="chars" D SPUT(.S,READER.Value)
"RTN","PSOERXA1",99,0)
 I $$STATCHK^XOBWLIB(STATUS2,.XOBERR2,1) D
"RTN","PSOERXA1",100,0)
 .N BREAK,S
"RTN","PSOERXA1",101,0)
 .S BREAK=0 F  Q:BREAK||READER2.EOF||'READER2.Read()  D
"RTN","PSOERXA1",102,0)
 ..N X,PUSHED,PARENT
"RTN","PSOERXA1",103,0)
 ..I READER2.AttributeCount D
"RTN","PSOERXA1",104,0)
 ...S PARENT=READER2.LocalName
"RTN","PSOERXA1",105,0)
 ...D SPUSH(.S,PARENT) S PUSHED=1
"RTN","PSOERXA1",106,0)
 ...F ATTR=1:1:READER2.AttributeCount D
"RTN","PSOERXA1",107,0)
 ....D READER2.MoveToAttributeIndex(ATTR)
"RTN","PSOERXA1",108,0)
 ....I READER2.NodeType="attribute" D APUT(.S,READER2.Value,READER2.LocalName)
"RTN","PSOERXA1",109,0)
 ..I READER2.NodeType="element",'$G(PUSHED) D SPUSH(.S,READER2.LocalName)
"RTN","PSOERXA1",110,0)
 ..I READER2.NodeType="endelement" D SPOP(.S,.X)
"RTN","PSOERXA1",111,0)
 ..I READER2.NodeType="chars" D SPUT(.S,READER2.Value)
"RTN","PSOERXA1",112,0)
 I '$L(NPI) S NPI=$G(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Pharmacy",0,"Identification",0,"NPI",0))
"RTN","PSOERXA1",113,0)
 I '$L(NPI) Q "0^Missing NPI. Institution could not be resolved. eRx not filed."
"RTN","PSOERXA1",114,0)
 S VAINST=$$FIND1^DIC(4,,"O",NPI,"ANPI")
"RTN","PSOERXA1",115,0)
 I '$G(VAINST) Q "0^Institution could not be resolved. eRx not filed."
"RTN","PSOERXA1",116,0)
 N NERXIEN,ERR
"RTN","PSOERXA1",117,0)
 S NERXIEN=$$HDR()
"RTN","PSOERXA1",118,0)
 I $P(NERXIEN,U)<1 Q NERXIEN
"RTN","PSOERXA1",119,0)
 I $G(VAINST) S FDA(52.49,NERXIEN_",",24.1)=VAINST D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",120,0)
 D PAT(NERXIEN),BFC(NERXIEN),PHR^PSOERXA2(NERXIEN),PRE^PSOERXA2(NERXIEN)
"RTN","PSOERXA1",121,0)
 D MED^PSOERXA3(NERXIEN,.ERXVALS),OBS(NERXIEN),SUP^PSOERXA2(NERXIEN)
"RTN","PSOERXA1",122,0)
 ; facility/request have no where to go at this point in time??
"RTN","PSOERXA1",123,0)
 ;D FAC(ERXIEN),REQ(ERXIEN)
"RTN","PSOERXA1",124,0)
 Q NERXIEN
"RTN","PSOERXA1",125,0)
HDR() ; header information
"RTN","PSOERXA1",126,0)
 N GL,GL2,FQUAL,TQUAL,FROM,TO,MID,PONUM,SRTID,SSTID,SENTTIME,RTMID,FDA,ERXIEN,FMID,NEWERX,MES,ERXIENS,SSSID,SRSID
"RTN","PSOERXA1",127,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Header",0))
"RTN","PSOERXA1",128,0)
 S GL2=$NA(^TMP($J,"PSOERXO1","Message","A","Qualifier","Header","A","Qualifier"))
"RTN","PSOERXA1",129,0)
 ; from and to qualifiers
"RTN","PSOERXA1",130,0)
 S FQUAL=$G(@GL2@("From","A","Qualifier"))
"RTN","PSOERXA1",131,0)
 S TQUAL=$G(@GL2@("To","A","Qualifier"))
"RTN","PSOERXA1",132,0)
 ; from, to, message id, prescriber order number
"RTN","PSOERXA1",133,0)
 S FROM=$G(@GL@("From",0))
"RTN","PSOERXA1",134,0)
 S TO=$G(@GL@("To",0))
"RTN","PSOERXA1",135,0)
 S MID=$G(@GL@("MessageID",0))
"RTN","PSOERXA1",136,0)
 ; set up the full message id
"RTN","PSOERXA1",137,0)
 S FMID=MID
"RTN","PSOERXA1",138,0)
 ; This logic was intended to handle 'updates' to and existing message if the same message id was received
"RTN","PSOERXA1",139,0)
 ; however, updates should probably occur through a change request, so if the same message id is received, we
"RTN","PSOERXA1",140,0)
 ; are returning an error.
"RTN","PSOERXA1",141,0)
 ;I $D(^PS(52.49,"FMID",FMID)) D
"RTN","PSOERXA1",142,0)
 ;.S ERXIEN=$O(^PS(52.49,"FMID",FMID,0)),UPDATE=1
"RTN","PSOERXA1",143,0)
 ;I '$G(ERXIEN) S ERXIEN="+1"
"RTN","PSOERXA1",144,0)
 S ERXIENS="+1,"
"RTN","PSOERXA1",145,0)
 ; quit and return a message back if this eRx exists.
"RTN","PSOERXA1",146,0)
 I $D(^PS(52.49,"FMID",ERXHID)) D  Q MES
"RTN","PSOERXA1",147,0)
 .S MES="0^This message already exists. Changes must occur via a change request XML message."
"RTN","PSOERXA1",148,0)
 S PONUM=$G(@GL@("PrescriberOrderNumber",0))
"RTN","PSOERXA1",149,0)
 ; security receiver tertiary identification
"RTN","PSOERXA1",150,0)
 S SRSID=$G(@GL@("Security",0,"Receiver",0,"SecondaryIdentification",0))
"RTN","PSOERXA1",151,0)
 S SRTID=$G(@GL@("Security",0,"Receiver",0,"TertiaryIdentification,",0))
"RTN","PSOERXA1",152,0)
 ; security sender tertiary identification
"RTN","PSOERXA1",153,0)
 S SSSID=$G(@GL@("Security",0,"Sender",0,"SecondaryIdentification",0))
"RTN","PSOERXA1",154,0)
 S SSTID=$G(@GL@("Security",0,"Sender",0,"TertiaryIdentification,",0))
"RTN","PSOERXA1",155,0)
 ; convert senttime to file manager dt/tm
"RTN","PSOERXA1",156,0)
 S SENTTIME=$G(@GL@("SentTime",0)),SENTTIME=$$CONVDTTM^PSOERXA1(SENTTIME)
"RTN","PSOERXA1",157,0)
 S RTMID=$G(@GL@("RelatesToMessageID",0))
"RTN","PSOERXA1",158,0)
 ; erx hub message id
"RTN","PSOERXA1",159,0)
 S FDA(52.49,ERXIENS,.01)=ERXHID
"RTN","PSOERXA1",160,0)
 ; change healthcare message id
"RTN","PSOERXA1",161,0)
 S FDA(52.49,ERXIENS,25)=FMID
"RTN","PSOERXA1",162,0)
 S FDA(52.49,ERXIENS,.02)=RTMID
"RTN","PSOERXA1",163,0)
 S FDA(52.49,ERXIENS,.03)=$$NOW^XLFDT
"RTN","PSOERXA1",164,0)
 S FDA(52.49,ERXIENS,.09)=PONUM
"RTN","PSOERXA1",165,0)
 S FDA(52.49,ERXIENS,1)=$$PRESOLV^PSOERXA1("N","ERX")
"RTN","PSOERXA1",166,0)
 S FDA(52.49,ERXIENS,22.1)=FROM
"RTN","PSOERXA1",167,0)
 S FDA(52.49,ERXIENS,22.2)=FQUAL
"RTN","PSOERXA1",168,0)
 S FDA(52.49,ERXIENS,22.3)=TO
"RTN","PSOERXA1",169,0)
 S FDA(52.49,ERXIENS,22.4)=TQUAL
"RTN","PSOERXA1",170,0)
 S FDA(52.49,ERXIENS,22.5)=SENTTIME
"RTN","PSOERXA1",171,0)
 S FDA(52.49,ERXIENS,24.3)=SSSID
"RTN","PSOERXA1",172,0)
 S FDA(52.49,ERXIENS,24.4)=SSTID
"RTN","PSOERXA1",173,0)
 S FDA(52.49,ERXIENS,24.5)=SRSID
"RTN","PSOERXA1",174,0)
 S FDA(52.49,ERXIENS,24.6)=SRTID
"RTN","PSOERXA1",175,0)
 ; if this is an existing record, file the updates to the erx and return the IEN
"RTN","PSOERXA1",176,0)
 ;I $G(UPDATE) D FILE^DIE(,"FDA") K FDA Q ERXIEN
"RTN","PSOERXA1",177,0)
 D UPDATE^DIE(,"FDA","NEWERX","EERR") K FDA
"RTN","PSOERXA1",178,0)
 S ERXIEN=""
"RTN","PSOERXA1",179,0)
 S ERXIEN=$O(NEWERX(0)),ERXIEN=$G(NEWERX(ERXIEN))
"RTN","PSOERXA1",180,0)
 I 'ERXIEN Q ""
"RTN","PSOERXA1",181,0)
 ; Future consideration - XSD shows digital signature. Do we need to collect this?
"RTN","PSOERXA1",182,0)
 Q ERXIEN
"RTN","PSOERXA1",183,0)
BFC(ERXIEN) ; benefits coordination
"RTN","PSOERXA1",184,0)
 N GL,BFCCNT,CHFN,CHLN,CHMN,CHPRE,CHSUFF,CHID,GRPID,PAYIDTYP,PAYIDVAL,CHFN,F,PIEN,NEWPAYER,BFCERR,IENS,CHFULLN,FDA,BSEQ
"RTN","PSOERXA1",185,0)
 S F=52.4918
"RTN","PSOERXA1",186,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"BenefitsCoordination"))
"RTN","PSOERXA1",187,0)
 ; cannot start at 0, since the first entry is on the 0 subscript.
"RTN","PSOERXA1",188,0)
 S BSEQ=0
"RTN","PSOERXA1",189,0)
 S BFCCNT=-1 F  S BFCCNT=$O(@GL@(BFCCNT)) Q:BFCCNT=""  D
"RTN","PSOERXA1",190,0)
 .S BSEQ=BSEQ+1
"RTN","PSOERXA1",191,0)
 .S CHFN=$$UP^XLFSTR($G(@GL@(BFCCNT,"CardHolderName",0,"FirstName",0)))
"RTN","PSOERXA1",192,0)
 .S CHLN=$$UP^XLFSTR($G(@GL@(BFCCNT,"CardHolderName",0,"LastName",0)))
"RTN","PSOERXA1",193,0)
 .S CHMN=$$UP^XLFSTR($G(@GL@(BFCCNT,"CardHolderName",0,"MiddleName",0)))
"RTN","PSOERXA1",194,0)
 .; set up full name - last, first, mi
"RTN","PSOERXA1",195,0)
 .S CHFULLN=CHLN_","_CHFN_$S(CHMN]"":" "_CHMN,1:"")
"RTN","PSOERXA1",196,0)
 .S CHPRE=$$UP^XLFSTR($G(@GL@(BFCCNT,"CardHolderName",0,"Prefix",0)))
"RTN","PSOERXA1",197,0)
 .S CHSUFF=$$UP^XLFSTR($G(@GL@(BFCCNT,"CardHolderName",0,"Suffix",0)))
"RTN","PSOERXA1",198,0)
 .S CHID=$G(@GL@(BFCCNT,"CardholderID",0))
"RTN","PSOERXA1",199,0)
 .S GRPID=$G(@GL@(BFCCNT,"GroupID",0))
"RTN","PSOERXA1",200,0)
 .S IENS="+1,"_ERXIEN_","
"RTN","PSOERXA1",201,0)
 .S FDA(F,IENS,.01)=BSEQ
"RTN","PSOERXA1",202,0)
 .S FDA(F,IENS,7)=CHID
"RTN","PSOERXA1",203,0)
 .S FDA(F,IENS,.02)=GRPID
"RTN","PSOERXA1",204,0)
 .S FDA(F,IENS,.03)=CHFULLN
"RTN","PSOERXA1",205,0)
 .S FDA(F,IENS,1)=CHLN,FDA(F,IENS,2)=CHFN,FDA(F,IENS,3)=CHMN,FDA(F,IENS,4)=CHSUFF,FDA(F,IENS,5)=CHPRE
"RTN","PSOERXA1",206,0)
 .D UPDATE^DIE(,"FDA","NEWPAYER","ERR") K FDA I $D(ERR) K ERR Q
"RTN","PSOERXA1",207,0)
 .S PIEN=$O(NEWPAYER(0)),PIEN=$G(NEWPAYER(PIEN))
"RTN","PSOERXA1",208,0)
 .I 'PIEN Q
"RTN","PSOERXA1",209,0)
 .S PAYIDTYP="" F  S PAYIDTYP=$O(@GL@(BFCCNT,"PayerIdentification",0,PAYIDTYP)) Q:PAYIDTYP=""  D
"RTN","PSOERXA1",210,0)
 ..S PAYIDVAL=$G(@GL@(BFCCNT,"PayerIdentification",0,PAYIDTYP,0))
"RTN","PSOERXA1",211,0)
 ..S FDA(52.49186,"+1,"_PIEN_","_ERXIEN_",",.01)=PAYIDTYP
"RTN","PSOERXA1",212,0)
 ..S FDA(52.49186,"+1,"_PIEN_","_ERXIEN_",",.02)=PAYIDVAL
"RTN","PSOERXA1",213,0)
 ..D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",214,0)
 .K NEWPAYER,PIEN
"RTN","PSOERXA1",215,0)
 Q
"RTN","PSOERXA1",216,0)
OBS(ERXIEN) ; Observation
"RTN","PSOERXA1",217,0)
 N GL,I,LAST,DIM,MSOURCE,MUNIT,OBSDT,MVAL,OBSNOTE,OBSCNT,F,EIENS,FDA
"RTN","PSOERXA1",218,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Observation",0))
"RTN","PSOERXA1",219,0)
 S F=52.4914,EIENS=ERXIEN_","
"RTN","PSOERXA1",220,0)
 S I=-1,OBSCNT=0 F  S I=$O(@GL@("Measurement",I)) Q:I=""  D
"RTN","PSOERXA1",221,0)
 .S OBSCNT=OBSCNT+1,FDA(F,"+1,"_EIENS,.01)=OBSCNT
"RTN","PSOERXA1",222,0)
 .S DIM=$G(@GL@("Measurement",I,"Dimension",0)),FDA(F,"+1,"_EIENS,.02)=DIM
"RTN","PSOERXA1",223,0)
 .S MSOURCE=$G(@GL@("Measurement",I,"MeasurementSourceCode",0)),FDA(F,"+1,"_EIENS,.06)=MSOURCE
"RTN","PSOERXA1",224,0)
 .S MUNIT=$G(@GL@("Measurement",I,"MeasurementUnitCode",0)),FDA(F,"+1,"_EIENS,.07)=MUNIT
"RTN","PSOERXA1",225,0)
 .; Future enhancement - we have a field for MeasurementDataQualifier (.05) - is this valid?
"RTN","PSOERXA1",226,0)
 .S OBSDT=$G(@GL@("Measurement",I,"ObservationDate",0,"Date",0)),OBSDT=$$CONVDTTM^PSOERXA1(OBSDT),FDA(F,"+1,"_EIENS,.04)=OBSDT
"RTN","PSOERXA1",227,0)
 .S MVAL=$G(@GL@("Measurement",I,"Value",0)),FDA(F,"+1,"_EIENS,.03)=MVAL
"RTN","PSOERXA1",228,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",229,0)
 S OBSNOTE=$G(@GL@("ObservationNotes",0)),FDA(52.49,EIENS,15)=OBSNOTE D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",230,0)
 Q
"RTN","PSOERXA1",231,0)
PAT(ERXIEN) ; patient
"RTN","PSOERXA1",232,0)
 N GL,AL1,AL2,CITY,STATE,ZIP,LN,FN,MN,PREF,SUFF,COMQUAL,COMVAL,PLQUAL,DOB,GEN,PRELATE,IDDONE,CDONE,I,C,CQUAL,CVAL
"RTN","PSOERXA1",233,0)
 N IDNM,IDVAL,PFN,ERXPAT,NEWPAT,F,EIENS,FDA,IDFND,SRCH,PIENS,NPIEN,PATSSN,PREL
"RTN","PSOERXA1",234,0)
 S F=52.46
"RTN","PSOERXA1",235,0)
 S EIENS=ERXIEN_","
"RTN","PSOERXA1",236,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Patient",0))
"RTN","PSOERXA1",237,0)
 S PREL=$G(@GL@("PatientRelationship",0))
"RTN","PSOERXA1",238,0)
 S FN=$$UP^XLFSTR($G(@GL@("Name",0,"FirstName",0)))
"RTN","PSOERXA1",239,0)
 S LN=$$UP^XLFSTR($G(@GL@("Name",0,"LastName",0)))
"RTN","PSOERXA1",240,0)
 S MN=$$UP^XLFSTR($G(@GL@("Name",0,"MiddleName",0)))
"RTN","PSOERXA1",241,0)
 S PFN=LN_","_FN_$S(MN]"":" "_MN,1:"")
"RTN","PSOERXA1",242,0)
 S SUFF=$$UP^XLFSTR($G(@GL@("Name",0,"Suffix",0)))
"RTN","PSOERXA1",243,0)
 S PREF=$$UP^XLFSTR($G(@GL@("Name",0,"Prefix",0)))
"RTN","PSOERXA1",244,0)
 S PRELATE=$G(@GL@("PatientRelationship",0))
"RTN","PSOERXA1",245,0)
 S GEN=$G(@GL@("Gender",0))
"RTN","PSOERXA1",246,0)
 S DOB=$G(@GL@("DateOfBirth",0,"Date",0)),DOB=$$CONVDTTM^PSOERXA1(DOB)
"RTN","PSOERXA1",247,0)
 I DOB<1 S DOB=""
"RTN","PSOERXA1",248,0)
 S AL1=$G(@GL@("Address",0,"AddressLine1",0))
"RTN","PSOERXA1",249,0)
 S AL2=$G(@GL@("Address",0,"AddressLine2",0))
"RTN","PSOERXA1",250,0)
 S CITY=$G(@GL@("Address",0,"City",0))
"RTN","PSOERXA1",251,0)
 S STATE=$G(@GL@("Address",0,"State",0))
"RTN","PSOERXA1",252,0)
 S ZIP=$G(@GL@("Address",0,"ZipCode",0))
"RTN","PSOERXA1",253,0)
 ; need to check for SSN before trying to match the patient. This needs to be stored in an array for later processing
"RTN","PSOERXA1",254,0)
 ; check 52.46 for a match before filing
"RTN","PSOERXA1",255,0)
 S PATSSN=$G(@GL@("Identification",0,"SocialSecurity",0))
"RTN","PSOERXA1",256,0)
 S ERXPAT=$$FINDPAT^PSOERXA1(PFN,DOB,GEN,$G(PATSSN),$G(AL1)) S PIENS=$S(ERXPAT:ERXPAT_",",1:"+1,")
"RTN","PSOERXA1",257,0)
 ; first, lets set up the main part
"RTN","PSOERXA1",258,0)
 S FDA(F,PIENS,.01)=PFN,FDA(F,PIENS,.02)=LN,FDA(F,PIENS,.03)=FN,FDA(F,PIENS,.04)=MN,FDA(F,PIENS,.05)=SUFF,FDA(F,PIENS,.06)=PREF
"RTN","PSOERXA1",259,0)
 S FDA(F,PIENS,.07)=GEN,FDA(F,PIENS,.08)=DOB
"RTN","PSOERXA1",260,0)
 S FDA(F,PIENS,1.4)=PATSSN,FDA(F,PIENS,1.7)=PREL
"RTN","PSOERXA1",261,0)
 S FDA(F,PIENS,3.1)=AL1,FDA(F,PIENS,3.2)=AL2,FDA(F,PIENS,3.3)=CITY
"RTN","PSOERXA1",262,0)
 S FDA(F,PIENS,3.4)=$$FIND1^DIC(5,,,STATE,"C")
"RTN","PSOERXA1",263,0)
 S FDA(F,PIENS,3.5)=ZIP
"RTN","PSOERXA1",264,0)
 I PIENS["+" D  Q
"RTN","PSOERXA1",265,0)
 .D UPDATE^DIE(,"FDA","NEWPAT") K FDA
"RTN","PSOERXA1",266,0)
 .S NPIEN=$O(NEWPAT(0)),NPIEN=$G(NEWPAT(NPIEN))
"RTN","PSOERXA1",267,0)
 .Q:'NPIEN
"RTN","PSOERXA1",268,0)
 .S NPIEN=NPIEN
"RTN","PSOERXA1",269,0)
 .D PATC(NPIEN)
"RTN","PSOERXA1",270,0)
 .S FDA(52.49,EIENS,.04)=NPIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",271,0)
 D FILE^DIE(,"FDA") K FDA D PATC(ERXPAT)
"RTN","PSOERXA1",272,0)
 S FDA(52.49,EIENS,.04)=ERXPAT D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",273,0)
 ; if this is an existing record loop through the communication values and do a compare to see what needs to be updated
"RTN","PSOERXA1",274,0)
 ; otherwise, build the FDA and file the communication values.
"RTN","PSOERXA1",275,0)
 Q
"RTN","PSOERXA1",276,0)
PATC(IEN) ; patient communication
"RTN","PSOERXA1",277,0)
 N IENS,CQUAL,CVAL,COMARY,FDA,SRCH,IDFND,IDNM,IDVAL,IDARY,PATSSN
"RTN","PSOERXA1",278,0)
 Q:'IEN
"RTN","PSOERXA1",279,0)
 S IENS=IEN_","
"RTN","PSOERXA1",280,0)
 ; Kill off existing communication values
"RTN","PSOERXA1",281,0)
 K ^PS(52.46,IEN,3)
"RTN","PSOERXA1",282,0)
 S C=-1 F  S C=$O(@GL@("CommunicationNumbers",0,"Communication",C)) Q:C=""  D
"RTN","PSOERXA1",283,0)
 .S CQUAL=$G(@GL@("CommunicationNumbers",0,"Communication",C,"Qualifier",0))
"RTN","PSOERXA1",284,0)
 .S CVAL=$G(@GL@("CommunicationNumbers",0,"Communication",C,"Number",0))
"RTN","PSOERXA1",285,0)
 .S COMARY(CQUAL)=CVAL
"RTN","PSOERXA1",286,0)
 .S FDA(52.462,"+1,"_IENS,.01)=CVAL
"RTN","PSOERXA1",287,0)
 .S FDA(52.462,"+1,"_IENS,.02)=CQUAL
"RTN","PSOERXA1",288,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",289,0)
 ; kill existing identification values in multiple
"RTN","PSOERXA1",290,0)
 K ^PS(52.46,IEN,5)
"RTN","PSOERXA1",291,0)
 S IDNM="" F  S IDNM=$O(@GL@("Identification",0,IDNM)) Q:IDNM=""  D
"RTN","PSOERXA1",292,0)
 .S IDVAL=$G(@GL@("Identification",0,IDNM,0))
"RTN","PSOERXA1",293,0)
 .I IDNM="SocialSecurity" S PATSSN=IDVAL
"RTN","PSOERXA1",294,0)
 .S IDARY(IDNM)=IDVAL
"RTN","PSOERXA1",295,0)
 .S IDFND=0
"RTN","PSOERXA1",296,0)
 .S SRCH=0 F  S SRCH=$O(^PS(52.46,IEN,5,SRCH)) Q:'SRCH  D
"RTN","PSOERXA1",297,0)
 ..I $$GET1^DIQ(52.465,SRCH_","_IEN_",",.01)=IDNM D
"RTN","PSOERXA1",298,0)
 ...S IDFND=1
"RTN","PSOERXA1",299,0)
 ...S FDA(52.465,SRCH_","_IEN_",",.02)=IDVAL D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",300,0)
 .Q:IDFND
"RTN","PSOERXA1",301,0)
 .S FDA(52.465,"+1,"_IEN_",",.01)=IDNM
"RTN","PSOERXA1",302,0)
 .S FDA(52.465,"+1,"_IEN_",",.02)=IDVAL
"RTN","PSOERXA1",303,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",304,0)
 I $G(PATSSN)]"" S FDA(52.46,IENS,1.4)=PATSSN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA1",305,0)
 Q
"RTN","PSOERXA1",306,0)
REQ ; request
"RTN","PSOERXA1",307,0)
 N GL,CRTYPE,RETREC,RRNUM
"RTN","PSOERXA1",308,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Request",0))
"RTN","PSOERXA1",309,0)
 S CRTYPE=$G(@GL@("ChangeRequestType",0))
"RTN","PSOERXA1",310,0)
 S RETREC=$G(@GL@("ReturnReceipt",0))
"RTN","PSOERXA1",311,0)
 S RRNUM=$G(@GL@("RequestReferenceNumber",0))
"RTN","PSOERXA1",312,0)
 ; Implement when different types of messages are coming in.
"RTN","PSOERXA1",313,0)
 Q
"RTN","PSOERXA1",314,0)
 ;
"RTN","PSOERXA1",315,0)
SPUSH(S,X) ;places X on the stack S and returns the current level of the stack
"RTN","PSOERXA1",316,0)
 N I S I=$O(S(""),-1)+1,S(I)=X
"RTN","PSOERXA1",317,0)
 Q I
"RTN","PSOERXA1",318,0)
 ;
"RTN","PSOERXA1",319,0)
SPOP(S,X) ;removes the top item from the stack S and put it into the variable X and returns the level that X was at
"RTN","PSOERXA1",320,0)
 N I S I=$O(S(""),-1)
"RTN","PSOERXA1",321,0)
 I I S X=S(I) K S(I)
"RTN","PSOERXA1",322,0)
 N J S J=$O(S(I),-1) I J S S(J,X)=$G(S(J,X))+1
"RTN","PSOERXA1",323,0)
 Q I
"RTN","PSOERXA1",324,0)
 ;
"RTN","PSOERXA1",325,0)
SPEEK(S,X) ;same as SPOP except the top item is not removed
"RTN","PSOERXA1",326,0)
 N I S I=$O(S(""),-1)
"RTN","PSOERXA1",327,0)
 I I S X=S(I)
"RTN","PSOERXA1",328,0)
 Q I
"RTN","PSOERXA1",329,0)
 ;
"RTN","PSOERXA1",330,0)
SPUT(S,X) ;implementation specific, uses the stack to form a global node
"RTN","PSOERXA1",331,0)
 N I,STR
"RTN","PSOERXA1",332,0)
 S X=$TR(X,";","")
"RTN","PSOERXA1",333,0)
 S STR=$P(GL,")")
"RTN","PSOERXA1",334,0)
 S I=0 F  S I=$O(S(I)) Q:'I  D
"RTN","PSOERXA1",335,0)
 .S STR=STR_","_""""_S(I)_""""_","
"RTN","PSOERXA1",336,0)
 .N NUM S NUM=0
"RTN","PSOERXA1",337,0)
 .I $D(S(I-1,S(I))) S NUM=+$G(S(I-1,S(I)))
"RTN","PSOERXA1",338,0)
 .S STR=STR_NUM
"RTN","PSOERXA1",339,0)
 S STR=STR_")"
"RTN","PSOERXA1",340,0)
 I $D(@STR) S @STR=@STR_X
"RTN","PSOERXA1",341,0)
 I '$D(@STR) S @STR=X
"RTN","PSOERXA1",342,0)
 Q STR
"RTN","PSOERXA1",343,0)
APUT(S,X,LN) ; what am i doing here?
"RTN","PSOERXA1",344,0)
 N I,STR
"RTN","PSOERXA1",345,0)
 S X=$TR(X,";","")
"RTN","PSOERXA1",346,0)
 S STR=$P(GL,")")
"RTN","PSOERXA1",347,0)
 S I=0 F  S I=$O(S(I)) Q:'I  D
"RTN","PSOERXA1",348,0)
 .S STR=STR_","_""""_S(I)_""""_","
"RTN","PSOERXA1",349,0)
 .N NUM S NUM="""A"""
"RTN","PSOERXA1",350,0)
 .;I $D(S(I-1,S(I))) S NUM=+$G(S(I-1,S(I)))
"RTN","PSOERXA1",351,0)
 .;S STR=STR_NUM
"RTN","PSOERXA1",352,0)
 .S STR=STR_NUM_","_""""_LN_""""
"RTN","PSOERXA1",353,0)
 S STR=STR_")"
"RTN","PSOERXA1",354,0)
 I $D(@STR) S @STR=@STR_X
"RTN","PSOERXA1",355,0)
 I '$D(@STR) S @STR=X
"RTN","PSOERXA1",356,0)
 Q STR
"RTN","PSOERXA1",357,0)
 ;
"RTN","PSOERXA1",358,0)
 ; VAL - value to resolve
"RTN","PSOERXA1",359,0)
 ; TYPE - This is the code type, which will tell which 'C' index type to get the code from
"RTN","PSOERXA1",360,0)
PRESOLV(VAL,TYPE) ;
"RTN","PSOERXA1",361,0)
 N MATCH
"RTN","PSOERXA1",362,0)
 S MATCH=""
"RTN","PSOERXA1",363,0)
 Q:'$L(TYPE)!('$L(VAL)) "" ; avoid null subscript
"RTN","PSOERXA1",364,0)
 S MATCH=$O(^PS(52.45,"C",TYPE,VAL,0))
"RTN","PSOERXA1",365,0)
 ; return the match found, null if no match
"RTN","PSOERXA1",366,0)
 Q MATCH
"RTN","PSOERXA1",367,0)
 ; look for existing patient
"RTN","PSOERXA1",368,0)
 ; NAME - PATIENT FULL NAME
"RTN","PSOERXA1",369,0)
 ; IDOB - INCOMING PATIENT DOB
"RTN","PSOERXA1",370,0)
 ; IDGEN - INCOMING PATIENT GENDER
"RTN","PSOERXA1",371,0)
 ; SSN - INCOMING PATIENT SSN
"RTN","PSOERXA1",372,0)
 ; AL1 - INCOMING PATIENT ADDRESS LINE 1
"RTN","PSOERXA1",373,0)
FINDPAT(NAME,IDOB,IGEN,SSN,AL1) ;
"RTN","PSOERXA1",374,0)
 N MPAT,MTCHCNT,PIEN,MATCH,PDOB,PGEN,PSSN,PAL1
"RTN","PSOERXA1",375,0)
 ; for now, quit quit if name match does not occur.
"RTN","PSOERXA1",376,0)
 I '$D(^PS(52.46,"BN",NAME)) Q ""
"RTN","PSOERXA1",377,0)
 S MTCHCNT=0
"RTN","PSOERXA1",378,0)
 S PIEN=0 F  S PIEN=$O(^PS(52.46,"BN",NAME,PIEN)) Q:'PIEN  D
"RTN","PSOERXA1",379,0)
 .S PDOB=$$GET1^DIQ(52.46,PIEN,.08,"I"),PGEN=$$GET1^DIQ(52.46,PIEN,.07,"I")
"RTN","PSOERXA1",380,0)
 .S PSSN=$$GET1^DIQ(52.46,PIEN,1.4),PAL1=$$GET1^DIQ(52.46,PIEN,3.1,"E")
"RTN","PSOERXA1",381,0)
 .; if the ssn exists, and does not match, quit
"RTN","PSOERXA1",382,0)
 .I $L(SSN),SSN'=PSSN Q
"RTN","PSOERXA1",383,0)
 .I PDOB=IDOB,PGEN=IGEN,AL1=PAL1 S MTCHCNT=MTCHCNT+1,MATCH(PIEN)=""
"RTN","PSOERXA1",384,0)
 I MTCHCNT'=1 Q ""
"RTN","PSOERXA1",385,0)
 S MPAT=$O(MATCH(0))
"RTN","PSOERXA1",386,0)
 I MPAT Q MPAT
"RTN","PSOERXA1",387,0)
 Q ""
"RTN","PSOERXA1",388,0)
 ; look for exising provider/prescriber
"RTN","PSOERXA1",389,0)
FINDPRE(NAME,NPI,DEA) ;
"RTN","PSOERXA1",390,0)
 N NPCNT,NPIMTCH,NLIST,NLCNT,NLOOP,NLIST2,NAMEMTCH,NMLOOP,NMCNT,NMLIST,DCNT,DEAMTCH,DLCNT,DLIST,DLIST2
"RTN","PSOERXA1",391,0)
 N DLOOP,DMTCH,NPDEA
"RTN","PSOERXA1",392,0)
 ; if there is an NPI, and DEA#, check both. If only one match, then this is the same provider
"RTN","PSOERXA1",393,0)
 I $L(NPI) D  Q NPIMTCH
"RTN","PSOERXA1",394,0)
 .I '$D(^PS(52.48,"C",NPI)) S NPIMTCH="" Q
"RTN","PSOERXA1",395,0)
 .S NPCNT=0
"RTN","PSOERXA1",396,0)
 .S NPIMTCH=0 F  S NPIMTCH=$O(^PS(52.48,"C",NPI,NPIMTCH)) Q:'NPIMTCH  D
"RTN","PSOERXA1",397,0)
 ..S NPDEA=$$GET1^DIQ(52.48,NPIMTCH,1.6,"E") I $L(DEA),NPDEA'=DEA Q
"RTN","PSOERXA1",398,0)
 ..S NLIST(NPIMTCH)="",NPCNT=NPCNT+1
"RTN","PSOERXA1",399,0)
 .; if we have a single match for NPI and DEA# return the result
"RTN","PSOERXA1",400,0)
 .I NPCNT=0 S NPIMTCH="" Q
"RTN","PSOERXA1",401,0)
 .I NPCNT=1 S NPIMTCH=$O(NLIST(0)) Q
"RTN","PSOERXA1",402,0)
 .S NLCNT=0
"RTN","PSOERXA1",403,0)
 .S NLOOP=0 F  S NLOOP=$O(NLIST(NLOOP)) Q:'NLOOP  D
"RTN","PSOERXA1",404,0)
 ..I $L(NAME),NAME=$$GET1^DIQ(52.48,NLOOP,.01,"E") S NLIST2(NLOOP)="",NLCNT=NLCNT+1
"RTN","PSOERXA1",405,0)
 .I NLCNT=0!(NLCNT>1) S NPIMTCH="" Q
"RTN","PSOERXA1",406,0)
 .I NLCNT=1 S NPIMTCH=$O(NLIST2(0)) Q
"RTN","PSOERXA1",407,0)
 I $L(DEA) D  Q DEAMTCH
"RTN","PSOERXA1",408,0)
 .I '$D(^PS(52.48,"D",DEA)) S DEAMTCH="" Q
"RTN","PSOERXA1",409,0)
 .S (DCNT,DMTCH)=0 F  S DMTCH=$O(^PS(52.48,"D",DEA,DMTCH)) Q:'DMTCH  D
"RTN","PSOERXA1",410,0)
 ..S DLIST(DMTCH)="",DCNT=DCNT+1
"RTN","PSOERXA1",411,0)
 .I DCNT=0 S DEAMTCH="" Q
"RTN","PSOERXA1",412,0)
 .I DCNT=1 S DEAMTCH=$O(DLIST(0)) Q
"RTN","PSOERXA1",413,0)
 .S (DLOOP,DLCNT)=0 F  S DLOOP=$O(DLIST(DLOOP)) Q:'DLOOP  D
"RTN","PSOERXA1",414,0)
 ..I $L(NAME),NAME=$$GET1^DIQ(52.48,DLOOP,.01,"E") S DLIST2(DLOOP)="",DLCNT=DLCNT+1
"RTN","PSOERXA1",415,0)
 .I DLCNT=0!(DLCNT>1) S DEAMTCH="" Q
"RTN","PSOERXA1",416,0)
 .I DLCNT=1 S DEAMTCH=$O(DLIST2(0))
"RTN","PSOERXA1",417,0)
 I $L(NAME) D  Q NAMEMTCH
"RTN","PSOERXA1",418,0)
 .I '$D(^PS(52.48,"BN",NAME)) S NAMEMTCH="" Q
"RTN","PSOERXA1",419,0)
 .S (NMLOOP,NMCNT)=0 F  S NMLOOP=$O(^PS(52.48,"BN",NAME,NMLOOP)) Q:'NMLOOP  D
"RTN","PSOERXA1",420,0)
 ..S NMLIST(NMLOOP)="",NMCNT=NMCNT+1
"RTN","PSOERXA1",421,0)
 .I NMCNT=0!(NMCNT>1) S NAMEMTCH="" Q
"RTN","PSOERXA1",422,0)
 .S NAMEMTCH=$O(NMLIST(0))
"RTN","PSOERXA1",423,0)
 Q ""
"RTN","PSOERXA1",424,0)
CONVDTTM(VAL) ;
"RTN","PSOERXA1",425,0)
 N EDATE,ETIME,X,ETZ,Y
"RTN","PSOERXA1",426,0)
 I '$L(VAL) Q ""
"RTN","PSOERXA1",427,0)
 S EDATE=$P(VAL,"T"),ETIME=$P(VAL,"T",2)
"RTN","PSOERXA1",428,0)
 ; split off time zone
"RTN","PSOERXA1",429,0)
 S ETZ=$P(ETIME,".",2)
"RTN","PSOERXA1",430,0)
 S ETIME=$P(ETIME,".")
"RTN","PSOERXA1",431,0)
 S X=EDATE D ^%DT I 'Y Q ""
"RTN","PSOERXA1",432,0)
 S VAL=Y_$S($L(ETIME):"."_$TR(ETIME,":",""),1:"")
"RTN","PSOERXA1",433,0)
 Q VAL
"RTN","PSOERXA2")
0^10^B75232526^n/a
"RTN","PSOERXA2",1,0)
PSOERXA2 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXA2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXA2",3,0)
 ;
"RTN","PSOERXA2",4,0)
 Q
"RTN","PSOERXA2",5,0)
FAC ; facility
"RTN","PSOERXA2",6,0)
 N GL,IDTYPE,IDVAL
"RTN","PSOERXA2",7,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Facility",0))
"RTN","PSOERXA2",8,0)
 ; future enhancement - file ID types - requires modification to the current payer information subfile
"RTN","PSOERXA2",9,0)
 ;                    - THIS REQUIRES RESOLUTION OF THE PAYERID TYPE ISSUE ALONG WITH PRIOR AUTH VALUES, ETC.
"RTN","PSOERXA2",10,0)
 S IDTYPE="" F  S IDTYPE=$O(@GL@("Identification",0,IDTYPE)) Q:IDTYPE=""  D
"RTN","PSOERXA2",11,0)
 .S IDVAL=$G(@GL@("Identification",0,IDTYPE,0))
"RTN","PSOERXA2",12,0)
 Q
"RTN","PSOERXA2",13,0)
PHR(ERXIEN) ; pharamcy
"RTN","PSOERXA2",14,0)
 N GL,SNAME,AL1,AL2,CIT,STATE,ZIP,PLQUAL,COMTYP,COMVAL,I,F,EIENS,PHIEN,CCNT,NEW,SPEC,FDA,NEWPHIEN,GL2,FQUAL,FROM
"RTN","PSOERXA2",15,0)
 N NCPDPID
"RTN","PSOERXA2",16,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Pharmacy",0))
"RTN","PSOERXA2",17,0)
 S GL2=$NA(^TMP($J,"PSOERXO1","Message","A","Qualifier","Header","A","Qualifier"))
"RTN","PSOERXA2",18,0)
 S FQUAL=$G(@GL2@("From","A","Qualifier"))
"RTN","PSOERXA2",19,0)
 S FROM=$G(@GL@("From",0))
"RTN","PSOERXA2",20,0)
 I FQUAL="P",FROM]"" S NCPDPID=FROM
"RTN","PSOERXA2",21,0)
 S F=52.47,PHIEN=""
"RTN","PSOERXA2",22,0)
 S EIENS=ERXIEN_","
"RTN","PSOERXA2",23,0)
 S SNAME=$G(@GL@("StoreName",0))
"RTN","PSOERXA2",24,0)
 I $D(^PS(52.47,"B",SNAME)) S PHIEN=$O(^PS(52.47,"B",SNAME,0)) I PHIEN S PHIEN=PHIEN_",",NEW=0
"RTN","PSOERXA2",25,0)
 ; if we found a match, clear out the existing communication numbers and identification
"RTN","PSOERXA2",26,0)
 I PHIEN K ^PS(52.47,$P(PHIEN,","),3),^PS(52.47,$P(PHIEN,","),2)
"RTN","PSOERXA2",27,0)
 I '$G(PHIEN) S PHIEN="+1,",NEW=1,FDA(F,PHIEN,.01)=SNAME
"RTN","PSOERXA2",28,0)
 S FDA(F,PHIEN,.05)=SNAME
"RTN","PSOERXA2",29,0)
 S SPEC=$G(@GL@("Specialty",0)),FDA(F,PHIEN,1.8)=SPEC
"RTN","PSOERXA2",30,0)
 S AL1=$G(@GL@("Address",0,"AddressLine1",0)),FDA(F,PHIEN,1.1)=AL1
"RTN","PSOERXA2",31,0)
 S AL2=$G(@GL@("Address",0,"AddressLine2",0)),FDA(F,PHIEN,1.2)=AL2
"RTN","PSOERXA2",32,0)
 S CITY=$G(@GL@("Address",0,"City",0)),FDA(F,PHIEN,1.3)=CITY
"RTN","PSOERXA2",33,0)
 S STATE=$G(@GL@("Address",0,"State",0)),FDA(F,PHIEN,1.4)=$$FIND1^DIC(5,,,STATE,"C")
"RTN","PSOERXA2",34,0)
 S ZIP=$G(@GL@("Address",0,"ZipCode",0)),FDA(F,PHIEN,1.5)=ZIP
"RTN","PSOERXA2",35,0)
 S PLQUAL=$G(@GL@("Address",0,"PlaceLocationQualifier",0)),FDA(F,PHIEN,1.7)=PLQUAL
"RTN","PSOERXA2",36,0)
 ; if this is an existing pharmacy entry, file the updates, communication values, and identification, then link to 52.49
"RTN","PSOERXA2",37,0)
 I 'NEW D  Q
"RTN","PSOERXA2",38,0)
 .D FILE^DIE(,"FDA") K FDA D PHRIC($P(PHIEN,","))
"RTN","PSOERXA2",39,0)
 .S FDA(52.49,EIENS,2.5)=$P(PHIEN,",") D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",40,0)
 ; for a new entry, file the entry, then file communication/identification and link to 52.49
"RTN","PSOERXA2",41,0)
 D UPDATE^DIE(,"FDA","NEWPHIEN") K FDA
"RTN","PSOERXA2",42,0)
 S PHIEN=$O(NEWPHIEN(0)),PHIEN=$G(NEWPHIEN(PHIEN))
"RTN","PSOERXA2",43,0)
 Q:'PHIEN
"RTN","PSOERXA2",44,0)
 D PHRIC(PHIEN)
"RTN","PSOERXA2",45,0)
 S FDA(52.49,EIENS,2.5)=PHIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",46,0)
 Q
"RTN","PSOERXA2",47,0)
PHRIC(IEN) ; pharmacy identification and communication information
"RTN","PSOERXA2",48,0)
 N IDTYP,IDVAL,FDA,I,CCNT,PHIEN,FDA,IDCNT
"RTN","PSOERXA2",49,0)
 Q:'IEN
"RTN","PSOERXA2",50,0)
 S PHIEN=IEN_","
"RTN","PSOERXA2",51,0)
 S IDCNT=0
"RTN","PSOERXA2",52,0)
 K ^PS(52.47,IEN,2)
"RTN","PSOERXA2",53,0)
 S IDNM="" F  S IDNM=$O(@GL@("Identification",0,IDNM)) Q:IDNM=""  D
"RTN","PSOERXA2",54,0)
 .S IDVAL=$G(@GL@("Identification",0,IDNM,0))
"RTN","PSOERXA2",55,0)
 .I IDNM="NCPDPID",$G(NCPDPID)']"" S NCPDPID=$G(IDVAL)
"RTN","PSOERXA2",56,0)
 .S IDARY(IDNM)=IDVAL
"RTN","PSOERXA2",57,0)
 .S IDFND=0
"RTN","PSOERXA2",58,0)
 .S SRCH=0 F  S SRCH=$O(^PS(52.47,IEN,2,SRCH)) Q:'SRCH  D
"RTN","PSOERXA2",59,0)
 ..I $$GET1^DIQ(52.472,SRCH_","_IEN_",",.01)=IDNM D
"RTN","PSOERXA2",60,0)
 ...S IDFND=1
"RTN","PSOERXA2",61,0)
 ...S FDA(52.472,SRCH_","_IEN_",",.02)=IDVAL D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",62,0)
 .Q:IDFND
"RTN","PSOERXA2",63,0)
 .S FDA(52.472,"+1,"_IEN_",",.01)=IDNM
"RTN","PSOERXA2",64,0)
 .S FDA(52.472,"+1,"_IEN_",",.02)=IDVAL
"RTN","PSOERXA2",65,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",66,0)
 I $G(NCPDPID)]"" S FDA(52.47,PHIEN,.02)=NCPDPID D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",67,0)
 ; clear out existing communication Numbers
"RTN","PSOERXA2",68,0)
 K ^PS(52.47,IEN,3)
"RTN","PSOERXA2",69,0)
 S I=-1 F  S I=$O(@GL@("CommunicationNumbers",0,"Communication",I)) Q:I=""  D
"RTN","PSOERXA2",70,0)
 .S CCNT=$G(CCNT)+1
"RTN","PSOERXA2",71,0)
 .S COMVAL=$G(@GL@("CommunicationNumbers",0,"Communication",I,"Number",0))
"RTN","PSOERXA2",72,0)
 .S COMTYP=$G(@GL@("CommunicationNumbers",0,"Communication",I,"Qualifier",0))
"RTN","PSOERXA2",73,0)
 .S FDA(52.473,"+"_CCNT_","_PHIEN,.01)=COMVAL
"RTN","PSOERXA2",74,0)
 .S FDA(52.473,"+"_CCNT_","_PHIEN,.02)=COMTYP
"RTN","PSOERXA2",75,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",76,0)
 Q
"RTN","PSOERXA2",77,0)
PRE(ERXIEN) ; prescriber
"RTN","PSOERXA2",78,0)
 N GL,FN,LN,MN,SUFF,PREF,AL1,AL2,CITY,STATE,ZIP,IDDONE,I,IDNM,IDVAL,C,CQUAL,CVAL,SPEC,AFN,ALN,AMN,APREF,ASUFF,FULLNM
"RTN","PSOERXA2",79,0)
 N EIENS,FDA,NPIEN,NEW,PRVIEN,PRVIENS,NEWIEN,IDFND,SRCH,PNPI,PDEA,GL2,FQUAL,FROM
"RTN","PSOERXA2",80,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Prescriber",0))
"RTN","PSOERXA2",81,0)
 S GL2=$NA(^TMP($J,"PSOERXO1","Message","A","Qualifier","Header","A","Qualifier"))
"RTN","PSOERXA2",82,0)
 S FQUAL=$G(@GL2@("From","A","Qualifier"))
"RTN","PSOERXA2",83,0)
 S FROM=$G(@GL@("From",0))
"RTN","PSOERXA2",84,0)
 I FQUAL="D",FROM]"" S PNPI=FROM
"RTN","PSOERXA2",85,0)
 S F=52.48
"RTN","PSOERXA2",86,0)
 S EIENS=ERXIEN_","
"RTN","PSOERXA2",87,0)
 S FN=$$UP^XLFSTR($G(@GL@("Name",0,"FirstName",0)))
"RTN","PSOERXA2",88,0)
 S LN=$$UP^XLFSTR($G(@GL@("Name",0,"LastName",0)))
"RTN","PSOERXA2",89,0)
 S MN=$$UP^XLFSTR($G(@GL@("Name",0,"MiddleName",0)))
"RTN","PSOERXA2",90,0)
 S FULLNM=LN_","_FN_$S(MN]"":" "_MN,1:"")
"RTN","PSOERXA2",91,0)
 S SUFF=$$UP^XLFSTR($G(@GL@("Name",0,"Suffix",0)))
"RTN","PSOERXA2",92,0)
 S PREF=$$UP^XLFSTR($G(@GL@("Name",0,"Prefix",0)))
"RTN","PSOERXA2",93,0)
 S AL1=$G(@GL@("Address",0,"AddressLine1",0))
"RTN","PSOERXA2",94,0)
 S AL2=$G(@GL@("Address",0,"AddressLine2",0))
"RTN","PSOERXA2",95,0)
 S CITY=$G(@GL@("Address",0,"City",0))
"RTN","PSOERXA2",96,0)
 S STATE=$G(@GL@("Address",0,"State",0))
"RTN","PSOERXA2",97,0)
 S ZIP=$G(@GL@("Address",0,"ZipCode",0))
"RTN","PSOERXA2",98,0)
 S SPEC=$G(@GL@("Specialty",0))
"RTN","PSOERXA2",99,0)
 S AFN=$$UP^XLFSTR($G(@GL@("PrescriberAgent",0,"FirstName",0)))
"RTN","PSOERXA2",100,0)
 S ALN=$$UP^XLFSTR($G(@GL@("PrescriberAgent",0,"LastName",0)))
"RTN","PSOERXA2",101,0)
 S AMN=$$UP^XLFSTR($G(@GL@("PrescriberAgent",0,"MiddleName",0)))
"RTN","PSOERXA2",102,0)
 S APREF=$$UP^XLFSTR($G(@GL@("PrescriberAgent",0,"Prefix",0)))
"RTN","PSOERXA2",103,0)
 S ASUFF=$$UP^XLFSTR($G(@GL@("PrescriberAgent",0,"Suffix",0)))
"RTN","PSOERXA2",104,0)
 ; try to match the provider/supervisor. if no match, create a  new entry for this provider
"RTN","PSOERXA2",105,0)
 ; if there is no NPI, grab it from the Identification multiple.
"RTN","PSOERXA2",106,0)
 I '$G(PNPI) S PNPI=$G(@GL@("Identification",0,"NPI",0))
"RTN","PSOERXA2",107,0)
 S PDEA=$G(@GL@("Identification",0,"DEANumber",0))
"RTN","PSOERXA2",108,0)
 S STLIC=$G(@GL@("Identification",0,"StateLicenseNumber",0))
"RTN","PSOERXA2",109,0)
 S PRVIEN=$$FINDPRE^PSOERXA1(FULLNM,$G(PNPI),PDEA) I PRVIEN S NEW=0
"RTN","PSOERXA2",110,0)
 I 'PRVIEN S NEW=1,PRVIEN="+1"
"RTN","PSOERXA2",111,0)
 S PRVIENS=PRVIEN_","
"RTN","PSOERXA2",112,0)
 S FDA(F,PRVIENS,.01)=FULLNM,FDA(F,PRVIENS,.02)=LN,FDA(F,PRVIENS,.03)=FN,FDA(F,PRVIENS,.04)=MN,FDA(F,PRVIENS,.05)=SUFF
"RTN","PSOERXA2",113,0)
 S FDA(F,PRVIENS,.06)=PREF,FDA(F,PRVIENS,4.1)=AL1,FDA(F,PRVIENS,4.2)=AL2,FDA(F,PRVIENS,4.3)=CITY
"RTN","PSOERXA2",114,0)
 S FDA(F,PRVIENS,4.4)=$$FIND1^DIC(5,,,STATE,"C"),FDA(F,PRVIENS,4.5)=ZIP
"RTN","PSOERXA2",115,0)
 S FDA(F,PRVIENS,5.1)=ALN,FDA(F,PRVIENS,5.2)=AFN,FDA(F,PRVIENS,5.3)=AMN,FDA(F,PRVIENS,5.4)=ASUFF,FDA(F,PRVIENS,5.5)=APREF
"RTN","PSOERXA2",116,0)
 S FDA(F,PRVIENS,1.2)=SPEC
"RTN","PSOERXA2",117,0)
 S FDA(F,PRVIENS,1.8)=$G(STLIC)
"RTN","PSOERXA2",118,0)
 S FDA(F,PRVIENS,1.1)="PR"
"RTN","PSOERXA2",119,0)
 I 'NEW D  Q
"RTN","PSOERXA2",120,0)
 .D FILE^DIE(,"FDA")
"RTN","PSOERXA2",121,0)
 .D PRVCI(PRVIEN)
"RTN","PSOERXA2",122,0)
 .S FDA(52.49,EIENS,2.1)=PRVIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",123,0)
 D UPDATE^DIE(,"FDA","NEWIEN") K FDA
"RTN","PSOERXA2",124,0)
 S NPIEN=$O(NEWIEN(0)),NPIEN=$G(NEWIEN(NPIEN))
"RTN","PSOERXA2",125,0)
 D PRVCI(NPIEN)
"RTN","PSOERXA2",126,0)
 S FDA(52.49,EIENS,2.1)=NPIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",127,0)
 Q
"RTN","PSOERXA2",128,0)
PRVCI(IEN) ;
"RTN","PSOERXA2",129,0)
 N IENS,C,CQUAL,CVAL,FDA,IDNM,IDVAL,IDARY,IDFND,SRCH,NCPDPID,PHIN,DEA,STLIC,PNPI
"RTN","PSOERXA2",130,0)
 S IENS=IEN_","
"RTN","PSOERXA2",131,0)
 ; kill off existing data
"RTN","PSOERXA2",132,0)
 K ^PS(52.48,IEN,3)
"RTN","PSOERXA2",133,0)
 S C=-1 F  S C=$O(@GL@("CommunicationNumbers",0,"Communication",C)) Q:C=""  D
"RTN","PSOERXA2",134,0)
 .S CQUAL=$G(@GL@("CommunicationNumbers",0,"Communication",C,"Qualifier",0))
"RTN","PSOERXA2",135,0)
 .S CVAL=$G(@GL@("CommunicationNumbers",0,"Communication",C,"Number",0))
"RTN","PSOERXA2",136,0)
 .S FDA(52.483,"+1,"_IENS,.01)=CVAL
"RTN","PSOERXA2",137,0)
 .S FDA(52.483,"+1,"_IENS,.02)=CQUAL
"RTN","PSOERXA2",138,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",139,0)
 ; kill existing Identification data.
"RTN","PSOERXA2",140,0)
 K ^PS(52.48,IEN,6)
"RTN","PSOERXA2",141,0)
 S IDNM="" F  S IDNM=$O(@GL@("Identification",0,IDNM)) Q:IDNM=""  D
"RTN","PSOERXA2",142,0)
 .S IDVAL=$G(@GL@("Identification",0,IDNM,0))
"RTN","PSOERXA2",143,0)
 .S IDARY(IDNM)=IDVAL
"RTN","PSOERXA2",144,0)
 .I IDNM="NCPDPID" S NCPDPID=IDVAL
"RTN","PSOERXA2",145,0)
 .I IDNM="HIN" S PHIN=IDVAL
"RTN","PSOERXA2",146,0)
 .I IDNM="DEANumber" S DEA=IDVAL
"RTN","PSOERXA2",147,0)
 .I IDNM="StateLicenseNumber" S STLIC=IDVAL
"RTN","PSOERXA2",148,0)
 .I IDNM="NPI" S PNPI=IDVAL
"RTN","PSOERXA2",149,0)
 .S IDFND=0
"RTN","PSOERXA2",150,0)
 .S SRCH=0 F  S SRCH=$O(^PS(52.48,IEN,6,SRCH)) Q:'SRCH  D
"RTN","PSOERXA2",151,0)
 ..I $$GET1^DIQ(52.486,SRCH_","_IEN_",",.01)=IDNM D
"RTN","PSOERXA2",152,0)
 ...S IDFND=1
"RTN","PSOERXA2",153,0)
 ...S FDA(52.486,SRCH_","_IEN_",",.02)=IDVAL D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",154,0)
 .Q:IDFND
"RTN","PSOERXA2",155,0)
 .S FDA(52.486,"+1,"_IEN_",",.01)=IDNM
"RTN","PSOERXA2",156,0)
 .S FDA(52.486,"+1,"_IEN_",",.02)=IDVAL
"RTN","PSOERXA2",157,0)
 .D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",158,0)
 S FDA(52.48,IENS,1.4)=$G(NCPDPID),FDA(52.48,IENS,1.5)=$G(PNPI),FDA(52.48,IENS,1.6)=$G(DEA),FDA(52.48,IENS,1.7)=$G(PHIN)
"RTN","PSOERXA2",159,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",160,0)
 Q
"RTN","PSOERXA2",161,0)
REQ ; request
"RTN","PSOERXA2",162,0)
 N GL,CRTYPE,RETREC,RRNUM
"RTN","PSOERXA2",163,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Request",0))
"RTN","PSOERXA2",164,0)
 S CRTYPE=$G(@GL@("ChangeRequestType",0))
"RTN","PSOERXA2",165,0)
 S RETREC=$G(@GL@("ReturnReceipt",0))
"RTN","PSOERXA2",166,0)
 S RRNUM=$G(@GL@("RequestReferenceNumber",0))
"RTN","PSOERXA2",167,0)
 ; FUTURE ENHANCEMENT - file this information when we are getting other request types.
"RTN","PSOERXA2",168,0)
 Q
"RTN","PSOERXA2",169,0)
SUP(ERXIEN) ; supervisor
"RTN","PSOERXA2",170,0)
 N GL,FN,LN,MN,SUFF,PREF,AL1,AL2,CITY,STATE,ZIP,IDDONE,I,IDNM,IDVAL,C,CQUAL,CVAL,SPEC,AFN,ALN,AMN,APREF,ASUFF,EIENS
"RTN","PSOERXA2",171,0)
 N FDA,NPIEN,NEW,PRVIEN,PRVIENS,NEWIEN,FDA,IDFND,SRCH,PNPI,PDEA,STLIC
"RTN","PSOERXA2",172,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"Supervisor",0))
"RTN","PSOERXA2",173,0)
 S EIENS=ERXIEN_","
"RTN","PSOERXA2",174,0)
 S FN=$$UP^XLFSTR($G(@GL@("Name",0,"FirstName",0)))
"RTN","PSOERXA2",175,0)
 S LN=$$UP^XLFSTR($G(@GL@("Name",0,"LastName",0))) Q:'$L(LN)
"RTN","PSOERXA2",176,0)
 S MN=$$UP^XLFSTR($G(@GL@("Name",0,"MiddleName",0)))
"RTN","PSOERXA2",177,0)
 S FULLNM=LN_","_FN_$S(MN]"":" "_MN,1:"")
"RTN","PSOERXA2",178,0)
 S SUFF=$$UP^XLFSTR($G(@GL@("Name",0,"Suffix",0)))
"RTN","PSOERXA2",179,0)
 S PREF=$$UP^XLFSTR($G(@GL@("Name",0,"Prefix",0)))
"RTN","PSOERXA2",180,0)
 S AL1=$G(@GL@("Address",0,"AddressLine1",0))
"RTN","PSOERXA2",181,0)
 S AL2=$G(@GL@("Address",0,"AddressLine2",0))
"RTN","PSOERXA2",182,0)
 S CITY=$G(@GL@("Address",0,"City",0))
"RTN","PSOERXA2",183,0)
 S STATE=$G(@GL@("Address",0,"State",0))
"RTN","PSOERXA2",184,0)
 S ZIP=$G(@GL@("Address",0,"ZipCode",0))
"RTN","PSOERXA2",185,0)
 S SPEC=$G(@GL@("Specialty",0))
"RTN","PSOERXA2",186,0)
 S PNPI=$G(@GL@("Identification",0,"NPI",0))
"RTN","PSOERXA2",187,0)
 S PDEA=$G(@GL@("Identification",0,"DEANumber",0))
"RTN","PSOERXA2",188,0)
 S STLIC=$G(@GL@("Identification",0,"StateLicenseNumber",0))
"RTN","PSOERXA2",189,0)
 S PRVIEN=$$FINDPRE^PSOERXA1(FULLNM,$G(PNPI),$G(PDEA)) I PRVIEN S NEW=0
"RTN","PSOERXA2",190,0)
 I 'PRVIEN S NEW=1,PRVIEN="+1"
"RTN","PSOERXA2",191,0)
 S PRVIENS=PRVIEN_","
"RTN","PSOERXA2",192,0)
 S FDA(F,PRVIENS,.01)=FULLNM,FDA(F,PRVIENS,.02)=LN,FDA(F,PRVIENS,.03)=FN,FDA(F,PRVIENS,.04)=MN,FDA(F,PRVIENS,.05)=SUFF
"RTN","PSOERXA2",193,0)
 S FDA(F,PRVIENS,.06)=PREF,FDA(F,PRVIENS,4.1)=AL1,FDA(F,PRVIENS,4.2)=AL2,FDA(F,PRVIENS,4.3)=CITY
"RTN","PSOERXA2",194,0)
 ; STATE AND POINTER RESOLUTION
"RTN","PSOERXA2",195,0)
 S FDA(F,PRVIENS,4.4)=$$FIND1^DIC(5,,,STATE,"C"),FDA(F,PRVIENS,4.5)=ZIP
"RTN","PSOERXA2",196,0)
 S FDA(F,PRVIENS,1.2)=SPEC
"RTN","PSOERXA2",197,0)
 S FDA(F,PRVIENS,1.1)="S"
"RTN","PSOERXA2",198,0)
 I 'NEW D  Q
"RTN","PSOERXA2",199,0)
 .D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",200,0)
 .D PRVCI(PRVIEN)
"RTN","PSOERXA2",201,0)
 .S FDA(52.49,EIENS,2.6)=PRVIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",202,0)
 D UPDATE^DIE(,"FDA","NEWIEN") K FDA
"RTN","PSOERXA2",203,0)
 S NPIEN=$O(NEWIEN(0)),NPIEN=$G(NEWIEN(NPIEN))
"RTN","PSOERXA2",204,0)
 D PRVCI(NPIEN)
"RTN","PSOERXA2",205,0)
 S FDA(52.49,EIENS,2.6)=NPIEN D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA2",206,0)
 Q
"RTN","PSOERXA3")
0^11^B37438894^n/a
"RTN","PSOERXA3",1,0)
PSOERXA3 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXA3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXA3",3,0)
 ;
"RTN","PSOERXA3",4,0)
 Q
"RTN","PSOERXA3",5,0)
MED(ERXIEN,ERXVALS) ; medication prescribed
"RTN","PSOERXA3",6,0)
 N GL,VALDT,DAYS,CIQUAL,PQUAL,PDIAG,SQUAL,DIAG,SDIAG,DIRECT,DCSTAT,DCSCODE,DDESC,DUE,CAID,CAQUAL,PSC,SREACODE,SRESCODE
"RTN","PSOERXA3",7,0)
 N EFFDT,EXPDT,NOTE,PEDT,PAUTHQ,PAUTHV,PAUTHS,QCLQ,QPUC,QUSC,QTY,REFQUAL,REFILLS,WRITDT,SUBS,STOPIND,CLINSIG,ACKREA
"RTN","PSOERXA3",8,0)
 N F,EIENS,SFDA,FDA,DIENS,DCCNT,VALDATE,DCDBCOD,DCDBCODQ,DCDEASCH,DCFC,DCFSC,DCPCODE,DCPCQUAL,DCSTR,DCSTRC,DCSTSC
"RTN","PSOERXA3",9,0)
 I 'ERXIEN Q
"RTN","PSOERXA3",10,0)
 S EIENS=ERXIEN_","
"RTN","PSOERXA3",11,0)
 S F=52.49
"RTN","PSOERXA3",12,0)
 S GL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"MedicationPrescribed",0))
"RTN","PSOERXA3",13,0)
 S VALDT=$G(@GL@("DateValidated",0,"Date",0)),VALDATE=$$CONVDTTM^PSOERXA1(VALDT),FDA(52.49,EIENS,6.6)=VALDATE
"RTN","PSOERXA3",14,0)
 S DAYS=$G(@GL@("DaysSupply",0)) I DAYS S FDA(F,EIENS,5.5)=+$G(DAYS)
"RTN","PSOERXA3",15,0)
 ; force to numeric
"RTN","PSOERXA3",16,0)
 I +$G(DAYS)<366 S FDA(F,EIENS,20.2)=+$G(DAYS)
"RTN","PSOERXA3",17,0)
 S FDA(F,EIENS,20.4)="M"
"RTN","PSOERXA3",18,0)
 S DIRECT=$G(@GL@("Directions",0)),FDA(F,EIENS,7)=DIRECT
"RTN","PSOERXA3",19,0)
 S DDESC=$$UP^XLFSTR($G(@GL@("DrugDescription",0))),FDA(52.49,EIENS,3.1)=DDESC
"RTN","PSOERXA3",20,0)
 ; drugCoded
"RTN","PSOERXA3",21,0)
 S DCPCODE=$G(@GL@("DrugCoded",0,"ProductCode",0)),FDA(F,EIENS,4.1)=DCPCODE
"RTN","PSOERXA3",22,0)
 S DCPCQUAL=$G(@GL@("DrugCoded",0,"ProductCodeQualifier",0)),FDA(F,EIENS,4.2)=DCPCQUAL
"RTN","PSOERXA3",23,0)
 S DCSTR=$G(@GL@("DrugCoded",0,"Strength",0)),FDA(F,EIENS,4.3)=DCSTR
"RTN","PSOERXA3",24,0)
 S DCDBCOD=$G(@GL@("DrugCoded",0,"DrugDBCode",0)),FDA(F,EIENS,4.4)=DCDBCOD
"RTN","PSOERXA3",25,0)
 S DCDBCODQ=$G(@GL@("DrugCoded",0,"DrugDBCodeQualifier",0)),FDA(F,EIENS,4.11)=$$PRESOLV^PSOERXA1(DCDBCODQ,"DDB")
"RTN","PSOERXA3",26,0)
 S DCFSC=$G(@GL@("DrugCoded",0,"FormSourceCode",0)),FDA(F,EIENS,4.5)=DCFSC
"RTN","PSOERXA3",27,0)
 S DCFC=$G(@GL@("DrugCoded",0,"FormCode",0)),FDA(F,EIENS,4.6)=DCFC
"RTN","PSOERXA3",28,0)
 S DCSTSC=$G(@GL@("DrugCoded",0,"StrengthSourceCode",0)),FDA(F,EIENS,4.7)=DCSTSC
"RTN","PSOERXA3",29,0)
 S DCSTRC=$G(@GL@("DrugCoded",0,"StrengthCode",0)),FDA(F,EIENS,4.8)=DCSTRC
"RTN","PSOERXA3",30,0)
 S DCDEASCH=$G(@GL@("DrugCoded",0,"DEASchedule")),FDA(F,EIENS,4.9)=DCDEASCH
"RTN","PSOERXA3",31,0)
 ; end drugCoded
"RTN","PSOERXA3",32,0)
 S EFFDT=$G(@GL@("EffectiveDate",0,"Date",0))
"RTN","PSOERXA3",33,0)
 I EFFDT="" S EFFDT=$G(@GL@("EffectiveDate",0,"DateTime",0))
"RTN","PSOERXA3",34,0)
 S EFFDT=$$CONVDTTM^PSOERXA1(EFFDT),FDA(F,EIENS,6.3)=EFFDT
"RTN","PSOERXA3",35,0)
 S EXPDT=$G(@GL@("ExpirationDate",0,"Date",0))
"RTN","PSOERXA3",36,0)
 I EXPDT="" S EXPDT=$G(@GL@("ExpirationDate",0,"DateTime",0))
"RTN","PSOERXA3",37,0)
 S EXPDT=$$CONVDTTM^PSOERXA1(EXPDT),FDA(F,EIENS,6.2)=EXPDT
"RTN","PSOERXA3",38,0)
 S NOTE=$G(@GL@("Note",0)),FDA(F,EIENS,8)=NOTE
"RTN","PSOERXA3",39,0)
 ; Future enhancement - no place to store period end date as of now, add in the future if needed
"RTN","PSOERXA3",40,0)
 S PEDT=$G(@GL@("PeriodEnd",0,"Date",0))
"RTN","PSOERXA3",41,0)
 I PEDT="" S PEDT=$G(@GL@("PeriodEnd",0,"DateTime",0))
"RTN","PSOERXA3",42,0)
 S PEDT=$$CONVDTTM^PSOERXA1(PEDT),FDA(F,EIENS,6.4)=PEDT
"RTN","PSOERXA3",43,0)
 S WRITDT=$G(@GL@("WrittenDate",0,"Date",0))
"RTN","PSOERXA3",44,0)
 I WRITDT="" S WRITDT=$G(@GL@("WrittenDate",0,"DateTime",0))
"RTN","PSOERXA3",45,0)
 S WRITDT=$$CONVDTTM^PSOERXA1(WRITDT),FDA(F,EIENS,5.9)=WRITDT
"RTN","PSOERXA3",46,0)
 ; dispense notes
"RTN","PSOERXA3",47,0)
 S SUBS=$G(@GL@("Substitutions",0)),FDA(F,EIENS,5.8)=SUBS
"RTN","PSOERXA3",48,0)
 ; Future enhancement - store stop indicator
"RTN","PSOERXA3",49,0)
 ;S STOPIND=$G(@GL@("Stop",0,"StopIndicator",0)),FDA(F,EIENS,12.7)=STOPIND
"RTN","PSOERXA3",50,0)
 ; prior authorization
"RTN","PSOERXA3",51,0)
 S PAUTHQ=$G(@GL@("PriorAuthorization",0,"Qualifier",0)),PAUTHQ=$$PRESOLV^PSOERXA1(PAUTHQ,"PAV"),FDA(F,EIENS,10.3)=PAUTHQ
"RTN","PSOERXA3",52,0)
 S PAUTHV=$G(@GL@("PriorAuthorization",0,"Value",0)),FDA(F,EIENS,10.2)=PAUTHV
"RTN","PSOERXA3",53,0)
 S PAUTHS=$G(@GL@("PriorAuthorizationStatus",0)),FDA(F,EIENS,10.4)=PAUTHS
"RTN","PSOERXA3",54,0)
 ; quantity
"RTN","PSOERXA3",55,0)
 S QCLQ=$G(@GL@("Quantity",0,"CodeListQualifier",0)),FDA(F,EIENS,5.2)=QCLQ
"RTN","PSOERXA3",56,0)
 S QPUC=$G(@GL@("Quantity",0,"PotencyUnitCode",0)),FDA(F,EIENS,5.4)=QPUC
"RTN","PSOERXA3",57,0)
 S QUSC=$G(@GL@("Quantity",0,"UnitSourceCode",0)),FDA(F,EIENS,5.3)=QUSC
"RTN","PSOERXA3",58,0)
 S QTY=$G(@GL@("Quantity",0,"Value",0)),FDA(F,EIENS,5.1)=QTY
"RTN","PSOERXA3",59,0)
 ; future consideration:
"RTN","PSOERXA3",60,0)
 ; need to look into quantity multiplier on the VA side of things. It looks like the 
"RTN","PSOERXA3",61,0)
 ; ncpdp quantity multiplier is for billing purposes only.
"RTN","PSOERXA3",62,0)
 I $L($P(QTY,".",2))<3 S FDA(F,EIENS,20.1)=QTY
"RTN","PSOERXA3",63,0)
 ; refills
"RTN","PSOERXA3",64,0)
 S REFQUAL=$G(@GL@("Refills",0,"Qualifier",0)),FDA(F,EIENS,5.7)=REFQUAL
"RTN","PSOERXA3",65,0)
 S REFILLS=$G(@GL@("Refills",0,"Value",0))
"RTN","PSOERXA3",66,0)
 S FDA(F,EIENS,5.6)=REFILLS
"RTN","PSOERXA3",67,0)
 ; ensure vista refills can be exacly what is passed in, as long as it is not greater than 11
"RTN","PSOERXA3",68,0)
 I REFILLS<12 S FDA(F,EIENS,20.5)=REFILLS
"RTN","PSOERXA3",69,0)
 S FDA(F,EIENS,20.4)="M"
"RTN","PSOERXA3",70,0)
 S FDA(F,EIENS,41)=$P($G(ERXVALS("FormCode")),U,2)
"RTN","PSOERXA3",71,0)
 S FDA(F,EIENS,42)=$P($G(ERXVALS("PotencyUnitCode")),U,2)
"RTN","PSOERXA3",72,0)
 S FDA(F,EIENS,43)=$P($G(ERXVALS("StrengthCode")),U,2)
"RTN","PSOERXA3",73,0)
 ; file what we currently have
"RTN","PSOERXA3",74,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXA3",75,0)
 ; diagnosis - primary and secondary
"RTN","PSOERXA3",76,0)
 N DIAGCNT,STORCODE,DIAFDA
"RTN","PSOERXA3",77,0)
 S DIAGCNT=0
"RTN","PSOERXA3",78,0)
 S DIAG=-1 F  S DIAG=$O(@GL@("Diagnosis",DIAG)) Q:DIAG=""  D
"RTN","PSOERXA3",79,0)
 .S DIAGCNT=DIAGCNT+1
"RTN","PSOERXA3",80,0)
 .S DIENS="+"_DIAGCNT_","_EIENS
"RTN","PSOERXA3",81,0)
 .S CIQUAL=$G(@GL@("Diagnosis",DIAG,"ClinicalInformationQualifier",0))
"RTN","PSOERXA3",82,0)
 .S PQUAL=$G(@GL@("Diagnosis",DIAG,"Primary",0,"Qualifier",0))
"RTN","PSOERXA3",83,0)
 .S PDIAG=$G(@GL@("Diagnosis",DIAG,"Primary",0,"Value",0))
"RTN","PSOERXA3",84,0)
 .S SQUAL=$G(@GL@("Diagnosis",DIAG,"Secondary",0,"Qualifier",0))
"RTN","PSOERXA3",85,0)
 .S SDIAG=$G(@GL@("Diagnosis",DIAG,"Secondary",0,"Value",0))
"RTN","PSOERXA3",86,0)
 .S DIAFDA(52.499,"+1,"_EIENS,.01)=DIAGCNT,DIAFDA(52.499,"+1,"_EIENS,.02)=CIQUAL
"RTN","PSOERXA3",87,0)
 .S DIAFDA(52.499,"+1,"_EIENS,.03)=PQUAL,DIAFDA(52.499,"+1,"_EIENS,.04)=PDIAG
"RTN","PSOERXA3",88,0)
 .S DIAFDA(52.499,"+1,"_EIENS,.05)=SQUAL,DIAFDA(52.499,"+1,"_EIENS,.06)=SDIAG
"RTN","PSOERXA3",89,0)
 .D UPDATE^DIE(,"DIAFDA") K DIAFDA
"RTN","PSOERXA3",90,0)
 ; drug coverage status codes
"RTN","PSOERXA3",91,0)
 S DCCNT=0
"RTN","PSOERXA3",92,0)
 S DCSTAT=-1 F  S DCSTAT=$O(@GL@("DrugCoverageStatusCode",DCSTAT)) Q:DCSTAT=""  D
"RTN","PSOERXA3",93,0)
 .S DCSCODE=$G(@GL@("DrugCoverageStatusCode",DCSTAT))
"RTN","PSOERXA3",94,0)
 .S STORCODE=$$PRESOLV^PSOERXA1(DCSCODE,"DCS") Q:'$L(STORCODE)
"RTN","PSOERXA3",95,0)
 .S DCCNT=DCCNT+1
"RTN","PSOERXA3",96,0)
 .S DCFDA(52.4928,"+1,"_EIENS,.01)=DCCNT
"RTN","PSOERXA3",97,0)
 .S DCFDA(52.4928,"+1,"_EIENS,.02)=STORCODE D UPDATE^DIE(,"DCFDA") K DCFDA
"RTN","PSOERXA3",98,0)
 ; if the service reason code (.01) be the same value more than once, convert the .01 field to a sequence
"RTN","PSOERXA3",99,0)
 S DUE=-1 F  S DUE=$O(@GL@("DrugUseEvaluation",DUE)) Q:DUE=""  D
"RTN","PSOERXA3",100,0)
 .S CAID=$G(@GL@("DrugUseEvaluation",DUE,"CoAgent",0,"CoAgentID",0)),DUEFDA(52.4916,"+1,"_EIENS,.04)=CAID
"RTN","PSOERXA3",101,0)
 .S CAQUAL=$G(@GL@("DrugUseEvaluation",DUE,"CoAgent",0,"CoAgentQualifier",0)),CAQUAL=$$PRESOLV^PSOERXA1(CAQUAL,"CAQ"),DUEFDA(52.4916,"+1,"_EIENS,.05)=CAQUAL
"RTN","PSOERXA3",102,0)
 .S PSC=$G(@GL@("DrugUseEvaluation",DUE,"ProfessionalServiceCode",0)),PSC=$$PRESOLV^PSOERXA1(PSC,"PSC"),DUEFDA(52.4916,"+1,"_EIENS,.02)=PSC
"RTN","PSOERXA3",103,0)
 .S SREACODE=$G(@GL@("DrugUseEvaluation",DUE,"ServiceReasonCode",0)),SREACODE=$$PRESOLV^PSOERXA1(SREACODE,"REA"),DUEFDA(52.4916,"+1,"_EIENS,.01)=SREACODE
"RTN","PSOERXA3",104,0)
 .S SRESCODE=$G(@GL@("DrugUseEvaluation",DUE,"ServiceResultCode",0)),SRESCODE=$$PRESOLV^PSOERXA1(SRESCODE,"RES"),DUEFDA(52.4916,"+1,"_EIENS,.03)=SRESCODE
"RTN","PSOERXA3",105,0)
 .S CLINSIG=$G(@GL@("DrugUseEvaluation",DUE,"ClinicalSignificanceCode",0)),DUEFDA(52.4916,"+1,"_EIENS,.06)=CLINSIG
"RTN","PSOERXA3",106,0)
 .S ACKREA=$G(@GL@("DrugUseEvaluation",DUE,"AcknowledgementReason",0)),DUEFDA(52.4916,"+1,"_EIENS,1)=ACKREA
"RTN","PSOERXA3",107,0)
 .D UPDATE^DIE(,"DUEFDA") K DUEFDA
"RTN","PSOERXA3",108,0)
 D SS^PSOERXA4(EIENS)
"RTN","PSOERXA3",109,0)
 Q
"RTN","PSOERXA4")
0^19^B86435195^n/a
"RTN","PSOERXA4",1,0)
PSOERXA4 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXA4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXA4",3,0)
 ;
"RTN","PSOERXA4",4,0)
 Q
"RTN","PSOERXA4",5,0)
SS(EIENS) ;Structured Sig
"RTN","PSOERXA4",6,0)
 N SSGL,STSIG,SIGSEQ,MSIGMOD,FTSIG,FTSIGSI,SNOMEDV,FMTV,DCIND,DDMC,DDMCQ,DDMMC,DDMMCQ,DDMTEXT,DFC,DFCQ,DFTEXT,DQTY,DRNGMOD
"RTN","PSOERXA4",7,0)
 N DCBMQ,DCBMV,DCCDN,DCCDUMC,DCCDUMCQ,DCCDUMT,DCDBNV,DCDBRM,DCDBUMC,DCDBUMCQ,DCDBUMT,DURNV,DURTXT,DURTXTC,DURTXTCQ
"RTN","PSOERXA4",8,0)
 N IIPC,IIPCQ,IIPCT,IIT,IITC,IITCQ,IIVT,IIVU,IIVUMC,IIVUMCQ,IIVUMT,IIVM,MDRNV,MDRNCQ,MDRUC,MDRUT,MDRVDM,MDRVNV,MDRVUC
"RTN","PSOERXA4",9,0)
 N MDRVUCQ,MDRVUT,ROAMRAM,ROAMC,ROAMCQ,ROAMT,SAMATM,SASAC,SASACQ,TATC,TATCQ,TATT,TFNV,TFUC,TFUCQ,TFUT,TINV,TIUC,TIUCQ
"RTN","PSOERXA4",10,0)
 N TIUT,TMATM,TRUMC,TRUMCQ,TRUMT,TRA,TTPBC,TTPBCQ,TTPBT,TVFM,TVIM,VMVM,VN,VNC,VNCQ,VQTY,VUMC,VUMCQ,VUMT,STSCNT,SAT
"RTN","PSOERXA4",11,0)
 N STIENS,SF
"RTN","PSOERXA4",12,0)
 S SF=52.4911
"RTN","PSOERXA4",13,0)
 ;S SSGL=$NA(^TMP($J,"PSOERXO1","Message",0,"Body",0,"NewRx",0,"MedicationPrescribed",0,"StructuredSIG"))
"RTN","PSOERXA4",14,0)
 S SSGL=$NA(^TMP($J,"PSOERXO1","SIG",0,"StructuredSIG"))
"RTN","PSOERXA4",15,0)
 S STSCNT=0
"RTN","PSOERXA4",16,0)
 S STSIG=-1 F  S STSIG=$O(@SSGL@(STSIG)) Q:STSIG=""  D
"RTN","PSOERXA4",17,0)
 .S STSCNT=STSCNT+1
"RTN","PSOERXA4",18,0)
 .S STIENS="+"_STSCNT_","_EIENS
"RTN","PSOERXA4",19,0)
 .S SIGSEQ=$G(@SSGL@(STSIG,"RepeatingSIG",0,"SigSequencePositionNumber",0)),SFDA(SF,STIENS,.01)=SIGSEQ
"RTN","PSOERXA4",20,0)
 .S MSIGMOD=$G(@SSGL@(STSIG,"RepeatingSIG",0,"MultipleSigModifier",0)),SFDA(SF,STIENS,.02)=MSIGMOD
"RTN","PSOERXA4",21,0)
 .S FTSIG=$G(@SSGL@(STSIG,"FreeText",0,"SigFreeText",0)),SFDA(SF,STIENS,1)=FTSIG
"RTN","PSOERXA4",22,0)
 .S FTSIGSI=$G(@SSGL@(STSIG,"FreeText",0,"SigFreeTextStringIndicator",0)),SFDA(SF,STIENS,.05)=FTSIGSI
"RTN","PSOERXA4",23,0)
 .S SNOMEDV=$G(@SSGL@(STSIG,"CodeSystem",0,"SNOMEDVersion",0)),SFDA(SF,STIENS,.03)=SNOMEDV
"RTN","PSOERXA4",24,0)
 .S FMTV=$G(@SSGL@(STSIG,"CodeSystem",0,"FMTVersion",0)),SFDA(SF,STIENS,.04)=FMTV
"RTN","PSOERXA4",25,0)
 .; dose section
"RTN","PSOERXA4",26,0)
 .S DCIND=$G(@SSGL@(STSIG,"Dose",0,"DoseCompositeIndicator",0)),SFDA(SF,STIENS,2.1)=DCIND
"RTN","PSOERXA4",27,0)
 .S DDMC=$G(@SSGL@(STSIG,"Dose",0,"DoseDeliveryMethodCode",0)),SFDA(SF,STIENS,2.4)=DDMC
"RTN","PSOERXA4",28,0)
 .S DDMCQ=$G(@SSGL@(STSIG,"Dose",0,"DoseDeliveryMethodCodeQualifier",0)),SFDA(SF,STIENS,2.3)=DDMCQ
"RTN","PSOERXA4",29,0)
 .S DDMMC=$G(@SSGL@(STSIG,"Dose",0,"DoseDeliveryMethodModifierCode",0)),SFDA(SF,STIENS,2.6)=DDMMC
"RTN","PSOERXA4",30,0)
 .S DDMMCQ=$G(@SSGL@(STSIG,"Dose",0,"DoseDeliveryMethodModifierCodeQualifier",0)),SFDA(SF,STIENS,2.7)=DDMMCQ
"RTN","PSOERXA4",31,0)
 .S DDMTEXT=$G(@SSGL@(STSIG,"Dose",0,"DoseDeliveryMethodText",0)),SFDA(SF,STIENS,2.2)=DDMTEXT
"RTN","PSOERXA4",32,0)
 .S DFC=$G(@SSGL@(STSIG,"Dose",0,"DoseFormCode",0)),SFDA(SF,STIENS,3.3)=DFC
"RTN","PSOERXA4",33,0)
 .S DFCQ=$G(@SSGL@(STSIG,"Dose",0,"DoseFormCodeQualifier",0)),SFDA(SF,STIENS,3.4)=DFCQ
"RTN","PSOERXA4",34,0)
 .S DFTEXT=$G(@SSGL@(STSIG,"Dose",0,"DoseFormText",0)),SFDA(SF,STIENS,3.2)=DFTEXT
"RTN","PSOERXA4",35,0)
 .S DQTY=$G(@SSGL@(STSIG,"Dose",0,"DoseQuantity",0)),SFDA(SF,STIENS,3.1)=DQTY
"RTN","PSOERXA4",36,0)
 .S DRNGMOD=$G(@SSGL@(STSIG,"Dose",0,"DoseRangeModifier",0)),SFDA(SF,STIENS,3.5)=DRNGMOD
"RTN","PSOERXA4",37,0)
 .; dose calcuation section
"RTN","PSOERXA4",38,0)
 .S DCBMQ=$G(@SSGL@(STSIG,"DoseCalculation",0,"BodyMetricQualifier",0)),SFDA(SF,STIENS,4.5)=DCBMQ
"RTN","PSOERXA4",39,0)
 .S DCBMV=$G(@SSGL@(STSIG,"DoseCalculation",0,"BodyMetricValue",0)),SFDA(SF,STIENS,4.6)=DCBMV
"RTN","PSOERXA4",40,0)
 .S DCCDN=$G(@SSGL@(STSIG,"DoseCalculation",0,"CalculatedDoseNumeric",0)),SFDA(SF,STIENS,4.7)=DCCDN
"RTN","PSOERXA4",41,0)
 .S DCCDUMC=$G(@SSGL@(STSIG,"DoseCalculation",0,"CalculatedDoseUnitofMeasureCode",0)),SFDA(SF,STIENS,4.9)=DCCDUMC
"RTN","PSOERXA4",42,0)
 .S DCCDUMCQ=$G(@SSGL@(STSIG,"DoseCalculation",0,"CalculatedDoseUnitofMeasureCodeQualifier",0)),SFDA(SF,STIENS,4.11)=DCCDUMCQ
"RTN","PSOERXA4",43,0)
 .S DCCDUMT=$G(@SSGL@(STSIG,"DoseCalculation",0,"CalculatedDoseUnitofMeasureText",0)),SFDA(SF,STIENS,4.8)=DCCDUMT
"RTN","PSOERXA4",44,0)
 .S DCDBNV=$G(@SSGL@(STSIG,"DoseCalculation",0,"DosingBasisNumericValue",0)),SFDA(SF,STIENS,4.1)=DCDBNV
"RTN","PSOERXA4",45,0)
 .S DCDBRM=$G(@SSGL@(STSIG,"DoseCalculation",0,"DosingBasisRangeModifier",0)),SFDA(SF,STIENS,4.12)=DCDBRM
"RTN","PSOERXA4",46,0)
 .S DCDBUMC=$G(@SSGL@(STSIG,"DoseCalculation",0,"DosingBasisUnitofMeasureCode",0)),SFDA(SF,STIENS,4.3)=DCDBUMC
"RTN","PSOERXA4",47,0)
 .S DCDBUMCQ=$G(@SSGL@(STSIG,"DoseCalculation",0,"DosingBasisUnitofMeasureCodeQualifier",0)),SFDA(SF,STIENS,4.4)=DCDBUMCQ
"RTN","PSOERXA4",48,0)
 .S DCDBUMT=$G(@SSGL@(STSIG,"DoseCalculation",0,"DosingBasisUnitofMeasureText",0)),SFDA(SF,STIENS,4.2)=DCDBUMT
"RTN","PSOERXA4",49,0)
 .; duration
"RTN","PSOERXA4",50,0)
 .S DURNV=$G(@SSGL@(STSIG,"Duration",0,"DurationNumericValue",0)),SFDA(SF,STIENS,9.6)=DURNV
"RTN","PSOERXA4",51,0)
 .S DURTXT=$G(@SSGL@(STSIG,"Duration",0,"DurationText",0)),SFDA(SF,STIENS,9.7)=DURTXT
"RTN","PSOERXA4",52,0)
 .S DURTXTC=$G(@SSGL@(STSIG,"Duration",0,"DurationTextCode",0)),SFDA(SF,STIENS,9.8)=DURTXTC
"RTN","PSOERXA4",53,0)
 .S DURTXTCQ=$G(@SSGL@(STSIG,"Duration",0,"DurationTextCodeQualifier",0)),SFDA(SF,STIENS,9.9)=DURTXTCQ
"RTN","PSOERXA4",54,0)
 .; indication
"RTN","PSOERXA4",55,0)
 .S IIPC=$G(@SSGL@(STSIG,"Indication",0,"IndicationPrecursorCode",0)),SFDA(SF,STIENS,11.2)=IIPC
"RTN","PSOERXA4",56,0)
 .S IIPCQ=$G(@SSGL@(STSIG,"Indication",0,"IndicationPrecursorCodeQualifier",0)),SFDA(SF,STIENS,11.3)=IIPCQ
"RTN","PSOERXA4",57,0)
 .S IIPCT=$G(@SSGL@(STSIG,"Indication",0,"IndicationPrecursorText",0)),SFDA(SF,STIENS,11.1)=IIPCT
"RTN","PSOERXA4",58,0)
 .S IIT=$G(@SSGL@(STSIG,"Indication",0,"IndicationText",0)),SFDA(SF,STIENS,11.4)=IIT
"RTN","PSOERXA4",59,0)
 .S IITC=$G(@SSGL@(STSIG,"Indication",0,"IndicationTextCode",0)),SFDA(SF,STIENS,11.5)=IITC
"RTN","PSOERXA4",60,0)
 .S IITCQ=$G(@SSGL@(STSIG,"Indication",0,"IndicationTextCodeQualifier",0)),SFDA(SF,STIENS,11.6)=IITCQ
"RTN","PSOERXA4",61,0)
 .S IIVT=$G(@SSGL@(STSIG,"Indication",0,"IndicationValueText",0)),SFDA(SF,STIENS,12.1)=IIVT
"RTN","PSOERXA4",62,0)
 .S IIVU=$G(@SSGL@(STSIG,"Indication",0,"IndicationValueUnit",0)),SFDA(SF,STIENS,12.2)=IIVU
"RTN","PSOERXA4",63,0)
 .S IIVUMC=$G(@SSGL@(STSIG,"Indication",0,"IndicationValueUnitofMeasureCode",0)),SFDA(SF,STIENS,12.4)=IIVUMC
"RTN","PSOERXA4",64,0)
 .S IIVUMCQ=$G(@SSGL@(STSIG,"Indication",0,"IndicationValueUnitofMeasureCodeQualifier",0)),SFDA(SF,STIENS,12.5)=IIVUMCQ
"RTN","PSOERXA4",65,0)
 .S IIVUMT=$G(@SSGL@(STSIG,"Indication",0,"IndicationValueUnitofMeasureText",0)),SFDA(SF,STIENS,12.3)=IIVUMT
"RTN","PSOERXA4",66,0)
 .S IIVM=$G(@SSGL@(STSIG,"Indication",0,"IndicationVariableModifier",0)),SFDA(SF,STIENS,12.6)=IIVM
"RTN","PSOERXA4",67,0)
 .; Maximum Dose Restriction
"RTN","PSOERXA4",68,0)
 .S MDRNV=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionNumericValue",0)),SFDA(SF,STIENS,10.1)=MDRNV
"RTN","PSOERXA4",69,0)
 .S MDRNCQ=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionCodeQualifier",0)),SFDA(SF,STIENS,10.3)=MDRNCQ
"RTN","PSOERXA4",70,0)
 .S MDRUC=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionUnitsCode",0)),SFDA(SF,STIENS,10.4)=MDRUC
"RTN","PSOERXA4",71,0)
 .S MDRUT=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionUnitsText",0)),SFDA(SF,STIENS,10.2)=MDRUT
"RTN","PSOERXA4",72,0)
 .S MDRVDM=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionVariableDurationModifier",0)),SFDA(SF,STIENS,10.9)=MDRVDM
"RTN","PSOERXA4",73,0)
 .S MDRVNV=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionVariableNumericValue",0)),SFDA(SF,STIENS,10.5)=MDRVNV
"RTN","PSOERXA4",74,0)
 .S MDRVUC=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionVariableUnitsCode",0)),SFDA(SF,STIENS,10.7)=MDRVUC
"RTN","PSOERXA4",75,0)
 .S MDRVUCQ=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionVariableUnitsCodeQualifier",0)),SFDA(SF,STIENS,10.8)=MDRVUCQ
"RTN","PSOERXA4",76,0)
 .S MDRVUT=$G(@SSGL@(STSIG,"MaximumDoseRestriction",0,"MaximumDoseRestrictionVariableUnitsText",0)),SFDA(SF,STIENS,10.6)=MDRVUT
"RTN","PSOERXA4",77,0)
 .; Route of Administration
"RTN","PSOERXA4",78,0)
 .S ROAMRAM=$G(@SSGL@(STSIG,"RouteOfAdministration",0,"MultipleRouteofAdministrationModifier",0)),SFDA(SF,STIENS,6.4)=ROAMRAM
"RTN","PSOERXA4",79,0)
 .S ROAMC=$G(@SSGL@(STSIG,"RouteOfAdministration",0,"RouteofAdministrationCode",0)),SFDA(SF,STIENS,6.2)=ROAMC
"RTN","PSOERXA4",80,0)
 .S ROAMCQ=$G(@SSGL@(STSIG,"RouteOfAdministration",0,"RouteofAdministrationCodeQualifier",0)),SFDA(SF,STIENS,6.3)=ROAMCQ
"RTN","PSOERXA4",81,0)
 .S ROAMT=$G(@SSGL@(STSIG,"RouteOfAdministration",0,"RouteofAdministrationText",0)),SFDA(SF,STIENS,6.1)=ROAMT
"RTN","PSOERXA4",82,0)
 .; site of Administration
"RTN","PSOERXA4",83,0)
 .S SAMATM=$G(@SSGL@(STSIG,"SiteofAdministration",0,"MultipleAdministrationTimingModifier",0)),SFDA(SF,STIENS,6.8)=SAMATM
"RTN","PSOERXA4",84,0)
 .S SASAC=$G(@SSGL@(STSIG,"SiteofAdministration",0,"SiteofAdministrationCode",0)),SFDA(SF,STIENS,6.6)=SASAC
"RTN","PSOERXA4",85,0)
 .S SASACQ=$G(@SSGL@(STSIG,"SiteofAdministration",0,"SiteofAdministrationCodeQualifier",0)),SFDA(SF,STIENS,6.7)=SASACQ
"RTN","PSOERXA4",86,0)
 .S SAT=$G(@SSGL@(STSIG,"SiteofAdministration",0,"SiteofAdministrationText",0)),SFDA(SF,STIENS,6.5)=SAT
"RTN","PSOERXA4",87,0)
 .; Timing
"RTN","PSOERXA4",88,0)
 .S TATC=$G(@SSGL@(STSIG,"Timing",0,"AdministrationTimingCode",0)),SFDA(SF,STIENS,7.2)=TATC
"RTN","PSOERXA4",89,0)
 .S TATCQ=$G(@SSGL@(STSIG,"Timing",0,"AdministrationTimingCodeQualifier",0)),SFDA(SF,STIENS,7.3)=TATCQ
"RTN","PSOERXA4",90,0)
 .S TATT=$G(@SSGL@(STSIG,"Timing",0,"AdministrationTimingText",0)),SFDA(SF,STIENS,7.1)=TATT
"RTN","PSOERXA4",91,0)
 .S TFNV=$G(@SSGL@(STSIG,"Timing",0,"FrequencyNumericValue",0)),SFDA(SF,STIENS,8.4)=TFNV
"RTN","PSOERXA4",92,0)
 .S TFUC=$G(@SSGL@(STSIG,"Timing",0,"FrequencyUnitsCode",0)),SFDA(SF,STIENS,8.6)=TFUC
"RTN","PSOERXA4",93,0)
 .S TFUCQ=$G(@SSGL@(STSIG,"Timing",0,"FrequencyUnitsCodeQualifier",0)),SFDA(SF,STIENS,8.7)=TFUCQ
"RTN","PSOERXA4",94,0)
 .S TFUT=$G(@SSGL@(STSIG,"Timing",0,"FrequencyUnitsText",0)),SFDA(SF,STIENS,8.5)=TFUT
"RTN","PSOERXA4",95,0)
 .S TINV=$G(@SSGL@(STSIG,"Timing",0,"IntervalNumericValue",0)),SFDA(SF,STIENS,9.1)=TINV
"RTN","PSOERXA4",96,0)
 .S TIUC=$G(@SSGL@(STSIG,"Timing",0,"IntervalUnitsCode",0)),SFDA(SF,STIENS,9.3)=TIUC
"RTN","PSOERXA4",97,0)
 .S TIUCQ=$G(@SSGL@(STSIG,"Timing",0,"IntervalUnitsCodeQualifier",0)),SFDA(SF,STIENS,9.4)=TIUCQ
"RTN","PSOERXA4",98,0)
 .S TIUT=$G(@SSGL@(STSIG,"Timing",0,"IntervalUnitsText",0)),SFDA(SF,STIENS,9.2)=TIUT
"RTN","PSOERXA4",99,0)
 .S TMATM=$G(@SSGL@(STSIG,"Timing",0,"MultipleAdministrationTimingModifier",0)),SFDA(SF,STIENS,7.4)=TMATM
"RTN","PSOERXA4",100,0)
 .S TRUMC=$G(@SSGL@(STSIG,"Timing",0,"RateUnitofMeasureCode",0)),SFDA(SF,STIENS,7.7)=TRUMC
"RTN","PSOERXA4",101,0)
 .S TRUMCQ=$G(@SSGL@(STSIG,"Timing",0,"RateUnitofMeasureCodeQualifier",0)),SFDA(SF,STIENS,7.8)=TRUMCQ
"RTN","PSOERXA4",102,0)
 .S TRUMT=$G(@SSGL@(STSIG,"Timing",0,"RateUnitofMeasureText",0)),SFDA(SF,STIENS,7.6)=TRUMT
"RTN","PSOERXA4",103,0)
 .S TRA=$G(@SSGL@(STSIG,"Timing",0,"RateofAdministration",0)),SFDA(SF,STIENS,7.5)=TRA
"RTN","PSOERXA4",104,0)
 .S TTPBC=$G(@SSGL@(STSIG,"Timing",0,"TimePeriodBasisCode",0)),SFDA(SF,STIENS,8.2)=TTPBC
"RTN","PSOERXA4",105,0)
 .S TTPBCQ=$G(@SSGL@(STSIG,"Timing",0,"TimePeriodBasisCodeQualifier",0)),SFDA(SF,STIENS,8.3)=TTPBCQ
"RTN","PSOERXA4",106,0)
 .S TTPBT=$G(@SSGL@(STSIG,"Timing",0,"TimePeriodBasisText",0)),SFDA(SF,STIENS,8.1)=TTPBT
"RTN","PSOERXA4",107,0)
 .S TVFM=$G(@SSGL@(STSIG,"Timing",0,"VariableFrequencyModifier",0)),SFDA(SF,STIENS,8.8)=TVFM
"RTN","PSOERXA4",108,0)
 .S TVIM=$G(@SSGL@(STSIG,"Timing",0,"VariableIntervalModifier",0)),SFDA(SF,STIENS,9.5)=TVIM
"RTN","PSOERXA4",109,0)
 .; Vehicle
"RTN","PSOERXA4",110,0)
 .S VMVM=$G(@SSGL@(STSIG,"Vehicle",0,"MultipleVehicleModifier",0)),SFDA(SF,STIENS,5.8)=VMVM
"RTN","PSOERXA4",111,0)
 .S VN=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleName",0)),SFDA(SF,STIENS,5.1)=VN
"RTN","PSOERXA4",112,0)
 .S VNC=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleNameCode",0)),SFDA(SF,STIENS,5.2)=VNC
"RTN","PSOERXA4",113,0)
 .S VNCQ=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleNameCodeQualifier",0)),SFDA(SF,STIENS,5.3)=VNCQ
"RTN","PSOERXA4",114,0)
 .S VQTY=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleQuantity",0)),SFDA(SF,STIENS,5.4)=VQTY
"RTN","PSOERXA4",115,0)
 .S VUMC=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleUnitofMeasureCode",0)),SFDA(SF,STIENS,5.6)=VUMC
"RTN","PSOERXA4",116,0)
 .S VUMCQ=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleUnitofMeasureCodeQualifier",0)),SFDA(SF,STIENS,5.7)=VUMCQ
"RTN","PSOERXA4",117,0)
 .S VUMT=$G(@SSGL@(STSIG,"Vehicle",0,"VehicleUnitofMeasureText",0)),SFDA(SF,STIENS,5.5)=VUMT
"RTN","PSOERXA4",118,0)
 .D UPDATE^DIE(,"SFDA") K SFDA
"RTN","PSOERXA4",119,0)
 Q
"RTN","PSOERXD1")
0^6^B120565051^n/a
"RTN","PSOERXD1",1,0)
PSOERXD1 ;ALB/BWF - eRx Drug display/actions ; 8/3/2016 5:14pm
"RTN","PSOERXD1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXD1",3,0)
 ;
"RTN","PSOERXD1",4,0)
EN ; -- main entry point for PSO ERX HOLDING QUEUE
"RTN","PSOERXD1",5,0)
 D EN^VALM("PSO ERX DRUG VALIDATION")
"RTN","PSOERXD1",6,0)
 Q
"RTN","PSOERXD1",7,0)
 ;
"RTN","PSOERXD1",8,0)
HDR ; -- header code
"RTN","PSOERXD1",9,0)
 S VALMHDR(1)="eRx Patient: "_$$GET1^DIQ(52.49,PSOIEN,.04,"E")
"RTN","PSOERXD1",10,0)
 S VALMHDR(2)="eRx Reference #: "_$$GET1^DIQ(52.49,PSOIEN,.01,"E")
"RTN","PSOERXD1",11,0)
 I $G(VALMBCK)="R" D INIT
"RTN","PSOERXD1",12,0)
 Q
"RTN","PSOERXD1",13,0)
 ;
"RTN","PSOERXD1",14,0)
INIT ;
"RTN","PSOERXD1",15,0)
 Q:'$G(PSOIEN)
"RTN","PSOERXD1",16,0)
 N LINE,ERXDRG,LINETXT,ERXQTY,ERXQQ,ERXDF,ERXSC,ERXRFLS,ERXDS,ERXDT,ERXDW,ERXDSUB,VADRG,NXTLINE,ORDITEM
"RTN","PSOERXD1",17,0)
 N ERXCOMM,ERXDRUG,ERXSIG,FILLDT,ISSDT,MAILWIN,PATSTAT,SGLOOP,SIGDATA,SIGLINE,SIGLOOP,VACLIN,VACOPIES,VADAYS
"RTN","PSOERXD1",18,0)
 N VADOSE,VADRGIEN,VAENBY,VAENDATE,VAPINST,VAPROV,VAPUS,VAQTY,VAREF,VAREMARK,VAROUTE,VASCHED,VASIG,VAVERB
"RTN","PSOERXD1",19,0)
 N PSODAT,PSONEW,SIGDATA,SGLOOP,PRVCARY,PCRFST,PCLOOP,INSTARY,IFRST,INLOOP,SEPLN,PATINST,PIARY,PILOOP
"RTN","PSOERXD1",20,0)
 N SFIRST,SIGARY,PSOIENS,PSODAT2,PFRST,FN,FSSIG,INST,PATIEN,PCFRST,PRVCOMM,PSODFN,SLOOP,ERXDIR,MANVAL
"RTN","PSOERXD1",21,0)
 N VASIG,VASARY,VALBY,VALDTTM,NFIRST,NLOOP,ERXNARY,DIE,DA,DR,INLOOP,ERXNOTE,PUC,DRGARY,DLP,X,Y,DINUM
"RTN","PSOERXD1",22,0)
 S LINE=0
"RTN","PSOERXD1",23,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERXD1",24,0)
 S FN=52.49
"RTN","PSOERXD1",25,0)
 D GETS^DIQ(52.49,PSOIEN,"**","IE","PSODAT")
"RTN","PSOERXD1",26,0)
 S PATIEN=$G(PSODAT(FN,PSOIENS,.05,"I"))
"RTN","PSOERXD1",27,0)
 ; stub entry in file 55 if it doesn't exist
"RTN","PSOERXD1",28,0)
 I $G(PATIEN) D
"RTN","PSOERXD1",29,0)
 .Q:$D(^PS(55,PATIEN,0))
"RTN","PSOERXD1",30,0)
 .S DIC="^PS(55,",DLAYGO=55
"RTN","PSOERXD1",31,0)
 .K DD,DO S DIC(0)="L",(DINUM,X)=PATIEN D FILE^DICN D:Y<1  K DIC,DA,DR,DD,DO,DLAYGO
"RTN","PSOERXD1",32,0)
 ..S $P(^PS(55,PATIEN,0),"^")=PATIEN K DIK,DA S DA=PATIEN,DIK="^PS(55,",DIK(1)=.01 D EN^DIK K DIK,DA
"RTN","PSOERXD1",33,0)
 S ERXDRUG=$G(PSODAT(FN,PSOIENS,3.1,"E"))
"RTN","PSOERXD1",34,0)
 ; quantity
"RTN","PSOERXD1",35,0)
 S ERXQTY=$G(PSODAT(FN,PSOIENS,5.1,"E"))
"RTN","PSOERXD1",36,0)
 ; quantity qualifier
"RTN","PSOERXD1",37,0)
 S ERXQQ=$G(PSODAT(FN,PSOIENS,5.2,"E"))
"RTN","PSOERXD1",38,0)
 ; drug form code
"RTN","PSOERXD1",39,0)
 S ERXDF=$G(PSODAT(FN,PSOIENS,41,"E"))
"RTN","PSOERXD1",40,0)
 ; strength code
"RTN","PSOERXD1",41,0)
 S ERXSC=$G(PSODAT(FN,PSOIENS,43,"E"))
"RTN","PSOERXD1",42,0)
 ; refills
"RTN","PSOERXD1",43,0)
 S ERXRFLS=$G(PSODAT(FN,PSOIENS,5.6,"E"))
"RTN","PSOERXD1",44,0)
 ; days supply
"RTN","PSOERXD1",45,0)
 S ERXDS=$G(PSODAT(FN,PSOIENS,5.5,"E"))
"RTN","PSOERXD1",46,0)
 ; erx date
"RTN","PSOERXD1",47,0)
 S ERXDT=$G(PSODAT(FN,PSOIENS,.03,"E"))
"RTN","PSOERXD1",48,0)
 ; written date
"RTN","PSOERXD1",49,0)
 S ERXDW=$G(PSODAT(FN,PSOIENS,5.9,"E"))
"RTN","PSOERXD1",50,0)
 ; substitions
"RTN","PSOERXD1",51,0)
 S ERXDSUB=$G(PSODAT(FN,PSOIENS,5.8,"E"))
"RTN","PSOERXD1",52,0)
 ; va (matched) drug
"RTN","PSOERXD1",53,0)
 S ERXDIR=$G(PSODAT(FN,PSOIENS,7,"E"))
"RTN","PSOERXD1",54,0)
 S VADRG=$G(PSODAT(FN,PSOIENS,3.2,"E"))
"RTN","PSOERXD1",55,0)
 I VADRG']"" S VADRG="NOT LINKED"
"RTN","PSOERXD1",56,0)
 S PUC=$G(PSODAT(FN,PSOIENS,42,"E"))
"RTN","PSOERXD1",57,0)
 D TXT2ARY(.DRGARY,ERXDRUG,,70)
"RTN","PSOERXD1",58,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"eRx Drug: "_$G(DRGARY(1)))
"RTN","PSOERXD1",59,0)
 S DLP=1
"RTN","PSOERXD1",60,0)
 F  S DLP=$O(DRGARY(DLP)) Q:'DLP  D
"RTN","PSOERXD1",61,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"          "_$G(DRGARY(DLP)))
"RTN","PSOERXD1",62,0)
 S LINE=LINE+1
"RTN","PSOERXD1",63,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Qty: ",ERXQTY,1,26)
"RTN","PSOERXD1",64,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Days Supply: ",ERXDS,28,26)
"RTN","PSOERXD1",65,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Date Written: ",$P(ERXDW,"@"),54,26)
"RTN","PSOERXD1",66,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",67,0)
 S LINE=LINE+1
"RTN","PSOERXD1",68,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Qty Qualifier: "_ERXQQ)
"RTN","PSOERXD1",69,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Drug Form: "_ERXDF)
"RTN","PSOERXD1",70,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Strength: "_ERXSC)
"RTN","PSOERXD1",71,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Potency Unit Code: "_PUC)
"RTN","PSOERXD1",72,0)
 S LINE=LINE+1
"RTN","PSOERXD1",73,0)
 S LINE=LINE+1
"RTN","PSOERXD1",74,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Refills: ",ERXRFLS,1,15)
"RTN","PSOERXD1",75,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Do not sub: ",ERXDSUB,28,50)
"RTN","PSOERXD1",76,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",77,0)
 S SIGDATA=""
"RTN","PSOERXD1",78,0)
 D TXT2ARY(.SIGARY,ERXDIR,,70)
"RTN","PSOERXD1",79,0)
 S SFIRST=$O(SIGARY(0))
"RTN","PSOERXD1",80,0)
 S SGLOOP=0 F  S SGLOOP=$O(SIGARY(SGLOOP)) Q:'SGLOOP  D
"RTN","PSOERXD1",81,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,$S(SGLOOP=SFIRST:"eRx Sig: ",1:"         ")_$G(SIGARY(SGLOOP)))
"RTN","PSOERXD1",82,0)
 S ERXNOTE=$G(PSODAT(FN,PSOIENS,8,"E"))
"RTN","PSOERXD1",83,0)
 D TXT2ARY(.ERXNARY,ERXNOTE,,65)
"RTN","PSOERXD1",84,0)
 S NFIRST=$O(ERXNARY(0))
"RTN","PSOERXD1",85,0)
 S NLOOP=0 F  S NLOOP=$O(ERXNARY(NLOOP)) Q:'NLOOP  D
"RTN","PSOERXD1",86,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,$S(NLOOP=NFIRST:"eRx Notes: ",1:"           ")_$G(ERXNARY(NLOOP)))
"RTN","PSOERXD1",87,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXD1",88,0)
 S $P(SEPLN,"-",80)="-" D SET^VALM10(LINE,SEPLN)
"RTN","PSOERXD1",89,0)
 ; vista drug information
"RTN","PSOERXD1",90,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.5,"I")
"RTN","PSOERXD1",91,0)
 S VALBY=$$GET1^DIQ(52.49,PSOIEN,1.11,"E")
"RTN","PSOERXD1",92,0)
 S VALDTTM=$$GET1^DIQ(52.49,PSOIEN,1.12,"E")
"RTN","PSOERXD1",93,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Status: "_$S(MANVAL:"VALIDATED ("_VALBY_" - "_VALDTTM_")",1:"NOT VALIDATED"))
"RTN","PSOERXD1",94,0)
 S VADRGIEN=$G(PSODAT(52.49,PSOIENS,3.2,"I"))
"RTN","PSOERXD1",95,0)
 S VADRG=$S(VADRGIEN:$$GET1^DIQ(50,VADRGIEN,.01,"E"),1:"NOT MATCHED")
"RTN","PSOERXD1",96,0)
 S LINE=LINE+1 D SET^VALM10(LINE," (1) Vista Drug: "_VADRG)
"RTN","PSOERXD1",97,0)
 ; may not need clinic or remarks.
"RTN","PSOERXD1",98,0)
 S (VACLIN,VAREMARK)=""
"RTN","PSOERXD1",99,0)
 S VAPROV=$G(PSODAT(52.49,PSOIENS,2.3,"E"))
"RTN","PSOERXD1",100,0)
 S INST=$G(PSODAT(52.49,PSOIENS,26,"E"))
"RTN","PSOERXD1",101,0)
 ; if erx user comments exist, should we display them separately from the erx provider directions?
"RTN","PSOERXD1",102,0)
 I $D(PSODAT(52.49,PSOIENS,30)) S PRVCOMM=$G(PSODAT(52.49,PSOIENS,30,"E"))
"RTN","PSOERXD1",103,0)
 I '$L($G(PRVCOMM)) S PRVCOMM=$G(PSODAT(52.49,PSOIENS,8,"E"))
"RTN","PSOERXD1",104,0)
 S VADAYS=$G(PSODAT(52.49,PSOIENS,20.2,"E"))
"RTN","PSOERXD1",105,0)
 S VAQTY=$G(PSODAT(52.49,PSOIENS,20.1,"E"))
"RTN","PSOERXD1",106,0)
 S VAVERB=$G(PSODAT(52.49,PSOIENS,20.3,"E"))
"RTN","PSOERXD1",107,0)
 S PATSTAT=$$GET1^DIQ(55,PATIEN,3,"E")
"RTN","PSOERXD1",108,0)
 S MAILWIN=$G(PSODAT(52.49,PSOIENS,20.4,"E")) I MAILWIN="" S DIE="^PS(52.49,",DA=PSOIEN,DR="20.4///W" D ^DIE K DIE
"RTN","PSOERXD1",109,0)
 S VAREF=$G(PSODAT(52.49,PSOIENS,20.5,"E"))
"RTN","PSOERXD1",110,0)
 S PATINST=$G(PSODAT(52.49,PSOIENS,27,"E"))
"RTN","PSOERXD1",111,0)
 S PATINST=$$LSIG^PSOQUTIL(PATINST)
"RTN","PSOERXD1",112,0)
 ; testing instruction building
"RTN","PSOERXD1",113,0)
 ; end testing
"RTN","PSOERXD1",114,0)
 S VACLIN=$G(PSODAT(52.49,PSOIENS,20.6,"E")) I VACLIN="" S DIE="^PS(52.49,",DA=PSOIEN,DR="20.6///"_$$GET1^DIQ(59,PSOSITE,10,"I") D ^DIE K DIE
"RTN","PSOERXD1",115,0)
 D TXT2ARY(.PIARY,PATINST,,55)
"RTN","PSOERXD1",116,0)
 D DOSE
"RTN","PSOERXD1",117,0)
 ; pat instructions built from dosage multiple
"RTN","PSOERXD1",118,0)
 S PFRST="",PFRST=$O(PIARY(0)) I 'PFRST S PFRST=0
"RTN","PSOERXD1",119,0)
 S LINE=LINE+1 D SET^VALM10(LINE," (3) Pat Instructions: "_$G(PIARY(PFRST)))
"RTN","PSOERXD1",120,0)
 S PILOOP=PFRST F  S PILOOP=$O(PIARY(PILOOP)) Q:'PILOOP  D
"RTN","PSOERXD1",121,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"                       "_$G(PIARY(PILOOP)))
"RTN","PSOERXD1",122,0)
 ; provider comments come from the 'notes' field in 52.49 (#8)
"RTN","PSOERXD1",123,0)
 D TXT2ARY(.PRVCARY,PRVCOMM,,57)
"RTN","PSOERXD1",124,0)
 S PCFRST=$O(PRVCARY(0))
"RTN","PSOERXD1",125,0)
 S PCLOOP=0 F  S PCLOOP=$O(PRVCARY(PCLOOP)) Q:'PCLOOP  D
"RTN","PSOERXD1",126,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,$S(PCFRST=PCLOOP:" (4) Provider Comments: ",1:"                        ")_PRVCARY(PCLOOP))
"RTN","PSOERXD1",127,0)
 ; instructions are the unaltered SIG.
"RTN","PSOERXD1",128,0)
 ; if the instructions are longer than 57, convert to array for display
"RTN","PSOERXD1",129,0)
 S VASIG=""
"RTN","PSOERXD1",130,0)
 S SLOOP=0 F  S SLOOP=$O(^PS(52.49,PSOIEN,"SIG",SLOOP)) Q:'SLOOP  D
"RTN","PSOERXD1",131,0)
 .I '$L($G(VASIG)) S VASIG=$G(^PS(52.49,PSOIEN,"SIG",SLOOP,0)) Q
"RTN","PSOERXD1",132,0)
 .S VASIG=$G(VASIG)_" "_$G(^PS(52.49,PSOIEN,"SIG",SLOOP,0))
"RTN","PSOERXD1",133,0)
 S INLOOP=0 F  S INLOOP=$O(PSODAT(52.49,PSOIENS,31,INLOOP)) Q:'INLOOP  D
"RTN","PSOERXD1",134,0)
 .I '$L(INST) S INST=$G(PSODAT(52.49,PSOIENS,31,INLOOP)) Q
"RTN","PSOERXD1",135,0)
 .S INST=INST_" "_$G(PSODAT(52.49,PSOIENS,31,INLOOP))
"RTN","PSOERXD1",136,0)
 D TXT2ARY(.INSTARY,INST,,57)
"RTN","PSOERXD1",137,0)
 S IFRST=$O(INSTARY(0))
"RTN","PSOERXD1",138,0)
 S INLOOP=0 F  S INLOOP=$O(INSTARY(INLOOP)) Q:'INLOOP  D
"RTN","PSOERXD1",139,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,$S(IFRST=INLOOP:"          Instructions: ",1:"                        ")_$G(INSTARY(INLOOP)))
"RTN","PSOERXD1",140,0)
 S VASIG=VASIG_" "_PATINST_" "_PRVCOMM
"RTN","PSOERXD1",141,0)
 D TXT2ARY(.VASARY,VASIG,,55)
"RTN","PSOERXD1",142,0)
 S FSSIG=$O(VASARY(0))
"RTN","PSOERXD1",143,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"                   SIG: "_$S(FSSIG:$G(VASARY(FSSIG)),1:""))
"RTN","PSOERXD1",144,0)
 S SLOOP=1 F  S SLOOP=$O(VASARY(SLOOP)) Q:'SLOOP  D
"RTN","PSOERXD1",145,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"                        "_VASARY(SLOOP))
"RTN","PSOERXD1",146,0)
 S LINETXT=""
"RTN","PSOERXD1",147,0)
 S LINE=LINE+1 D SET^VALM10(LINE," (5) Patient Status: "_PATSTAT)
"RTN","PSOERXD1",148,0)
 S LINE=LINE+1
"RTN","PSOERXD1",149,0)
 D ADDITEM^PSOERX1A(.LINETXT," (6)     QTY: ",VAQTY,1,25)
"RTN","PSOERXD1",150,0)
 D ADDITEM^PSOERX1A(.LINETXT,"(7) Days Supply: ",VADAYS,40,30)
"RTN","PSOERXD1",151,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",152,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"    Provider ordered '"_$S(VAREF:VAREF,1:0)_"' refills")
"RTN","PSOERXD1",153,0)
 S LINE=LINE+1
"RTN","PSOERXD1",154,0)
 D ADDITEM^PSOERX1A(.LINETXT," (8) # of Refills: ",VAREF,1,30)
"RTN","PSOERXD1",155,0)
 ; routing defaults to 'M'ail
"RTN","PSOERXD1",156,0)
 D ADDITEM^PSOERX1A(.LINETXT,"(9) Routing: ",MAILWIN,45,25)
"RTN","PSOERXD1",157,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",158,0)
 S LINE=LINE+1 D SET^VALM10(LINE," (10)    Clinic: "_VACLIN)
"RTN","PSOERXD1",159,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"       Provider: "_VAPROV)
"RTN","PSOERXD1",160,0)
 S VALMCNT=LINE
"RTN","PSOERXD1",161,0)
 S EDTYP="D"
"RTN","PSOERXD1",162,0)
 K PSODAT,PSONEW,DOENT,TDUR
"RTN","PSOERXD1",163,0)
 Q
"RTN","PSOERXD1",164,0)
 ;
"RTN","PSOERXD1",165,0)
HELP ; -- help code
"RTN","PSOERXD1",166,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOERXD1",167,0)
 Q
"RTN","PSOERXD1",168,0)
 ;
"RTN","PSOERXD1",169,0)
EXIT ; -- exit code
"RTN","PSOERXD1",170,0)
 K @VALMAR,EDTYP
"RTN","PSOERXD1",171,0)
 Q
"RTN","PSOERXD1",172,0)
 ;
"RTN","PSOERXD1",173,0)
EXPND ; -- expand code
"RTN","PSOERXD1",174,0)
 Q
"RTN","PSOERXD1",175,0)
 ; ARY - array to store the output (pass by reference)
"RTN","PSOERXD1",176,0)
 ; TEXT - the text to convert into the array format
"RTN","PSOERXD1",177,0)
 ; DELIM - delimiter for text (default is space)
"RTN","PSOERXD1",178,0)
 ; MAXLEN - maximum lenth of each array items text, defaults to 80
"RTN","PSOERXD1",179,0)
TXT2ARY(ARY,TEXT,DELIM,MAXLEN) ;
"RTN","PSOERXD1",180,0)
 N WORD,I,LCNT,LINETXT,S
"RTN","PSOERXD1",181,0)
 S S=$S($D(DELIM):DELIM,1:" ")
"RTN","PSOERXD1",182,0)
 I '$G(MAXLEN) S MAXLEN=80
"RTN","PSOERXD1",183,0)
 S LCNT=1,LINETXT=""
"RTN","PSOERXD1",184,0)
 F I=1:1:$L(TEXT,S) D
"RTN","PSOERXD1",185,0)
 .S WORD=$P(TEXT,S,I)
"RTN","PSOERXD1",186,0)
 .I $L(LINETXT)+$L(S)+$L(WORD)>MAXLEN D  Q
"RTN","PSOERXD1",187,0)
 ..S ARY(LCNT)=LINETXT
"RTN","PSOERXD1",188,0)
 ..S LCNT=LCNT+1,LINETXT=WORD
"RTN","PSOERXD1",189,0)
 .I '$L(LINETXT) S LINETXT=WORD Q
"RTN","PSOERXD1",190,0)
 .S LINETXT=LINETXT_S_WORD
"RTN","PSOERXD1",191,0)
 ; if there is information left, set it into the array
"RTN","PSOERXD1",192,0)
 I $L(LINETXT) S ARY(LCNT)=$G(LINETXT)
"RTN","PSOERXD1",193,0)
 Q
"RTN","PSOERXD1",194,0)
DOSE ;displays dosing info for pending orders.  called from psoorfi1
"RTN","PSOERXD1",195,0)
 K II,UNITS S DS=1
"RTN","PSOERXD1",196,0)
 I '$O(^PS(52.49,PSOIEN,21,0)) S LINE=LINE+1,LINETXT="" D ADDITEM^PSOERX1A(.LINETXT," (2)          *Dosage:",,1,30) D SET^VALM10(LINE,LINETXT) S LINETXT="" G DOSEX
"RTN","PSOERXD1",197,0)
 F I=0:0 S I=$O(^PS(52.49,PSOIEN,21,I)) Q:'I  S DOSE=$G(^PS(52.49,PSOIEN,21,I,1)),DOSE1=$G(^(2)) D  D DOSE1
"RTN","PSOERXD1",198,0)
 .S II=$G(II)+1 K PSONEW("UNITS",II)
"RTN","PSOERXD1",199,0)
 .S PSONEW("DOSE",II)=$P(DOSE1,"^"),PSONEW("DOSE ORDERED",II)=$P(DOSE1,"^",2),PSONEW("UNITS",II)=$P(DOSE,"^",9),PSONEW("NOUN",II)=$P(DOSE,"^",5)
"RTN","PSOERXD1",200,0)
 .S:$P(DOSE,"^",9) UNITS=$P(^PS(50.607,$P(DOSE,"^",9),0),"^")
"RTN","PSOERXD1",201,0)
 .S PSONEW("VERB",II)=$P(DOSE,"^",10),PSONEW("ROUTE",II)=$P(DOSE,"^",8)
"RTN","PSOERXD1",202,0)
 .S ROUTE="" S:$P(DOSE,"^",8) ROUTE=$P(^PS(51.2,$P(DOSE,"^",8),0),"^")
"RTN","PSOERXD1",203,0)
 .S PSONEW("SCHEDULE",II)=$P(DOSE,"^"),PSONEW("DURATION",II)=$P(DOSE,"^",2)
"RTN","PSOERXD1",204,0)
 .S DOENT=$G(DOENT)+1 I $P(DOSE,"^",6)]"" S PSONEW("CONJUNCTION",II)=$S($P(DOSE,"^",6)="S":"T",$P(DOSE,"^",6)="X":"X",1:"A")
"RTN","PSOERXD1",205,0)
 .I 'PSONEW("DOSE ORDERED",II),$G(PSONEW("VERB",II))]"" D
"RTN","PSOERXD1",206,0)
 ..S LINETXT="" S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"               Verb: ",$G(PSONEW("VERB",II)),1,40)
"RTN","PSOERXD1",207,0)
 ..D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",208,0)
 .S:$G(DS) LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT," (2)","",1,5)
"RTN","PSOERXD1",209,0)
DOSEX S PSONEW("ENT")=+$G(II) K DOSE,DOSE1,II,I,UNITS,ROUTE,DG
"RTN","PSOERXD1",210,0)
 Q
"RTN","PSOERXD1",211,0)
DOSE1 ;
"RTN","PSOERXD1",212,0)
 I $G(DS)=1 D ADDITEM^PSOERX1A(.LINETXT,"        *Dosage:","",4,30) D FMD G DU
"RTN","PSOERXD1",213,0)
 S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"            *Dosage:","",1,30) D FMD
"RTN","PSOERXD1",214,0)
DU ;
"RTN","PSOERXD1",215,0)
 S PSODFN=$O(^PS(55,"B",PATIEN,0))
"RTN","PSOERXD1",216,0)
 I 'PSONEW("DOSE ORDERED",I),$P($G(^PS(55,PSODFN,"LAN")),"^") D
"RTN","PSOERXD1",217,0)
 .S LINE=LINE+1,LINETXT="" D ADDITEM^PSOERX1A(.LINETXT,"  Oth. Lang. Dosage: ",$G(PSONEW("ODOSE",I)),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",218,0)
 I PSONEW("DOSE ORDERED",II),$G(PSONEW("VERB",II))]"" D
"RTN","PSOERXD1",219,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"               Verb: ",$G(PSONEW("VERB",II)),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",220,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"     Dispense Units: ",$S($E(PSONEW("DOSE ORDERED",II),1)=".":"0",1:"")_PSONEW("DOSE ORDERED",II),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",221,0)
 I PSONEW("NOUN",II)]"" D
"RTN","PSOERXD1",222,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"               Noun: ",PSONEW("NOUN",II),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",223,0)
 I $G(ROUTE)]"" D
"RTN","PSOERXD1",224,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"             *Route: ",$G(ROUTE),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",225,0)
 S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"          *Schedule: ",PSONEW("SCHEDULE",II),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",226,0)
 I $G(PSONEW("DURATION",II))]"" D
"RTN","PSOERXD1",227,0)
 .S PSONEW("DURATION",II)=$S($E(PSONEW("DURATION",II),1)'?.N:$E(PSONEW("DURATION",II),2,99)_$E(PSONEW("DURATION",II),1),1:PSONEW("DURATION",II))
"RTN","PSOERXD1",228,0)
 .S TDUR=PSONEW("DURATION",II)_" ("_$S(PSONEW("DURATION",II)["M":"MINUTES",PSONEW("DURATION",II)["H":"HOURS",PSONEW("DURATION",II)["L":"MONTHS",PSONEW("DURATION",II)["W":"WEEKS",1:"DAYS")_")"
"RTN","PSOERXD1",229,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"          *Duration: ",TDUR,1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",230,0)
 I $G(PSONEW("CONJUNCTION",II))]"" D
"RTN","PSOERXD1",231,0)
 .S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT,"       *Conjunction: ",$S(PSONEW("CONJUNCTION",II)="T":"THEN",PSONEW("CONJUNCTION",II)="X":"EXCEPT",1:"AND"),1,50) D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",232,0)
 Q
"RTN","PSOERXD1",233,0)
FMD ;
"RTN","PSOERXD1",234,0)
 Q:$G(PSONEW("DOSE",II))']""  S MIG=PSONEW("DOSE",II)
"RTN","PSOERXD1",235,0)
 I $E(MIG,1)=".",$G(PSONEW("DOSE ORDERED",II)) S MIG="0"_MIG
"RTN","PSOERXD1",236,0)
 F SG=1:1:$L(MIG," ") D
"RTN","PSOERXD1",237,0)
 .I $L(LINETXT_" "_$P(MIG," ",SG))>80 D  Q
"RTN","PSOERXD1",238,0)
 ..S LINE=LINE+1 D ADDITEM^PSOERX1A(.LINETXT," ","",20,1)
"RTN","PSOERXD1",239,0)
 ..D ADDITEM^PSOERX1A(.LINETXT," ",$P(MIG," ",SG),$L(LINETXT),$L($P(MIG," ",SG))+1)
"RTN","PSOERXD1",240,0)
 .D ADDITEM^PSOERX1A(.LINETXT," ",$P(MIG," ",SG),$L(LINETXT),$L($P(MIG," ",SG))+1)
"RTN","PSOERXD1",241,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",242,0)
 I $G(UNITS)]"" D
"RTN","PSOERXD1",243,0)
 .I $L(LINETXT_" ("_UNITS_")")>80 D  Q
"RTN","PSOERXD1",244,0)
 ..S LINE=LINE+1,LINETXT=""
"RTN","PSOERXD1",245,0)
 ..D ADDITEM^PSOERX1A(.LINETXT," ","",20,1)
"RTN","PSOERXD1",246,0)
 ..D ADDITEM^PSOERX1A(.LINETXT," ("_UNITS_")",22,50)
"RTN","PSOERXD1",247,0)
 ..D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXD1",248,0)
 K DS,MIG,SG
"RTN","PSOERXD1",249,0)
 ; Consider invoking this as a future enhancement.
"RTN","PSOERXD1",250,0)
 ;I '$G(PSONEW("DOSE ORDERED",II)),$P($G(^PS(55,PSODFN,"LAN")),"^") D LAN^PSOORED5
"RTN","PSOERXD1",251,0)
 Q
"RTN","PSOERXD2")
0^24^B205678720^n/a
"RTN","PSOERXD2",1,0)
PSOERXD2 ;ALB/BWF - eRx Drug edit actions ; 5/26/2017 9:57am
"RTN","PSOERXD2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXD2",3,0)
 ;
"RTN","PSOERXD2",4,0)
 Q
"RTN","PSOERXD2",5,0)
SBN ;
"RTN","PSOERXD2",6,0)
 N Y,ERXIEN
"RTN","PSOERXD2",7,0)
 S Y=$P(XQORNOD(0),"=",2)
"RTN","PSOERXD2",8,0)
 I Y']"" S VALMBCK="R" Q
"RTN","PSOERXD2",9,0)
 D EDIT^PSOERX1A("D",Y)
"RTN","PSOERXD2",10,0)
 S VALMBCK="R"
"RTN","PSOERXD2",11,0)
 Q
"RTN","PSOERXD2",12,0)
VDRG1(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",13,0)
 N VANDRG,VAODRG,DIE,DA,DR,AUTOVAL,DIC,Y,QTLOOP,SELDRG,VDRG,VANDRG,VAOI,PATINST
"RTN","PSOERXD2",14,0)
 Q:'$G(PSOIEN)
"RTN","PSOERXD2",15,0)
 S VAODRG=$$GET1^DIQ(52.49,PSOIEN,3.2,"I")
"RTN","PSOERXD2",16,0)
 S AUTOVAL=$$GET1^DIQ(52.49,PSOIEN,1.4,"I")
"RTN","PSOERXD2",17,0)
 I VAODRG W !,"Current Vista Drug: "_$$GET1^DIQ(50,VAODRG,.01,"E")
"RTN","PSOERXD2",18,0)
 ; for now allow user to search by drug name. may enhance screening in the future.
"RTN","PSOERXD2",19,0)
 S DIC(0)="AEMQ",DIC=50,DIC("S")="I $$ACTIVE^PSOERXA0(Y),($$OUTPAT^PSOERXA0(Y)),('$$INVCOMP^PSOERXA0(Y)),('$$CS^PSOERXA0(Y))"
"RTN","PSOERXD2",20,0)
 I VAODRG]"" S DIC("B")=VAODRG
"RTN","PSOERXD2",21,0)
 D ^DIC K DIC
"RTN","PSOERXD2",22,0)
 I $G(DUOUT)!($P(Y,U)<1) S PQUIT=1 Q
"RTN","PSOERXD2",23,0)
 S SELDRG=Y
"RTN","PSOERXD2",24,0)
 W !!,"You have selected: "_$P(Y,U,2),!,"Would you like to use this drug/supply?" S DIR(0)="YO" D ^DIR K DIR
"RTN","PSOERXD2",25,0)
 I Y="^"!(Y<1) S PQUIT=1 Q
"RTN","PSOERXD2",26,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="3.2///"_$P(SELDRG,U,1) D ^DIE
"RTN","PSOERXD2",27,0)
 ; set the manual validation flag if the drug has been selected.
"RTN","PSOERXD2",28,0)
 S VANDRG=$$GET1^DIQ(52.49,PSOIEN,3.2,"I")
"RTN","PSOERXD2",29,0)
 I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERXD2",30,0)
 ; if the drug has changed, update the manual validation by and date/time
"RTN","PSOERXD2",31,0)
 I VANDRG'="",VAODRG'=VANDRG D
"RTN","PSOERXD2",32,0)
 .S QTLOOP=0 F  S QTLOOP=$O(^PS(52.49,PSOIEN,21,QTLOOP)) Q:'QTLOOP  D
"RTN","PSOERXD2",33,0)
 ..S FDA(52.4921,QTLOOP_","_PSOIENS,.01)="@" D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXD2",34,0)
 .; if the drug is the same, leave the manual validation,otherwise delete it.
"RTN","PSOERXD2",35,0)
 .S FDA(52.49,PSOIENS,1.5)=""
"RTN","PSOERXD2",36,0)
 .S FDA(52.49,PSOIENS,1.11)="",FDA(52.49,PSOIENS,1.12)=""
"RTN","PSOERXD2",37,0)
 .S FDA(52.49,PSOIENS,20.3)="",FDA(52.49,PSOIENS,20.4)=""
"RTN","PSOERXD2",38,0)
 .S FDA(52.49,PSOIENS,27)="",FDA(52.49,PSOIENS,20.1)="",FDA(52.49,PSOIENS,20.2)=""
"RTN","PSOERXD2",39,0)
 .S FDA(52.49,PSOIENS,20.3)="",FDA(52.49,PSOIENS,20.4)="",FDA(52.49,PSOIENS,20.5)=""
"RTN","PSOERXD2",40,0)
 ; get and file patient instructions
"RTN","PSOERXD2",41,0)
 S VDRG=VANDRG
"RTN","PSOERXD2",42,0)
 S VAOI=$$GET1^DIQ(50,VDRG,2.1,"I")
"RTN","PSOERXD2",43,0)
 S PATINST=$$GET1^DIQ(50.7,VAOI,7,"E")
"RTN","PSOERXD2",44,0)
 I $L(PATINST) D
"RTN","PSOERXD2",45,0)
 .S DIE="^PS(52.49,",DA=PSOIEN,DR="27///"_$G(PATINST) D ^DIE K DIE,DA
"RTN","PSOERXD2",46,0)
 D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXD2",47,0)
 Q
"RTN","PSOERXD2",48,0)
VDRG2(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",49,0)
 N PSOQTS,PSOFROM
"RTN","PSOERXD2",50,0)
 N PSODOSE,PSONEW,PSODRUG,PSORXED,VERB,QTIEN,SFIENS,DOSE,PSODFN
"RTN","PSOERXD2",51,0)
 ; get patient IEN
"RTN","PSOERXD2",52,0)
 S PSODFN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERXD2",53,0)
 I 'PSODFN D  Q
"RTN","PSOERXD2",54,0)
 .W !,"Cannot continue with dosing instructions until patient has been matched."
"RTN","PSOERXD2",55,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERXD2",56,0)
 .S PQUIT=1
"RTN","PSOERXD2",57,0)
 ; get drug ien and orderable item ien
"RTN","PSOERXD2",58,0)
 D DERX1(PSOIEN,PSOIENS,1)
"RTN","PSOERXD2",59,0)
 S PSODRUG("IEN")=$$GET1^DIQ(52.49,PSOIEN,3.2,"I") Q:'PSODRUG("IEN")
"RTN","PSOERXD2",60,0)
 S PSODRUG("OI")=$$GET1^DIQ(50,PSODRUG("IEN"),2.1,"I") Q:'PSODRUG("OI")
"RTN","PSOERXD2",61,0)
 S (PSORXED("ENT"),ENT)=1
"RTN","PSOERXD2",62,0)
 ; SET PSOFROM=PENDING so the dosage list will activate and present to the user
"RTN","PSOERXD2",63,0)
 S PSOFROM="PENDING"
"RTN","PSOERXD2",64,0)
 D DOSE^PSSORPH(.DOSE,PSODRUG("IEN"),"O",PSODFN)
"RTN","PSOERXD2",65,0)
 D ASK^PSOBKDED
"RTN","PSOERXD2",66,0)
 I $G(DOSE)']"" S PQUIT=1 Q
"RTN","PSOERXD2",67,0)
 I $$GET1^DIQ(52.49,PSOIEN,1,"E")="N" D UPDSTAT^PSOERXU1(PSOIEN,"I")
"RTN","PSOERXD2",68,0)
 I $G(VERB)]"" S PSORXED("VERB",ENT)=VERB G DUPD
"RTN","PSOERXD2",69,0)
VER ;
"RTN","PSOERXD2",70,0)
 D DERX1(PSOIEN,PSOIENS,1)
"RTN","PSOERXD2",71,0)
 ;below logic brought over from VER^PSOOREDX
"RTN","PSOERXD2",72,0)
 D KV S DIR(0)="52.0113,8"
"RTN","PSOERXD2",73,0)
 S:$G(PSORXED("VERB",ENT))]"" DIR("B")=PSORXED("VERB",ENT)
"RTN","PSOERXD2",74,0)
 D ^DIR
"RTN","PSOERXD2",75,0)
 I X[U,$L(X)>1 S FIELD="VER" G JUMP
"RTN","PSOERXD2",76,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",77,0)
 I X="@" K PSORXED("VERB",ENT),VERB G DUPD
"RTN","PSOERXD2",78,0)
 S:X'="" (PSORXED("VERB",ENT),VERB)=X
"RTN","PSOERXD2",79,0)
DUPD ;
"RTN","PSOERXD2",80,0)
 I $G(PSORXED("DOSE",ENT))'?.N&($G(PSORXED("DOSE",ENT))'?.N1".".N)!'DOSE("LD") K PSORXED("DOSE ORDERED",ENT),DUPD G NOU1
"RTN","PSOERXD2",81,0)
 ; below logic brough over from DUPD^PSOOREDX
"RTN","PSOERXD2",82,0)
 D KV S DIR(0)="52.0113,1",DIR("A")="DISPENSE UNITS PER DOSE"_$S($G(PSORXED("NOUN",ENT))]"":"("_PSORXED("NOUN",ENT)_")",1:"")
"RTN","PSOERXD2",83,0)
 I '$G(PSORXED("DOSE",ENT)),$G(PSORXED("DOSE",ENT-1)) S PSORXED("DOSE",ENT)=PSORXED("DOSE",ENT-1)
"RTN","PSOERXD2",84,0)
 S DIR("B")=$S($G(PSORXED("DOSE ORDERED",ENT))]"":PSORXED("DOSE ORDERED",ENT),1:1) S:$E($G(DIR("B")),1)="." DIR("B")="0"_$G(DIR("B")) K:DIR("B")="" DIR("B")
"RTN","PSOERXD2",85,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUPD" G JUMP
"RTN","PSOERXD2",86,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",87,0)
 I X="@"!(X=0) W !,"Dispense Units Per Dose is Required!!",! G DUPD
"RTN","PSOERXD2",88,0)
 ;below logic brought over from STR^PSOOREDX
"RTN","PSOERXD2",89,0)
 S:+STRE>0&(X>0) PSORXED("DOSE",ENT)=(X*STRE) W !,"Dosage Ordered: "_$S($E(PSORXED("DOSE",ENT),1)=".":"0",1:"")_PSORXED("DOSE",ENT)_UNITN,!
"RTN","PSOERXD2",90,0)
 S:X'="" (PSORXED("DOSE ORDERED",ENT),DUPD)=X
"RTN","PSOERXD2",91,0)
NOU1 ;
"RTN","PSOERXD2",92,0)
 G:'$G(PSORXED("DOSE ORDERED",ENT)) RTE
"RTN","PSOERXD2",93,0)
 D CNON
"RTN","PSOERXD2",94,0)
 N PSONDEF
"RTN","PSOERXD2",95,0)
 I $G(NOUN)]"" S PSORXED("NOUN",ENT)=NOUN
"RTN","PSOERXD2",96,0)
NOU ;
"RTN","PSOERXD2",97,0)
 ;below logic brought over from NOU^PSOOREDX
"RTN","PSOERXD2",98,0)
 D KV S DIR(0)="52.0113,3"
"RTN","PSOERXD2",99,0)
 S DIR("B")=$S($G(NOUN)]"":NOUN,1:$G(PSORXED("NOUN",ENT))) K:DIR("B")="" DIR("B")
"RTN","PSOERXD2",100,0)
 S PSONDEF=$G(DIR("B"))
"RTN","PSOERXD2",101,0)
 D ^DIR
"RTN","PSOERXD2",102,0)
 I X[U,$L(X)>1 S FIELD="NOU" G JUMP
"RTN","PSOERXD2",103,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",104,0)
 I X="@" K PSORXED("NOUN",ENT),NOUN G RTE
"RTN","PSOERXD2",105,0)
 I X'="",$G(PSONDEF)="" S NOUN=X
"RTN","PSOERXD2",106,0)
 I X'="",$G(PSONDEF)'=X S NOUN=X
"RTN","PSOERXD2",107,0)
 S:X'="" PSORXED("NOUN",ENT)=X
"RTN","PSOERXD2",108,0)
 ;
"RTN","PSOERXD2",109,0)
RTE ;
"RTN","PSOERXD2",110,0)
 N CURTE,ERXRTE
"RTN","PSOERXD2",111,0)
 S CURTE=$$GET1^DIQ(52.4921,ENT_","_PSOIEN_",",10,"E") S PSORXED("ROUTE",ENT)=CURTE
"RTN","PSOERXD2",112,0)
 K JUMP ;S ROU="PSOORED3" D RTE2 K ROU
"RTN","PSOERXD2",113,0)
 S ROU="PSOERXD2" D RTE2 K ROU
"RTN","PSOERXD2",114,0)
 K ROU
"RTN","PSOERXD2",115,0)
 I $G(JUMP) K JUMP G JUMP
"RTN","PSOERXD2",116,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",117,0)
 ;
"RTN","PSOERXD2",118,0)
SCH ;
"RTN","PSOERXD2",119,0)
 K PSOSCH,DIR,CURSCH
"RTN","PSOERXD2",120,0)
 I '$D(ENT) S ENT=PSORXED("ENT")
"RTN","PSOERXD2",121,0)
 S CURSCH=$$GET1^DIQ(52.4921,ENT_","_PSOIEN_",",1,"E") I CURSCH]"" S DIR("B")=CURSCH
"RTN","PSOERXD2",122,0)
 S DIR("?")="^D SCHLP^PSOORED4",DIR("A")="Schedule: ",DIR(0)="FA^1:20^I X[""""""""!(X?.E1C.E)!($A(X)=45)!($L(X,"" "")>$S(X[""PRN"":4,1:3))!($L(X)>20)!($L(X)<1) K X"
"RTN","PSOERXD2",123,0)
 D ^DIR
"RTN","PSOERXD2",124,0)
 I X[U,$L(X)>1 S FIELD="SCH" G JUMP
"RTN","PSOERXD2",125,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",126,0)
 S SCH=Y D SCH^PSOSIG I $G(SCH)']"" G SCH
"RTN","PSOERXD2",127,0)
 S PSORXED("SCHEDULE",ENT)=SCH W " ("_SCHEX_")" K SCH,SCHEX,X,Y,PSOSCH
"RTN","PSOERXD2",128,0)
 S:PSORXED("ENT")<ENT PSORXED("ENT")=ENT
"RTN","PSOERXD2",129,0)
 ;
"RTN","PSOERXD2",130,0)
DUR ;
"RTN","PSOERXD2",131,0)
 N SIG,SIGDAT,SLOOP,P01,I,DDONE
"RTN","PSOERXD2",132,0)
 D KV K EXP S DIR(0)="52.0113,4",DIR("A")="LIMITED DURATION (IN DAYS, HOURS OR MINUTES)"
"RTN","PSOERXD2",133,0)
 S DIR("B")=$S($G(PSORXED("DURATION",ENT))]"":PSORXED("DURATION",ENT),1:"") K:DIR("B")="" DIR("B")
"RTN","PSOERXD2",134,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="DUR" G JUMP
"RTN","PSOERXD2",135,0)
 G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",136,0)
 ;below logic is from DUR1^PSOOREDX
"RTN","PSOERXD2",137,0)
 I X="@" K DUR,PSORXED("DURATION",ENT)
"RTN","PSOERXD2",138,0)
 I Y'="" S PSORXED("DURATION",ENT)=Y W " ("_$S(Y["L":"MONTHS",Y["W":"WEEKS",Y["H":"HOURS",Y["M":"MINUTES",1:"DAYS")_")"
"RTN","PSOERXD2",139,0)
 ;
"RTN","PSOERXD2",140,0)
 ; KEEP THIS CODE! - REMOVE CONJUNCTION FOR NOW, SINCE WE WILL NOT HAVE COMPLEX DOSING - FUTURE ENHANCEMENT
"RTN","PSOERXD2",141,0)
 ;CON D CON^PSOOREDX I X[U,$L(X)>1 S FIELD="CON" G JUMP
"RTN","PSOERXD2",142,0)
 ;G:$D(DTOUT)!($D(DUOUT)) EXQ
"RTN","PSOERXD2",143,0)
 ;I X="@",$G(PSORXED("CONJUNCTION",ENT))="" W !,?10,"Invalid Entry - nothing to delete!!" G CON
"RTN","PSOERXD2",144,0)
 ;S:X'=""&(X'="@") PSORXED("CONJUNCTION",ENT)=Y
"RTN","PSOERXD2",145,0)
 ;I X="@",$D(PSORXED("CONJUNCTION",ENT)) D CON1^PSOOREDX G:$D(DIRUT) EXQ G:'Y CON N CKX S CKX=1 D UPD^PSOOREDX G CON
"RTN","PSOERXD2",146,0)
 ;;
"RTN","PSOERXD2",147,0)
 ;N PSODLBD4 S PSOSAVX=X,PSODLBD4=1
"RTN","PSOERXD2",148,0)
 ;;*437
"RTN","PSOERXD2",149,0)
 ;I '$$DUROK^PSOORED3(.PSORXED,ENT) D  G DUR
"RTN","PSOERXD2",150,0)
 ;. W !!,"Duration is required for the dosage entered prior to the THEN conjunction.",$C(7),!
"RTN","PSOERXD2",151,0)
 ;I $G(PSORXED("CONJUNCTION",ENT))]"" S PSOCKCON=1 D DCHK1^PSODOSUT G:$G(PSONEW("DFLG")) EX S ENT=ENT+1 K DIR G ASK
"RTN","PSOERXD2",152,0)
 ;E  K PSOCKCON D DCHK1^PSODOSUT I $D(DTOUT)!($D(DUOUT)) S PSORX("DFLG")=1,PSONEW("DFLG")=1 G EX  ;don't need to print the full summary, just the last sequence. 
"RTN","PSOERXD2",153,0)
 ;I PSOSAVX="",$G(PSORXED) K PSOCKCON,PSOEDDOS
"RTN","PSOERXD2",154,0)
 ;K PSOSAVX
"RTN","PSOERXD2",155,0)
 ;;
"RTN","PSOERXD2",156,0)
 ;S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOERXD2",157,0)
 ;D EN^PSOFSIG(.PSORXED),VERI I $G(CKX),'$G(PSOSIGFL) D MP1 K CKX
"RTN","PSOERXD2",158,0)
 ;I $G(PSOSIGFL)=1 D  I '$G(PSOSIGFL) Q
"RTN","PSOERXD2",159,0)
 ;.I $D(OR0),$P(OR0,"^",24)=1 S VALMSG="Digitally Signed Order - No such changes allowed." K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) D  Q
"RTN","PSOERXD2",160,0)
 ;..I $D(PSOBDR) K PSODRUG M PSODRUG=PSOBDR K PSOBDR,PSOBDRG
"RTN","PSOERXD2",161,0)
 ;.S PSORXED("ENT")=ENT,SIGOK=1,VALMSG="This change will create a new prescription!",NCPDPFLG=1
"RTN","PSOERXD2",162,0)
 ;K QTYHLD S:$G(PSORXED("QTY")) QTYHLD=PSORXED("QTY") D QTY^PSOSIG(.PSORXED) I $G(PSORXED("QTY")) S QTY=1
"RTN","PSOERXD2",163,0)
 ;I $G(QTYHLD),'$G(PSORXED("QTY")) S PSORXED("QTY")=QTYHLD
"RTN","PSOERXD2",164,0)
 ;K QTYHLD
"RTN","PSOERXD2",165,0)
 ;I '$G(PSORXED("QTY")),$P(OR0,"^",10) S PSORXED("QTY")=$P(OR0,"^",10)
"RTN","PSOERXD2",166,0)
 ;S PSORXED("INS")="TESTING TO SEE HOW LONG WE CAN MAKE THE SIG AND GET THIS TO FORMAT CORRECTLY"
"RTN","PSOERXD2",167,0)
 S X=$G(PSORXED("INS")) D SIG^PSOHELP S:$G(INS1)]"" PSORXED("SIG")=$E(INS1,2,9999999)
"RTN","PSOERXD2",168,0)
 D EN^PSOFSIG(.PSORXED)
"RTN","PSOERXD2",169,0)
 ; delete existing SIG
"RTN","PSOERXD2",170,0)
 S SLOOP=0 F  S SLOOP=$O(^PS(52.49,PSOIEN,"SIG",SLOOP)) Q:'SLOOP  D
"RTN","PSOERXD2",171,0)
 .S FDA(52.4926,SLOOP_","_PSOIEN_",",.01)="@"
"RTN","PSOERXD2",172,0)
 I $D(FDA) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXD2",173,0)
 ; file sig into appropriate VA DISPENSING INSTRUCTIONS multiple
"RTN","PSOERXD2",174,0)
 S SLOOP=0 F  S SLOOP=$O(SIG(SLOOP)) Q:'SLOOP  D
"RTN","PSOERXD2",175,0)
 .S SIGDAT=$G(SIG(SLOOP)) Q:SIGDAT=""
"RTN","PSOERXD2",176,0)
 .S SFDA(52.4926,"+1,"_PSOIENS,.01)=SIGDAT D UPDATE^DIE(,"SFDA",,"SERR") K SFDA
"RTN","PSOERXD2",177,0)
 S QTIEN=$O(^PS(52.49,PSOIEN,21,0))
"RTN","PSOERXD2",178,0)
 S SFIENS=$S(QTIEN:QTIEN_",",1:"+1,")
"RTN","PSOERXD2",179,0)
 S P01=$S($L($G(PSORXED("DOSE ORDERED",ENT))):$G(PSORXED("DOSE ORDERED",ENT))_"&"_$G(PSORXED("NOUN",ENT)),1:$G(PSORXED("DOSE",ENT)))
"RTN","PSOERXD2",180,0)
 I '$L(P01) D  Q
"RTN","PSOERXD2",181,0)
 .W !,"Dosage is required. Please re-enter the dosing instructions." S DIR(0)="W" D ^DIR D EX Q 
"RTN","PSOERXD2",182,0)
 S FDA(52.4921,SFIENS_PSOIENS,.01)=$G(PSORXED("DOSE ORDERED",ENT))_"&"_$G(PSORXED("NOUN",ENT))
"RTN","PSOERXD2",183,0)
 S FDA(52.4921,SFIENS_PSOIENS,1)=$G(PSORXED("SCHEDULE",ENT))
"RTN","PSOERXD2",184,0)
 S FDA(52.4921,SFIENS_PSOIENS,2)=$G(PSORXED("DURATION",ENT))
"RTN","PSOERXD2",185,0)
 S FDA(52.4921,SFIENS_PSOIENS,8)=$G(PSORXED("DOSE",ENT))
"RTN","PSOERXD2",186,0)
 S FDA(52.4921,SFIENS_PSOIENS,9)=$G(PSORXED("DOSE ORDERED",ENT))
"RTN","PSOERXD2",187,0)
 S FDA(52.4921,SFIENS_PSOIENS,10)=$G(PSORXED("ROUTE",ENT))
"RTN","PSOERXD2",188,0)
 S FDA(52.4921,SFIENS_PSOIENS,11)=$G(PSORXED("UNITS",ENT))
"RTN","PSOERXD2",189,0)
 S FDA(52.4921,SFIENS_PSOIENS,12)=$G(PSORXED("NOUN",ENT))
"RTN","PSOERXD2",190,0)
 S FDA(52.4921,SFIENS_PSOIENS,13)=$G(PSORXED("VERB",ENT))
"RTN","PSOERXD2",191,0)
 ; VA INSTRUCTIONS
"RTN","PSOERXD2",192,0)
 N UNEXINS,UNEXARY,DDONE
"RTN","PSOERXD2",193,0)
 I $G(PSORXED("ENT")) D
"RTN","PSOERXD2",194,0)
 .S DDONE=0
"RTN","PSOERXD2",195,0)
 .F I=1:1:PSORXED("ENT")  D  Q:DDONE
"RTN","PSOERXD2",196,0)
 ..I '$D(PSORXED("DOSE ORDERED",I)) S DDONE=1 Q
"RTN","PSOERXD2",197,0)
 ..I '$L($G(UNEXINS)) D  Q
"RTN","PSOERXD2",198,0)
 ...S UNEXINS=$G(PSORXED("VERB",I))_" "_$G(PSORXED("DOSE ORDERED",I))_" "_$G(PSORXED("NOUN",I))_" "_$G(ERXRTE(I))_" "_$G(PSORXED("SCHEDULE",I))
"RTN","PSOERXD2",199,0)
 ...I $L($G(PSORXED("DURATION",I))) S UNEXINS=UNEXINS_" "_$G(PSORXED("DURATION",I))
"RTN","PSOERXD2",200,0)
 ...I $L($G(PSORXED("CONJUNCTION",I))) S UNEXINS=UNEXINS_" "_$G(PSORXED("CONJUNCTION",I))
"RTN","PSOERXD2",201,0)
 ..S UNEXINS=UNEXINS_$G(PSORXED("VERB",I))_" "_$G(PSORXED("DOSE ORDERED",I))_" "_$G(PSORXED("NOUN",I))_" "_$G(ERXRTE(I))_" "_$G(PSORXED("SCHEDULE",I))
"RTN","PSOERXD2",202,0)
 ..I $L($G(PSORXED("DURATION",I))) S UNEXINS=UNEXINS_" "_$G(PSORXED("DURATION",I))
"RTN","PSOERXD2",203,0)
 ..I $L($G(PSORXED("CONJUNCTION",I))) S UNEXINS=UNEXINS_" "_$G(PSORXED("CONJUNCTION",I))
"RTN","PSOERXD2",204,0)
 I $L($G(UNEXINS)) D
"RTN","PSOERXD2",205,0)
 .D TXT2ARY^PSOERXD1(.UNEXARY,UNEXINS,,80)
"RTN","PSOERXD2",206,0)
 .D WP^DIE(52.49,PSOIEN_",",31,"K","UNEXARY","BWFERR")
"RTN","PSOERXD2",207,0)
 I SFIENS["+" D UPDATE^DIE(,"FDA",,"ERR") K FDA
"RTN","PSOERXD2",208,0)
 ; if there is a quantity/timing entry, overwrite the data (we are not using complex dosing in this phase)
"RTN","PSOERXD2",209,0)
 I SFIENS'["+" D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXD2",210,0)
EX ;
"RTN","PSOERXD2",211,0)
 K PSOBDR,PSOBDRG,PSOSCH,DUPD,STRE,UNITN,SCH,VERB,NOUN,DOSEOR,RTE,DUR,X,Y,ENTS,PSODOSE,OLENT,FIELD,FLDNM,AR,NM,ENT,STRE,UNITN,PSODOSE,ERTE,ROU,AR1,INS1
"RTN","PSOERXD2",212,0)
KV K DTOUT,DUOUT,DIR,DIRUT
"RTN","PSOERXD2",213,0)
 Q
"RTN","PSOERXD2",214,0)
EXQ ;
"RTN","PSOERXD2",215,0)
 K PSORXED,PSOSIGFL M PSORXED=PSODOSE D EN^PSOFSIG(.PSORXED) D MP1
"RTN","PSOERXD2",216,0)
 I $D(PSOBDR) M PSODRUG=PSOBDR K PSOBDR,PSOBDRG
"RTN","PSOERXD2",217,0)
 S PQUIT=1
"RTN","PSOERXD2",218,0)
 G EX Q
"RTN","PSOERXD2",219,0)
MP1 ;
"RTN","PSOERXD2",220,0)
 S VALMSG="eRx Not Updated!"
"RTN","PSOERXD2",221,0)
 Q
"RTN","PSOERXD2",222,0)
JUMP ;jump to fields
"RTN","PSOERXD2",223,0)
 I $L($E(X,2,99))<3 W !,"Field Name Must Be At Least 3 Characters in Length",! G @FIELD
"RTN","PSOERXD2",224,0)
 D FNM
"RTN","PSOERXD2",225,0)
 I FLDNM']"" K X,NM,FLDNM W !,"INVALID FIELD NAME.  PLEASE TRY AGAIN!",! G @FIELD
"RTN","PSOERXD2",226,0)
 F AR=1:1:PSORXED("ENT") W !,AR_". "_$P(FLDNM,"^",2)_": "_$S(NM="ROU"&($G(PSORXED($P(FLDNM,"^"),AR))):$P(^PS(51.2,PSORXED($P(FLDNM,"^"),AR),0),"^"),1:$G(PSORXED($P(FLDNM,"^"),AR))) S AR1=AR
"RTN","PSOERXD2",227,0)
 D KV S DIR("A",1)="* Indicates which fields will create a New Order",DIR("A")="Select Field to Edit by number",DIR(0)="NO^1:"_AR1 D ^DIR G:$D(DIRUT) @FIELD
"RTN","PSOERXD2",228,0)
 D JFN G:FLDNM="" @FIELD G @FLDNM
"RTN","PSOERXD2",229,0)
 G EX
"RTN","PSOERXD2",230,0)
 Q
"RTN","PSOERXD2",231,0)
FNM S NM=$E(X,2,4),NM=$TR(NM,"qwertyuioplkjhgfdsazxcvbnm","QWERTYUIOPLKJHGFDSAZXCVBNM")
"RTN","PSOERXD2",232,0)
 S FLDNM=$S(NM="DOS":"DOSE^*Dosage",NM="DIS":"DOSE ORDERED^Dispense Units",NM="ROU":"ROUTE^*Route",NM="SCH":"SCHEDULE^*Schedule",NM="DUR"!(NM="LIM"):"DURATION^*Duration",1:"")
"RTN","PSOERXD2",233,0)
 S:FLDNM="" FLDNM=$S(NM="CON":"CONJUNCTION^*Conjunction",NM="NOU":"NOUN^Noun",NM="VER":"VERB^Verb",1:"")
"RTN","PSOERXD2",234,0)
 Q
"RTN","PSOERXD2",235,0)
JFN K FLDNM,AR S ENT=+Y,FLDNM=$S(NM="NOU":"NOU",NM="VER":"VER",NM="DOS":"ASK",NM="DIS":"DUPD",NM="ROU":"RTE",NM="SCH":"SCH",NM="DUR"!(NM="LIM"):"DUR",NM="CON":"CON",1:"")
"RTN","PSOERXD2",236,0)
 Q
"RTN","PSOERXD2",237,0)
CNON ;
"RTN","PSOERXD2",238,0)
 I $G(NOUN)'="" Q
"RTN","PSOERXD2",239,0)
 I '$G(PSORXED("DOSE ORDERED",ENT)) Q
"RTN","PSOERXD2",240,0)
 N PSONLT,PSONLL,PSONLG
"RTN","PSOERXD2",241,0)
 S PSONLL=$P($G(DOSE("DD",+$G(PSODRUG("IEN")))),"^",9) I PSONLL="" Q
"RTN","PSOERXD2",242,0)
 S PSONLG=$L(PSONLL)
"RTN","PSOERXD2",243,0)
 I PSONLG'>3 Q
"RTN","PSOERXD2",244,0)
 S PSONLT=$E(PSONLL,(PSONLG-2),PSONLG)
"RTN","PSOERXD2",245,0)
 I PSONLT'="(S)",PSONLT'="(s)" Q
"RTN","PSOERXD2",246,0)
 ;test noun of (S)
"RTN","PSOERXD2",247,0)
 K NOUN
"RTN","PSOERXD2",248,0)
 I $G(PSORXED("DOSE ORDERED",ENT))>1 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))_$E(PSONLT,2) Q
"RTN","PSOERXD2",249,0)
 S PSORXED("NOUN",ENT)=$E(PSONLL,1,(PSONLG-3))
"RTN","PSOERXD2",250,0)
 Q
"RTN","PSOERXD2",251,0)
RTE2 I $G(DRET) S PSORXED("ROUTE",ENT)=""
"RTN","PSOERXD2",252,0)
 I $G(RTE) K RTE
"RTN","PSOERXD2",253,0)
 K DIR,DIRUT S DIR(0)="FO^2:45",DIR("A")="ROUTE",DIR("?")="^D HLP^PSOORED4"
"RTN","PSOERXD2",254,0)
 ;S DIR("B")=$S($G(PSORXED("ROUTE",ENT)):$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),$G(RTE)]"":RTE,$G(DRET):"",1:"PO") K:DIR("B")="" DIR("B")
"RTN","PSOERXD2",255,0)
 S DIR("B")=$G(CURTE)
"RTN","PSOERXD2",256,0)
 ;I '$G(PSORXED("ROUTE",ENT)),$G(PSOREEDT) K DIR("B")
"RTN","PSOERXD2",257,0)
 D ^DIR I X[U,$L(X)>1 S FIELD="RTE",JUMP=1 K DIRUT,DTOUT Q
"RTN","PSOERXD2",258,0)
 Q:$D(DTOUT)!($D(DUOUT))
"RTN","PSOERXD2",259,0)
 I X="@"!(X="") K RTE,ERTE S DRET=1,PSORXED("ROUTE",ENT)="" Q
"RTN","PSOERXD2",260,0)
 K DRET I X=$P($G(^PS(51.2,+$G(PSORXED("ROUTE",ENT)),0)),"^") S RTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^"),ERTE=$P(^PS(51.2,PSORXED("ROUTE",ENT),0),"^",2) W X_" "_$G(ERTE) Q
"RTN","PSOERXD2",261,0)
 S DIC=51.2,DIC(0)="QEZM",DIC("S")="I $P(^(0),""^"",4)" D ^DIC Q:X[U  G:Y=-1 RTE2 W "  "_$P(Y(0),"^",2)
"RTN","PSOERXD2",262,0)
 ;S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2)
"RTN","PSOERXD2",263,0)
 S:X'="" PSORXED("ROUTE",ENT)=+Y,RTE=Y(0,0),ERTE=$P(Y(0),"^",2),ERXRTE(ENT)=$P(Y(0),U,3)
"RTN","PSOERXD2",264,0)
 Q
"RTN","PSOERXD2",265,0)
VDRG3(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",266,0)
 N DIR,Y,PATINST,ERXDRUG,VDRG,VAOI,FDA
"RTN","PSOERXD2",267,0)
 D DERX1(PSOIEN,PSOIENS,1)
"RTN","PSOERXD2",268,0)
 S ERXDRUG=$$GET1^DIQ(52.49,PSOIEN,3.2,"I")
"RTN","PSOERXD2",269,0)
 S PATINST=$$GET1^DIQ(52.49,PSOIEN,27,"E")
"RTN","PSOERXD2",270,0)
 I '$L(PATINST) D
"RTN","PSOERXD2",271,0)
 .S VDRG=$$GET1^DIQ(52.49,PSOIEN,3.2,"I") Q:'VDRG
"RTN","PSOERXD2",272,0)
 .S VAOI=$$GET1^DIQ(50,VDRG,2.1,"I") Q:'VAOI
"RTN","PSOERXD2",273,0)
 .S PATINST=$$GET1^DIQ(50.7,VAOI,7,"E")
"RTN","PSOERXD2",274,0)
 K DIR
"RTN","PSOERXD2",275,0)
 S DIR(0)="52.49,27",DIR("A")="VA PATIENT INSTRUCTIONS"
"RTN","PSOERXD2",276,0)
 I $L(PATINST) S DIR("B")=PATINST
"RTN","PSOERXD2",277,0)
 D ^DIR K DIR
"RTN","PSOERXD2",278,0)
 I Y["^" S PQUIT=1 Q
"RTN","PSOERXD2",279,0)
 S FDA(52.49,PSOIEN_",",27)=$$UP^XLFSTR(Y) D FILE^DIE(,"FDA","ERR") K FDA
"RTN","PSOERXD2",280,0)
 Q
"RTN","PSOERXD2",281,0)
VDRG4(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",282,0)
 N DIR,Y,USERCOMM,VPATINST,UFLAG,VAPCOMM,ERXPCOMM,FDA
"RTN","PSOERXD2",283,0)
 ; POSSIBLE FUTURE IMPLEMENTATION OF ERX DETAILS
"RTN","PSOERXD2",284,0)
 ;D DERX1(PSOIEN,PSOIENS,1)
"RTN","PSOERXD2",285,0)
 S VPATINST=$$GET1^DIQ(52.49,PSOIEN,27,"E")
"RTN","PSOERXD2",286,0)
 S ERXPCOMM=$$GET1^DIQ(52.49,PSOIEN,8,"E")
"RTN","PSOERXD2",287,0)
 S VAPCOMM=$$GET1^DIQ(52.49,PSOIEN,30,"E")
"RTN","PSOERXD2",288,0)
 S DIR(0)="FO^1:240",DIR("A")="VA Provider Comments",DIR("B")=$S($L(VAPCOMM):VAPCOMM,1:ERXPCOMM)
"RTN","PSOERXD2",289,0)
 D ^DIR K DIR
"RTN","PSOERXD2",290,0)
 I Y["^" S PQUIT=1 Q
"RTN","PSOERXD2",291,0)
 S USERCOMM=$$UP^XLFSTR(Y) K Y
"RTN","PSOERXD2",292,0)
 S FDA(52.49,PSOIEN_",",30)=$$UP^XLFSTR(USERCOMM) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXD2",293,0)
 Q
"RTN","PSOERXD2",294,0)
VDRG5(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",295,0)
 N PATIEN,PS55IEN,Y,DIE,DR,DA
"RTN","PSOERXD2",296,0)
 S PATIEN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERXD2",297,0)
 I 'PATIEN W !!,"Patient has not been validated, cannot edit patient status",! Q
"RTN","PSOERXD2",298,0)
 S PS55IEN=$O(^PS(55,"B",PATIEN,0)) Q:'PS55IEN
"RTN","PSOERXD2",299,0)
 S DIE="^PS(55,",DA=PS55IEN,DR="3" D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",300,0)
 I $D(Y) S PQUIT=1
"RTN","PSOERXD2",301,0)
 Q
"RTN","PSOERXD2",302,0)
VDRG6(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",303,0)
 ;S DIE="^PS(52.49,",DA=PSOIEN,DR="20.1" D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",304,0)
 N DIR,PSODRG,DRGMSG,ERXQTY,VAQTY,DIE,DA,DR
"RTN","PSOERXD2",305,0)
 S PSODRG=$$GET1^DIQ(52.49,PSOIEN,3.2,"I")
"RTN","PSOERXD2",306,0)
 I PSODRG S DRGMSG=$$GET1^DIQ(50,PSODRG,215,"E")
"RTN","PSOERXD2",307,0)
 S ERXQTY=$$GET1^DIQ(52.49,PSOIEN,5.1,"E")
"RTN","PSOERXD2",308,0)
 W !,"eRx Quantity: "_ERXQTY
"RTN","PSOERXD2",309,0)
 I $P(ERXQTY,".",2)>2 S ERXQTY=""
"RTN","PSOERXD2",310,0)
 S VAQTY=$$GET1^DIQ(52.49,PSOIEN,20.1,"E")
"RTN","PSOERXD2",311,0)
 S DIR("B")=$S(VAQTY]"":VAQTY,1:ERXQTY)
"RTN","PSOERXD2",312,0)
 S DIR(0)="52.49,20.1",DIR("A")="VISTA QUANTITY"_$S($G(DRGMSG)]"":" <"_DRGMSG_">",1:"") D ^DIR
"RTN","PSOERXD2",313,0)
 I Y["^" S PQUIT=1 Q
"RTN","PSOERXD2",314,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="20.1///"_Y D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",315,0)
 Q
"RTN","PSOERXD2",316,0)
VDRG7(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",317,0)
 N Y,ERXDS,DIE,DR,DA
"RTN","PSOERXD2",318,0)
 S ERXDS=$$GET1^DIQ(52.49,PSOIEN,5.5,"E")
"RTN","PSOERXD2",319,0)
 W !,"eRx Days Supply: "_ERXDS
"RTN","PSOERXD2",320,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="20.2" D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",321,0)
 I $O(Y(0)) S PQUIT=1
"RTN","PSOERXD2",322,0)
 Q
"RTN","PSOERXD2",323,0)
VDRG8(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",324,0)
 N Y,ERXRFLS,DIE,DR,DA
"RTN","PSOERXD2",325,0)
 S ERXRFLS=$$GET1^DIQ(52.49,PSOIEN,5.6,"E")
"RTN","PSOERXD2",326,0)
 W !,"eRx Refills: "_ERXRFLS
"RTN","PSOERXD2",327,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="20.5" D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",328,0)
 I $O(Y(0)) S PQUIT=1
"RTN","PSOERXD2",329,0)
 Q
"RTN","PSOERXD2",330,0)
VDRG9(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",331,0)
 N Y,DIR,DIE,DR,DA
"RTN","PSOERXD2",332,0)
 S DIR("A")="PICKUP ROUTING"
"RTN","PSOERXD2",333,0)
 S DIR(0)="SO^M:MAIL;W:WINDOW",DIR("B")="M" D ^DIR K DIR
"RTN","PSOERXD2",334,0)
 I Y["^" S PQUIT=1 Q
"RTN","PSOERXD2",335,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="20.4///"_Y D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",336,0)
 Q
"RTN","PSOERXD2",337,0)
VDRG10(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",338,0)
 N DIC,Y,VACLIN,CURCLIN,DIE,DR,DA
"RTN","PSOERXD2",339,0)
 S CURCLIN=$$GET1^DIQ(52.49,PSOIEN,20.6,"E")
"RTN","PSOERXD2",340,0)
 I '$L(CURCLIN) S CURCLIN=$$GET1^DIQ(59,PSOSITE,10,"E")
"RTN","PSOERXD2",341,0)
 S DIC("B")=CURCLIN
"RTN","PSOERXD2",342,0)
 S DIC="^SC(",DIC(0)="QEAMZ",DIC("A")="Select CLINIC: " D ^DIC K DIC
"RTN","PSOERXD2",343,0)
 I Y<1 Q
"RTN","PSOERXD2",344,0)
 I ($D(DTOUT))!($D(DUOUT)) S PQUIT=1 Q
"RTN","PSOERXD2",345,0)
 S VACLIN=$P(Y,U)
"RTN","PSOERXD2",346,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="20.6///"_VACLIN D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",347,0)
 K DTOUT,DUOUT
"RTN","PSOERXD2",348,0)
 Q
"RTN","PSOERXD2",349,0)
VDRG11(PSOIEN,PSOIENS) ;
"RTN","PSOERXD2",350,0)
 N DIE,DR,DA,Y
"RTN","PSOERXD2",351,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="8" D ^DIE K DIE,DR,DA
"RTN","PSOERXD2",352,0)
 I $O(Y(0)) S PQUIT=1
"RTN","PSOERXD2",353,0)
 Q
"RTN","PSOERXD2",354,0)
 ; display erx info
"RTN","PSOERXD2",355,0)
 ; DFLG - display flag
"RTN","PSOERXD2",356,0)
 ;          1 - drug sig comments
"RTN","PSOERXD2",357,0)
 ;          ""- all
"RTN","PSOERXD2",358,0)
 ;          
"RTN","PSOERXD2",359,0)
DERX1(PSOIEN,PSOIENS,DFLG) ;
"RTN","PSOERXD2",360,0)
 N EDRG,ERXDAT,ESIG,COMM,SUBS,DFORM,DSTR,QQUAL,POTUC,QTY,DAYS,REFILL,COMMARY,SIGARY
"RTN","PSOERXD2",361,0)
 D GETS^DIQ(52.49,PSOIENS,"3.1;4.6;4.8;5.1;5.2;5.4;5.5;5.6;5.8;7;8;41;42;43","E","ERXDAT")
"RTN","PSOERXD2",362,0)
 S DFLG=$G(DFLG,"")
"RTN","PSOERXD2",363,0)
 S EDRG=$G(ERXDAT(52.49,PSOIENS,3.1,"E"))
"RTN","PSOERXD2",364,0)
 S ESIG=$G(ERXDAT(52.49,PSOIENS,7,"E"))
"RTN","PSOERXD2",365,0)
 S COMM=$G(ERXDAT(52.49,PSOIENS,8,"E"))
"RTN","PSOERXD2",366,0)
 S SUBS=$G(ERXDAT(52.49,PSOIENS,5.8,"E"))
"RTN","PSOERXD2",367,0)
 S DFORM=$G(ERXDAT(52.49,PSOIENS,41,"E"))
"RTN","PSOERXD2",368,0)
 S DSTR=$G(ERXDAT(52.49,PSOIENS,43,"E"))
"RTN","PSOERXD2",369,0)
 S QQUAL=$G(ERXDAT(52.49,PSOIENS,5.2,"E"))
"RTN","PSOERXD2",370,0)
 S POTUC=$G(ERXDAT(52.49,PSOIENS,42,"E"))
"RTN","PSOERXD2",371,0)
 S QTY=$G(ERXDAT(52.49,PSOIENS,5.1,"E"))
"RTN","PSOERXD2",372,0)
 S DAYS=$G(ERXDAT(52.49,PSOIENS,5.5,"E"))
"RTN","PSOERXD2",373,0)
 S REFILL=$G(ERXDAT(52.49,PSOIENS,5.6,"E"))
"RTN","PSOERXD2",374,0)
 D TXT2ARY^PSOERXD1(.SIGARY,ESIG,,69)
"RTN","PSOERXD2",375,0)
 D TXT2ARY^PSOERXD1(.COMMARY,COMM,,65)
"RTN","PSOERXD2",376,0)
 W !!!,"eRx Drug: "_EDRG
"RTN","PSOERXD2",377,0)
 W !,"eRx Sig: "
"RTN","PSOERXD2",378,0)
 S I=0 F  S I=$O(SIGARY(I)) Q:'I  D
"RTN","PSOERXD2",379,0)
 .W $S(I>1:"         "_SIGARY(I),1:SIGARY(I)),!
"RTN","PSOERXD2",380,0)
 I '$L(ESIG) W !
"RTN","PSOERXD2",381,0)
 W "eRx Notes: "
"RTN","PSOERXD2",382,0)
 S I=0 F  S I=$O(COMMARY(I)) Q:'I  D
"RTN","PSOERXD2",383,0)
 .W $S(I>1:"              "_COMMARY(I),1:COMMARY(I)),!
"RTN","PSOERXD2",384,0)
 I '$L(COMM) W !
"RTN","PSOERXD2",385,0)
 Q:DFLG=1
"RTN","PSOERXD2",386,0)
 W "Drug Form: "_DFORM,?40,"Strength: "_DSTR
"RTN","PSOERXD2",387,0)
 W !,"Qty Qualifier: "_QQUAL,?40,"Potency Unit Code: "_POTUC
"RTN","PSOERXD2",388,0)
 W !,"DAW Code: "_SUBS
"RTN","PSOERXD2",389,0)
 W !,"Qty: "_QTY,?25,"Days Supply: "_DAYS,?55,"Refills: "_REFILL,!!
"RTN","PSOERXD2",390,0)
 Q
"RTN","PSOERXH1")
0^13^B14280628^n/a
"RTN","PSOERXH1",1,0)
PSOERXH1 ;ALB/BWF - eRx Utilities/RPC's ; 8/3/2016 5:14pm
"RTN","PSOERXH1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXH1",3,0)
 ;
"RTN","PSOERXH1",4,0)
 Q
"RTN","PSOERXH1",5,0)
 ; place eRx on Hold
"RTN","PSOERXH1",6,0)
HOLD ;
"RTN","PSOERXH1",7,0)
 N DIE,DA,DR,CURSTAT,CSTATI,LMATCH,LSTAT,SUBFIEN,NEWSTAT,RESP,DIR,RXSTAT,HCOMM
"RTN","PSOERXH1",8,0)
 Q:'$G(PSOIEN)
"RTN","PSOERXH1",9,0)
 D FULL^VALM1
"RTN","PSOERXH1",10,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERXH1",11,0)
 .W !!,"Cannot hold a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERXH1",12,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERXH1",13,0)
 ; check to see if the erx order status is a hold status
"RTN","PSOERXH1",14,0)
 S CSTATI=$$GET1^DIQ(52.49,PSOIEN,1,"I")
"RTN","PSOERXH1",15,0)
 S CURSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E")
"RTN","PSOERXH1",16,0)
 S VALMBCK="R"
"RTN","PSOERXH1",17,0)
 I $E(CURSTAT,1)="H" D  Q
"RTN","PSOERXH1",18,0)
 .S DIR(0)="YO",DIR("B")="NO"
"RTN","PSOERXH1",19,0)
 .S DIR("A",1)="This eRx is already in a 'HOLD' status."
"RTN","PSOERXH1",20,0)
 .S DIR("A")="Would you like to change the hold status and comments?"
"RTN","PSOERXH1",21,0)
 .D ^DIR
"RTN","PSOERXH1",22,0)
 .Q:'Y
"RTN","PSOERXH1",23,0)
 .K DIR
"RTN","PSOERXH1",24,0)
 .S RESP=$$HDIR(1)
"RTN","PSOERXH1",25,0)
 .I 'RESP D  Q
"RTN","PSOERXH1",26,0)
 ..W "Hold Reason required. eRx not placed in a 'Hold' status."
"RTN","PSOERXH1",27,0)
 ..S DIR(0)="E" D ^DIR
"RTN","PSOERXH1",28,0)
 .S DIR(0)="52.4919,1",DIR("A")="Additional Comments (Optional)" D ^DIR K DIR
"RTN","PSOERXH1",29,0)
 .I Y="^" W !,"eRx NOT placed on hold." D ^DIR K DIR Q
"RTN","PSOERXH1",30,0)
 .S HCOMM=$G(Y)
"RTN","PSOERXH1",31,0)
 .S DIE="52.49",DR="1///"_RESP,DA=PSOIEN D ^DIE K DIE
"RTN","PSOERXH1",32,0)
 .S SUBFIEN=$$NSTAT(PSOIEN,RESP,HCOMM)
"RTN","PSOERXH1",33,0)
 .K @VALMAR D INIT^PSOERX1
"RTN","PSOERXH1",34,0)
 K Y
"RTN","PSOERXH1",35,0)
 S RESP=$$HDIR()
"RTN","PSOERXH1",36,0)
 I 'RESP D  Q
"RTN","PSOERXH1",37,0)
 .W "Hold Reason required. eRx not placed in a 'Hold' status."
"RTN","PSOERXH1",38,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERXH1",39,0)
 S DIR(0)="52.4919,1",DIR("A")="Additional Comments (Optional)" D ^DIR K DIR
"RTN","PSOERXH1",40,0)
 I Y="^" Q
"RTN","PSOERXH1",41,0)
 S HCOMM=Y
"RTN","PSOERXH1",42,0)
 S DIE="52.49",DR="1///"_RESP,DA=PSOIEN D ^DIE K DIE
"RTN","PSOERXH1",43,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.01)=$$NOW^XLFDT()
"RTN","PSOERXH1",44,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.02)=RESP
"RTN","PSOERXH1",45,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.03)=$G(DUZ)
"RTN","PSOERXH1",46,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",1)=HCOMM
"RTN","PSOERXH1",47,0)
 D UPDATE^DIE(,"FDA","NEWSTAT","ERR") K FDA
"RTN","PSOERXH1",48,0)
 S SUBFIEN=$O(NEWSTAT(0)) Q:'SUBFIEN
"RTN","PSOERXH1",49,0)
 S SUBFIEN=$G(NEWSTAT(SUBFIEN))
"RTN","PSOERXH1",50,0)
 K @VALMAR D INIT^PSOERX1
"RTN","PSOERXH1",51,0)
 Q
"RTN","PSOERXH1",52,0)
NSTAT(IEN,STAT,COMM) ;
"RTN","PSOERXH1",53,0)
 N SUBFIEN
"RTN","PSOERXH1",54,0)
 S FDA(52.4919,"+1,"_IEN_",",.01)=$$NOW^XLFDT()
"RTN","PSOERXH1",55,0)
 S FDA(52.4919,"+1,"_IEN_",",.02)=STAT
"RTN","PSOERXH1",56,0)
 S FDA(52.4919,"+1,"_IEN_",",.03)=$G(DUZ)
"RTN","PSOERXH1",57,0)
 S FDA(52.4919,"+1,"_IEN_",",1)=COMM
"RTN","PSOERXH1",58,0)
 D UPDATE^DIE(,"FDA","NEWSTAT") K FDA
"RTN","PSOERXH1",59,0)
 S SUBFIEN=$O(NEWSTAT(0)) Q:'SUBFIEN
"RTN","PSOERXH1",60,0)
 S SUBFIEN=$G(NEWSTAT(SUBFIEN))
"RTN","PSOERXH1",61,0)
 Q SUBFIEN
"RTN","PSOERXH1",62,0)
HDIR(HTYP) ; 
"RTN","PSOERXH1",63,0)
 N DIR,DIC,Y,X
"RTN","PSOERXH1",64,0)
 ;S DIC="^PS(52.45,",X(1)="ERX",X(2)="H",DIC(0)="EMQ",D="C" D IX^DIC K DIC,D
"RTN","PSOERXH1",65,0)
 S DIC("A")="Select HOLD reason code: "
"RTN","PSOERXH1",66,0)
 S DIC="^PS(52.45,",DIC(0)="AEMQ",DIC("S")="I $D(^PS(52.45,""TYPE"",""ERX"",Y)),$E($P(^PS(52.45,Y,0),U),1)=""H"""
"RTN","PSOERXH1",67,0)
 D ^DIC K DIC
"RTN","PSOERXH1",68,0)
 I Y<1 Q 0
"RTN","PSOERXH1",69,0)
 Q:'+$P(Y,U) 0
"RTN","PSOERXH1",70,0)
 Q $P(Y,U)
"RTN","PSOERXH1",71,0)
 ; remove hold from eRx
"RTN","PSOERXH1",72,0)
UNHOLD ;
"RTN","PSOERXH1",73,0)
 N Y,DIR,DIE,DA,DR,NEWSIEN,RXSTAT
"RTN","PSOERXH1",74,0)
 D FULL^VALM1
"RTN","PSOERXH1",75,0)
 S VALMBCK="R"
"RTN","PSOERXH1",76,0)
 S RXSTAT=$$GET1^DIQ(52.49,PSOIEN,1,"E") I RXSTAT="RJ"!(RXSTAT="RM")!(RXSTAT="PR") D  Q
"RTN","PSOERXH1",77,0)
 .W !!,"Cannot un-hold a prescription with a status of 'Rejected', 'Removed',",!,"or 'Processed",!
"RTN","PSOERXH1",78,0)
 .S DIR(0)="E" D ^DIR
"RTN","PSOERXH1",79,0)
 W !
"RTN","PSOERXH1",80,0)
 I $E($$GET1^DIQ(52.49,PSOIEN,1,"E"),1)'="H" D  Q
"RTN","PSOERXH1",81,0)
 .W !,"This eRx is not currently on hold. Please use the 'Hold'",!,"function to update the hold status and comments.",!!
"RTN","PSOERXH1",82,0)
 .S DIR(0)="E"
"RTN","PSOERXH1",83,0)
 .D ^DIR
"RTN","PSOERXH1",84,0)
 .K @VALMAR D INIT^PSOERX1
"RTN","PSOERXH1",85,0)
 D UPDSTAT^PSOERXU1(PSOIEN,"I","HOLD REMOVED BY "_$$NAME^XUSER(DUZ))
"RTN","PSOERXH1",86,0)
 W !,"eRx removed from hold status, and placed to 'In Progress'."
"RTN","PSOERXH1",87,0)
 S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERXH1",88,0)
 K @VALMAR D INIT^PSOERX1
"RTN","PSOERXH1",89,0)
 Q
"RTN","PSOERXO1")
0^9^B57309099^n/a
"RTN","PSOERXO1",1,0)
PSOERXO1 ;ALB/BWF - eRx Outbound Error messages ; 8/3/2016 5:14pm
"RTN","PSOERXO1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXO1",3,0)
 ;
"RTN","PSOERXO1",4,0)
 Q
"RTN","PSOERXO1",5,0)
 ;
"RTN","PSOERXO1",6,0)
MSGERR() ;check errors from XML return
"RTN","PSOERXO1",7,0)
 ; note - not currently in use
"RTN","PSOERXO1",8,0)
 ;returns empty string "" if there was no error
"RTN","PSOERXO1",9,0)
 ;returns empty string "" if the only error was "ALL_PATIENT_IDS_EXCLUDED"
"RTN","PSOERXO1",10,0)
 ;otherwise returns the exceptionMessage string from the errorSection
"RTN","PSOERXO1",11,0)
 N ORRET S ORRET=""
"RTN","PSOERXO1",12,0)
 I $D(^TMP($J,"ORRDI","ClinicalData",0,"errorSection")) D
"RTN","PSOERXO1",13,0)
 .N I F I="fatalErrors","errors","warnings" D
"RTN","PSOERXO1",14,0)
 ..N J S J="" F  S J=$O(^TMP($J,"ORRDI","ClinicalData",0,"errorSection",0,I,J)) Q:J=""  D
"RTN","PSOERXO1",15,0)
 ...N ORSTR S ORSTR=$G(^TMP($J,"ORRDI","ClinicalData",0,"errorSection",0,I,J,"errorCode",0))
"RTN","PSOERXO1",16,0)
 ...I ORSTR'="ALL_PATIENT_IDS_EXCLUDED" S ORRET=ORSTR
"RTN","PSOERXO1",17,0)
 Q ORRET
"RTN","PSOERXO1",18,0)
ERRHNDL(DFN) ;handle any errors that may get thrown in call to GET^ORRDI1
"RTN","PSOERXO1",19,0)
 K ^TMP($J,"ORRDI"),^XTMP("ORRDI","PSOO",DFN),^XTMP("ORRDI","ART",DFN)
"RTN","PSOERXO1",20,0)
 D UNWIND^%ZTER
"RTN","PSOERXO1",21,0)
 Q
"RTN","PSOERXO1",22,0)
POST(ERXIEN,PSSOUT,ECODE,DESCODE,DESC) ;
"RTN","PSOERXO1",23,0)
 N PSS,PSSERR,PSSFDBRT,PSREQ,INST,GBL,C
"RTN","PSOERXO1",24,0)
 N TOQUAL,FRQUAL,TO,FROM,MID,RTMID,ERXIENS,F,PSODAT
"RTN","PSOERXO1",25,0)
 S F=52.49,C=0
"RTN","PSOERXO1",26,0)
 S PSSFDBRT=1
"RTN","PSOERXO1",27,0)
 S GBL=$NA(^TMP("POST^PSOERXO1",$J)) K @GBL
"RTN","PSOERXO1",28,0)
 Q:'$G(ERXIEN)
"RTN","PSOERXO1",29,0)
 S ERXIENS=ERXIEN_","
"RTN","PSOERXO1",30,0)
 D GETS^DIQ(F,ERXIENS,".01;.02;22.1:22.4;24.1;25","IE","PSODAT")
"RTN","PSOERXO1",31,0)
 S INST=$G(PSODAT(F,ERXIENS,24.1,"I")) I 'INST S PSSOUT(0)=-1_U_"Unable to identify instution. Cannot send message." Q
"RTN","PSOERXO1",32,0)
 ; message ID needs to be unique from vista - Site#.DUZ.erxIEN.date.time??
"RTN","PSOERXO1",33,0)
 S MID=INST_"."_DUZ_"."_ERXIEN_"."_$$NOW^XLFDT
"RTN","PSOERXO1",34,0)
 ; relates to message ID is the incoming message id from CH for outbound messages.
"RTN","PSOERXO1",35,0)
 S RTMID=$G(PSODAT(F,ERXIENS,25,"E"))
"RTN","PSOERXO1",36,0)
 ; from is TO from the erx.
"RTN","PSOERXO1",37,0)
 S FROM=$G(PSODAT(F,ERXIENS,22.3,"E"))
"RTN","PSOERXO1",38,0)
 S FRQUAL=$G(PSODAT(F,ERXIENS,22.4,"I"))
"RTN","PSOERXO1",39,0)
 ; to is FROM from the erx
"RTN","PSOERXO1",40,0)
 S TO=$G(PSODAT(F,ERXIENS,22.1,"E"))
"RTN","PSOERXO1",41,0)
 S TOQUAL=$G(PSODAT(F,ERXIENS,22.2,"I"))
"RTN","PSOERXO1",42,0)
 ;
"RTN","PSOERXO1",43,0)
 D C S @GBL@(C,0)="<?xml version = '1.0' encoding = 'UTF-8'?><Message version=""010"" release=""006"" xmlns=""http://www.ncpdp.org/schema/SCRIPT"">"
"RTN","PSOERXO1",44,0)
 D C S @GBL@(C,0)="<Header><To Qualifier="""_TOQUAL_""">"_TO_"</To><From Qualifier="""_FRQUAL_""">"_FROM_"</From><MessageID>"_MID_"</MessageID>"
"RTN","PSOERXO1",45,0)
 D C S @GBL@(C,0)="<RelatesToMessageID>"_RTMID_"</RelatesToMessageID><SentTime>"_$$EXTIME()_"</SentTime></Header>"
"RTN","PSOERXO1",46,0)
 D C S @GBL@(C,0)="<Body><Error><Code>"_$G(ECODE)_"</Code>"
"RTN","PSOERXO1",47,0)
 I $L(DESCODE) D C S @GBL@(C,0)="<DescriptionCode>"_$G(DESCODE)_"</DescriptionCode>"
"RTN","PSOERXO1",48,0)
 D C S @GBL@(C,0)="<Description>"_$G(DESC)_"</Description>"
"RTN","PSOERXO1",49,0)
 D C S @GBL@(C,0)="</Error></Body></Message>"
"RTN","PSOERXO1",50,0)
 D RESTPOST(.PSSOUT,.GBL)
"RTN","PSOERXO1",51,0)
 K @GBL,C
"RTN","PSOERXO1",52,0)
 Q
"RTN","PSOERXO1",53,0)
C ;
"RTN","PSOERXO1",54,0)
 S C=C+1
"RTN","PSOERXO1",55,0)
 Q
"RTN","PSOERXO1",56,0)
RESTPOST(PSSOUT,GBL) ;
"RTN","PSOERXO1",57,0)
 N $ETRAP,$ESTACK,PSREQ
"RTN","PSOERXO1",58,0)
 N PSREQ,PSS,PSSERR,GLOOP,GDAT
"RTN","PSOERXO1",59,0)
 ; Set error trap
"RTN","PSOERXO1",60,0)
 SET $ETRAP="DO ERROR^PSSHTTP"
"RTN","PSOERXO1",61,0)
 K ^TMP($J,"OUT")    ; if exists from previous runs, posting would not execute.
"RTN","PSOERXO1",62,0)
 SET PSS("server")="PSO WEB SERVER"
"RTN","PSOERXO1",63,0)
 SET PSS("webserviceName")="PSO ERX WEB SERVICE"
"RTN","PSOERXO1",64,0)
 SET PSS("path")="services/rest/vistaoutboundMsg/processXMLMessage"
"RTN","PSOERXO1",65,0)
 SET PSS("parameterName")="xmlRequest"
"RTN","PSOERXO1",66,0)
 ;SET PSS("parameterValue")=PSREQ
"RTN","PSOERXO1",67,0)
 ;
"RTN","PSOERXO1",68,0)
 ; get instance of client REST request object
"RTN","PSOERXO1",69,0)
 SET PSS("restObject")=$$GETREST^XOBWLIB(PSS("webserviceName"),PSS("server"))
"RTN","PSOERXO1",70,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") Q PSSOUT
"RTN","PSOERXO1",71,0)
 ;
"RTN","PSOERXO1",72,0)
 ; insert XML as parameter
"RTN","PSOERXO1",73,0)
 ;DO PSS("restObject").InsertFormData(PSS("parameterName"),PSS("parameterValue"))
"RTN","PSOERXO1",74,0)
 S PSS("restObject").ContentType="application/xml"
"RTN","PSOERXO1",75,0)
 S GLOOP=0 F  S GLOOP=$O(@GBL@(GLOOP)) Q:'GLOOP  D
"RTN","PSOERXO1",76,0)
 .S GDAT=$G(@GBL@(GLOOP,0))
"RTN","PSOERXO1",77,0)
 .;SET PSS("parameterValue")=$G(PSS("parameterValue"))_$G(@GBL@(GLOOP,0))
"RTN","PSOERXO1",78,0)
 .DO PSS("restObject").EntityBody.Write(GDAT)
"RTN","PSOERXO1",79,0)
 ;DO PSS("restObject").InsertFormData(PSS("parameterName"),PSS("parameterValue"))
"RTN","PSOERXO1",80,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") QUIT PSSOUT
"RTN","PSOERXO1",81,0)
 ;
"RTN","PSOERXO1",82,0)
 ; execute HTTP Post method
"RTN","PSOERXO1",83,0)
 SET PSS("postResult")=$$POST^XOBWLIB(PSS("restObject"),PSS("path"),.PSSERR)
"RTN","PSOERXO1",84,0)
 IF $DATA(^TMP($JOB,"OUT","EXCEPTION"))>0 S PSSOUT(0)="-1^"_^TMP($JOB,"OUT","EXCEPTION") K ^TMP($JOB,"OUT","EXCEPTION") QUIT PSSOUT
"RTN","PSOERXO1",85,0)
 ;
"RTN","PSOERXO1",86,0)
 ; response coming back
"RTN","PSOERXO1",87,0)
 ;<vistaOutboundResponse><success>true</success></vistaOutboundResponse>
"RTN","PSOERXO1",88,0)
 ; error handling
"RTN","PSOERXO1",89,0)
 DO:'PSS("postResult")
"RTN","PSOERXO1",90,0)
 . SET PSSOUT(0)=-1_U_"Unable to make http request."
"RTN","PSOERXO1",91,0)
 . SET PSS("result")=0
"RTN","PSOERXO1",92,0)
 . QUIT
"RTN","PSOERXO1",93,0)
 ;
"RTN","PSOERXO1",94,0)
 ; if every thing is ok parse the returned xml result
"RTN","PSOERXO1",95,0)
 I PSS("postResult") S PSS("result")=1 D PRSSTRM(PSS("restObject"),.PSSOUT) S PSSOUT(0)=1
"RTN","PSOERXO1",96,0)
 ; for now we do not pass back the message ID for storage into 52.49
"RTN","PSOERXO1",97,0)
 Q PSS("result")
"RTN","PSOERXO1",98,0)
 ;
"RTN","PSOERXO1",99,0)
PRSSTRM(RESTOBJ,PSSOUT) ;  parse the XML into token
"RTN","PSOERXO1",100,0)
 ;  input: RESTOBJ--a rest object
"RTN","PSOERXO1",101,0)
 ; output: PSSOUT - array containing the list of route names for the given drug.
"RTN","PSOERXO1",102,0)
 ;
"RTN","PSOERXO1",103,0)
 ; parse the XML into tokens. the first part of the token is the type of node being read.
"RTN","PSOERXO1",104,0)
 ; the second part is the data--either the name of the node, or data. these fields are delimited using "<>".
"RTN","PSOERXO1",105,0)
 ; if the node is type attribute, each attribute is separated by a caret ("^").
"RTN","PSOERXO1",106,0)
 ;
"RTN","PSOERXO1",107,0)
 N AREADER
"RTN","PSOERXO1",108,0)
 S AREADER=$$GETREADR(RESTOBJ)
"RTN","PSOERXO1",109,0)
 D PARSXML(AREADER,.PSSOUT)
"RTN","PSOERXO1",110,0)
 Q
"RTN","PSOERXO1",111,0)
 ;
"RTN","PSOERXO1",112,0)
PARSXML(AREADER,PSSOUT) ; extract the list of routes from XML results
"RTN","PSOERXO1",113,0)
 ;  input: AREADER-%XML.TextReader object.
"RTN","PSOERXO1",114,0)
 ; output: PSSOUT - array containing the list of route names for the given drug.
"RTN","PSOERXO1",115,0)
 ;
"RTN","PSOERXO1",116,0)
 N ATOKEN,NODETYPE
"RTN","PSOERXO1",117,0)
 F  D  Q:AREADER.EOF
"RTN","PSOERXO1",118,0)
 .S ATOKEN=$$GETTOKEN(AREADER)
"RTN","PSOERXO1",119,0)
 .I '$L(ATOKEN) Q
"RTN","PSOERXO1",120,0)
 .S NODETYPE=$P(ATOKEN,"<>"),ATOKEN=$P(ATOKEN,"<>",2)
"RTN","PSOERXO1",121,0)
 .I ATOKEN="errorMessage" D POSTERR(AREADER,.PSSOUT)
"RTN","PSOERXO1",122,0)
 .I ATOKEN="success" D POSTRES(AREADER,.PSSOUT)
"RTN","PSOERXO1",123,0)
 Q
"RTN","PSOERXO1",124,0)
 ;
"RTN","PSOERXO1",125,0)
POSTRES(AREADER,PSSOUT) ; get value of success/failure
"RTN","PSOERXO1",126,0)
 N TOKEN,TYPE
"RTN","PSOERXO1",127,0)
 F  D  Q:TOKEN="/success"
"RTN","PSOERXO1",128,0)
 .S TOKEN=$$GETTOKEN(AREADER)
"RTN","PSOERXO1",129,0)
 .S TYPE=$P(TOKEN,"<>"),TOKEN=$P(TOKEN,"<>",2)
"RTN","PSOERXO1",130,0)
 .Q:'$L(TOKEN)!(TOKEN="/success")
"RTN","PSOERXO1",131,0)
 .S PSSOUT("success")=TOKEN
"RTN","PSOERXO1",132,0)
 Q
"RTN","PSOERXO1",133,0)
POSTERR(AREADER,PSSOUT) ; get error message
"RTN","PSOERXO1",134,0)
 N TOKEN,TYPE
"RTN","PSOERXO1",135,0)
 F  D  Q:TOKEN="/errorMessage"
"RTN","PSOERXO1",136,0)
 .S TOKEN=$$GETTOKEN(AREADER)
"RTN","PSOERXO1",137,0)
 .S TYPE=$P(TOKEN,"<>"),TOKEN=$P(TOKEN,"<>",2)
"RTN","PSOERXO1",138,0)
 .Q:'$L(TOKEN)!(TOKEN="/errorMessage")
"RTN","PSOERXO1",139,0)
 .S PSSOUT("errorMessage")=$TR(TOKEN,$C(10)," ")
"RTN","PSOERXO1",140,0)
 Q
"RTN","PSOERXO1",141,0)
 ;
"RTN","PSOERXO1",142,0)
GETREADR(RESTOBJ) ; set up and return a Textreader object to be used to parse the XML stream
"RTN","PSOERXO1",143,0)
 ;  input: RESTOBJ-  REST object
"RTN","PSOERXO1",144,0)
 ; output: returns a %XML.TextReader object.
"RTN","PSOERXO1",145,0)
 ;
"RTN","PSOERXO1",146,0)
 N AREADER
"RTN","PSOERXO1",147,0)
 S AREADER=##class(%XML.TextReader).%New("%XML.TextReader")
"RTN","PSOERXO1",148,0)
 D ##class(%XML.TextReader).ParseStream(RESTOBJ.HttpResponse.Data,.AREADER)
"RTN","PSOERXO1",149,0)
 Q AREADER
"RTN","PSOERXO1",150,0)
 ;
"RTN","PSOERXO1",151,0)
GETTOKEN(READER) ; get a token at a time
"RTN","PSOERXO1",152,0)
 ;  input: AREADER-%XML.TextReader object
"RTN","PSOERXO1",153,0)
 ; Output: returns a token
"RTN","PSOERXO1",154,0)
 ;
"RTN","PSOERXO1",155,0)
 ;   this is the key to the parsing of the XML stream.
"RTN","PSOERXO1",156,0)
 ;   each element is parsed with its associated data (if any)
"RTN","PSOERXO1",157,0)
 ;   the nodetype is concatenated with "<>" with the Token
"RTN","PSOERXO1",158,0)
 ;   which can be the tag or the data.
"RTN","PSOERXO1",159,0)
 ;   for example each time is called return one of the following:
"RTN","PSOERXO1",160,0)
 ;     . . .
"RTN","PSOERXO1",161,0)
 ;     . . .
"RTN","PSOERXO1",162,0)
 ;     drug(attributes)<>gcnSeqNo=17240
"RTN","PSOERXO1",163,0)
 ;     element<>routes
"RTN","PSOERXO1",164,0)
 ;     element<>route
"RTN","PSOERXO1",165,0)
 ;     element<>id
"RTN","PSOERXO1",166,0)
 ;     chars<>006
"RTN","PSOERXO1",167,0)
 ;     endelement<>/id
"RTN","PSOERXO1",168,0)
 ;     element<>name
"RTN","PSOERXO1",169,0)
 ;     chars<>CONTINUOUS INFUSION
"RTN","PSOERXO1",170,0)
 ;     endelement<>/name
"RTN","PSOERXO1",171,0)
 ;     endelement<>/route
"RTN","PSOERXO1",172,0)
 ;     . . .
"RTN","PSOERXO1",173,0)
 ;     . . .
"RTN","PSOERXO1",174,0)
 ;
"RTN","PSOERXO1",175,0)
 N TOKEN,NODETYPE,SUBTOKEN,ALLTOKEN
"RTN","PSOERXO1",176,0)
 S TOKEN="",SUBTOKEN="",NODETYPE="",ALLTOKEN=""
"RTN","PSOERXO1",177,0)
 D
"RTN","PSOERXO1",178,0)
 .Q:READER.EOF
"RTN","PSOERXO1",179,0)
 .D READER.Read()  ; go to first node
"RTN","PSOERXO1",180,0)
 .Q:READER.EOF     ; try before and after read
"RTN","PSOERXO1",181,0)
 .;W !,READER.NodeTypeGet()
"RTN","PSOERXO1",182,0)
 .;S NODETYPE=READER.NodeTypeGet()
"RTN","PSOERXO1",183,0)
 .I READER.HasAttributes D
"RTN","PSOERXO1",184,0)
 ..S NODETYPE=READER.Name_"(attributes)"
"RTN","PSOERXO1",185,0)
 ..S TOKEN=$$GETATTS(READER)
"RTN","PSOERXO1",186,0)
 .I '$L(TOKEN) S NODETYPE=READER.NodeTypeGet() D
"RTN","PSOERXO1",187,0)
 ..I NODETYPE="element" S TOKEN=READER.Name Q
"RTN","PSOERXO1",188,0)
 ..I NODETYPE="chars" S TOKEN=READER.Value Q
"RTN","PSOERXO1",189,0)
 ..I NODETYPE="endelement" S TOKEN="/"_READER.Name Q
"RTN","PSOERXO1",190,0)
 ..I NODETYPE="comment" S TOKEN="^"
"RTN","PSOERXO1",191,0)
 ..I NODETYPE="processinginstruction" S TOKEN=READER.Value Q
"RTN","PSOERXO1",192,0)
 ..I NODETYPE="ignorablewhitespace" S TOKEN="^" Q
"RTN","PSOERXO1",193,0)
 ..I NODETYPE="startprefixmapping" S TOKEN=READER.Value Q
"RTN","PSOERXO1",194,0)
 ..I NODETYPE="warning" S TOKEN=READER.Value Q
"RTN","PSOERXO1",195,0)
 ..I '$L(TOKEN) S TOKEN="^"
"RTN","PSOERXO1",196,0)
 ..;
"RTN","PSOERXO1",197,0)
 .I $L(NODETYPE) S ALLTOKEN=NODETYPE_"<>"_TOKEN
"RTN","PSOERXO1",198,0)
 ;W !,"TOKEN="_ALLTOKEN
"RTN","PSOERXO1",199,0)
 Q ALLTOKEN
"RTN","PSOERXO1",200,0)
 ;
"RTN","PSOERXO1",201,0)
GETATTS(AREADER) ; get attributes
"RTN","PSOERXO1",202,0)
 ;  input: AREADER-%XML.TextReader object
"RTN","PSOERXO1",203,0)
 ; Output: returns the attributes
"RTN","PSOERXO1",204,0)
 ;
"RTN","PSOERXO1",205,0)
 N I,INDEX,TOKEN,SUBTOKEN,ATTRB
"RTN","PSOERXO1",206,0)
 S (TOKEN,SUBTOKEN)=""
"RTN","PSOERXO1",207,0)
 S INDEX=AREADER.AttributeCountGet()
"RTN","PSOERXO1",208,0)
 FOR I=1:1:INDEX D
"RTN","PSOERXO1",209,0)
 .S ATTRB=AREADER.MoveToAttributeIndex(I) D
"RTN","PSOERXO1",210,0)
 .S SUBTOKEN=AREADER.Name_"="_AREADER.Value
"RTN","PSOERXO1",211,0)
 .I '$L(TOKEN) S TOKEN=SUBTOKEN Q
"RTN","PSOERXO1",212,0)
 .S TOKEN=TOKEN_"^"_SUBTOKEN
"RTN","PSOERXO1",213,0)
 ;W !,"  ATT=",TOKEN
"RTN","PSOERXO1",214,0)
 Q TOKEN
"RTN","PSOERXO1",215,0)
EXTIME(IDTTM) ;
"RTN","PSOERXO1",216,0)
 N YY,MM,DD,TIME,EXDT,TLEN,I,TZONE,DTTM
"RTN","PSOERXO1",217,0)
 S IDTTM=$G(IDTTM,"")
"RTN","PSOERXO1",218,0)
 S DTTM=$S($L(IDTTM):$$FMTHL7^XLFDT(IDTTM),1:$$FMTHL7^XLFDT($$NOW^XLFDT()))
"RTN","PSOERXO1",219,0)
 S TZONE=$P(DTTM,"-",2)
"RTN","PSOERXO1",220,0)
 I 'TZONE S TZONE=$P($$FMTHL7^XLFDT($$NOW^XLFDT()),"-",2)
"RTN","PSOERXO1",221,0)
 S DTTM=$P(DTTM,"-"),TZONE=$E(TZONE,1,2)_":"_$E(TZONE,3,4)
"RTN","PSOERXO1",222,0)
 S YY=$E(DTTM,1,4),MM=$E(DTTM,5,6),DD=$E(DTTM,7,8),TIME=$E(DTTM,9,$L(DTTM))
"RTN","PSOERXO1",223,0)
 I $L(TIME)<6 D
"RTN","PSOERXO1",224,0)
 .S TLEN=$L(TIME)
"RTN","PSOERXO1",225,0)
 .F I=TLEN:1:6 D
"RTN","PSOERXO1",226,0)
 ..S TIME=TIME_0
"RTN","PSOERXO1",227,0)
 ; now construct the date
"RTN","PSOERXO1",228,0)
 S EXDT=YY_"-"_MM_"-"_DD_"T"_$E(TIME,1,2)_":"_$E(TIME,3,4)_":"_$E(TIME,5,6)_$S($L(TZONE):"-"_TZONE,1:"")
"RTN","PSOERXO1",229,0)
 Q EXDT
"RTN","PSOERXP1")
0^7^B23837983^n/a
"RTN","PSOERXP1",1,0)
PSOERXP1 ;ALB/BWF - eRx Patient Display/Actions ; 8/3/2016 5:14pm
"RTN","PSOERXP1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXP1",3,0)
 ;
"RTN","PSOERXP1",4,0)
EN ; -- main entry point for PSO ERX HOLDING QUEUE
"RTN","PSOERXP1",5,0)
 D EN^VALM("PSO ERX PATIENT VALIDATION")
"RTN","PSOERXP1",6,0)
 Q
"RTN","PSOERXP1",7,0)
 ;
"RTN","PSOERXP1",8,0)
HDR ; -- header code
"RTN","PSOERXP1",9,0)
 S VALMHDR(1)="eRx Patient: "_$$GET1^DIQ(52.49,PSOIEN,.04,"E")
"RTN","PSOERXP1",10,0)
 S VALMHDR(2)="eRx Reference #: "_$$GET1^DIQ(52.49,PSOIEN,.01,"E")
"RTN","PSOERXP1",11,0)
 I $G(VALMBCK)="R" K @VALMAR D INIT S VALMBCK=""
"RTN","PSOERXP1",12,0)
 Q
"RTN","PSOERXP1",13,0)
 ;
"RTN","PSOERXP1",14,0)
INIT ;
"RTN","PSOERXP1",15,0)
 Q:'$G(PSOIEN)
"RTN","PSOERXP1",16,0)
 N LINE,PATDAT,EXPIEN,EXPIENS,EXPNM,EXPDOB,EXPSSN,EXPADD,EXPGEN,EXPCTY,EXPST,EXPZIP,HFIEN,EXPHPH,CPIEN,EXPCPH,LINETXT
"RTN","PSOERXP1",17,0)
 N MANVAL,VAPATIEN,SEPLN,COMM,COMLINE,DONE,TEXT,VAEL,VAELIEN,VAELIG,VAELNM,WORD,VALBY,VALDTTM
"RTN","PSOERXP1",18,0)
 S LINE=0,LINETXT=""
"RTN","PSOERXP1",19,0)
 S EXPIEN=$$GET1^DIQ(52.49,PSOIEN,.04,"I")
"RTN","PSOERXP1",20,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.13,"I")
"RTN","PSOERXP1",21,0)
 S EXPIENS=EXPIEN_","
"RTN","PSOERXP1",22,0)
 D GETS^DIQ(52.46,EXPIENS,"**","E","PATDAT")
"RTN","PSOERXP1",23,0)
 S EXPNM=$G(PATDAT(52.46,EXPIENS,.01,"E"))
"RTN","PSOERXP1",24,0)
 S EXPDOB=$G(PATDAT(52.46,EXPIENS,.08,"E"))
"RTN","PSOERXP1",25,0)
 S EXPSSN=$G(PATDAT(52.46,EXPIENS,1.4,"E")) I EXPSSN S EXPSSN=$E(EXPSSN,1,3)_"-"_$E(EXPSSN,4,5)_"-"_$E(EXPSSN,6,9)
"RTN","PSOERXP1",26,0)
 S EXPADD=$G(PATDAT(52.46,EXPIENS,3.1,"E"))
"RTN","PSOERXP1",27,0)
 S EXPGEN=$G(PATDAT(52.46,EXPIENS,.07,"E"))
"RTN","PSOERXP1",28,0)
 S EXPCTY=$G(PATDAT(52.46,EXPIENS,3.3,"E"))
"RTN","PSOERXP1",29,0)
 S EXPST=$G(PATDAT(52.46,EXPIENS,3.4,"E"))
"RTN","PSOERXP1",30,0)
 S EXPZIP=$G(PATDAT(52.46,EXPIENS,3.5,"E")),EXPZIP=$E(EXPZIP,1,5)
"RTN","PSOERXP1",31,0)
 S HFIEN=$O(^PS(52.46,EXPIEN,3,"C","HP",0))
"RTN","PSOERXP1",32,0)
 ; home phone
"RTN","PSOERXP1",33,0)
 S EXPHPH=$$GET1^DIQ(52.462,HFIEN_","_EXPIENS,.01,"E")
"RTN","PSOERXP1",34,0)
 ; cellular phone
"RTN","PSOERXP1",35,0)
 S CPIEN=$O(^PS(52.46,EXPIEN,3,"C","CP",0))
"RTN","PSOERXP1",36,0)
 S EXPCPH=$$GET1^DIQ(52.462,CPIEN_","_EXPIENS,.01,"E")
"RTN","PSOERXP1",37,0)
 S LINE=LINE+1,LINETXT=""
"RTN","PSOERXP1",38,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Patient: ",EXPNM,1,58)
"RTN","PSOERXP1",39,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",EXPDOB,55,17)
"RTN","PSOERXP1",40,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",41,0)
 S LINE=LINE+1
"RTN","PSOERXP1",42,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Sex: ",EXPGEN,1,15)
"RTN","PSOERXP1",43,0)
 D ADDITEM^PSOERX1A(.LINETXT,"SSN: ",EXPSSN,55,20)
"RTN","PSOERXP1",44,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",45,0)
 S LINE=LINE+1
"RTN","PSOERXP1",46,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Addr: ",$E(EXPADD,1,40),1,50)
"RTN","PSOERXP1",47,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",48,0)
 S LINE=LINE+1
"RTN","PSOERXP1",49,0)
 D ADDITEM^PSOERX1A(.LINETXT,"City: ",$E(EXPCTY,1,20),1,25)
"RTN","PSOERXP1",50,0)
 D ADDITEM^PSOERX1A(.LINETXT,"St: ",$E(EXPST,1,20),35,20)
"RTN","PSOERXP1",51,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Zip: ",EXPZIP,65,10)
"RTN","PSOERXP1",52,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",53,0)
 S LINE=LINE+1
"RTN","PSOERXP1",54,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Home Phone: ",EXPHPH,1,25)
"RTN","PSOERXP1",55,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Cell Phone: ",EXPCPH,40,25)
"RTN","PSOERXP1",56,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",57,0)
 S COMM=$$GET1^DIQ(52.49,PSOIEN,8,"E"),COMM="Comments: "_COMM
"RTN","PSOERXP1",58,0)
 S COMLINE="",DONE=0
"RTN","PSOERXP1",59,0)
 I $L(COMM)<80!$L(COMM)=80 D SET^VALM10(LINE,COMM)
"RTN","PSOERXP1",60,0)
 I $L(COMM)>80 D
"RTN","PSOERXP1",61,0)
 .F WORD=1:1:$L(COMM," ") D
"RTN","PSOERXP1",62,0)
 ..S TEXT=$P(COMM," ",WORD)
"RTN","PSOERXP1",63,0)
 ..; if the text is to long, quit
"RTN","PSOERXP1",64,0)
 ..I $L(COMLINE)+$L(TEXT)>80 D  Q
"RTN","PSOERXP1",65,0)
 ...S LINE=LINE+1 D SET^VALM10(LINE,COMLINE)
"RTN","PSOERXP1",66,0)
 ...S COMLINE=TEXT
"RTN","PSOERXP1",67,0)
 ..I '$L(COMLINE) S COMLINE=TEXT Q
"RTN","PSOERXP1",68,0)
 ..S COMLINE=$G(COMLINE)_" "_TEXT
"RTN","PSOERXP1",69,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXP1",70,0)
 ;S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXP1",71,0)
 S $P(SEPLN,"-",80)="-" D SET^VALM10(LINE,SEPLN)
"RTN","PSOERXP1",72,0)
 ; vista patient information
"RTN","PSOERXP1",73,0)
 S VAPATIEN=$$GET1^DIQ(52.49,PSOIEN,.05,"I")
"RTN","PSOERXP1",74,0)
 I VAPATIEN D
"RTN","PSOERXP1",75,0)
 .S DFN=VAPATIEN D DEM^VADPT,ADD^VADPT,ELIG^VADPT
"RTN","PSOERXP1",76,0)
 .S VAELIG=$G(VAEL(1)),VAELIEN=$P(VAELIG,U),VAELNM=$P(VAELIG,U,2)
"RTN","PSOERXP1",77,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.7,"I")
"RTN","PSOERXP1",78,0)
 S VALBY=$$GET1^DIQ(52.49,PSOIEN,1.13,"E")
"RTN","PSOERXP1",79,0)
 S VALDTTM=$$GET1^DIQ(52.49,PSOIEN,1.14,"E")
"RTN","PSOERXP1",80,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Status: "_$S(MANVAL:"VALIDATED ("_VALBY_" - "_VALDTTM_")",1:"NOT VALIDATED"))
"RTN","PSOERXP1",81,0)
 I 'VAPATIEN S LINE=LINE+1 D SET^VALM10(LINE,"PATIENT NOT MATCHED")
"RTN","PSOERXP1",82,0)
 I VAPATIEN D
"RTN","PSOERXP1",83,0)
 .S LINE=LINE+1
"RTN","PSOERXP1",84,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Vista Patient: ",$G(VADM(1)),1,53)
"RTN","PSOERXP1",85,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",$P($G(VADM(3)),U,2),55,20)
"RTN","PSOERXP1",86,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",87,0)
 .S LINE=LINE+1
"RTN","PSOERXP1",88,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Sex: ",$P($G(VADM(5)),U,2),1,20)
"RTN","PSOERXP1",89,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"SSN: ",$P($G(VADM(2)),U,2),55,20)
"RTN","PSOERXP1",90,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",91,0)
 .S LINE=LINE+1
"RTN","PSOERXP1",92,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Addr: ",$P($G(VAPA(1)),U),1,70)
"RTN","PSOERXP1",93,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",94,0)
 .S LINE=LINE+1
"RTN","PSOERXP1",95,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"City: ",$P($G(VAPA(4)),U),1,25)
"RTN","PSOERXP1",96,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"St: ",$P(VAPA(5),U,2),35,20)
"RTN","PSOERXP1",97,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Zip: ",$P($G(VAPA(6)),U),65,10)
"RTN","PSOERXP1",98,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",99,0)
 .S LINE=LINE+1
"RTN","PSOERXP1",100,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Home Phone: ",$P($G(VAPA(8)),U),1,25)
"RTN","PSOERXP1",101,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Cell Phone: ",$$GET1^DIQ(2,VAPATIEN,.134,"E"),40,25)
"RTN","PSOERXP1",102,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXP1",103,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXP1",104,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Eligibility: "_$G(VAELNM))
"RTN","PSOERXP1",105,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Pharmacy Narrative: "_$$GET1^DIQ(55,VAPATIEN,1,"E"))
"RTN","PSOERXP1",106,0)
 S VALMCNT=LINE
"RTN","PSOERXP1",107,0)
 S EDTYP="P"
"RTN","PSOERXP1",108,0)
 K VAPA,VADM,DFN,VA
"RTN","PSOERXP1",109,0)
 Q
"RTN","PSOERXP1",110,0)
HELP ; -- help code
"RTN","PSOERXP1",111,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOERXP1",112,0)
 Q
"RTN","PSOERXP1",113,0)
 ;
"RTN","PSOERXP1",114,0)
EXIT ; -- exit code
"RTN","PSOERXP1",115,0)
 K EDTYP,@VALMAR
"RTN","PSOERXP1",116,0)
 Q
"RTN","PSOERXP1",117,0)
 ;
"RTN","PSOERXP1",118,0)
EXPND ; -- expand code
"RTN","PSOERXP1",119,0)
 Q
"RTN","PSOERXR1")
0^8^B24483319^n/a
"RTN","PSOERXR1",1,0)
PSOERXR1 ;ALB/BWF - eRx Provider Display/actions ; 8/3/2016 5:14pm
"RTN","PSOERXR1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXR1",3,0)
 ;
"RTN","PSOERXR1",4,0)
EN ; -- main entry point for PSO ERX HOLDING QUEUE
"RTN","PSOERXR1",5,0)
 D EN^VALM("PSO ERX PROVIDER VALIDATION")
"RTN","PSOERXR1",6,0)
 Q
"RTN","PSOERXR1",7,0)
 ;
"RTN","PSOERXR1",8,0)
HDR ; -- header code
"RTN","PSOERXR1",9,0)
 ;S VALMHDR(1)="eRx Processing"
"RTN","PSOERXR1",10,0)
 S VALMHDR(1)="eRx Patient: "_$$GET1^DIQ(52.49,PSOIEN,.04,"E")
"RTN","PSOERXR1",11,0)
 S VALMHDR(2)="eRx Reference #: "_$$GET1^DIQ(52.49,PSOIEN,.01,"E")
"RTN","PSOERXR1",12,0)
 I $G(VALMBCK)="R" D INIT
"RTN","PSOERXR1",13,0)
 Q
"RTN","PSOERXR1",14,0)
 ;
"RTN","PSOERXR1",15,0)
INIT ;
"RTN","PSOERXR1",16,0)
 Q:'$G(PSOIEN)
"RTN","PSOERXR1",17,0)
 N LINE,PARVDAT,EXPIEN,EXPIENS,EXPNM,EXPDOB,EXPSSN,EXPADD,EXPGEN,EXPCTY,EXPST,EXPZIP,HFIEN,EXPHPH,CPIEN,EXPCPH,LINETXT
"RTN","PSOERXR1",18,0)
 N EXPADD1,EXPADD2,EXPAGNT,EXPDEA,EXPFN,EXPLIC,EXPNPI,EXPSUPER,EXPWPH,FNIEN,MANVAL,PRVDAT,VAPADD1,VAPADD2,VAPCIT,DEAEXP
"RTN","PSOERXR1",19,0)
 N VAPDEA,VAPFAX,VAPIENS,VAPLIC,VAPNM,VAPNPI,VAPROV,VAPRVIEN,VAPST,VAPTEL,VAPZIP,WPIEN,SEPLN,VAPDEAEX,VALBY,VALDTTM
"RTN","PSOERXR1",20,0)
 S LINE=0,LINETXT=""
"RTN","PSOERXR1",21,0)
 S EXPIEN=$$GET1^DIQ(52.49,PSOIEN,2.1,"I")
"RTN","PSOERXR1",22,0)
 S EXPIENS=EXPIEN_","
"RTN","PSOERXR1",23,0)
 D GETS^DIQ(52.48,EXPIENS,"**","E","PRVDAT")
"RTN","PSOERXR1",24,0)
 S EXPNM=$G(PRVDAT(52.48,EXPIENS,.01,"E"))
"RTN","PSOERXR1",25,0)
 S EXPNPI=$G(PRVDAT(52.48,EXPIENS,1.5,"E"))
"RTN","PSOERXR1",26,0)
 S EXPDEA=$G(PRVDAT(52.48,EXPIENS,1.6,"E"))
"RTN","PSOERXR1",27,0)
 S EXPLIC=$G(PRVDAT(52.48,EXPIENS,1.8,"E"))
"RTN","PSOERXR1",28,0)
 S EXPAGNT=$G(PRVDAT(52.48,EXPIENS,5.1,"E")) I $L(EXPAGNT) S EXPAGNT=EXPAGNT_", "_$G(PRVDAT(52.48,EXPIENS,5.2,"E"))
"RTN","PSOERXR1",29,0)
 S EXPSUPER=$$GET1^DIQ(52.49,PSOIEN,2.6,"E")
"RTN","PSOERXR1",30,0)
 S EXPADD1=$G(PRVDAT(52.48,EXPIENS,4.1,"E"))
"RTN","PSOERXR1",31,0)
 S EXPADD2=$G(PRVDAT(52.48,EXPIENS,4.2,"E"))
"RTN","PSOERXR1",32,0)
 S EXPCTY=$G(PRVDAT(52.48,EXPIENS,4.3,"E"))
"RTN","PSOERXR1",33,0)
 S EXPST=$G(PRVDAT(52.48,EXPIENS,4.4,"E"))
"RTN","PSOERXR1",34,0)
 S EXPZIP=$G(PRVDAT(52.48,EXPIENS,4.5,"E")),EXPZIP=$E(EXPZIP,1,5)
"RTN","PSOERXR1",35,0)
 S WPIEN=$O(^PS(52.48,EXPIEN,3,"C","WP",0))
"RTN","PSOERXR1",36,0)
 ; home phone
"RTN","PSOERXR1",37,0)
 S EXPWPH=$$GET1^DIQ(52.483,WPIEN_","_EXPIENS,.01,"E")
"RTN","PSOERXR1",38,0)
 ; fax number
"RTN","PSOERXR1",39,0)
 S FNIEN=$O(^PS(52.48,EXPIEN,3,"C","FX",0))
"RTN","PSOERXR1",40,0)
 S EXPFN=$$GET1^DIQ(52.483,FNIEN_","_EXPIENS,.01,"E")
"RTN","PSOERXR1",41,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"eRx Provider: "_$E(EXPNM,1,50))
"RTN","PSOERXR1",42,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Address: "_$E(EXPADD1,1,50))
"RTN","PSOERXR1",43,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"         "_$E(EXPADD2,1,50))
"RTN","PSOERXR1",44,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"         "_EXPCTY_", "_EXPST_" "_EXPZIP)
"RTN","PSOERXR1",45,0)
 S LINE=LINE+1
"RTN","PSOERXR1",46,0)
 D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",EXPNPI,1,26)
"RTN","PSOERXR1",47,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DEA: ",EXPDEA,28,26)
"RTN","PSOERXR1",48,0)
 D ADDITEM^PSOERX1A(.LINETXT,"State Lic: ",EXPLIC,54,26)
"RTN","PSOERXR1",49,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXR1",50,0)
 S LINE=LINE+1
"RTN","PSOERXR1",51,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Tel: ",EXPWPH,1,26)
"RTN","PSOERXR1",52,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Fax: ",EXPFN,28,26)
"RTN","PSOERXR1",53,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXR1",54,0)
 S LINE=LINE+1
"RTN","PSOERXR1",55,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Agent: ",$S($L(EXPAGNT):EXPAGNT,1:""),1,35)
"RTN","PSOERXR1",56,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Supervisor: ",$S($L(EXPSUPER):EXPSUPER,1:""),40,40)
"RTN","PSOERXR1",57,0)
 D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXR1",58,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXR1",59,0)
 S $P(SEPLN,"-",80)="-" D SET^VALM10(LINE,SEPLN)
"RTN","PSOERXR1",60,0)
 ; vista patient information
"RTN","PSOERXR1",61,0)
 S VAPRVIEN=$$GET1^DIQ(52.49,PSOIEN,2.3,"I")
"RTN","PSOERXR1",62,0)
 ; INITIALIZE variables
"RTN","PSOERXR1",63,0)
 S (VAPNM,VAPADD1,VAPADD2,VAPCIT,VAPST,VAPZIP,VAPNPI,VAPDEA,VAPLIC,VAPTEL,VAPFAX)=""
"RTN","PSOERXR1",64,0)
 S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.3,"I")
"RTN","PSOERXR1",65,0)
 S VALBY=$$GET1^DIQ(52.49,PSOIEN,1.8,"E")
"RTN","PSOERXR1",66,0)
 S VALDTTM=$$GET1^DIQ(52.49,PSOIEN,1.9,"E")
"RTN","PSOERXR1",67,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"Status: "_$S(MANVAL:"VALIDATED ("_VALBY_" - "_VALDTTM_")",1:"NOT VALIDATED"))
"RTN","PSOERXR1",68,0)
 I 'VAPRVIEN S LINE=LINE+1 D SET^VALM10(LINE,"PROVIDER NOT MATCHED")
"RTN","PSOERXR1",69,0)
 I VAPRVIEN D
"RTN","PSOERXR1",70,0)
 .S VAPIENS=VAPRVIEN_","
"RTN","PSOERXR1",71,0)
 .; 41.99 - NPI, 53.2 - DEA, 54.2 - STATE LICENSING DEA NUMBER, .132 - OFFICE PHONE, .136 - FAX
"RTN","PSOERXR1",72,0)
 .D GETS^DIQ(200,VAPIENS_",",".01;.111;.112;.113;.114;.115;.116;.132;.136;41.99;53.2;54.2","IE","VAPROV")
"RTN","PSOERXR1",73,0)
 .S VAPNM=$G(VAPROV(200,VAPIENS,.01,"E"))
"RTN","PSOERXR1",74,0)
 .S VAPADD1=$G(VAPROV(200,VAPIENS,.111,"E"))
"RTN","PSOERXR1",75,0)
 .S VAPADD2=$G(VAPROV(200,VAPIENS,.112,"E"))
"RTN","PSOERXR1",76,0)
 .S VAPCIT=$G(VAPROV(200,VAPIENS,.114,"E"))
"RTN","PSOERXR1",77,0)
 .S VAPST=$G(VAPROV(200,VAPIENS,.115,"E"))
"RTN","PSOERXR1",78,0)
 .S VAPZIP=$G(VAPROV(200,VAPIENS,.116,"E"))
"RTN","PSOERXR1",79,0)
 .S VAPNPI=$G(VAPROV(200,VAPIENS,41.99,"E"))
"RTN","PSOERXR1",80,0)
 .S VAPDEA=$G(VAPROV(200,VAPIENS,53.2,"E"))
"RTN","PSOERXR1",81,0)
 .S VAPDEAEX=$$GET1^DIQ(200,VAPIENS,747.44,"I") I VAPDEAEX,VAPDEAEX<DT S DEAEXP=1
"RTN","PSOERXR1",82,0)
 .S VAPLIC=$G(VAPROV(200,VAPIENS,54.2,"E"))
"RTN","PSOERXR1",83,0)
 .S VAPTEL=$G(VAPROV(200,VAPIENS,.132,"E"))
"RTN","PSOERXR1",84,0)
 .S VAPFAX=$G(VAPROV(200,VAPIENS,.136,"E"))
"RTN","PSOERXR1",85,0)
 .S MANVAL=$$GET1^DIQ(52.49,PSOIEN,1.3,"I")
"RTN","PSOERXR1",86,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Vista Provider: "_VAPNM)
"RTN","PSOERXR1",87,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"Address: "_$S($L(VAPADD1):VAPADD1,1:"No street address on file."))
"RTN","PSOERXR1",88,0)
 .I $L(VAPADD2) S LINE=LINE+1 D SET^VALM10(LINE,"         "_VAPADD2)
"RTN","PSOERXR1",89,0)
 .S LINE=LINE+1 D SET^VALM10(LINE,"         "_VAPCIT_", "_VAPST_" "_VAPZIP)
"RTN","PSOERXR1",90,0)
 .S LINE=LINE+1
"RTN","PSOERXR1",91,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",VAPNPI,1,26)
"RTN","PSOERXR1",92,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"DEA: ",VAPDEA_$S($G(DEAEXP):" (Expired)",1:""),28,26)
"RTN","PSOERXR1",93,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXR1",94,0)
 .S LINE=LINE+1
"RTN","PSOERXR1",95,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Tel: ",VAPTEL,1,26)
"RTN","PSOERXR1",96,0)
 .D ADDITEM^PSOERX1A(.LINETXT,"Fax: ",VAPFAX,28,26)
"RTN","PSOERXR1",97,0)
 .D SET^VALM10(LINE,LINETXT) S LINETXT=""
"RTN","PSOERXR1",98,0)
 S LINE=LINE+1 D SET^VALM10(LINE,"")
"RTN","PSOERXR1",99,0)
 S VALMCNT=LINE
"RTN","PSOERXR1",100,0)
 S EDTYP="PR"
"RTN","PSOERXR1",101,0)
 Q
"RTN","PSOERXR1",102,0)
HELP ; -- help code
"RTN","PSOERXR1",103,0)
 S X="?" D DISP^XQORM1 W !!
"RTN","PSOERXR1",104,0)
 Q
"RTN","PSOERXR1",105,0)
 ;
"RTN","PSOERXR1",106,0)
EXIT ; -- exit code
"RTN","PSOERXR1",107,0)
 K EDTYP,@VALMAR
"RTN","PSOERXR1",108,0)
 Q
"RTN","PSOERXR1",109,0)
 ;
"RTN","PSOERXR1",110,0)
EXPND ; -- expand code
"RTN","PSOERXR1",111,0)
 Q
"RTN","PSOERXU1")
0^23^B72865919^n/a
"RTN","PSOERXU1",1,0)
PSOERXU1 ;ALB/BWF - eRx utilities ; 5/26/2017 9:57am
"RTN","PSOERXU1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXU1",3,0)
 ;
"RTN","PSOERXU1",4,0)
 Q
"RTN","PSOERXU1",5,0)
 ; OR0 - OR0 FROM PENDING OUTPATIENT ORDERS OR BACKDOOR ORDERS
"RTN","PSOERXU1",6,0)
CHKERX(OR0) ;
"RTN","PSOERXU1",7,0)
 N ORIEN,ERXIEN
"RTN","PSOERXU1",8,0)
 S ORIEN=$P(OR0,U) Q:'ORIEN
"RTN","PSOERXU1",9,0)
 I '$D(^PS(52.49,"ORN",ORIEN)) Q 0
"RTN","PSOERXU1",10,0)
 S ERXIEN=$O(^PS(52.49,"ORN",ORIEN,0))
"RTN","PSOERXU1",11,0)
 I 'ERXIEN Q 0
"RTN","PSOERXU1",12,0)
 Q ERXIEN
"RTN","PSOERXU1",13,0)
 ; STORE IN ^TMP("PSOPO",$J,IEN,0)
"RTN","PSOERXU1",14,0)
DERX1(GL,PSOIEN,DFLG,IEN) ;
"RTN","PSOERXU1",15,0)
 N EDRG,ERXDAT,ESIG,COMM,SUBS,DFORM,DSTR,QQUAL,POTUC,QTY,DAYS,REFILL,PSOIENS,LINE,LINETXT,ADLINE,ADARY,ALOOP,COMMARY
"RTN","PSOERXU1",16,0)
 N ERXPAT,ERXPIEN,ERXPDOB,ERXPSSN,ERXPROV,ERXPRIEN,ERXPRDEA,ERXPRNPI,ERXPRSA1,ERXPRSA2,ERXPRCTY,ERXPRST,ERXPRZIP,I
"RTN","PSOERXU1",17,0)
 N PROVDAT,SIGARY,STHIS,STAT,ACBY,FOUND,ACDTTM,DRGARY,DLP
"RTN","PSOERXU1",18,0)
 Q:'PSOIEN
"RTN","PSOERXU1",19,0)
 S PSOIENS=PSOIEN_","
"RTN","PSOERXU1",20,0)
 D GETS^DIQ(52.49,PSOIENS,".04;2.1;3.1;4.6;4.8;5.1;5.2;5.4;5.5;5.6;5.8;7;8;41;42;43","IE","ERXDAT")
"RTN","PSOERXU1",21,0)
 S DFLG=$G(DFLG,"")
"RTN","PSOERXU1",22,0)
 S EDRG=$G(ERXDAT(52.49,PSOIENS,3.1,"E"))
"RTN","PSOERXU1",23,0)
 S ESIG=$G(ERXDAT(52.49,PSOIENS,7,"E"))
"RTN","PSOERXU1",24,0)
 S COMM=$G(ERXDAT(52.49,PSOIENS,8,"E"))
"RTN","PSOERXU1",25,0)
 S SUBS=$G(ERXDAT(52.49,PSOIENS,5.8,"E"))
"RTN","PSOERXU1",26,0)
 S DFORM=$G(ERXDAT(52.49,PSOIENS,41,"E"))
"RTN","PSOERXU1",27,0)
 S DSTR=$G(ERXDAT(52.49,PSOIENS,43,"E"))
"RTN","PSOERXU1",28,0)
 S QQUAL=$G(ERXDAT(52.49,PSOIENS,5.2,"E"))
"RTN","PSOERXU1",29,0)
 S POTUC=$G(ERXDAT(52.49,PSOIENS,42,"E"))
"RTN","PSOERXU1",30,0)
 S QTY=$G(ERXDAT(52.49,PSOIENS,5.1,"E"))
"RTN","PSOERXU1",31,0)
 S DAYS=$G(ERXDAT(52.49,PSOIENS,5.5,"E"))
"RTN","PSOERXU1",32,0)
 S REFILL=$G(ERXDAT(52.49,PSOIENS,5.6,"E"))
"RTN","PSOERXU1",33,0)
 S ERXPAT=$G(ERXDAT(52.49,PSOIENS,.04,"E"))
"RTN","PSOERXU1",34,0)
 S ERXPIEN=$G(ERXDAT(52.49,PSOIENS,.04,"I"))
"RTN","PSOERXU1",35,0)
 S ERXPDOB=$$GET1^DIQ(52.46,ERXPIEN,.08,"E")
"RTN","PSOERXU1",36,0)
 S ERXPSSN=$$GET1^DIQ(52.46,ERXPIEN,1.4,"E")
"RTN","PSOERXU1",37,0)
 S ERXPROV=$G(ERXDAT(52.49,PSOIENS,2.1,"E"))
"RTN","PSOERXU1",38,0)
 S ERXPRIEN=$G(ERXDAT(52.49,PSOIENS,2.1,"I"))
"RTN","PSOERXU1",39,0)
 D GETS^DIQ(52.48,ERXPRIEN_",","1.5;1.6;4.1;4.2;4.3;4.4;4.5","E","PROVDAT")
"RTN","PSOERXU1",40,0)
 S ERXPRDEA=$G(PROVDAT(52.48,ERXPRIEN_",",1.6,"E"))
"RTN","PSOERXU1",41,0)
 S ERXPRNPI=$G(PROVDAT(52.48,ERXPRIEN_",",1.5,"E"))
"RTN","PSOERXU1",42,0)
 S ERXPRSA1=$G(PROVDAT(52.48,ERXPRIEN_",",4.1,"E"))
"RTN","PSOERXU1",43,0)
 S ERXPRSA2=$G(PROVDAT(52.48,ERXPRIEN_",",4.2,"E"))
"RTN","PSOERXU1",44,0)
 S ERXPRCTY=$G(PROVDAT(52.48,ERXPRIEN_",",4.3,"E"))
"RTN","PSOERXU1",45,0)
 S ERXPRST=$G(PROVDAT(52.48,ERXPRIEN_",",4.4,"E"))
"RTN","PSOERXU1",46,0)
 S ERXPRZIP=$G(PROVDAT(52.48,ERXPRIEN_",",4.5,"E"))
"RTN","PSOERXU1",47,0)
 D TXT2ARY^PSOERXD1(.SIGARY,ESIG,,69)
"RTN","PSOERXU1",48,0)
 D TXT2ARY^PSOERXD1(.COMMARY,COMM,,65)
"RTN","PSOERXU1",49,0)
 S STHIS=99999,FOUND=0
"RTN","PSOERXU1",50,0)
 F  S STHIS=$O(^PS(52.49,PSOIEN,19,STHIS),-1) Q:'STHIS!(FOUND)  D
"RTN","PSOERXU1",51,0)
 .S STAT=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.02,"I")
"RTN","PSOERXU1",52,0)
 .I $$GET1^DIQ(52.45,STAT,.01,"E")'="PR" Q
"RTN","PSOERXU1",53,0)
 .S ACDTTM=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.01,"E")
"RTN","PSOERXU1",54,0)
 .S ACBY=$$GET1^DIQ(52.4919,STHIS_","_PSOIENS,.03,"E"),FOUND=1
"RTN","PSOERXU1",55,0)
 I $L($G(ACBY)) S IEN=IEN+1,@GL@(IEN,0)="eRx Accepted By: "_ACBY_" ("_ACDTTM_")"
"RTN","PSOERXU1",56,0)
 S LINETXT=""
"RTN","PSOERXU1",57,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Patient: ",ERXPAT,1,55)
"RTN","PSOERXU1",58,0)
 D ADDITEM^PSOERX1A(.LINETXT,"SSN: ",ERXPSSN,57,15)
"RTN","PSOERXU1",59,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",60,0)
 S LINETXT=""
"RTN","PSOERXU1",61,0)
 I $L(ERXPAT)>55 D ADDITEM^PSOERX1A(.LINETXT,"            ",$E(ERXPAT,56,98),1,55)
"RTN","PSOERXU1",62,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DOB: ",ERXPDOB,57,20)
"RTN","PSOERXU1",63,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",64,0)
 I $L(ERXPAT)>98 D
"RTN","PSOERXU1",65,0)
 .S IEN=IEN+1,@GL@(IEN,0)="            "_$E(ERXPAT,99,135)
"RTN","PSOERXU1",66,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",67,0)
 S LINETXT=""
"RTN","PSOERXU1",68,0)
 D ADDITEM^PSOERX1A(.LINETXT,"eRx Provider: ",$E(ERXPROV,1,55),1,55)
"RTN","PSOERXU1",69,0)
 D ADDITEM^PSOERX1A(.LINETXT,"DEA: ",ERXPRDEA,57,20)
"RTN","PSOERXU1",70,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",71,0)
 I $L(ERXPROV)>55 D ADDITEM^PSOERX1A(.LINETXT,"              ",$E(ERXPROV,56,96),1,55)
"RTN","PSOERXU1",72,0)
 D ADDITEM^PSOERX1A(.LINETXT,"NPI: ",ERXPRNPI,57,20)
"RTN","PSOERXU1",73,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",74,0)
 I $L(ERXPROV)>96 D ADDITEM^PSOERX1A(.LINETXT,"              ",$E(ERXPROV,97,135),1,55)
"RTN","PSOERXU1",75,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT,LINETXT=""
"RTN","PSOERXU1",76,0)
 S ADLINE=$S($L(ERXPRSA1):ERXPRSA1,1:"ADDRESS UNKNOWN ")
"RTN","PSOERXU1",77,0)
 I $L(ERXPRSA2) S ADLINE=ADLINE_ERXPRSA2_" "
"RTN","PSOERXU1",78,0)
 S ADLINE=ADLINE_$S($L(ERXPRCTY):ERXPRCTY_",",1:"")
"RTN","PSOERXU1",79,0)
 S ADLINE=ADLINE_$S($L(ERXPRST):ERXPRST_" ",1:"")
"RTN","PSOERXU1",80,0)
 S ADLINE=ADLINE_$S($L(ERXPRZIP):ERXPRZIP,1:"")
"RTN","PSOERXU1",81,0)
 I $L(ADLINE)>80 D TXT2ARY^PSOERXD1(.ADARY,ADLINE,,80)
"RTN","PSOERXU1",82,0)
 S IEN=IEN+1,@GL@(IEN,0)="Address: "_$S($D(ADARY):ADARY(1),1:ADLINE)
"RTN","PSOERXU1",83,0)
 I $O(ADARY(0)) D
"RTN","PSOERXU1",84,0)
 .S ALOOP=1 F  S ALOOP=$O(ADARY(ALOOP)) Q:'ALOOP  D
"RTN","PSOERXU1",85,0)
 ..S IEN=IEN+1,@GL@(IEN,0)="         "_ADARY(ALOOP)
"RTN","PSOERXU1",86,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",87,0)
 D TXT2ARY^PSOERXD1(.DRGARY,EDRG,,70)
"RTN","PSOERXU1",88,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Drug: "_$G(DRGARY(1))
"RTN","PSOERXU1",89,0)
 S DLP=1
"RTN","PSOERXU1",90,0)
 F  S DLP=$O(DRGARY(DLP)) Q:'DLP  D
"RTN","PSOERXU1",91,0)
 .S IEN=IEN+1,@GL@(IEN,0)="          "_$G(DRGARY(DLP))
"RTN","PSOERXU1",92,0)
 S LINETXT=""
"RTN","PSOERXU1",93,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Qty: ",QTY,1,25)
"RTN","PSOERXU1",94,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Days Supply: ",DAYS,27,16)
"RTN","PSOERXU1",95,0)
 D ADDITEM^PSOERX1A(.LINETXT,"Refills: ",REFILL,58,20)
"RTN","PSOERXU1",96,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",97,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Sig: "
"RTN","PSOERXU1",98,0)
 S I=0 F  S I=$O(SIGARY(I)) Q:'I  D
"RTN","PSOERXU1",99,0)
 .I I=1 S @GL@(IEN,0)=@GL@(IEN,0)_SIGARY(I) Q
"RTN","PSOERXU1",100,0)
 .S IEN=IEN+1,@GL@(IEN,0)=$S(I>1:"         "_SIGARY(I),1:SIGARY(I))
"RTN","PSOERXU1",101,0)
 I '$L(ESIG) S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",102,0)
 S IEN=IEN+1,@GL@(IEN,0)="eRx Notes: "
"RTN","PSOERXU1",103,0)
 S I=0 F  S I=$O(COMMARY(I)) Q:'I  D
"RTN","PSOERXU1",104,0)
 .I I=1 S @GL@(IEN,0)=@GL@(IEN,0)_$S(I>1:"              "_COMMARY(I),1:COMMARY(I)) Q
"RTN","PSOERXU1",105,0)
 .S IEN=IEN+1,@GL@(IEN,0)=$S(I>1:"              "_COMMARY(I),1:COMMARY(I))
"RTN","PSOERXU1",106,0)
 I '$L(COMM) S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",107,0)
 Q:DFLG=1
"RTN","PSOERXU1",108,0)
 S LINETXT=""
"RTN","PSOERXU1",109,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",110,0)
 S IEN=IEN+1,@GL@(IEN,0)="Drug Form: "_DFORM
"RTN","PSOERXU1",111,0)
 S IEN=IEN+1,@GL@(IEN,0)="Strength: "_DSTR
"RTN","PSOERXU1",112,0)
 S LINETXT=""
"RTN","PSOERXU1",113,0)
 S IEN=IEN+1,@GL@(IEN,0)="Qty Qualifier: "_QQUAL
"RTN","PSOERXU1",114,0)
 S IEN=IEN+1,@GL@(IEN,0)="Potency Unit Code: "_POTUC
"RTN","PSOERXU1",115,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINETXT
"RTN","PSOERXU1",116,0)
 S IEN=IEN+1,@GL@(IEN,0)="DAW Code: "_SUBS
"RTN","PSOERXU1",117,0)
 S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",118,0)
 ; diagnosis information
"RTN","PSOERXU1",119,0)
 N DIAGIEN,DIAGDAT,DIAGSEQ,PDIAGQ,PDIAGV,SDIAGQ,SDIAGV,DIAGDAT,DIACIC,DRES,SDRES
"RTN","PSOERXU1",120,0)
 N SDRESL,SDRESDAT,DRESL,DRESDAT,PDIAGARY,SDIAGARY,PDFRST,SDFRST,PDLOOP,SDLOOP,DIENS
"RTN","PSOERXU1",121,0)
 S DIAGIEN=0 F  S DIAGIEN=$O(^PS(52.49,PSOIEN,9,DIAGIEN)) Q:'DIAGIEN  D
"RTN","PSOERXU1",122,0)
 .S DIENS=DIAGIEN_","_PSOIEN_"," K PDIAGARY,SDIAGARY,DIAGDAT
"RTN","PSOERXU1",123,0)
 .D GETS^DIQ(52.499,DIENS,".01:.06","IE","DIAGDAT")
"RTN","PSOERXU1",124,0)
 .S DIAGSEQ=$G(DIAGDAT(52.499,DIENS,.01,"E"))
"RTN","PSOERXU1",125,0)
 .S DIACIC=$G(DIAGDAT(52.499,DIENS,.02,"E"))
"RTN","PSOERXU1",126,0)
 .S PDIAGQ=$G(DIAGDAT(52.499,DIENS,.03,"E"))
"RTN","PSOERXU1",127,0)
 .S PDIAGV=$G(DIAGDAT(52.499,DIENS,.04,"E"))
"RTN","PSOERXU1",128,0)
 .I PDIAGQ="ICD-10-CM"!(PDIAGQ="ICD-9-CM") D
"RTN","PSOERXU1",129,0)
 ..K DRES,PDIAGARY
"RTN","PSOERXU1",130,0)
 ..D ICDDESC^ICDXCODE(PDIAGQ,PDIAGV,,.DRES)
"RTN","PSOERXU1",131,0)
 ..I '$O(DRES(0)) D TXT2ARY^PSOERXD1(.PDIAGARY,PDIAGV," ",62) Q
"RTN","PSOERXU1",132,0)
 ..S DRESL=0 F  S DRESL=$O(DRES(DRESL)) Q:'DRESL  D
"RTN","PSOERXU1",133,0)
 ...S DRESDAT=$G(DRES(DRESL)) Q:DRESDAT=""
"RTN","PSOERXU1",134,0)
 ...I DRESL=1 S PDIAGV=PDIAGV_" - "_DRESDAT Q
"RTN","PSOERXU1",135,0)
 ...S PDIAGV=PDIAGV_" "_DRESDAT
"RTN","PSOERXU1",136,0)
 ..D TXT2ARY^PSOERXD1(.PDIAGARY,PDIAGV," ",62)
"RTN","PSOERXU1",137,0)
 .S SDIAGQ=$G(DIAGDAT(52.499,DIENS,.05,"E"))
"RTN","PSOERXU1",138,0)
 .S SDIAGV=$G(DIAGDAT(52.499,DIENS,.06,"E"))
"RTN","PSOERXU1",139,0)
 .I SDIAGQ="ICD-10-CM"!(SDIAGQ="ICD-9-CM") D
"RTN","PSOERXU1",140,0)
 ..K SDRES,SDIAGARY
"RTN","PSOERXU1",141,0)
 ..D ICDDESC^ICDXCODE(SDIAGQ,SDIAGV,,.SDRES)
"RTN","PSOERXU1",142,0)
 ..I '$O(SDRES(0)) D TXT2ARY^PSOERXD1(.SDIAGARY,SDIAGV," ",62) Q
"RTN","PSOERXU1",143,0)
 ..S SDRESL=0 F  S SDRESL=$O(SDRES(SDRESL)) Q:'SDRESL  D
"RTN","PSOERXU1",144,0)
 ...S SDRESDAT=$G(SDRES(SDRESL)) Q:SDRESDAT=""
"RTN","PSOERXU1",145,0)
 ...I SDRESL=1 S SDIAGV=SDIAGV_" - "_SDRESDAT Q
"RTN","PSOERXU1",146,0)
 ...S SDIAGV=SDIAGV_" "_SDRESDAT
"RTN","PSOERXU1",147,0)
 ..D TXT2ARY^PSOERXD1(.SDIAGARY,SDIAGV," ",62)
"RTN","PSOERXU1",148,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Diagnosis Sequence: "_DIAGSEQ
"RTN","PSOERXU1",149,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Primary DX Qualifier: "_PDIAGQ
"RTN","PSOERXU1",150,0)
 .S PDFRST=$O(PDIAGARY(0))
"RTN","PSOERXU1",151,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Primary Dx Value: "_$S(PDFRST:$G(PDIAGARY(PDFRST)),1:PDIAGV)
"RTN","PSOERXU1",152,0)
 .S PDLOOP=PDFRST F  S PDLOOP=$O(PDIAGARY(PDLOOP)) Q:'PDLOOP  D
"RTN","PSOERXU1",153,0)
 ..S IEN=IEN+1,@GL@(IEN,0)="                  "_$G(PDIAGARY(PDLOOP))
"RTN","PSOERXU1",154,0)
 .S IEN=IEN+1,@GL@(IEN,0)=""
"RTN","PSOERXU1",155,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Secondary DX Qualifier: "_SDIAGQ
"RTN","PSOERXU1",156,0)
 .S SDFRST=$O(SDIAGARY(0))
"RTN","PSOERXU1",157,0)
 .S IEN=IEN+1,@GL@(IEN,0)="Secondary Dx Value: "_$S(SDFRST:$G(SDIAGARY(SDFRST)),1:SDIAGV)
"RTN","PSOERXU1",158,0)
 .S SDLOOP=SDFRST F  S SDLOOP=$O(SDIAGARY(SDLOOP)) Q:'SDLOOP  D
"RTN","PSOERXU1",159,0)
 ..S IEN=IEN+1,@GL@(IEN,0)="                    "_$G(SDIAGARY(SDLOOP))
"RTN","PSOERXU1",160,0)
 S $P(LINE,"-",80)=""
"RTN","PSOERXU1",161,0)
 S IEN=IEN+1,@GL@(IEN,0)=LINE
"RTN","PSOERXU1",162,0)
 Q
"RTN","PSOERXU1",163,0)
OPACCESS(OPTION,DUZ) ;
"RTN","PSOERXU1",164,0)
 I OPTION="PSO ERX ACCEPT ERX",'$D(^XUSEC("PSDRPH",DUZ)) Q 0
"RTN","PSOERXU1",165,0)
 I OPTION="PSO ERX ACCEPT VALIDATION",($D(^XUSEC("PSO ERX TECH",DUZ))!($D(^XUSEC("PSO ERX VIEW",DUZ)))) Q 0
"RTN","PSOERXU1",166,0)
 I OPTION="PSO ERX REJECT",($D(^XUSEC("PSO ERX TECH",DUZ))!($D(^XUSEC("PSO ERX VIEW",DUZ)))) Q 0
"RTN","PSOERXU1",167,0)
 I OPTION="PSO ERX REMOVE",($D(^XUSEC("PSO ERX TECH",DUZ))!($D(^XUSEC("PSO ERX VIEW",DUZ)))) Q 0
"RTN","PSOERXU1",168,0)
 ; UNREMOVE NEEDS TO BE ADDED IF WE ADD THE OPTION
"RTN","PSOERXU1",169,0)
 I OPTION="PSO ERX VALIDATE PATIENT",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",170,0)
 I OPTION="PSO ERX VALIDATE PROVIDER",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",171,0)
 I OPTION="PSO ERX VALIDATE DRUG",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",172,0)
 I OPTION="PSO ERX HOLD",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",173,0)
 I OPTION="PSO ERX UNHOLD",$D(^XUSEC("PSO ERX VIEW",DUZ)) Q 0
"RTN","PSOERXU1",174,0)
 Q 1
"RTN","PSOERXU1",175,0)
 ; update the status of an eRx
"RTN","PSOERXU1",176,0)
 ; PSOIEN - ien for file 52.49 (required)
"RTN","PSOERXU1",177,0)
 ; STAT - The status value to change the eRx to (required)
"RTN","PSOERXU1",178,0)
 ; SCOMM - status comments (optional)
"RTN","PSOERXU1",179,0)
UPDSTAT(PSOIEN,STAT,SCOMM) ;
"RTN","PSOERXU1",180,0)
 N DIE,NSTAT,DA,DR
"RTN","PSOERXU1",181,0)
 Q:'PSOIEN!(STAT="")
"RTN","PSOERXU1",182,0)
 Q:'$D(^PS(52.45,"C","ERX",STAT))
"RTN","PSOERXU1",183,0)
 S NSTAT=$O(^PS(52.45,"C","ERX",STAT,0))
"RTN","PSOERXU1",184,0)
 ;S NSTAT=$O(^PS(52.45,"C","ERX","I",0))
"RTN","PSOERXU1",185,0)
 S DIE="^PS(52.49,",DA=PSOIEN,DR="1///"_NSTAT D ^DIE
"RTN","PSOERXU1",186,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.01)=$$NOW^XLFDT
"RTN","PSOERXU1",187,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.02)=NSTAT
"RTN","PSOERXU1",188,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",.03)=$G(DUZ)
"RTN","PSOERXU1",189,0)
 S FDA(52.4919,"+1,"_PSOIEN_",",1)=$G(SCOMM)
"RTN","PSOERXU1",190,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",191,0)
 Q
"RTN","PSOERXU1",192,0)
ERRSEQ() ;
"RTN","PSOERXU1",193,0)
 N SEQ
"RTN","PSOERXU1",194,0)
 I '$O(^PS(52.49,EIEN,100,0)) S SEQ=1
"RTN","PSOERXU1",195,0)
 I '$G(SEQ) S SEQ=$O(^PS(52.49,EIEN,100,999999),-1)+1
"RTN","PSOERXU1",196,0)
 Q SEQ
"RTN","PSOERXU1",197,0)
 ;
"RTN","PSOERXU1",198,0)
 ; IENS - ien of the erx holding queue entry
"RTN","PSOERXU1",199,0)
 ;  SEQ - sequence number of the error
"RTN","PSOERXU1",200,0)
 ; TYPE - type (d-drug, pr-provider, pa-patient, a-allergy, o-order check, t-transfer)
"RTN","PSOERXU1",201,0)
 ;  SRC - v - vista, e - erx processing hub
"RTN","PSOERXU1",202,0)
 ;  TXT - error text
"RTN","PSOERXU1",203,0)
FILERR(IENS,SEQ,TYPE,SRC,TXT) ;
"RTN","PSOERXU1",204,0)
 N FDA
"RTN","PSOERXU1",205,0)
 S FDA(52.49101,"+1,"_IENS,.01)=SEQ
"RTN","PSOERXU1",206,0)
 S FDA(52.49101,"+1,"_IENS,.02)=TYPE
"RTN","PSOERXU1",207,0)
 S FDA(52.49101,"+1,"_IENS,.03)=SRC
"RTN","PSOERXU1",208,0)
 ; all new errors are set to pending
"RTN","PSOERXU1",209,0)
 S FDA(52.49101,"+1,"_IENS,.04)="P"
"RTN","PSOERXU1",210,0)
 S FDA(52.49101,"+1,"_IENS,1)=TXT
"RTN","PSOERXU1",211,0)
 D UPDATE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",212,0)
 ; now set the eRx entry status to error
"RTN","PSOERXU1",213,0)
 ;S FDA(52.49,IENS,1)=$O(^PS(52.45,"C","ERX","E",0)) D FILE^DIE(,"FDA") K FDA
"RTN","PSOERXU1",214,0)
 Q
"RTN","PSOERXU1",215,0)
MSGDIR(MSG) ;
"RTN","PSOERXU1",216,0)
 N DIR,MLOOP,MTXT
"RTN","PSOERXU1",217,0)
 S VALMBCK="R"
"RTN","PSOERXU1",218,0)
 D FULL^VALM1
"RTN","PSOERXU1",219,0)
 W !!,"Errors encountered during processing:",!
"RTN","PSOERXU1",220,0)
 S MLOOP=0 F  S MLOOP=$O(MSG(MLOOP)) Q:'MLOOP  D
"RTN","PSOERXU1",221,0)
 .S MTXT=$G(MSG(MLOOP)) W !,MLOOP_".) ",MTXT
"RTN","PSOERXU1",222,0)
 W !!,"Cannot process eRx.",!
"RTN","PSOERXU1",223,0)
 S DIR(0)="E" D ^DIR
"RTN","PSOERXU1",224,0)
 Q
"RTN","PSOERXX1")
0^14^B44864162^n/a
"RTN","PSOERXX1",1,0)
PSOERXX1 ;ALB/BWF - eRx xml utilities ; 8/3/2016 5:14pm
"RTN","PSOERXX1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXX1",3,0)
 ;
"RTN","PSOERXX1",4,0)
 Q
"RTN","PSOERXX1",5,0)
 ; PSOIEN - ien from 52.49 (erx holding queue)
"RTN","PSOERXX1",6,0)
 ; PSOSITE - site ien from the outpatient site file (59)
"RTN","PSOERXX1",7,0)
 ; REFILL REQUEST VIA THE ERX HOLDING QUEUE
"RTN","PSOERXX1",8,0)
RREQHQ(PSOIEN,PSOSITE) ;
"RTN","PSOERXX1",9,0)
 N ORNUM,RXIEN,PSSOUT,GBL,REFL,I,EXDT,PEND,PSSRET,CNT,DIR,Y
"RTN","PSOERXX1",10,0)
 S VALMBCK="R"
"RTN","PSOERXX1",11,0)
 Q:'PSOIEN
"RTN","PSOERXX1",12,0)
 D FULL^VALM1
"RTN","PSOERXX1",13,0)
 S ORNUM=$$GET1^DIQ(52.49,PSOIEN,.12,"I") I 'ORNUM W !!,"No OE/RR order number. Cannot create renewal request." D DIRE Q
"RTN","PSOERXX1",14,0)
 S PEND=$O(^PS(52.41,"B",ORNUM,0))
"RTN","PSOERXX1",15,0)
 S RXIEN=$O(^PSRX("APL",ORNUM,0))
"RTN","PSOERXX1",16,0)
 I PEND,'RXIEN W !!,"RX appears to be in Pending Outpatient Orders, but not yet processed to",!,"backdoor orders." D DIRE Q
"RTN","PSOERXX1",17,0)
 I 'PEND,'RXIEN W !!,"Cannot resolve RX#. Please ensure the prescription is in the prescription file."  D DIRE Q
"RTN","PSOERXX1",18,0)
 S EXDT=$$GET1^DIQ(52,RXIEN,26,"I") I EXDT<DT W !!,"Medication has expired, cannot renew precription." D DIRE Q
"RTN","PSOERXX1",19,0)
 S REFL=$$GET1^DIQ(52,RXIEN,9,"I"),I=0 F  S I=$O(^PSRX(RXIEN,1,I)) Q:'I  S REFL=REFL-1
"RTN","PSOERXX1",20,0)
 ; When renewal/refill request is being used, re-activate the following line of code
"RTN","PSOERXX1",21,0)
 ;I REFL>0 W !!,"Refills remaining for this prescription. Cannot create refill request." D DIRE Q
"RTN","PSOERXX1",22,0)
 W !!,"Would you like to send a refill (renewal) request to the prescriber"
"RTN","PSOERXX1",23,0)
 S DIR(0)="YO" D ^DIR
"RTN","PSOERXX1",24,0)
 I Y<1 Q
"RTN","PSOERXX1",25,0)
 S GBL=$$RREQ(PSOIEN,RXIEN,ORNUM,PSOSITE) I '$O(@GBL@(0)) W !!,"Could not create outgoing renewal message structure." D DIRE Q
"RTN","PSOERXX1",26,0)
 S PSSRET=$$RESTPOST^PSOERXO1(.PSSRET,.GBL)
"RTN","PSOERXX1",27,0)
 ; if the post was unsuccessful, inform the user and quit.
"RTN","PSOERXX1",28,0)
 I $P(PSSRET(0),U)<1 W !,$P(PSSRET(0),U,2) S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",29,0)
 I $D(PSSRET("errorMessage")) W !,PSSRET("errorMessage") S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",30,0)
 W !!,"Renewal Request sent." S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERXX1",31,0)
 K @GBL
"RTN","PSOERXX1",32,0)
 Q
"RTN","PSOERXX1",33,0)
 ; CHANGE REQUEST VIA ERX HOLDING QUEUE
"RTN","PSOERXX1",34,0)
CREQHQ(PSOIEN) ;
"RTN","PSOERXX1",35,0)
 N ORNUM,RXIEN,DRUG,GBL,DROK,PSSRET,CNT
"RTN","PSOERXX1",36,0)
 Q:'PSOIEN
"RTN","PSOERXX1",37,0)
 ; IF THIS HASN'T BEEN SENT TO THE PRESCRIPTION FILE, WE DONT NEED ORDER OR RXIEN
"RTN","PSOERXX1",38,0)
 S ORNUM=$$GET1^DIQ(52.49,PSOIEN,.12,"I") I 'ORNUM W !!,"This order has been Accepted from eRx and cannot be changed." D DIRE Q
"RTN","PSOERXX1",39,0)
 S RXIEN=$O(^PSRX("APL",ORNUM,0)) I 'RXIEN W !!,"A current prescription exists for this eRx. Cannot change eRx." D DIRE Q
"RTN","PSOERXX1",40,0)
 ; build drug information into array to be passed into xml builder
"RTN","PSOERXX1",41,0)
 ; for future use
"RTN","PSOERXX1",42,0)
 ; may consider having the user fill in the drug validation screen then issue change request. Or replicate
"RTN","PSOERXX1",43,0)
 ; drug validation section into another 'Change Request' screen.
"RTN","PSOERXX1",44,0)
 S DROK=$$DRGPRMPT(.DRUG) I 'DROK W !!,"Insufficient drug information. Cannot create change request.",!,"Please try again." D DIRE Q
"RTN","PSOERXX1",45,0)
 S GBL=$$CREQ(PSOIEN,.DRUG) I '$L(GBL) W !!,"Could not create outgoing message structure." D DIRE Q
"RTN","PSOERXX1",46,0)
 S PSSRET=$$RESTPOST^PSOERXO1(.PSSRET,.GBL)
"RTN","PSOERXX1",47,0)
 ; if the post was unsuccessful, inform the user and quit.
"RTN","PSOERXX1",48,0)
 I $P(PSSRET(0),U)<1 W !,$P(PSSRET(0),U,2) S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",49,0)
 I $D(PSSRET("errorMessage")) W !,PSSRET("errorMessage") S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",50,0)
 W !!,"Change Request sent." S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERXX1",51,0)
 K @GBL
"RTN","PSOERXX1",52,0)
 Q
"RTN","PSOERXX1",53,0)
 ; RXFILL MESSAGE
"RTN","PSOERXX1",54,0)
FMES(PSOIEN) ;
"RTN","PSOERXX1",55,0)
 N ORNUM,RXIEN,DRUG,GBL,FTYPE,PSSRET,CNT
"RTN","PSOERXX1",56,0)
 Q:'PSOIEN
"RTN","PSOERXX1",57,0)
 S ORNUM=$$GET1^DIQ(52.49,PSOIEN,.12,"I") I 'ORNUM W !!,"No OE/RR order number. Cannot create refill request." D DIRE Q
"RTN","PSOERXX1",58,0)
 S RXIEN=$O(^PSRX("APL",ORNUM,0)) I 'RXIEN W !!,"Could not resolve RX #. Please contact technical support." D DIRE Q
"RTN","PSOERXX1",59,0)
 ; FOR NOW SET NOTE AND FTYPE (FULL/PARTIAL) FOR BUILDING XML
"RTN","PSOERXX1",60,0)
 S NOTE="TESTING NOTE"
"RTN","PSOERXX1",61,0)
 S FTYPE="F"
"RTN","PSOERXX1",62,0)
 S GBL=$$RXFILL(PSOIEN,FTYPE,NOTE,RXIEN,ORNUM) I '$L(GBL) W !!,"Could not create outgoing message structure." D DIRE Q
"RTN","PSOERXX1",63,0)
 ;W !!,"RxFill message sent to prescriber." S DIR(0)="E" D ^DIR K DIR 
"RTN","PSOERXX1",64,0)
 S PSSRET=$$RESTPOST^PSOERXO1(.PSSRET,.GBL)
"RTN","PSOERXX1",65,0)
 ; if the post was unsuccessful, inform the user and quit.
"RTN","PSOERXX1",66,0)
 I $P(PSSRET(0),U)<1 W !,$P(PSSRET(0),U,2) S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",67,0)
 I $D(PSSRET("errorMessage")) W !,PSSRET("errorMessage") S DIR(0)="E" D ^DIR K DIR Q
"RTN","PSOERXX1",68,0)
 W !!,"RxFill Message sent." S DIR(0)="E" D ^DIR K DIR
"RTN","PSOERXX1",69,0)
 K @GBL
"RTN","PSOERXX1",70,0)
 Q
"RTN","PSOERXX1",71,0)
 ; prompt for drug fields needed to create a change request - not currently used
"RTN","PSOERXX1",72,0)
DRGPRMPT(DRG) ;
"RTN","PSOERXX1",73,0)
 ; Prompt for drug
"RTN","PSOERXX1",74,0)
 N DIC,PSODRUG,DIR,Y
"RTN","PSOERXX1",75,0)
 S DIC(0)="AEMQ",DIC=50,DIC("S")="I $$ACTIVE^PSOERXA0(Y),($$OUTPAT^PSOERXA0(Y)),('$$INVCOMP^PSOERXA0(Y)),('$$CS^PSOERXA0(Y))" D ^DIC
"RTN","PSOERXX1",76,0)
 K DIC
"RTN","PSOERXX1",77,0)
 Q:$P(Y,U)<1 0
"RTN","PSOERXX1",78,0)
 ; FOR FUTURE USE - ADD ROUTE PROMPT
"RTN","PSOERXX1",79,0)
 ; Y=DRUG IEN^DRUG DESCRIPTION
"RTN","PSOERXX1",80,0)
 S DRG("DRUG")=$P(Y,U,2)
"RTN","PSOERXX1",81,0)
 S PSODRUG("IEN")=$P(Y,U)
"RTN","PSOERXX1",82,0)
 ; prompt for days supply
"RTN","PSOERXX1",83,0)
 K DIR S DIR(0)="52.49,20.2" D ^DIR
"RTN","PSOERXX1",84,0)
 Q:$P(Y,U)<1 0
"RTN","PSOERXX1",85,0)
 S DRG("DSUP")=Y
"RTN","PSOERXX1",86,0)
 ; prompt for quantity
"RTN","PSOERXX1",87,0)
 K DIR S DIR(0)="52.49,20.1" D ^DIR
"RTN","PSOERXX1",88,0)
 Q:$P(Y,U)<1 0
"RTN","PSOERXX1",89,0)
 S DRG("QTY")=Y
"RTN","PSOERXX1",90,0)
 ; prompt for refills
"RTN","PSOERXX1",91,0)
 K DIR S DIR(0)="52.49,20.5" D ^DIR
"RTN","PSOERXX1",92,0)
 Q:$P(Y,U)<1 0
"RTN","PSOERXX1",93,0)
 S DRG("REF")=Y
"RTN","PSOERXX1",94,0)
 ; prompt for directions
"RTN","PSOERXX1",95,0)
 K DIR S DIR(0)="52.49,7" D ^DIR
"RTN","PSOERXX1",96,0)
 Q:Y="^" 0
"RTN","PSOERXX1",97,0)
 Q:Y']"" 0
"RTN","PSOERXX1",98,0)
 S DRG("DIR")=Y
"RTN","PSOERXX1",99,0)
 Q 1
"RTN","PSOERXX1",100,0)
 ; CHANGE REQUEST VIA BACKDOOR ORDERS
"RTN","PSOERXX1",101,0)
CREQBD(RXIEN) ;
"RTN","PSOERXX1",102,0)
 Q
"RTN","PSOERXX1",103,0)
 ; CHANGE REQUEST VIA PSO LMOE FINISH
"RTN","PSOERXX1",104,0)
CREQPO(ORIEN) ;
"RTN","PSOERXX1",105,0)
 Q
"RTN","PSOERXX1",106,0)
RREQ(PSOIEN,RXIEN,ORNUM,PSOSITE) ;RefillRequest
"RTN","PSOERXX1",107,0)
 N GBL,PSOIENS,CNT
"RTN","PSOERXX1",108,0)
 Q:'PSOIEN ""
"RTN","PSOERXX1",109,0)
 S GBL=$NA(^TMP("RREQ^PSOERXX1",$J)) K @GBL
"RTN","PSOERXX1",110,0)
 S CNT=0
"RTN","PSOERXX1",111,0)
 D MSG^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",112,0)
 ; header
"RTN","PSOERXX1",113,0)
 D HDR^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",114,0)
 ; body header
"RTN","PSOERXX1",115,0)
 D BHF^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",116,0)
 ; request type header
"RTN","PSOERXX1",117,0)
 D RTYPE^PSOERXX2(.GBL,"RefillRequest",1)
"RTN","PSOERXX1",118,0)
 ; request info - not currently used
"RTN","PSOERXX1",119,0)
 ;D REQUEST^PSOERXX2(.GBL,"ACC","ACC")
"RTN","PSOERXX1",120,0)
 D VAPHARM^PSOERXX2(.GBL,PSOSITE,PSOIEN)
"RTN","PSOERXX1",121,0)
 D PRESCRIB^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",122,0)
 D SUPERVIS^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",123,0)
 D FACIL^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",124,0)
 D PATIENT^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",125,0)
 D MEDPRES^PSOERXX4(.GBL,PSOIEN)
"RTN","PSOERXX1",126,0)
 D MEDDIS^PSOERXX4(.GBL,RXIEN,ORNUM,PSOIEN)
"RTN","PSOERXX1",127,0)
 D OBSERVE^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",128,0)
 D BENEFITS^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",129,0)
 D DRUGEVAL^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",130,0)
 ;D DIAGNOS(.GBL,PSOIEN)
"RTN","PSOERXX1",131,0)
 D RTYPE^PSOERXX2(.GBL,"RefillRequest",2)
"RTN","PSOERXX1",132,0)
 D BHF^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",133,0)
 D MSG^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",134,0)
 Q GBL
"RTN","PSOERXX1",135,0)
 ; PSOIEN - erx IEN from 52.49
"RTN","PSOERXX1",136,0)
CREQ(PSOIEN,REQDRUG) ;ChangeRequest
"RTN","PSOERXX1",137,0)
 N GBL,PSOIENS,CNT
"RTN","PSOERXX1",138,0)
 Q:'PSOIEN ""
"RTN","PSOERXX1",139,0)
 S GBL=$NA(^TMP("CREQ^PSOERXX1",$J)) K @GBL
"RTN","PSOERXX1",140,0)
 S CNT=0
"RTN","PSOERXX1",141,0)
 D MSG^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",142,0)
 ; header
"RTN","PSOERXX1",143,0)
 D HDR^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",144,0)
 ; body header
"RTN","PSOERXX1",145,0)
 D BHF^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",146,0)
 ; request type header
"RTN","PSOERXX1",147,0)
 D RTYPE^PSOERXX2(.GBL,"ChangeRequest",1)
"RTN","PSOERXX1",148,0)
 ; request info
"RTN","PSOERXX1",149,0)
 D REQUEST^PSOERXX2(.GBL,"TST","TST")
"RTN","PSOERXX1",150,0)
 D VAPHARM^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",151,0)
 D PRESCRIB^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",152,0)
 D SUPERVIS^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",153,0)
 D FACIL^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",154,0)
 D PATIENT^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",155,0)
 D MEDPRES^PSOERXX4(.GBL,PSOIEN)
"RTN","PSOERXX1",156,0)
 D MEDREQ^PSOERXX4(.GBL,PSOIEN,.REQDRUG)
"RTN","PSOERXX1",157,0)
 D OBSERVE^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",158,0)
 D BENEFITS^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",159,0)
 D DRUGEVAL^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",160,0)
 D DIAGNOS^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",161,0)
 D RTYPE^PSOERXX2(.GBL,"ChangeRequest",2)
"RTN","PSOERXX1",162,0)
 D BHF^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",163,0)
 D MSG^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",164,0)
 Q GBL
"RTN","PSOERXX1",165,0)
 ; FP - full or partial fill (F/P)
"RTN","PSOERXX1",166,0)
 ; NOTE - fill notes
"RTN","PSOERXX1",167,0)
RXFILL(PSOIEN,FP,NOTE,RXIEN,ORNUM) ;
"RTN","PSOERXX1",168,0)
 N GBL,PSOIENS,CNT
"RTN","PSOERXX1",169,0)
 Q:'PSOIEN ""
"RTN","PSOERXX1",170,0)
 S GBL=$NA(^TMP("RXFILL^PSOERXX1",$J)) K @GBL
"RTN","PSOERXX1",171,0)
 S CNT=0
"RTN","PSOERXX1",172,0)
 D MSG^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",173,0)
 ; header
"RTN","PSOERXX1",174,0)
 D HDR^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",175,0)
 ; body header
"RTN","PSOERXX1",176,0)
 D BHF^PSOERXX2(.GBL,1)
"RTN","PSOERXX1",177,0)
 ; request type header
"RTN","PSOERXX1",178,0)
 D RTYPE^PSOERXX2(.GBL,"RxFill",1)
"RTN","PSOERXX1",179,0)
 ; request info
"RTN","PSOERXX1",180,0)
 ;D REQUEST(.GBL,"TEST1","TEST2")
"RTN","PSOERXX1",181,0)
 ;FP - full or partial fill
"RTN","PSOERXX1",182,0)
 S FP="F"
"RTN","PSOERXX1",183,0)
 S NOTE=$G(NOTE,"TESTING NOTES")
"RTN","PSOERXX1",184,0)
 ; fill status
"RTN","PSOERXX1",185,0)
 D FILLST^PSOERXX3(.GBL,FP,NOTE)
"RTN","PSOERXX1",186,0)
 D VAPHARM^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",187,0)
 D PRESCRIB^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",188,0)
 D SUPERVIS^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",189,0)
 D FACIL^PSOERXX2(.GBL,PSOIEN)
"RTN","PSOERXX1",190,0)
 D PATIENT^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",191,0)
 D MEDPRES^PSOERXX4(.GBL,PSOIEN)
"RTN","PSOERXX1",192,0)
 D MEDDIS^PSOERXX4(.GBL,PSOIEN)
"RTN","PSOERXX1",193,0)
 D OBSERVE^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",194,0)
 D BENEFITS^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",195,0)
 D DRUGEVAL^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",196,0)
 ;D DIAGNOS^PSOERXX3(.GBL,PSOIEN)
"RTN","PSOERXX1",197,0)
 D RTYPE^PSOERXX2(.GBL,"RxFill",2)
"RTN","PSOERXX1",198,0)
 D BHF^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",199,0)
 D MSG^PSOERXX2(.GBL,2)
"RTN","PSOERXX1",200,0)
 Q GBL
"RTN","PSOERXX1",201,0)
DIRE ;
"RTN","PSOERXX1",202,0)
 N DIR S DIR(0)="E" D ^DIR
"RTN","PSOERXX1",203,0)
 Q
"RTN","PSOERXX2")
0^15^B181162473^n/a
"RTN","PSOERXX2",1,0)
PSOERXX2 ;ALB/BWF - eRx xml utilities ; 8/3/2016 5:14pm
"RTN","PSOERXX2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXX2",3,0)
 ;
"RTN","PSOERXX2",4,0)
 Q
"RTN","PSOERXX2",5,0)
MSG(GBL,HF) ;
"RTN","PSOERXX2",6,0)
 Q:'HF
"RTN","PSOERXX2",7,0)
 I HF=1 D C S @GBL@(CNT,0)="<?xml version=""1.0"" encoding=""UTF-8""?><Message version=""010"" release=""006"" HighestVersionSupported="""" xmlns=""http://www.ncpdp.org/schema/SCRIPT"">" Q
"RTN","PSOERXX2",8,0)
 I HF=2 D C S @GBL@(CNT,0)="</Message>"
"RTN","PSOERXX2",9,0)
 Q
"RTN","PSOERXX2",10,0)
HDR(GBL,IEN) ;
"RTN","PSOERXX2",11,0)
 N F,TOQUAL,TOVAL,FRQUAL,FRVAL,MID,STIME,STERTID,RTERTID,PON,RETREC,REQREF,PSDAT,INST,SSECID,RSECID
"RTN","PSOERXX2",12,0)
 N RTMID
"RTN","PSOERXX2",13,0)
 S F=52.49
"RTN","PSOERXX2",14,0)
 S IENS=IEN_","
"RTN","PSOERXX2",15,0)
 D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX2",16,0)
 ; 'TO' values come from the 'FROM' fields of the eRx.
"RTN","PSOERXX2",17,0)
 S TOQUAL=$G(PSDAT(F,IENS,22.2,"I"))
"RTN","PSOERXX2",18,0)
 S TOVAL=$G(PSDAT(F,IENS,22.1,"E"))
"RTN","PSOERXX2",19,0)
 ; 'FROM' values come from the 'TO' fields of the eRx.
"RTN","PSOERXX2",20,0)
 S FRQUAL=$G(PSDAT(F,IENS,22.4,"I"))
"RTN","PSOERXX2",21,0)
 S FRVAL=$G(PSDAT(F,IENS,22.3,"E"))
"RTN","PSOERXX2",22,0)
 S INST=DUZ(2)
"RTN","PSOERXX2",23,0)
 ; message ID needs to be unique from vista - Site#.DUZ.erxIEN.date.time??
"RTN","PSOERXX2",24,0)
 S MID=INST_"."_DUZ_"."_PSOIEN_"."_$$NOW^XLFDT
"RTN","PSOERXX2",25,0)
 S RTMID=$G(PSDAT(F,IENS,25,"E"))
"RTN","PSOERXX2",26,0)
 ;
"RTN","PSOERXX2",27,0)
 S PON=$G(PSDAT(F,IENS,.09,"E"))
"RTN","PSOERXX2",28,0)
 ; return receipt and request reference # currenly not stored. Do we need to add a field in 52.49?
"RTN","PSOERXX2",29,0)
 S RETREC=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX2",30,0)
 S REQREF=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX2",31,0)
 S RETREC="ACA",REQREF=""
"RTN","PSOERXX2",32,0)
 S SSECID=$G(PSDAT(F,IENS,24.5,"E"))
"RTN","PSOERXX2",33,0)
 ; leaving this in place for now CH wanted the tertiary ID to be TECHNATOMY. I suspect this will
"RTN","PSOERXX2",34,0)
 ; need to be something different in the long run
"RTN","PSOERXX2",35,0)
 ;S STERTID=$G(PSDAT(F,IENS,24.6,"E"))
"RTN","PSOERXX2",36,0)
 S STERTID="TECHNATOMY"
"RTN","PSOERXX2",37,0)
 S RSECID=$G(PSDAT(F,IENS,24.3,"E"))
"RTN","PSOERXX2",38,0)
 ;S RTERTID=$G(PSDAT(F,IENS,24.4,"E"))
"RTN","PSOERXX2",39,0)
 S RTERTID="ERXPAD"
"RTN","PSOERXX2",40,0)
 D C S @GBL@(CNT,0)="<Header><To Qualifier="""_TOQUAL_""">"_TOVAL_"</To>"
"RTN","PSOERXX2",41,0)
 D C S @GBL@(CNT,0)="<From Qualifier="""_FRQUAL_""">"_FRVAL_"</From>"
"RTN","PSOERXX2",42,0)
 D C S @GBL@(CNT,0)="<MessageID>"_MID_"</MessageID>"
"RTN","PSOERXX2",43,0)
 I $L(RTMID) D C S @GBL@(CNT,0)="<RelatesToMessageID>"_RTMID_"</RelatesToMessageID>"
"RTN","PSOERXX2",44,0)
 D C S @GBL@(CNT,0)="<SentTime>"_$$EXTIME^PSOERXO1()_"</SentTime>"
"RTN","PSOERXX2",45,0)
 D C S @GBL@(CNT,0)="<Security>"
"RTN","PSOERXX2",46,0)
 ; todo -  missing UsernameToken
"RTN","PSOERXX2",47,0)
 D C S @GBL@(CNT,0)="<Sender>"
"RTN","PSOERXX2",48,0)
 ; for now we are not using secondary identifications, this will stay in place for future activation.
"RTN","PSOERXX2",49,0)
 ;I $L(SSECID) D C S @GBL@(CNT,0)="<SecondaryIdentification>"_SSECID_"</SecondaryIdentification>"
"RTN","PSOERXX2",50,0)
 I $L(STERTID) D C S @GBL@(CNT,0)="<TertiaryIdentification>"_STERTID_"</TertiaryIdentification>"
"RTN","PSOERXX2",51,0)
 D C S @GBL@(CNT,0)="</Sender>"
"RTN","PSOERXX2",52,0)
 D C S @GBL@(CNT,0)="<Receiver>"
"RTN","PSOERXX2",53,0)
 ;I $L(RSECID) D C S @GBL@(CNT,0)="<SecondaryIdentification>"_RSECID_"</SecondaryIdentification>"
"RTN","PSOERXX2",54,0)
 I $L(RTERTID) D C S @GBL@(CNT,0)="<TertiaryIdentification>"_RTERTID_"</TertiaryIdentification>"
"RTN","PSOERXX2",55,0)
 D C S @GBL@(CNT,0)="</Receiver>"
"RTN","PSOERXX2",56,0)
 D C S @GBL@(CNT,0)="</Security>"
"RTN","PSOERXX2",57,0)
 ; missing 'Mailbox' - note for future enhancement. Was not needed for CH certification.
"RTN","PSOERXX2",58,0)
 ;D C S @GBL@(CNT,0)="<PrescriberOrderNumber>"_PON_"</PrescriberOrderNumber>"
"RTN","PSOERXX2",59,0)
 I $L(PON) D C S @GBL@(CNT,0)="<RxReferenceNumber>"_PON_"</RxReferenceNumber>"
"RTN","PSOERXX2",60,0)
 D C S @GBL@(CNT,0)="</Header>"
"RTN","PSOERXX2",61,0)
 Q
"RTN","PSOERXX2",62,0)
 ; body header/footer
"RTN","PSOERXX2",63,0)
BHF(GBL,HF) ;
"RTN","PSOERXX2",64,0)
 Q:'$D(HF)
"RTN","PSOERXX2",65,0)
 D C
"RTN","PSOERXX2",66,0)
 S @GBL@(CNT,0)=$S(HF=1:"<Body>",HF=2:"</Body>",1:"")
"RTN","PSOERXX2",67,0)
 Q
"RTN","PSOERXX2",68,0)
 ;HF   1 - header
"RTN","PSOERXX2",69,0)
 ;     2 - footer
"RTN","PSOERXX2",70,0)
RTYPE(GBL,RTYPE,HF) ;
"RTN","PSOERXX2",71,0)
 Q:'HF
"RTN","PSOERXX2",72,0)
 D C
"RTN","PSOERXX2",73,0)
 S @GBL@(CNT,0)=$S(HF=1:"<"_RTYPE_">",HF=2:"</"_RTYPE_">",1:"")
"RTN","PSOERXX2",74,0)
 Q
"RTN","PSOERXX2",75,0)
REQUEST(GBL,RETREC,REQREF) ;
"RTN","PSOERXX2",76,0)
 D C S @GBL@(CNT,0)="<Request>"
"RTN","PSOERXX2",77,0)
 D C S @GBL@(CNT,0)="<ReturnReceipt>"_RETREC_"</ReturnReceipt>"
"RTN","PSOERXX2",78,0)
 D C S @GBL@(CNT,0)="<RequestReferenceNumber>"_REQREF_"</RequestReferenceNumber>"
"RTN","PSOERXX2",79,0)
 D C S @GBL@(CNT,0)="</Request>"
"RTN","PSOERXX2",80,0)
 Q
"RTN","PSOERXX2",81,0)
VAPHARM(GBL,PSOSITE,PSOIEN) ;
"RTN","PSOERXX2",82,0)
 N F,F2,NCPID,NPI,SPEC,LNAME,FNAME,MNAME,SUFF,PREF,STNM,ADDL1,ADDL2,CITY,STATE,PLQ,TELE,UIENS
"RTN","PSOERXX2",83,0)
 N PHIEN,PHIENS,EXPHIEN,EXPHIENS,PHARDAT,PHARDAT,PSDAT,AREA,FTELE,FULLNM,PDAT,PHRMCIST,SIENS
"RTN","PSOERXX2",84,0)
 N EIEN,EIENS,CMNUM,ID,IDTYP,IDVAL,CMVAL,CMQUAL
"RTN","PSOERXX2",85,0)
 S F=52.47,F2=52.48
"RTN","PSOERXX2",86,0)
 ; this is the vista pharmacy/pharmacist
"RTN","PSOERXX2",87,0)
 S EIEN=$$GET1^DIQ(52.49,PSOIEN,2.5,"I")
"RTN","PSOERXX2",88,0)
 S EIENS=EIEN_","
"RTN","PSOERXX2",89,0)
 S PHIEN=$$GET1^DIQ(52.49,PSOIEN,2.2,"I")
"RTN","PSOERXX2",90,0)
 S PHIENS=PHIEN_","
"RTN","PSOERXX2",91,0)
 D GETS^DIQ(F,EIENS,"**","IE","PHARDAT")
"RTN","PSOERXX2",92,0)
 S NCPID=$G(PHARDAT(F,EIENS,.02,"E"))
"RTN","PSOERXX2",93,0)
 D GETS^DIQ(F2,PHIENS,"**","IE","PHRMCIST")
"RTN","PSOERXX2",94,0)
 ;S FULLNM=$G(PHRMCIST(F2,UIENS,.01,"E"))
"RTN","PSOERXX2",95,0)
 S LNAME=$G(PHRMCIST(F2,PHIENS,.02,"E"))
"RTN","PSOERXX2",96,0)
 S FNAME=$G(PHRMCIST(F2,PHIENS,.03,"E"))
"RTN","PSOERXX2",97,0)
 S MNAME=$G(PHRMCIST(F2,PHIENS,.04,"E"))
"RTN","PSOERXX2",98,0)
 S SUFF=$G(PHRMCIST(F2,PHIENS,.05,"E"))
"RTN","PSOERXX2",99,0)
 S PREF=$G(PHRMCIST(F2,PHIENS,.06,"E"))
"RTN","PSOERXX2",100,0)
 S NPI=$G(PHRMCIST(F2,PHIENS,1.5,"E"))
"RTN","PSOERXX2",101,0)
 S STNM=$$SYMENC^MXMLUTL($G(PHARDAT(F,EIENS,.01,"E")))
"RTN","PSOERXX2",102,0)
 S ADDL1=$$SYMENC^MXMLUTL($G(PHARDAT(F,EIENS,1.1,"E")))
"RTN","PSOERXX2",103,0)
 S ADDL2=$$SYMENC^MXMLUTL($G(PHARDAT(F,EIENS,1.2,"E")))
"RTN","PSOERXX2",104,0)
 S CITY=$$SYMENC^MXMLUTL($G(PHARDAT(F,EIENS,1.3,"E")))
"RTN","PSOERXX2",105,0)
 S STATE=$G(PHARDAT(F,EIENS,1.4,"E"))
"RTN","PSOERXX2",106,0)
 S STATE=$$FIND1^DIC(5,,,STATE,"B") I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX2",107,0)
 S ZIP=$G(PHARDAT(F,EIENS,1.5,"E")),ZIP=$TR(ZIP,"-","")
"RTN","PSOERXX2",108,0)
 ; address missing from NewRx
"RTN","PSOERXX2",109,0)
 I '$L(ADDL1) D
"RTN","PSOERXX2",110,0)
 .S ADDL1=$$GET1^DIQ(59,PSOSITE,.02,"E")
"RTN","PSOERXX2",111,0)
 .S ADDL2=""
"RTN","PSOERXX2",112,0)
 .S CITY=$$GET1^DIQ(59,PSOSITE,.07,"E")
"RTN","PSOERXX2",113,0)
 .S STATE=$$GET1^DIQ(59,PSOSITE,.08,"I")
"RTN","PSOERXX2",114,0)
 .I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX2",115,0)
 .S ZIP=$E($$GET1^DIQ(59,PSOSITE,.05,"E"),1,5)
"RTN","PSOERXX2",116,0)
 D C S @GBL@(CNT,0)="<Pharmacy>"
"RTN","PSOERXX2",117,0)
 I $O(^PS(52.47,EIEN,2,0)) D
"RTN","PSOERXX2",118,0)
 .D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX2",119,0)
 .S ID=0 F  S ID=$O(^PS(52.47,EIEN,2,ID)) Q:'ID  D
"RTN","PSOERXX2",120,0)
 ..S IDTYP=$$GET1^DIQ(52.472,ID_","_EIEN_",",.01,"E")
"RTN","PSOERXX2",121,0)
 ..S IDVAL=$$GET1^DIQ(52.472,ID_","_EIEN_",",.02,"E")
"RTN","PSOERXX2",122,0)
 ..D C S @GBL@(CNT,0)="<"_IDTYP_">"_IDVAL_"</"_IDTYP_">"
"RTN","PSOERXX2",123,0)
 .D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX2",124,0)
 ;D C S @GBL@(CNT,0)="<Specialty>"_SPEC_"</Specialty>"
"RTN","PSOERXX2",125,0)
 I $L(LNAME) D
"RTN","PSOERXX2",126,0)
 .D C S @GBL@(CNT,0)="<Pharmacist>"
"RTN","PSOERXX2",127,0)
 .I $L(LNAME) D C S @GBL@(CNT,0)="<LastName>"_LNAME_"</LastName>"
"RTN","PSOERXX2",128,0)
 .I $L(FNAME) D C S @GBL@(CNT,0)="<FirstName>"_FNAME_"</FirstName>"
"RTN","PSOERXX2",129,0)
 .I $L(MNAME) D C S @GBL@(CNT,0)="<MiddleName>"_MNAME_"</MiddleName>"
"RTN","PSOERXX2",130,0)
 .I $L(SUFF) D C S @GBL@(CNT,0)="<Suffix>"_SUFF_"</Suffix>"
"RTN","PSOERXX2",131,0)
 .I $L(PREF) D C S @GBL@(CNT,0)="<Prefix>"_PREF_"</Prefix>"
"RTN","PSOERXX2",132,0)
 .D C S @GBL@(CNT,0)="</Pharmacist>"
"RTN","PSOERXX2",133,0)
 I $L(STNM) D C S @GBL@(CNT,0)="<StoreName>"_STNM_"</StoreName>"
"RTN","PSOERXX2",134,0)
 I $L(ADDL1)!($L(ADDL2))!($L(CITY))!($L(STATE))!($L(ZIP)) D
"RTN","PSOERXX2",135,0)
 .D C S @GBL@(CNT,0)="<Address>"
"RTN","PSOERXX2",136,0)
 .I $L(ADDL1) D C S @GBL@(CNT,0)="<AddressLine1>"_ADDL1_"</AddressLine1>"
"RTN","PSOERXX2",137,0)
 .I $L(ADDL2) D C S @GBL@(CNT,0)="<AddressLine2>"_ADDL2_"</AddressLine2>"
"RTN","PSOERXX2",138,0)
 .I $L(CITY) D C S @GBL@(CNT,0)="<City>"_CITY_"</City>"
"RTN","PSOERXX2",139,0)
 .I $L(STATE) D C S @GBL@(CNT,0)="<State>"_STATE_"</State>"
"RTN","PSOERXX2",140,0)
 .I $L(ZIP) D C S @GBL@(CNT,0)="<ZipCode>"_ZIP_"</ZipCode>"
"RTN","PSOERXX2",141,0)
 .;D C S @GBL@(CNT,0)="<PlaceLocationQualifier>"_PLQ_"</PlaceLocationQualifier>"
"RTN","PSOERXX2",142,0)
 .D C S @GBL@(CNT,0)="</Address>"
"RTN","PSOERXX2",143,0)
 I '$O(^PS(52.47,EIEN,3,0)) D
"RTN","PSOERXX2",144,0)
 .S CMVAL=$$GET1^DIQ(59,PSOIEN,.03,"E")
"RTN","PSOERXX2",145,0)
 .S CMVAL=CMVAL_$$GET1^DIQ(59,PSOIEN,.04,"E")
"RTN","PSOERXX2",146,0)
 .I '$L(CMVAL) S CMVAL="0000000000"
"RTN","PSOERXX2",147,0)
 .S CMVAL=$TR(CMVAL,"-","")
"RTN","PSOERXX2",148,0)
 .S CMQUAL="TE"
"RTN","PSOERXX2",149,0)
 .D C S @GBL@(CNT,0)="<CommunicationNumbers>"
"RTN","PSOERXX2",150,0)
 .D COMMNUM(.GBL,CMVAL,CMQUAL)
"RTN","PSOERXX2",151,0)
 .D COMMNUM(.GBL,"0000000000","FX")
"RTN","PSOERXX2",152,0)
 .D C S @GBL@(CNT,0)="</CommunicationNumbers>"
"RTN","PSOERXX2",153,0)
 I $O(^PS(52.47,EIEN,3,0)) D
"RTN","PSOERXX2",154,0)
 .D C S @GBL@(CNT,0)="<CommunicationNumbers>"
"RTN","PSOERXX2",155,0)
 .S CMNUM=0 F  S CMNUM=$O(^PS(52.47,EIEN,3,CMNUM)) Q:'CMNUM  D
"RTN","PSOERXX2",156,0)
 ..S CMVAL=$$GET1^DIQ(52.473,CMNUM_","_EIEN_",",.01,"E")
"RTN","PSOERXX2",157,0)
 ..S CMQUAL=$$GET1^DIQ(52.473,CMNUM_","_EIEN_",",.02,"I")
"RTN","PSOERXX2",158,0)
 ..D COMMNUM(.GBL,CMVAL,CMQUAL)
"RTN","PSOERXX2",159,0)
 .D C S @GBL@(CNT,0)="</CommunicationNumbers>"
"RTN","PSOERXX2",160,0)
 D C S @GBL@(CNT,0)="</Pharmacy>"
"RTN","PSOERXX2",161,0)
 Q
"RTN","PSOERXX2",162,0)
 ; GBL - global for xml storage
"RTN","PSOERXX2",163,0)
 ; IENS - ien string for the current entry
"RTN","PSOERXX2",164,0)
 ; FIL - top level file number
"RTN","PSOERXX2",165,0)
 ; SUBFIL - subfile number
"RTN","PSOERXX2",166,0)
COMMNUM(GBL,COMMNUM,QUAL) ;
"RTN","PSOERXX2",167,0)
 D C S @GBL@(CNT,0)="<Communication>"
"RTN","PSOERXX2",168,0)
 D C S @GBL@(CNT,0)="<Number>"_$$SYMENC^MXMLUTL(COMMNUM)_"</Number>"
"RTN","PSOERXX2",169,0)
 D C S @GBL@(CNT,0)="<Qualifier>"_QUAL_"</Qualifier>"
"RTN","PSOERXX2",170,0)
 D C S @GBL@(CNT,0)="</Communication>"
"RTN","PSOERXX2",171,0)
 Q
"RTN","PSOERXX2",172,0)
IDENT(GBL,TYPE,VAL) ;
"RTN","PSOERXX2",173,0)
 D C S @GBL@(CNT,0)="<"_TYPE_">"_VAL_"</"_TYPE_">"
"RTN","PSOERXX2",174,0)
 Q
"RTN","PSOERXX2",175,0)
 ; GBL - GLOBAL WHERE DATA IS STORED
"RTN","PSOERXX2",176,0)
 ; IEN - IEN TO 52.49
"RTN","PSOERXX2",177,0)
PRESCRIB(GBL,IEN) ;
"RTN","PSOERXX2",178,0)
 N F,DEAN,NPI,SPEC,CLINIC,LNAME,FNAME,MNAME,SUFF,PREF,ADDL1,ADDL2,CITY,STATE,ZIP,PLQ,ALNAME,AFNAME,AMNAME,ASUFF,APREF
"RTN","PSOERXX2",179,0)
 N PSDAT,CLOOP,CNUM,CQUAL,ILOOP,ITYP,IVAL,PIEN,PIENS
"RTN","PSOERXX2",180,0)
 S F=52.48,IENS=IEN_","
"RTN","PSOERXX2",181,0)
 S PIEN=$$GET1^DIQ(52.49,IEN,2.1,"I") Q:'PIEN
"RTN","PSOERXX2",182,0)
 S PIENS=PIEN_","
"RTN","PSOERXX2",183,0)
 D GETS^DIQ(F,PIENS,"**","IE","PSDAT")
"RTN","PSOERXX2",184,0)
 S DEAN=$G(PSDAT(F,PIENS,1.6,"E"))
"RTN","PSOERXX2",185,0)
 S NPI=$G(PSDAT(F,PIENS,1.5,"E"))
"RTN","PSOERXX2",186,0)
 S SPEC=$G(PSDAT(F,PIENS,1.2,"E"))
"RTN","PSOERXX2",187,0)
 S CLINIC=$G(PSDAT(F,PIENS,2.1,"E"))
"RTN","PSOERXX2",188,0)
 S LNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.02,"E")))
"RTN","PSOERXX2",189,0)
 S FNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.03,"E")))
"RTN","PSOERXX2",190,0)
 S MNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.04,"E")))
"RTN","PSOERXX2",191,0)
 S SUFF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.05,"E")))
"RTN","PSOERXX2",192,0)
 S PREF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.06,"E")))
"RTN","PSOERXX2",193,0)
 S ADDL1=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,4.1,"E")))
"RTN","PSOERXX2",194,0)
 S ADDL2=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,4.2,"E")))
"RTN","PSOERXX2",195,0)
 S CITY=$G(PSDAT(F,PIENS,4.3,"E"))
"RTN","PSOERXX2",196,0)
 S STATE=$G(PSDAT(F,PIENS,4.4,"I"))
"RTN","PSOERXX2",197,0)
 I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX2",198,0)
 S ZIP=$G(PSDAT(F,PIENS,4.5,"E"))
"RTN","PSOERXX2",199,0)
 S PLQ=$G(PSDAT(F,PIENS,2.2,"E"))
"RTN","PSOERXX2",200,0)
 S ALNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,5.1,"E")))
"RTN","PSOERXX2",201,0)
 S AFNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,5.2,"E")))
"RTN","PSOERXX2",202,0)
 S AMNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,5.3,"E")))
"RTN","PSOERXX2",203,0)
 S ASUFF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,5.4,"E")))
"RTN","PSOERXX2",204,0)
 S APREF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,5.5,"E")))
"RTN","PSOERXX2",205,0)
 D C S @GBL@(CNT,0)="<Prescriber>"
"RTN","PSOERXX2",206,0)
 I $O(^PS(52.48,PIEN,6,0)) D
"RTN","PSOERXX2",207,0)
 .D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX2",208,0)
 .S ILOOP=0 F  S ILOOP=$O(^PS(52.48,PIEN,6,ILOOP)) Q:'ILOOP  D
"RTN","PSOERXX2",209,0)
 ..S ITYP=$$GET1^DIQ(52.486,ILOOP_","_PIENS,.01,"E")
"RTN","PSOERXX2",210,0)
 ..S IVAL=$$GET1^DIQ(52.486,ILOOP_","_PIENS,.02,"E")
"RTN","PSOERXX2",211,0)
 ..D IDENT(.GBL,ITYP,IVAL)
"RTN","PSOERXX2",212,0)
 .D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX2",213,0)
 I $L(SPEC) D C S @GBL@(CNT,0)="<Specialty>"_SPEC_"</Specialty>" ; ***SLASH AT THE END???
"RTN","PSOERXX2",214,0)
 I $L(CLINIC) D C S @GBL@(CNT,0)="<ClinicName>"_CLINIC_"</ClinicName>" ; ***SLASH AT THE END???
"RTN","PSOERXX2",215,0)
 D C S @GBL@(CNT,0)="<Name>"
"RTN","PSOERXX2",216,0)
 I $L(LNAME) D C S @GBL@(CNT,0)="<LastName>"_LNAME_"</LastName>"
"RTN","PSOERXX2",217,0)
 I $L(FNAME) D C S @GBL@(CNT,0)="<FirstName>"_FNAME_"</FirstName>"
"RTN","PSOERXX2",218,0)
 I $L(MNAME) D C S @GBL@(CNT,0)="<MiddleName>"_MNAME_"</MiddleName>"
"RTN","PSOERXX2",219,0)
 I $L(SUFF) D C S @GBL@(CNT,0)="<Suffix>"_SUFF_"</Suffix>"
"RTN","PSOERXX2",220,0)
 I $L(PREF) D C S @GBL@(CNT,0)="<Prefix>"_PREF_"</Prefix>"
"RTN","PSOERXX2",221,0)
 D C S @GBL@(CNT,0)="</Name>"
"RTN","PSOERXX2",222,0)
 D C S @GBL@(CNT,0)="<Address>"
"RTN","PSOERXX2",223,0)
 I $L(ADDL1) D C S @GBL@(CNT,0)="<AddressLine1>"_ADDL1_"</AddressLine1>"
"RTN","PSOERXX2",224,0)
 I $L(ADDL2) D C S @GBL@(CNT,0)="<AddressLine2>"_ADDL2_"</AddressLine2>"
"RTN","PSOERXX2",225,0)
 I $L(CITY) D C S @GBL@(CNT,0)="<City>"_CITY_"</City>"
"RTN","PSOERXX2",226,0)
 I $L(STATE) D C S @GBL@(CNT,0)="<State>"_STATE_"</State>"
"RTN","PSOERXX2",227,0)
 I $L(ZIP) D C S @GBL@(CNT,0)="<ZipCode>"_ZIP_"</ZipCode>"
"RTN","PSOERXX2",228,0)
 I $L(PLQ) D C S @GBL@(CNT,0)="<PlaceLocationQualifier>"_PLQ_"</PlaceLocationQualifier>"
"RTN","PSOERXX2",229,0)
 D C S @GBL@(CNT,0)="</Address>"
"RTN","PSOERXX2",230,0)
 I $O(^PS(52.48,PIEN,3,0)) D
"RTN","PSOERXX2",231,0)
 .D C S @GBL@(CNT,0)="<CommunicationNumbers>"
"RTN","PSOERXX2",232,0)
 .S CLOOP=0 F  S CLOOP=$O(^PS(52.48,PIEN,3,CLOOP)) Q:'CLOOP  D
"RTN","PSOERXX2",233,0)
 ..S CNUM=$$GET1^DIQ(52.483,CLOOP_","_PIENS,.01,"E")
"RTN","PSOERXX2",234,0)
 ..S CQUAL=$$GET1^DIQ(52.483,CLOOP_","_PIENS,.02,"I")
"RTN","PSOERXX2",235,0)
 ..D COMMNUM(.GBL,CNUM,CQUAL)
"RTN","PSOERXX2",236,0)
 .D C S @GBL@(CNT,0)="</CommunicationNumbers>"
"RTN","PSOERXX2",237,0)
 I $L(ALNAME) D
"RTN","PSOERXX2",238,0)
 .D C S @GBL@(CNT,0)="<PrescriberAgent>"
"RTN","PSOERXX2",239,0)
 .I $L(ALNAME) D C S @GBL@(CNT,0)="<LastName>"_ALNAME_"</LastName>"
"RTN","PSOERXX2",240,0)
 .I $L(AFNAME) D C S @GBL@(CNT,0)="<FirstName>"_AFNAME_"</FirstName>"
"RTN","PSOERXX2",241,0)
 .I $L(AMNAME) D C S @GBL@(CNT,0)="<MiddleName>"_AMNAME_"</MiddleName>"
"RTN","PSOERXX2",242,0)
 .I $L(ASUFF) D C S @GBL@(CNT,0)="<Suffix>"_ASUFF_"</Suffix>"
"RTN","PSOERXX2",243,0)
 .I $L(APREF) D C S @GBL@(CNT,0)="<Prefix>"_APREF_"</Prefix>"
"RTN","PSOERXX2",244,0)
 .D C S @GBL@(CNT,0)="</PrescriberAgent>"
"RTN","PSOERXX2",245,0)
 D C S @GBL@(CNT,0)="</Prescriber>"
"RTN","PSOERXX2",246,0)
 Q
"RTN","PSOERXX2",247,0)
SUPERVIS(GBL,IEN) ;
"RTN","PSOERXX2",248,0)
 N F,SLN,DEAN,SPEC,LNAME,FNAME,MNAME,SUFF,PREF,CLNAME,ADDL1,ADDL2,CITY,STATE,ZIP,PLQ,PSDAT,ILOOP,ITYP,IVAL
"RTN","PSOERXX2",249,0)
 N SIEN,SIENS
"RTN","PSOERXX2",250,0)
 S F=52.48
"RTN","PSOERXX2",251,0)
 S IENS=IEN_","
"RTN","PSOERXX2",252,0)
 S SIEN=$$GET1^DIQ(52.49,IEN,2.6,"I") Q:'SIEN
"RTN","PSOERXX2",253,0)
 S SIENS=SIEN_","
"RTN","PSOERXX2",254,0)
 D GETS^DIQ(F,SIENS,"**","IE","PSDAT")
"RTN","PSOERXX2",255,0)
 S SLN=$G(PSDAT(F,SIENS,1.8,"E"))
"RTN","PSOERXX2",256,0)
 S DEAN=$G(PSDAT(F,SIENS,1.6,"E"))
"RTN","PSOERXX2",257,0)
 S SPEC=$G(PSDAT(F,SIENS,1.2,"E"))
"RTN","PSOERXX2",258,0)
 S LNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,.02,"E")))
"RTN","PSOERXX2",259,0)
 S FNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,.03,"E")))
"RTN","PSOERXX2",260,0)
 S MNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,.04,"E")))
"RTN","PSOERXX2",261,0)
 S SUFF=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,.05,"E")))
"RTN","PSOERXX2",262,0)
 S PREF=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,.06,"E")))
"RTN","PSOERXX2",263,0)
 S CLNAME=$G(PSDAT(F,SIENS,2.1,"E"))
"RTN","PSOERXX2",264,0)
 S ADDL1=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,4.1,"E")))
"RTN","PSOERXX2",265,0)
 S ADDL2=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,4.2,"E")))
"RTN","PSOERXX2",266,0)
 S CITY=$$SYMENC^MXMLUTL($G(PSDAT(F,SIENS,4.3,"E")))
"RTN","PSOERXX2",267,0)
 S STATE=$G(PSDAT(F,SIENS,4.4,"I"))
"RTN","PSOERXX2",268,0)
 I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX2",269,0)
 S ZIP=$G(PSDAT(F,SIENS,4.5,"E"))
"RTN","PSOERXX2",270,0)
 S PLQ=$G(PSDAT(F,SIENS,2.2,"E"))
"RTN","PSOERXX2",271,0)
 D C S @GBL@(CNT,0)="<Supervisor>"
"RTN","PSOERXX2",272,0)
 I $O(^PS(52.48,SIEN,6,0)) D
"RTN","PSOERXX2",273,0)
 .D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX2",274,0)
 .S ILOOP=0 F  S ILOOP=$O(^PS(52.48,SIEN,6,ILOOP)) Q:'ILOOP  D
"RTN","PSOERXX2",275,0)
 ..S ITYP=$$GET1^DIQ(52.486,ILOOP_","_SIENS,.01,"E")
"RTN","PSOERXX2",276,0)
 ..S IVAL=$$GET1^DIQ(52.486,ILOOP_","_SIENS,.02,"E")
"RTN","PSOERXX2",277,0)
 ..D IDENT(.GBL,ITYP,IVAL)
"RTN","PSOERXX2",278,0)
 .D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX2",279,0)
 D C S @GBL@(CNT,0)="<Specialty>"_SPEC_"</Specialty>"
"RTN","PSOERXX2",280,0)
 D C S @GBL@(CNT,0)="<Name>"
"RTN","PSOERXX2",281,0)
 D C S @GBL@(CNT,0)="<LastName>"_LNAME_"</LastName>"
"RTN","PSOERXX2",282,0)
 D C S @GBL@(CNT,0)="<FirstName>"_FNAME_"</FirstName>"
"RTN","PSOERXX2",283,0)
 D C S @GBL@(CNT,0)="<MiddleName>"_MNAME_"</MiddleName>"
"RTN","PSOERXX2",284,0)
 D C S @GBL@(CNT,0)="<Suffix>"_SUFF_"</Suffix>"
"RTN","PSOERXX2",285,0)
 D C S @GBL@(CNT,0)="<Prefix>"_PREF_"</Prefix>"
"RTN","PSOERXX2",286,0)
 D C S @GBL@(CNT,0)="</Name>"
"RTN","PSOERXX2",287,0)
 D C S @GBL@(CNT,0)="<ClinicName>"_CLNAME_"</ClinicName>"
"RTN","PSOERXX2",288,0)
 D C S @GBL@(CNT,0)="<Address>"
"RTN","PSOERXX2",289,0)
 D C S @GBL@(CNT,0)="<AddressLine1>"_ADDL1_"</AddressLine1>"
"RTN","PSOERXX2",290,0)
 D C S @GBL@(CNT,0)="<AddressLine2>"_ADDL2_"</AddressLine2>"
"RTN","PSOERXX2",291,0)
 D C S @GBL@(CNT,0)="<City>"_CITY_"</City>"
"RTN","PSOERXX2",292,0)
 D C S @GBL@(CNT,0)="<State>"_STATE_"</State>"
"RTN","PSOERXX2",293,0)
 I $L(ZIP) D C S @GBL@(CNT,0)="<ZipCode>"_ZIP_"</ZipCode>"
"RTN","PSOERXX2",294,0)
 D C S @GBL@(CNT,0)="<PlaceLocationQualifier>"_PLQ_"</PlaceLocationQualifier>"
"RTN","PSOERXX2",295,0)
 D C S @GBL@(CNT,0)="</Address>"
"RTN","PSOERXX2",296,0)
 D C S @GBL@(CNT,0)="<CommunicationNumbers>"
"RTN","PSOERXX2",297,0)
 S CLOOP=0 F  S CLOOP=$O(^PS(52.48,SIEN,3,CLOOP)) Q:'CLOOP  D
"RTN","PSOERXX2",298,0)
 .S CNUM=$$GET1^DIQ(52.483,CLOOP_","_SIENS,.01,"E")
"RTN","PSOERXX2",299,0)
 .S CQUAL=$$GET1^DIQ(52.483,CLOOP_","_SIENS,.02,"I")
"RTN","PSOERXX2",300,0)
 .D COMMNUM(.GBL,CNUM,CQUAL)
"RTN","PSOERXX2",301,0)
 ; ***COMMUNICATION NUMBERS***
"RTN","PSOERXX2",302,0)
 D C S @GBL@(CNT,0)="</CommunicationNumbers>"
"RTN","PSOERXX2",303,0)
 D C S @GBL@(CNT,0)="</Supervisor>"
"RTN","PSOERXX2",304,0)
 Q
"RTN","PSOERXX2",305,0)
FACIL(GBL,IENS) ;
"RTN","PSOERXX2",306,0)
 N F,NPI,NAME,ADDL1,ADDL2,CITY,STATE,ZIP,PLQ,PSDAT
"RTN","PSOERXX2",307,0)
 S F=52.49
"RTN","PSOERXX2",308,0)
 ; FOR NOW, JUST BUILD HEADER AND FOOTER
"RTN","PSOERXX2",309,0)
 Q
"RTN","PSOERXX2",310,0)
 D C S @GBL@(CNT,0)="<Facility>"
"RTN","PSOERXX2",311,0)
 D C S @GBL@(CNT,0)="</Facility>"
"RTN","PSOERXX2",312,0)
 Q
"RTN","PSOERXX2",313,0)
 ; complete this as a future enhancement
"RTN","PSOERXX2",314,0)
 D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX2",315,0)
 S NPI=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX2",316,0)
 S NAME=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,1,"E")))
"RTN","PSOERXX2",317,0)
 S ADDL1=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,1,"E")))
"RTN","PSOERXX2",318,0)
 S ADDL2=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,1,"E")))
"RTN","PSOERXX2",319,0)
 S CITY=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,1,"E")))
"RTN","PSOERXX2",320,0)
 S STATE=$G(PSDAT(F,IENS,1,"I"))
"RTN","PSOERXX2",321,0)
 I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX2",322,0)
 S ZIP=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX2",323,0)
 S PLQ=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX2",324,0)
 D C S @GBL@(CNT,0)="<Facility>"
"RTN","PSOERXX2",325,0)
 I $L(NPI) D
"RTN","PSOERXX2",326,0)
 .D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX2",327,0)
 .D C S @GBL@(CNT,0)="<NPI>"_NPI_"<NPI>"
"RTN","PSOERXX2",328,0)
 .D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX2",329,0)
 D C S @GBL@(CNT,0)="<FacilityName>"_NAME_"</FacilityName>"
"RTN","PSOERXX2",330,0)
 D C S @GBL@(CNT,0)="<Address>"
"RTN","PSOERXX2",331,0)
 D C S @GBL@(CNT,0)="<AddressLine1>"_ADDL1_"</AddressLine1>"
"RTN","PSOERXX2",332,0)
 D C S @GBL@(CNT,0)="<AddressLine2>"_ADDL2_"</AddressLine2>"
"RTN","PSOERXX2",333,0)
 D C S @GBL@(CNT,0)="<City>"_CITY_"</City>"
"RTN","PSOERXX2",334,0)
 D C S @GBL@(CNT,0)="<State>"_STATE_"</State>"
"RTN","PSOERXX2",335,0)
 I $L(ZIP) D C S @GBL@(CNT,0)="<ZipCode>"_ZIP_"</ZipCode>"
"RTN","PSOERXX2",336,0)
 D C S @GBL@(CNT,0)="<PlaceLocationQualifier>"_PLQ_"</PlaceLocationQualifier>"
"RTN","PSOERXX2",337,0)
 D C S @GBL@(CNT,0)="</Address>"
"RTN","PSOERXX2",338,0)
 ;***COMMUNICATION NUMBERS
"RTN","PSOERXX2",339,0)
 D C S @GBL@(CNT,0)="</Facility>"
"RTN","PSOERXX2",340,0)
 Q
"RTN","PSOERXX2",341,0)
C ;
"RTN","PSOERXX2",342,0)
 S CNT=$G(CNT)+1
"RTN","PSOERXX2",343,0)
 Q
"RTN","PSOERXX3")
0^16^B81556769^n/a
"RTN","PSOERXX3",1,0)
PSOERXX3 ;ALB/BWF - eRx xml utilities ; 8/3/2016 5:14pm
"RTN","PSOERXX3",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXX3",3,0)
 ;
"RTN","PSOERXX3",4,0)
 Q
"RTN","PSOERXX3",5,0)
PATIENT(GBL,IEN) ;
"RTN","PSOERXX3",6,0)
 N F,PATREL,LNAME,FNAME,MNAME,SUFF,PREF,GENDER,DOB,ADDL1,ADDL2,CITY,STATE,ZIP,PLQ,CUNIT,BED,ROOM,PSDAT,ILOOP
"RTN","PSOERXX3",7,0)
 N ITYP,IVAL,CLOOP,CNUM,CQUAL,PIEN,PIENS,PSSN
"RTN","PSOERXX3",8,0)
 S F=52.46
"RTN","PSOERXX3",9,0)
 S PIEN=$$GET1^DIQ(52.49,IEN,.04,"I") Q:'PIEN
"RTN","PSOERXX3",10,0)
 S PIENS=PIEN_","
"RTN","PSOERXX3",11,0)
 D GETS^DIQ(F,PIENS,"**","IE","PSDAT")
"RTN","PSOERXX3",12,0)
 S PATREL=$G(PSDAT(F,PIENS,1.7,"I"))
"RTN","PSOERXX3",13,0)
 S LNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.02,"E")))
"RTN","PSOERXX3",14,0)
 S FNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.03,"E")))
"RTN","PSOERXX3",15,0)
 S MNAME=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.04,"E")))
"RTN","PSOERXX3",16,0)
 S SUFF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.05,"E")))
"RTN","PSOERXX3",17,0)
 S PREF=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,.06,"E")))
"RTN","PSOERXX3",18,0)
 S GENDER=$G(PSDAT(F,PIENS,.07,"I"))
"RTN","PSOERXX3",19,0)
 ; DOB NEEDS TO BE CONVERTED
"RTN","PSOERXX3",20,0)
 S DOB=$G(PSDAT(F,PIENS,.08,"I")) I DOB S DOB=$P($$EXTIME^PSOERXO1(DOB),"T")
"RTN","PSOERXX3",21,0)
 S ADDL1=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,3.1,"E")))
"RTN","PSOERXX3",22,0)
 S ADDL2=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,3.2,"E")))
"RTN","PSOERXX3",23,0)
 S CITY=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,3.3,"E")))
"RTN","PSOERXX3",24,0)
 S STATE=$G(PSDAT(F,PIENS,3.4,"I"))
"RTN","PSOERXX3",25,0)
 I STATE S STATE=$$GET1^DIQ(5,STATE,1,"E")
"RTN","PSOERXX3",26,0)
 S ZIP=$G(PSDAT(F,PIENS,3.5,"E"))
"RTN","PSOERXX3",27,0)
 S PLQ=$G(PSDAT(F,PIENS,1.6,"E"))
"RTN","PSOERXX3",28,0)
 S PSSN=$G(PSDAT(F,PIENS,1.4,"E"))
"RTN","PSOERXX3",29,0)
 ; FUTURE ENHANCEMENT, GRAB CUNIT/BED/ROOM FROM CORRECT LOCATIONS. THIS LOGIC IS NOT ACTIVE WITH VERSION 2 
"RTN","PSOERXX3",30,0)
 S CUNIT=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,1,"E")))
"RTN","PSOERXX3",31,0)
 S BED=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,1,"E")))
"RTN","PSOERXX3",32,0)
 S ROOM=$$SYMENC^MXMLUTL($G(PSDAT(F,PIENS,1,"E")))
"RTN","PSOERXX3",33,0)
 D C S @GBL@(CNT,0)="<Patient>"
"RTN","PSOERXX3",34,0)
 I $L(PATREL) D C S @GBL@(CNT,0)="<PatientRelationship>"_PATREL_"</PatientRelationship>"
"RTN","PSOERXX3",35,0)
 I '$O(^PS(52.46,PIEN,5,0)) D
"RTN","PSOERXX3",36,0)
 .I PSSN D
"RTN","PSOERXX3",37,0)
 ..D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX3",38,0)
 ..D C S @GBL@(CNT,0)="<SocialSecurity>"_PSSN_"</SocialSecurity>"
"RTN","PSOERXX3",39,0)
 ..D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX3",40,0)
 I $O(^PS(52.46,PIEN,5,0)) D
"RTN","PSOERXX3",41,0)
 .D C S @GBL@(CNT,0)="<Identification>"
"RTN","PSOERXX3",42,0)
 .S ILOOP=0 F  S ILOOP=$O(^PS(52.46,PIEN,5,ILOOP)) Q:'ILOOP  D
"RTN","PSOERXX3",43,0)
 ..S ITYP=$$GET1^DIQ(52.465,ILOOP_","_PIENS,.01,"E")
"RTN","PSOERXX3",44,0)
 ..S IVAL=$$GET1^DIQ(52.465,ILOOP_","_PIENS,.02,"E")
"RTN","PSOERXX3",45,0)
 ..D IDENT^PSOERXX2(.GBL,ITYP,IVAL)
"RTN","PSOERXX3",46,0)
 .D C S @GBL@(CNT,0)="</Identification>"
"RTN","PSOERXX3",47,0)
 D C S @GBL@(CNT,0)="<Name>"
"RTN","PSOERXX3",48,0)
 I $L(LNAME) D C S @GBL@(CNT,0)="<LastName>"_LNAME_"</LastName>"
"RTN","PSOERXX3",49,0)
 I $L(FNAME) D C S @GBL@(CNT,0)="<FirstName>"_FNAME_"</FirstName>"
"RTN","PSOERXX3",50,0)
 I $L(MNAME) D C S @GBL@(CNT,0)="<MiddleName>"_MNAME_"</MiddleName>"
"RTN","PSOERXX3",51,0)
 I $L(SUFF) D C S @GBL@(CNT,0)="<Suffix>"_SUFF_"</Suffix>"
"RTN","PSOERXX3",52,0)
 I $L(PREF) D C S @GBL@(CNT,0)="<Prefix>"_PREF_"</Prefix>"
"RTN","PSOERXX3",53,0)
 D C S @GBL@(CNT,0)="</Name>"
"RTN","PSOERXX3",54,0)
 I $L(GENDER) D C S @GBL@(CNT,0)="<Gender>"_GENDER_"</Gender>"
"RTN","PSOERXX3",55,0)
 I $L(DOB) D
"RTN","PSOERXX3",56,0)
 .D C S @GBL@(CNT,0)="<DateOfBirth>"
"RTN","PSOERXX3",57,0)
 .D C S @GBL@(CNT,0)="<Date>"_DOB_"</Date>"
"RTN","PSOERXX3",58,0)
 .D C S @GBL@(CNT,0)="</DateOfBirth>"
"RTN","PSOERXX3",59,0)
 I $L(ADDL1) D
"RTN","PSOERXX3",60,0)
 .D C S @GBL@(CNT,0)="<Address>"
"RTN","PSOERXX3",61,0)
 .I $L(ADDL1) D C S @GBL@(CNT,0)="<AddressLine1>"_ADDL1_"</AddressLine1>"
"RTN","PSOERXX3",62,0)
 .I $L(ADDL2) D C S @GBL@(CNT,0)="<AddressLine2>"_ADDL2_"</AddressLine2>"
"RTN","PSOERXX3",63,0)
 .I $L(CITY) D C S @GBL@(CNT,0)="<City>"_CITY_"</City>"
"RTN","PSOERXX3",64,0)
 .I $L(STATE) D C S @GBL@(CNT,0)="<State>"_STATE_"</State>"
"RTN","PSOERXX3",65,0)
 .I $L(ZIP) D C S @GBL@(CNT,0)="<ZipCode>"_ZIP_"</ZipCode>"
"RTN","PSOERXX3",66,0)
 .I $L(PLQ) D C S @GBL@(CNT,0)="<PlaceLocationQualifier>"_PLQ_"</PlaceLocationQualifier>"
"RTN","PSOERXX3",67,0)
 .D C S @GBL@(CNT,0)="</Address>"
"RTN","PSOERXX3",68,0)
 I $O(^PS(52.46,PIEN,3,0)) D
"RTN","PSOERXX3",69,0)
 .D C S @GBL@(CNT,0)="<CommunicationNumbers>"
"RTN","PSOERXX3",70,0)
 .S CLOOP=0 F  S CLOOP=$O(^PS(52.46,PIEN,3,CLOOP)) Q:'CLOOP  D
"RTN","PSOERXX3",71,0)
 ..S CNUM=$$GET1^DIQ(52.462,CLOOP_","_PIENS,.01,"E")
"RTN","PSOERXX3",72,0)
 ..S CQUAL=$$GET1^DIQ(52.462,CLOOP_","_PIENS,.02,"I")
"RTN","PSOERXX3",73,0)
 ..D COMMNUM^PSOERXX2(.GBL,CNUM,CQUAL)
"RTN","PSOERXX3",74,0)
 .D C S @GBL@(CNT,0)="</CommunicationNumbers>"
"RTN","PSOERXX3",75,0)
 I $L(CUNIT)!($L(BED))!($L(ROOM)) D
"RTN","PSOERXX3",76,0)
 .D C S @GBL@(CNT,0)="<PatientLocation>"
"RTN","PSOERXX3",77,0)
 .I $L(CUNIT) D C S @GBL@(CNT,0)="<FacilityUnit>"_CUNIT_"</FacilityUnit>"
"RTN","PSOERXX3",78,0)
 .I $L(BED) D C S @GBL@(CNT,0)="<Bed>"_BED_"</Bed>"
"RTN","PSOERXX3",79,0)
 .I $L(ROOM) D C S @GBL@(CNT,0)="<Room>"_ROOM_"</Room>"
"RTN","PSOERXX3",80,0)
 .D C S @GBL@(CNT,0)="</PatientLocation>"
"RTN","PSOERXX3",81,0)
 D C S @GBL@(CNT,0)="</Patient>"
"RTN","PSOERXX3",82,0)
 Q
"RTN","PSOERXX3",83,0)
FILLST(GBL,FTYPE,FNOTE) ;
"RTN","PSOERXX3",84,0)
 D C S @GBL@(CNT,0)="<FillStatus>"
"RTN","PSOERXX3",85,0)
 D C S @GBL@(CNT,0)=$S(FTYPE="F":"<Filled>",FTYPE="P":"<PartialFill>",1:"")
"RTN","PSOERXX3",86,0)
 D C S @GBL@(CNT,0)="<Note>"_FNOTE_"</Note>"
"RTN","PSOERXX3",87,0)
 D C S @GBL@(CNT,0)=$S(FTYPE="F":"</Filled>",FTYPE="P":"</PartialFill>",1:"")
"RTN","PSOERXX3",88,0)
 D C S @GBL@(CNT,0)="</FillStatus>"
"RTN","PSOERXX3",89,0)
 Q
"RTN","PSOERXX3",90,0)
BENEFITS(GBL,IEN) ;
"RTN","PSOERXX3",91,0)
 N F,NCPDPID,NCPDPID,PAYNAME,CARDID,LNAME,FNAME,MNAME,SUFF,PREF,GID,PSDAT,BIENS,BLOOP
"RTN","PSOERXX3",92,0)
 S IENS=IEN_","
"RTN","PSOERXX3",93,0)
 S F=52.4918
"RTN","PSOERXX3",94,0)
 I '$O(^PS(52.49,IEN,18,0)) Q
"RTN","PSOERXX3",95,0)
 D C S @GBL@(CNT,0)="<BenefitsCoordination>"
"RTN","PSOERXX3",96,0)
 S BLOOP=0 F  S BLOOP=$O(^PS(52.49,IEN,18,BLOOP)) Q:'BLOOP  D
"RTN","PSOERXX3",97,0)
 .S BIENS=BLOOP_","_IENS
"RTN","PSOERXX3",98,0)
 .D GETS^DIQ(F,BIENS,"**","IE","PSDAT")
"RTN","PSOERXX3",99,0)
 .; FUTURE ENHANCEMENT - the IDENTIFICATION multiple is where the NCPDPID info belongs, USE IDENTIFICATION MULTIPLE IN THE PAYER SUBFILE
"RTN","PSOERXX3",100,0)
 .;S NCPDPID=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",101,0)
 .;FUTURE ENHANCEMENT - STORE PAYER NAME DIFFERENTLY AN..35
"RTN","PSOERXX3",102,0)
 .S PAYNAME=$E($G(PSDAT(F,BIENS,.03,"E")),1,35)
"RTN","PSOERXX3",103,0)
 .S CARDID=$G(PSDAT(F,BIENS,.01,"E"))
"RTN","PSOERXX3",104,0)
 .S LNAME=$G(PSDAT(F,BIENS,1,"E"))
"RTN","PSOERXX3",105,0)
 .S FNAME=$G(PSDAT(F,BIENS,2,"E"))
"RTN","PSOERXX3",106,0)
 .S MNAME=$G(PSDAT(F,BIENS,3,"E"))
"RTN","PSOERXX3",107,0)
 .S SUFF=$G(PSDAT(F,BIENS,4,"E"))
"RTN","PSOERXX3",108,0)
 .S PREF=$G(PSDAT(F,BIENS,5,"E"))
"RTN","PSOERXX3",109,0)
 .S GID=$G(PSDAT(F,BIENS,.02,"E"))
"RTN","PSOERXX3",110,0)
 .; FUTURE ENHANCEMENT, INCLUDE PAYER IDENTIFICATION INFORMATION
"RTN","PSOERXX3",111,0)
 .;D C S @GBL@(CNT,0)="<PayerIdentification>"
"RTN","PSOERXX3",112,0)
 .;S IDLOOP=0 F  S IDLOOP=$O(^PS(52.49,IEN,18,BLOOP,6,IDLOOP)) Q:'IDLOOP  D
"RTN","PSOERXX3",113,0)
 .;.S ITYP=$$GET1^DIQ(52.49186,IDLOOP_","_BLOOP_","_IENS,.01,"E")
"RTN","PSOERXX3",114,0)
 .;.S IVAL=$$GET1^DIQ(52.49186,IDLOOP_","_BLOOP_","_IENS,.02,"E")
"RTN","PSOERXX3",115,0)
 .;.D IDENT(.GBL,ITYP,IVAL)
"RTN","PSOERXX3",116,0)
 .;D C S @GBL@(CNT,0)="</PayerIdentification>"
"RTN","PSOERXX3",117,0)
 .;D C S @GBL@(CNT,0)="<PayerName>"_PAYNAME_"</PayerName>"
"RTN","PSOERXX3",118,0)
 .I $L(CARDID) D C S @GBL@(CNT,0)="<CardholderID>"_CARDID_"</CardholderID>"
"RTN","PSOERXX3",119,0)
 .D C S @GBL@(CNT,0)="<CardHolderName>"
"RTN","PSOERXX3",120,0)
 .I $L(LNAME) D C S @GBL@(CNT,0)="<LastName>"_LNAME_"</LastName>"
"RTN","PSOERXX3",121,0)
 .I $L(FNAME) D C S @GBL@(CNT,0)="<FirstName>"_FNAME_"</FirstName>"
"RTN","PSOERXX3",122,0)
 .I $L(MNAME) D C S @GBL@(CNT,0)="<MiddleName>"_MNAME_"</MiddleName>"
"RTN","PSOERXX3",123,0)
 .I $L(SUFF) D C S @GBL@(CNT,0)="<Suffix>"_SUFF_"</Suffix>"
"RTN","PSOERXX3",124,0)
 .I $L(PREF) D C S @GBL@(CNT,0)="<Prefix>"_PREF_"</Prefix>"
"RTN","PSOERXX3",125,0)
 .D C S @GBL@(CNT,0)="</CardHolderName>"
"RTN","PSOERXX3",126,0)
 .I $L(GID) D C S @GBL@(CNT,0)="<GroupID>"_GID_"</GroupID>"
"RTN","PSOERXX3",127,0)
 D C S @GBL@(CNT,0)="</BenefitsCoordination>"
"RTN","PSOERXX3",128,0)
 Q
"RTN","PSOERXX3",129,0)
OBSERVE(GBL,IEN) ;
"RTN","PSOERXX3",130,0)
 N F,DIMENS,VALUE,OBDATE,MDQ,MSC,MUC,OBNOTE,PSDAT,OIENS,OLOOP
"RTN","PSOERXX3",131,0)
 S F=52.4914
"RTN","PSOERXX3",132,0)
 S IENS=IEN_","
"RTN","PSOERXX3",133,0)
 S OLOOP=0 F  S OLOOP=$O(^PS(52.49,IEN,14,OLOOP)) Q:'OLOOP  D
"RTN","PSOERXX3",134,0)
 .S OIENS=OLOOP_","_IENS
"RTN","PSOERXX3",135,0)
 .D GETS^DIQ(F,OIENS,"**","IE","PSDAT")
"RTN","PSOERXX3",136,0)
 .S DIMENS=$G(PSDAT(F,OIENS,.02,"E"))
"RTN","PSOERXX3",137,0)
 .S VALUE=$G(PSDAT(F,OIENS,.03,"E"))
"RTN","PSOERXX3",138,0)
 .; convert observation date
"RTN","PSOERXX3",139,0)
 .S OBDATE=$G(PSDAT(F,OIENS,.04,"I")) I OBDATE S OBDATE=$P($$EXTIME^PSOERXO1(OBDATE),"T")
"RTN","PSOERXX3",140,0)
 .S MDQ=$G(PSDAT(F,OIENS,.05,"I"))
"RTN","PSOERXX3",141,0)
 .S MSC=$G(PSDAT(F,OIENS,.06,"E"))
"RTN","PSOERXX3",142,0)
 .S MUC=$G(PSDAT(F,OIENS,.07,"E"))
"RTN","PSOERXX3",143,0)
 .S OBNOTE=$G(PSDAT(F,OIENS,15,"E"))
"RTN","PSOERXX3",144,0)
 .D C S @GBL@(CNT,0)="<Observation>"
"RTN","PSOERXX3",145,0)
 .D C S @GBL@(CNT,0)="<Measurement>"
"RTN","PSOERXX3",146,0)
 .D C S @GBL@(CNT,0)="<Dimension>"_DIMENS_"</Dimension>"
"RTN","PSOERXX3",147,0)
 .D C S @GBL@(CNT,0)="<Value>"_VALUE_"</Value>"
"RTN","PSOERXX3",148,0)
 .I $L(OBDATE) D
"RTN","PSOERXX3",149,0)
 ..D C S @GBL@(CNT,0)="<ObservationDate>"
"RTN","PSOERXX3",150,0)
 ..D C S @GBL@(CNT,0)="<Date>"_OBDATE_"</Date>"
"RTN","PSOERXX3",151,0)
 ..D C S @GBL@(CNT,0)="</ObservationDate>"
"RTN","PSOERXX3",152,0)
 .I $L(MDQ) D C S @GBL@(CNT,0)="<MeasurementDataQualifier>"_MDQ_"</MeasurementDataQualifier>"
"RTN","PSOERXX3",153,0)
 .I $L(MSC) D C S @GBL@(CNT,0)="<MeasurementSourceCode>"_MSC_"</MeasurementSourceCode>"
"RTN","PSOERXX3",154,0)
 .I $L(MUC) D C S @GBL@(CNT,0)="<MeasurementUnitCode>"_MUC_"</MeasurementUnitCode>"
"RTN","PSOERXX3",155,0)
 .D C S @GBL@(CNT,0)="</Measurement>"
"RTN","PSOERXX3",156,0)
 .I $L(OBNOTE) D
"RTN","PSOERXX3",157,0)
 ..D C S @GBL@(CNT,0)="<ObservationNotes>"_OBNOTE_"</ObservationNotes>"
"RTN","PSOERXX3",158,0)
 .D C S @GBL@(CNT,0)="</Observation>"
"RTN","PSOERXX3",159,0)
 Q
"RTN","PSOERXX3",160,0)
DRUGEVAL(GBL,IEN) ;
"RTN","PSOERXX3",161,0)
 N F,SRC,PSC,SERVRC,CAID,CAQ,CSC,AR,PSDAT,DLOOP
"RTN","PSOERXX3",162,0)
 Q
"RTN","PSOERXX3",163,0)
 S F=52.4916
"RTN","PSOERXX3",164,0)
 S DLOOP=0 F  S DLOOP=$O(^PS(52.49,IEN,16,DLOOP)) Q:'DLOOP  D
"RTN","PSOERXX3",165,0)
 .S IENS=IEN_","_DLOOP_","
"RTN","PSOERXX3",166,0)
 .K PSDAT D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX3",167,0)
 .S SRC=$G(PSDAT(F,IENS,.01,"E"))
"RTN","PSOERXX3",168,0)
 .S PSC=$G(PSDAT(F,IENS,.02,"E"))
"RTN","PSOERXX3",169,0)
 .S SERVRC=$G(PSDAT(F,IENS,.03,"E"))
"RTN","PSOERXX3",170,0)
 .S CAID=$G(PSDAT(F,IENS,.04,"E"))
"RTN","PSOERXX3",171,0)
 .S CAQ=$G(PSDAT(F,IENS,.05,"E"))
"RTN","PSOERXX3",172,0)
 .S CSC=$G(PSDAT(F,IENS,.06,"E"))
"RTN","PSOERXX3",173,0)
 .S AR=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",174,0)
 .D C S @GBL@(CNT,0)="<DrugUseEvaluation>"
"RTN","PSOERXX3",175,0)
 .D C S @GBL@(CNT,0)="<ServiceReasonCode>"_SRC_"</ServiceReasonCode>"
"RTN","PSOERXX3",176,0)
 .D C S @GBL@(CNT,0)="<ProfessionalServiceCode>"_PSC_"</ProfessionalServiceCode>"
"RTN","PSOERXX3",177,0)
 .D C S @GBL@(CNT,0)="<ServiceResultCode>"_SERVRC_"</ServiceResultCode>"
"RTN","PSOERXX3",178,0)
 .D C S @GBL@(CNT,0)="<CoAgent>"
"RTN","PSOERXX3",179,0)
 .D C S @GBL@(CNT,0)="<CoAgentID>"_CAID_"</CoAgentID>"
"RTN","PSOERXX3",180,0)
 .D C S @GBL@(CNT,0)="<CoAgentQualifier>"_CAQ_"</CoAgentQualifier>"
"RTN","PSOERXX3",181,0)
 .D C S @GBL@(CNT,0)="</CoAgent>"
"RTN","PSOERXX3",182,0)
 .D C S @GBL@(CNT,0)="<ClinicalSignificanceCode>"_CSC_"</ClinicalSignificanceCode>"
"RTN","PSOERXX3",183,0)
 .D C S @GBL@(CNT,0)="<AcknowledgementReason>"_AR_"</AcknowledgementReason>"
"RTN","PSOERXX3",184,0)
 .D C S @GBL@(CNT,0)="</DrugUseEvaluation>"
"RTN","PSOERXX3",185,0)
 Q
"RTN","PSOERXX3",186,0)
DIAGNOS(GBL,IENS) ;
"RTN","PSOERXX3",187,0)
 N F,CIQ,PQUAL,PVAL,SQUAL,SVAL,PSDAT
"RTN","PSOERXX3",188,0)
 S F=52.499
"RTN","PSOERXX3",189,0)
 D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX3",190,0)
 S CIQ=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",191,0)
 S PQUAL=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",192,0)
 S PVAL=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",193,0)
 S SQUAL=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",194,0)
 S SVAL=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX3",195,0)
 ;FUTURE ENHANCEMENT - FOR NOW JUST BUILD HEADER/FOOTER AND QUIT, LATER BUILD THE REST
"RTN","PSOERXX3",196,0)
 D C S @GBL@(CNT,0)="<Diagnosis>"
"RTN","PSOERXX3",197,0)
 D C S @GBL@(CNT,0)="</Diagnosis>"
"RTN","PSOERXX3",198,0)
 Q
"RTN","PSOERXX3",199,0)
 D C S @GBL@(CNT,0)="<Diagnosis>"
"RTN","PSOERXX3",200,0)
 D C S @GBL@(CNT,0)="<ClinicalInformationQualifier>"_CIQ_"</ClinicalInformationQualifier>"
"RTN","PSOERXX3",201,0)
 D C S @GBL@(CNT,0)="<Primary>"
"RTN","PSOERXX3",202,0)
 D C S @GBL@(CNT,0)="<Qualifier>"_PQUAL_"</Qualifier>"
"RTN","PSOERXX3",203,0)
 D C S @GBL@(CNT,0)="<Value>"_PVAL_"</Value>"
"RTN","PSOERXX3",204,0)
 D C S @GBL@(CNT,0)="</Primary>"
"RTN","PSOERXX3",205,0)
 D C S @GBL@(CNT,0)="<Secondary>"
"RTN","PSOERXX3",206,0)
 D C S @GBL@(CNT,0)="<Qualifier>"_SQUAL_"</Qualifier>"
"RTN","PSOERXX3",207,0)
 D C S @GBL@(CNT,0)="<Value>"_SVAL_"</VALUE>"
"RTN","PSOERXX3",208,0)
 D C S @GBL@(CNT,0)="</Secondary>"
"RTN","PSOERXX3",209,0)
 D C S @GBL@(CNT,0)="</Diagnosis>"
"RTN","PSOERXX3",210,0)
 Q
"RTN","PSOERXX3",211,0)
C ;
"RTN","PSOERXX3",212,0)
 S CNT=$G(CNT)+1
"RTN","PSOERXX3",213,0)
 Q
"RTN","PSOERXX4")
0^17^B86144240^n/a
"RTN","PSOERXX4",1,0)
PSOERXX4 ;ALB/BWF - eRx xml utilities ; 8/3/2016 5:14pm
"RTN","PSOERXX4",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXX4",3,0)
 ;
"RTN","PSOERXX4",4,0)
 Q
"RTN","PSOERXX4",5,0)
 ; GBL - global location
"RTN","PSOERXX4",6,0)
 ; IEN - erx ien
"RTN","PSOERXX4",7,0)
 ; REQOR - refill qualifier override (optional)
"RTN","PSOERXX4",8,0)
MEDPRES(GBL,IEN,REQOR) ;
"RTN","PSOERXX4",9,0)
 N F,DRUGDES,PRODCODE,PCQUAL,STRENGTH,DDBCODE,DDBCQUAL,FSCODE,FCODE,SSCODE,SCODE,DEASCH,QTYVAL,CLQUAL,USCODE,PUC,DAYSUPP
"RTN","PSOERXX4",10,0)
 N DIRECT,NOTE,REQUAL,SUB,WDATE,LFDATE,EXDATE,EFDATE,PEND,DOD,DATEVAL,PAQUAL,PAVAL,DCS,PAS,REVAL,PSDAT,DCS,DCSVAL,DCLOOP
"RTN","PSOERXX4",11,0)
 N IENS,SIENS,SLOOP
"RTN","PSOERXX4",12,0)
 S IENS=IEN_","
"RTN","PSOERXX4",13,0)
 S F=52.49
"RTN","PSOERXX4",14,0)
 D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX4",15,0)
 S DRUGDES=$G(PSDAT(F,IENS,3.1,"E"))
"RTN","PSOERXX4",16,0)
 S PRODCODE=$G(PSDAT(F,IENS,4.1,"E"))
"RTN","PSOERXX4",17,0)
 S PCQUAL=$G(PSDAT(F,IENS,4.2,"I"))
"RTN","PSOERXX4",18,0)
 S STRENGTH=$G(PSDAT(F,IENS,4.3,"E"))
"RTN","PSOERXX4",19,0)
 S DDBCODE=$G(PSDAT(F,IENS,4.4,"E"))
"RTN","PSOERXX4",20,0)
 S DDBCQUAL=$G(PSDAT(F,IENS,4.11,"E"))
"RTN","PSOERXX4",21,0)
 S FSCODE=$G(PSDAT(F,IENS,4.5,"I"))
"RTN","PSOERXX4",22,0)
 S FCODE=$G(PSDAT(F,IENS,4.6,"E"))
"RTN","PSOERXX4",23,0)
 S SSCODE=$G(PSDAT(F,IENS,4.7,"I"))
"RTN","PSOERXX4",24,0)
 S SCODE=$G(PSDAT(F,IENS,4.8,"E"))
"RTN","PSOERXX4",25,0)
 S DEASCH=$G(PSDAT(F,IENS,4.9,"E"))
"RTN","PSOERXX4",26,0)
 S QTYVAL=$G(PSDAT(F,IENS,5.1,"E"))
"RTN","PSOERXX4",27,0)
 S CLQUAL=$G(PSDAT(F,IENS,5.2,"I"))
"RTN","PSOERXX4",28,0)
 S USCODE=$G(PSDAT(F,IENS,5.3,"I"))
"RTN","PSOERXX4",29,0)
 S PUC=$G(PSDAT(F,IENS,5.4,"E"))
"RTN","PSOERXX4",30,0)
 S DAYSUPP=$G(PSDAT(F,IENS,5.5,"E"))
"RTN","PSOERXX4",31,0)
 S DIRECT=$G(PSDAT(F,IENS,7,"E"))
"RTN","PSOERXX4",32,0)
 S NOTE=$G(PSDAT(F,IENS,8,"E"))
"RTN","PSOERXX4",33,0)
 S REVAL=$G(PSDAT(F,IENS,5.6,"E"))
"RTN","PSOERXX4",34,0)
 S REQUAL=$G(PSDAT(F,IENS,5.7,"I")) I REQUAL="R" S REQUAL="P"
"RTN","PSOERXX4",35,0)
 S SUB=$G(PSDAT(F,IENS,5.8,"I"))
"RTN","PSOERXX4",36,0)
 S WDATE=$G(PSDAT(F,IENS,5.9,"I")) I WDATE S WDATE=$P($$EXTIME^PSOERXO1(WDATE),"T")
"RTN","PSOERXX4",37,0)
 S LFDATE=$G(PSDAT(F,IENS,6.1,"I")) I LFDATE S LFDATE=$P($$EXTIME^PSOERXO1(LFDATE),"T")
"RTN","PSOERXX4",38,0)
 S EXDATE=$G(PSDAT(F,IENS,6.2,"I")) I EXDATE S EXDATE=$P($$EXTIME^PSOERXO1(EXDATE),"T")
"RTN","PSOERXX4",39,0)
 S EFDATE=$G(PSDAT(F,IENS,6.3,"I")) I EFDATE S EFDATE=$P($$EXTIME^PSOERXO1(EFDATE),"T")
"RTN","PSOERXX4",40,0)
 S PEND=$G(PSDAT(F,IENS,6.4,"I")) I PEND S PEND=$P($$EXTIME^PSOERXO1(PEND),"T")
"RTN","PSOERXX4",41,0)
 S DOD=$G(PSDAT(F,IENS,6.5,"I")) I DOD S DOD=$P($$EXTIME^PSOERXO1(DOD),"T")
"RTN","PSOERXX4",42,0)
 S DATEVAL=$G(PSDAT(F,IENS,6.6,"I")) I DATEVAL S DATEVAL=$P($$EXTIME^PSOERXO1(DATEVAL),"T")
"RTN","PSOERXX4",43,0)
 S PAQUAL=$G(PSDAT(F,IENS,10.3,"E"))
"RTN","PSOERXX4",44,0)
 S PAVAL=$G(PSDAT(F,IENS,10.2,"E"))
"RTN","PSOERXX4",45,0)
 S PAS=$G(PSDAT(F,IENS,10.4,"I"))
"RTN","PSOERXX4",46,0)
 D C S @GBL@(CNT,0)="<MedicationPrescribed>"
"RTN","PSOERXX4",47,0)
 D C S @GBL@(CNT,0)="<DrugDescription>"_DRUGDES_"</DrugDescription>"
"RTN","PSOERXX4",48,0)
 I $L(PRODCODE)!($L(PCQUAL))!($L(STRENGTH))!($L(DDBCODE))!($L(DDBCQUAL))!($L(FSCODE))!($L(FCODE))!($L(SSCODE))!($L(SCODE))!($L(DEASCH)) D
"RTN","PSOERXX4",49,0)
 .D C S @GBL@(CNT,0)="<DrugCoded>"
"RTN","PSOERXX4",50,0)
 .I $L(PRODCODE) D C S @GBL@(CNT,0)="<ProductCode>"_PRODCODE_"</ProductCode>"
"RTN","PSOERXX4",51,0)
 .I $L(PCQUAL) D C S @GBL@(CNT,0)="<ProductCodeQualifier>"_PCQUAL_"</ProductCodeQualifier>"
"RTN","PSOERXX4",52,0)
 .I $L(STRENGTH) D C S @GBL@(CNT,0)="<Strength>"_STRENGTH_"</Strength>"
"RTN","PSOERXX4",53,0)
 .I $L(DDBCODE) D C S @GBL@(CNT,0)="<DrugDBCode>"_DDBCODE_"</DrugDBCode>"
"RTN","PSOERXX4",54,0)
 .I $L(DDBCQUAL) D C S @GBL@(CNT,0)="<DrugDBCodeQualifier>"_DDBCQUAL_"</DrugDBCodeQualifier>"
"RTN","PSOERXX4",55,0)
 .I $L(FSCODE) D C S @GBL@(CNT,0)="<FormSourceCode>"_FSCODE_"</FormSourceCode>"
"RTN","PSOERXX4",56,0)
 .I $L(FCODE) D C S @GBL@(CNT,0)="<FormCode>"_FCODE_"</FormCode>"
"RTN","PSOERXX4",57,0)
 .I $L(SSCODE) D C S @GBL@(CNT,0)="<StrengthSourceCode>"_SSCODE_"</StrengthSourceCode>"
"RTN","PSOERXX4",58,0)
 .I $L(SCODE) D C S @GBL@(CNT,0)="<StrengthCode>"_SCODE_"</StrengthCode>"
"RTN","PSOERXX4",59,0)
 .I $L(DEASCH) D C S @GBL@(CNT,0)="<DEASchedule>"_DEASCH_"</DEASchedule>"
"RTN","PSOERXX4",60,0)
 .D C S @GBL@(CNT,0)="</DrugCoded>"
"RTN","PSOERXX4",61,0)
 I $L(QTYVAL)!($L(CLQUAL))!($L(USCODE))!($L(PUC)) D
"RTN","PSOERXX4",62,0)
 .D C S @GBL@(CNT,0)="<Quantity>"
"RTN","PSOERXX4",63,0)
 .I $L(QTYVAL) D C S @GBL@(CNT,0)="<Value>"_QTYVAL_"</Value>"
"RTN","PSOERXX4",64,0)
 .I $L(CLQUAL) D C S @GBL@(CNT,0)="<CodeListQualifier>"_CLQUAL_"</CodeListQualifier>"
"RTN","PSOERXX4",65,0)
 .I $L(USCODE) D C S @GBL@(CNT,0)="<UnitSourceCode>"_USCODE_"</UnitSourceCode>"
"RTN","PSOERXX4",66,0)
 .I $L(PUC) D C S @GBL@(CNT,0)="<PotencyUnitCode>"_PUC_"</PotencyUnitCode>"
"RTN","PSOERXX4",67,0)
 .D C S @GBL@(CNT,0)="</Quantity>"
"RTN","PSOERXX4",68,0)
 I $L(DAYSUPP) D C S @GBL@(CNT,0)="<DaysSupply>"_DAYSUPP_"</DaysSupply>"
"RTN","PSOERXX4",69,0)
 I $L(DIRECT) D C S @GBL@(CNT,0)="<Directions>"_DIRECT_"</Directions>"
"RTN","PSOERXX4",70,0)
 I $L(NOTE) D C S @GBL@(CNT,0)="<Note>"_NOTE_"</Note>"
"RTN","PSOERXX4",71,0)
 I $L(REQUAL)!($L(REVAL)) D
"RTN","PSOERXX4",72,0)
 .D C S @GBL@(CNT,0)="<Refills>"
"RTN","PSOERXX4",73,0)
 .I $L(REQUAL) D C S @GBL@(CNT,0)="<Qualifier>"_REQUAL_"</Qualifier>"
"RTN","PSOERXX4",74,0)
 .I $L(REVAL) D C S @GBL@(CNT,0)="<Value>"_REVAL_"</Value>"
"RTN","PSOERXX4",75,0)
 .D C S @GBL@(CNT,0)="</Refills>"
"RTN","PSOERXX4",76,0)
 I $L(SUB) D C S @GBL@(CNT,0)="<Substitutions>"_SUB_"</Substitutions>"
"RTN","PSOERXX4",77,0)
 I $L(WDATE) D
"RTN","PSOERXX4",78,0)
 .D C S @GBL@(CNT,0)="<WrittenDate>"
"RTN","PSOERXX4",79,0)
 .D C S @GBL@(CNT,0)="<Date>"_WDATE_"</Date>"
"RTN","PSOERXX4",80,0)
 .D C S @GBL@(CNT,0)="</WrittenDate>"
"RTN","PSOERXX4",81,0)
 I $L(LFDATE) D
"RTN","PSOERXX4",82,0)
 .D C S @GBL@(CNT,0)="<LastFillDate>"
"RTN","PSOERXX4",83,0)
 .D C S @GBL@(CNT,0)="<Date>"_LFDATE_"</Date>"
"RTN","PSOERXX4",84,0)
 .D C S @GBL@(CNT,0)="</LastFillDate>"
"RTN","PSOERXX4",85,0)
 I $L(EXDATE) D
"RTN","PSOERXX4",86,0)
 .D C S @GBL@(CNT,0)="<ExpirationDate>"
"RTN","PSOERXX4",87,0)
 .D C S @GBL@(CNT,0)="<Date>"_EXDATE_"</Date>"
"RTN","PSOERXX4",88,0)
 .D C S @GBL@(CNT,0)="</ExpirationDate>"
"RTN","PSOERXX4",89,0)
 I $L(EFDATE) D
"RTN","PSOERXX4",90,0)
 .D C S @GBL@(CNT,0)="<EffectiveDate>"
"RTN","PSOERXX4",91,0)
 .D C S @GBL@(CNT,0)="<Date>"_EFDATE_"</Date>"
"RTN","PSOERXX4",92,0)
 .D C S @GBL@(CNT,0)="</EffectiveDate>"
"RTN","PSOERXX4",93,0)
 I $L(PEND) D
"RTN","PSOERXX4",94,0)
 .D C S @GBL@(CNT,0)="<PeriodEnd>"
"RTN","PSOERXX4",95,0)
 .D C S @GBL@(CNT,0)="<Date>"_PEND_"</Date>"
"RTN","PSOERXX4",96,0)
 .D C S @GBL@(CNT,0)="</PeriodEnd>"
"RTN","PSOERXX4",97,0)
 I $L(DOD) D
"RTN","PSOERXX4",98,0)
 .D C S @GBL@(CNT,0)="<DeliveredOnDate>"
"RTN","PSOERXX4",99,0)
 .D C S @GBL@(CNT,0)="<Date>"_DOD_"</Date>"
"RTN","PSOERXX4",100,0)
 .D C S @GBL@(CNT,0)="</DeliveredOnDate>"
"RTN","PSOERXX4",101,0)
 I $L(DATEVAL) D
"RTN","PSOERXX4",102,0)
 .D C S @GBL@(CNT,0)="<DateValidated>"
"RTN","PSOERXX4",103,0)
 .D C S @GBL@(CNT,0)="<Date>"_DATEVAL_"</Date>"
"RTN","PSOERXX4",104,0)
 .D C S @GBL@(CNT,0)="</DateValidated>"
"RTN","PSOERXX4",105,0)
 ;***DO DIAGNOS, IT IS A MULTIPLE***
"RTN","PSOERXX4",106,0)
 I $L(PAQUAL)!($L(PAVAL)) D
"RTN","PSOERXX4",107,0)
 .D C S @GBL@(CNT,0)="<PriorAuthorization>"
"RTN","PSOERXX4",108,0)
 .I $L(PAQUAL) D C S @GBL@(CNT,0)="<Qualifier>"_PAQUAL_"</Qualifier>"
"RTN","PSOERXX4",109,0)
 .I $L(PAVAL) D C S @GBL@(CNT,0)="<Value>"_PAVAL_"</Value>"
"RTN","PSOERXX4",110,0)
 .D C S @GBL@(CNT,0)="</PriorAuthorization>"
"RTN","PSOERXX4",111,0)
 ;***DO DRUG USE EVAL***
"RTN","PSOERXX4",112,0)
 S DCLOOP=0 F  S DCS=$O(^PS(52.49,IEN,28,DCLOOP)) Q:'DCLOOP  D
"RTN","PSOERXX4",113,0)
 .S DCSVAL=$$GET1^DIQ(52.4928,DCLOOP_","_IENS,.02,"E")
"RTN","PSOERXX4",114,0)
 .D C S @GBL@(CNT,0)="<DrugCoverageStatusCode>"_DCSVAL_"</DrugCoverageStatusCode>"
"RTN","PSOERXX4",115,0)
 I $L(PAS) D C S @GBL@(CNT,0)="<PriorAuthorizationStatus>"_PAS_"</PriorAuthorizationStatus>"
"RTN","PSOERXX4",116,0)
 S SLOOP=0 F  S SLOOP=$O(^PS(52.49,IEN,11,SLOOP)) Q:'SLOOP  D
"RTN","PSOERXX4",117,0)
 .S SIENS=SLOOP_","_IEN_","
"RTN","PSOERXX4",118,0)
 .D STRUCSIG^PSOERXX5(.GBL,SIENS)
"RTN","PSOERXX4",119,0)
 ; STRUCTURED SIG GOES HERE
"RTN","PSOERXX4",120,0)
 D C S @GBL@(CNT,0)="</MedicationPrescribed>"
"RTN","PSOERXX4",121,0)
 Q
"RTN","PSOERXX4",122,0)
 ; IEN - 52.49 IEN
"RTN","PSOERXX4",123,0)
 ; RXIEN - Prescription IEN (file #52)
"RTN","PSOERXX4",124,0)
MEDDIS(GBL,RXIEN,ORIEN,PSOIEN) ;
"RTN","PSOERXX4",125,0)
 N DRUGDES,PRODCODE,PCQUAL,STRENGTH,DDBCODE,DDBCQUAL,FSCODE,FCODE,SSCODE,SCODE,DEASCH,VALUE,CLQUAL,USCODE,PUC,DAYSUPP
"RTN","PSOERXX4",126,0)
 N F,DIRECT,NOTE,REQUAL,SUB,WDATE,LFDATE,EXDATE,EFDATE,PEND,DOD,DATEVAL,PAQUAL,PAVAL,DCS,PAS
"RTN","PSOERXX4",127,0)
 N RXDAT,RXIENS,DRUGDES,QTY,RXDAT,RVAL
"RTN","PSOERXX4",128,0)
 ;S F=52.49
"RTN","PSOERXX4",129,0)
 ; this is the section we will likely be using
"RTN","PSOERXX4",130,0)
 S RXIENS=RXIEN_","
"RTN","PSOERXX4",131,0)
 D GETS^DIQ(52,RXIENS,"1;6;7;8;9;10;10.2;101","IE","RXDAT")
"RTN","PSOERXX4",132,0)
 S DRUGDES=$G(RXDAT(52,RXIENS,6,"E"))
"RTN","PSOERXX4",133,0)
 S QTY=$G(RXDAT(52,RXIENS,7,"E"))
"RTN","PSOERXX4",134,0)
 ; FUTURE ENHANCEMENTS
"RTN","PSOERXX4",135,0)
 ; - the qualifier may change between rxfill and refill request
"RTN","PSOERXX4",136,0)
 ; - consider modifying quantity code list qualifier in 52.49 to be a set of codes.
"RTN","PSOERXX4",137,0)
 ; this is a refill request, so the codelistqualifier will always be 38 - original quantity
"RTN","PSOERXX4",138,0)
 ;38 Original Quantity
"RTN","PSOERXX4",139,0)
 ;40 Remaining Quantity
"RTN","PSOERXX4",140,0)
 ;87 Quantity Received
"RTN","PSOERXX4",141,0)
 ;QS Quantity sufficient as determined by the dispensing pharmacy.
"RTN","PSOERXX4",142,0)
 ;   Quantity to be based on established dispensing protocols between
"RTN","PSOERXX4",143,0)
 ;   the prescriber and pharmacy/pharmacist.
"RTN","PSOERXX4",144,0)
 ; FUTURE - WHEN THIS IS USED, CLQUAL MAY NEED TO BE CALCULATED AND NOT HARD CODED
"RTN","PSOERXX4",145,0)
 S CLQUAL=38
"RTN","PSOERXX4",146,0)
 ; how to determine Unit Source Code?
"RTN","PSOERXX4",147,0)
 ;AA - NCI values of Diagnostic, Therapeutic, and Research Equipment - Pharmaceutical Dosage Form (http://www.cancer.gov/cancertopics/terminologyresources/page4- NCI Thesaurus)
"RTN","PSOERXX4",148,0)
 ;AB - NCI values of Units of Presentation (http://www.cancer.gov/cancertopics/terminologyresources/page4- NCI Thesaurus)
"RTN","PSOERXX4",149,0)
 ;AC - NCI values of Property or Attribute - Unit of Measure - Unit of Category - Potency Unit (http://www.cancer.gov/cancertopics/terminologyresources/page4- NCI Thesaurus)
"RTN","PSOERXX4",150,0)
 ; FOR NOW SET IT TO AA
"RTN","PSOERXX4",151,0)
 S USCODE="AA"
"RTN","PSOERXX4",152,0)
 ; FUTURE ENHANCEMENT - find out how to identify potency unit code, for now use C38046 - Not Stated explicity or in detail
"RTN","PSOERXX4",153,0)
 S PUC="C38046"
"RTN","PSOERXX4",154,0)
 S DAYSUPP=$G(RXDAT(52,RXIENS,8,"E"))
"RTN","PSOERXX4",155,0)
 ; DIRECTIONS COME FROM SIG, FIELD 10
"RTN","PSOERXX4",156,0)
 ; FUTURE ENHANCEMENT - SHOULD WE GRAB ALL INFORMATION FROM THE SIG1 MULTIPLE? 52,10.2
"RTN","PSOERXX4",157,0)
 S DIRECT=$E($G(^PSRX(RXIEN,"SIG1",1,0)),1,140)
"RTN","PSOERXX4",158,0)
 S REQUAL=$$GET1^DIQ(52.49,PSOIEN,5.7,"I") I REQUAL="R" S REQUAL="P"
"RTN","PSOERXX4",159,0)
 S RVAL=$G(RXDAT(52,RXIENS,9,"E"))
"RTN","PSOERXX4",160,0)
 ; CONVERT DATE types, ALSO MAKE SURE WE NEED TO POPULATE THESE.. MAY NOT BE NEEDED
"RTN","PSOERXX4",161,0)
 S LFDATE=$G(RXDAT(52,RXIENS,101,"I")) I LFDATE S LFDATE=$P($$EXTIME^PSOERXO1(LFDATE),"T")
"RTN","PSOERXX4",162,0)
 S EXDATE=$G(RXDAT(52,RXIENS,26,"I")) I EXDATE S EXDATE=$P($$EXTIME^PSOERXO1(EXDATE),"T")
"RTN","PSOERXX4",163,0)
 S WDATE=$G(RXDAT(52,RXIENS,1,"I")) I WDATE S WDATE=$P($$EXTIME^PSOERXO1(WDATE),"T")
"RTN","PSOERXX4",164,0)
 S EFDATE=""
"RTN","PSOERXX4",165,0)
 D C S @GBL@(CNT,0)="<MedicationDispensed>"
"RTN","PSOERXX4",166,0)
 D C S @GBL@(CNT,0)="<DrugDescription>"_DRUGDES_"</DrugDescription>"
"RTN","PSOERXX4",167,0)
 D C S @GBL@(CNT,0)="<Quantity>"
"RTN","PSOERXX4",168,0)
 D C S @GBL@(CNT,0)="<Value>"_QTY_"</Value>"
"RTN","PSOERXX4",169,0)
 D C S @GBL@(CNT,0)="<CodeListQualifier>"_CLQUAL_"</CodeListQualifier>"
"RTN","PSOERXX4",170,0)
 D C S @GBL@(CNT,0)="<UnitSourceCode>"_USCODE_"</UnitSourceCode>"
"RTN","PSOERXX4",171,0)
 D C S @GBL@(CNT,0)="<PotencyUnitCode>"_PUC_"</PotencyUnitCode>"
"RTN","PSOERXX4",172,0)
 D C S @GBL@(CNT,0)="</Quantity>"
"RTN","PSOERXX4",173,0)
 D C S @GBL@(CNT,0)="<DaysSupply>"_DAYSUPP_"</DaysSupply>"
"RTN","PSOERXX4",174,0)
 D C S @GBL@(CNT,0)="<Directions>"_DIRECT_"</Directions>"
"RTN","PSOERXX4",175,0)
 I $L(REQUAL)!($L(RVAL)) D
"RTN","PSOERXX4",176,0)
 .D C S @GBL@(CNT,0)="<Refills>"
"RTN","PSOERXX4",177,0)
 .I $L(REQUAL) D C S @GBL@(CNT,0)="<Qualifier>"_REQUAL_"</Qualifier>"
"RTN","PSOERXX4",178,0)
 .I $L(RVAL) D C S @GBL@(CNT,0)="<Value>"_RVAL_"</Value>"
"RTN","PSOERXX4",179,0)
 .D C S @GBL@(CNT,0)="</Refills>"
"RTN","PSOERXX4",180,0)
 I $L(WDATE) D
"RTN","PSOERXX4",181,0)
 .D C S @GBL@(CNT,0)="<WrittenDate>"
"RTN","PSOERXX4",182,0)
 .D C S @GBL@(CNT,0)="<Date>"_WDATE_"</Date>"
"RTN","PSOERXX4",183,0)
 .D C S @GBL@(CNT,0)="</WrittenDate>"
"RTN","PSOERXX4",184,0)
 I $L(LFDATE) D
"RTN","PSOERXX4",185,0)
 .D C S @GBL@(CNT,0)="<LastFillDate>"
"RTN","PSOERXX4",186,0)
 .D C S @GBL@(CNT,0)="<Date>"_LFDATE_"</Date>"
"RTN","PSOERXX4",187,0)
 .D C S @GBL@(CNT,0)="</LastFillDate>"
"RTN","PSOERXX4",188,0)
 I $L(EXDATE) D
"RTN","PSOERXX4",189,0)
 .D C S @GBL@(CNT,0)="<ExpirationDate>"
"RTN","PSOERXX4",190,0)
 .D C S @GBL@(CNT,0)="<Date>"_EXDATE_"</Date>"
"RTN","PSOERXX4",191,0)
 .D C S @GBL@(CNT,0)="</ExpirationDate>"
"RTN","PSOERXX4",192,0)
 I $L(EFDATE) D
"RTN","PSOERXX4",193,0)
 .D C S @GBL@(CNT,0)="<EffectiveDate>"
"RTN","PSOERXX4",194,0)
 .D C S @GBL@(CNT,0)="<Date>"_EFDATE_"</Date>"
"RTN","PSOERXX4",195,0)
 .D C S @GBL@(CNT,0)="</EffectiveDate>"
"RTN","PSOERXX4",196,0)
 D C S @GBL@(CNT,0)="</MedicationDispensed>"
"RTN","PSOERXX4",197,0)
 Q
"RTN","PSOERXX4",198,0)
MEDREQ(GBL,IEN,DDAT) ;
"RTN","PSOERXX4",199,0)
 N DRUGDES,PRODCODE,PCQUAL,STRENGTH,DDBCODE,DDBCQUAL,FSCODE,FCODE,SSCODE,SCODE,DEASCH,VALUE,CLQUAL,USCODE,PUC,DAYSUPP
"RTN","PSOERXX4",200,0)
 N F,DIRECT,NOTE,REQUAL,SUB,WDATE,LFDATE,EXDATE,EFDATE,PEND,DOD,DATEVAL,PAQUAL,PAVAL,DCS,PAS
"RTN","PSOERXX4",201,0)
 S F=52.49
"RTN","PSOERXX4",202,0)
 ; FUTURE ENHANCEMENT - FOR NOW BUILD HEADER AND FOOTER AND QUIT. tHIS MAY NEED TO LOOK AT 52.41 OR 52 FOR DATA
"RTN","PSOERXX4",203,0)
 S DRUGDES=$G(DDAT("DRUG"))
"RTN","PSOERXX4",204,0)
 S QTY=$G(DDAT("QTY"))
"RTN","PSOERXX4",205,0)
 S DAYSUPP=$G(DDAT("DSUP"))
"RTN","PSOERXX4",206,0)
 S RVAL=$G(DDAT("REF"))
"RTN","PSOERXX4",207,0)
 S DIRECT=$G(DDAT("DIR"))
"RTN","PSOERXX4",208,0)
 S REQUAL="R"
"RTN","PSOERXX4",209,0)
 S CLQUAL="TEST"
"RTN","PSOERXX4",210,0)
 S USCODE="TEST"
"RTN","PSOERXX4",211,0)
 S PUC="TEST"
"RTN","PSOERXX4",212,0)
 D C S @GBL@(CNT,0)="<MedicationRequested>"
"RTN","PSOERXX4",213,0)
 D C S @GBL@(CNT,0)="<DrugDescription>"_DRUGDES_"</DrugDescription>"
"RTN","PSOERXX4",214,0)
 D C S @GBL@(CNT,0)="<Quantity>"
"RTN","PSOERXX4",215,0)
 D C S @GBL@(CNT,0)="<Value>"_QTY_"</Value>"
"RTN","PSOERXX4",216,0)
 D C S @GBL@(CNT,0)="<CodeListQualifier>"_CLQUAL_"</CodeListQualifier>"
"RTN","PSOERXX4",217,0)
 D C S @GBL@(CNT,0)="<UnitSourceCode>"_USCODE_"</UnitSourceCode>"
"RTN","PSOERXX4",218,0)
 D C S @GBL@(CNT,0)="<PotencyUnitCode>"_PUC_"</PotencyUnitCode>"
"RTN","PSOERXX4",219,0)
 D C S @GBL@(CNT,0)="</Quantity>"
"RTN","PSOERXX4",220,0)
 D C S @GBL@(CNT,0)="<DaysSupply>"_DAYSUPP_"</DaysSupply>"
"RTN","PSOERXX4",221,0)
 D C S @GBL@(CNT,0)="<Directions>"_DIRECT_"</Directions>"
"RTN","PSOERXX4",222,0)
 D C S @GBL@(CNT,0)="<Refills>"
"RTN","PSOERXX4",223,0)
 D C S @GBL@(CNT,0)="<Qualifier>"_REQUAL_"</Qualifier>"
"RTN","PSOERXX4",224,0)
 D C S @GBL@(CNT,0)="<Value>"_RVAL_"</Value>"
"RTN","PSOERXX4",225,0)
 D C S @GBL@(CNT,0)="</Refills>"
"RTN","PSOERXX4",226,0)
 D C S @GBL@(CNT,0)="</MedicationRequested>"
"RTN","PSOERXX4",227,0)
 Q
"RTN","PSOERXX4",228,0)
C ;
"RTN","PSOERXX4",229,0)
 S CNT=$G(CNT)+1
"RTN","PSOERXX4",230,0)
 Q
"RTN","PSOERXX5")
0^18^B181218192^n/a
"RTN","PSOERXX5",1,0)
PSOERXX5 ;ALB/BWF - eRx xml utilities ; 8/3/2016 5:14pm
"RTN","PSOERXX5",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**467**;DEC 1997;Build 153
"RTN","PSOERXX5",3,0)
 ;
"RTN","PSOERXX5",4,0)
 Q
"RTN","PSOERXX5",5,0)
STRUCSIG(GBL,IENS) ;
"RTN","PSOERXX5",6,0)
 N SSPN,MSM,SV,FMTV,SFTSI,SFT,DCI,DDM,DDMCQ,DDMC,DDMMT,DDMMCQ,DDMMC
"RTN","PSOERXX5",7,0)
 N DQ,DFT,DFCQ,DFC,DRM,DBMV,DBUM,DBUMCQ,DBUC,BMQ,BMV,CDM,CDUMT,CDUMCQ,CDUMC,DBRM
"RTN","PSOERXX5",8,0)
 N VN,VNCQ,VUMT,VUMCQ,VUMC,MVM,RAT,RACQ,RAC,MRAM,SAT,SACQ,SAC,MATM,RM,RUMT
"RTN","PSOERXX5",9,0)
 N RUMCQ,RUMC,TPBT,TPBCQ,TPBC,FNV,FUT,FUCQ,FUC,VFM,INV,IUT,IUCQ,IUC,OR,DNV,DT,DTCQ
"RTN","PSOERXX5",10,0)
 N DTC,MDRNV,MDRUT,MDRCQ,MDRUC,MDRVN,MDRVUT,MDRVUCQ,MDRVUC,MDRVDM,IPT,IPCQ,IPC,IT
"RTN","PSOERXX5",11,0)
 N F,ITCQ,ITC,IVT,IVU,IVUMT,IVUMCQ,IVUMC,IVM,STOPI,PSDAT,ATC,ATCQ,ATT,TMATM,VIM,VNC,VQ
"RTN","PSOERXX5",12,0)
 S F=52.4911
"RTN","PSOERXX5",13,0)
 D GETS^DIQ(F,IENS,"**","IE","PSDAT")
"RTN","PSOERXX5",14,0)
 S SSPN=$G(PSDAT(F,IENS,.01,"E"))
"RTN","PSOERXX5",15,0)
 S MSM=$G(PSDAT(F,IENS,.02,"I"))
"RTN","PSOERXX5",16,0)
 S SV=$G(PSDAT(F,IENS,.03,"E"))
"RTN","PSOERXX5",17,0)
 S FMTV=$G(PSDAT(F,IENS,.04,"E"))
"RTN","PSOERXX5",18,0)
 S SFTSI=$G(PSDAT(F,IENS,.05,"E"))
"RTN","PSOERXX5",19,0)
 S SFT=$G(PSDAT(F,IENS,1,"E"))
"RTN","PSOERXX5",20,0)
 S DCI=$G(PSDAT(F,IENS,2.1,"E"))
"RTN","PSOERXX5",21,0)
 S DDM=$G(PSDAT(F,IENS,2.2,"E"))
"RTN","PSOERXX5",22,0)
 S DDMCQ=$G(PSDAT(F,IENS,2.3,"I"))
"RTN","PSOERXX5",23,0)
 S DDMC=$G(PSDAT(F,IENS,2.4,"E"))
"RTN","PSOERXX5",24,0)
 S DDMMT=$G(PSDAT(F,IENS,2.5,"E"))
"RTN","PSOERXX5",25,0)
 S DDMMCQ=$G(PSDAT(F,IENS,2.7,"I"))
"RTN","PSOERXX5",26,0)
 S DDMMC=$G(PSDAT(F,IENS,2.6,"E"))
"RTN","PSOERXX5",27,0)
 S DQ=$G(PSDAT(F,IENS,3.1,"E"))
"RTN","PSOERXX5",28,0)
 S DFT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,3.2,"E")))
"RTN","PSOERXX5",29,0)
 S DFCQ=$G(PSDAT(F,IENS,3.4,"I"))
"RTN","PSOERXX5",30,0)
 S DFC=$G(PSDAT(F,IENS,3.3,"E"))
"RTN","PSOERXX5",31,0)
 S DRM=$G(PSDAT(F,IENS,3.5,"I"))
"RTN","PSOERXX5",32,0)
 S DBMV=$G(PSDAT(F,IENS,4.1,"E"))
"RTN","PSOERXX5",33,0)
 S DBUM=$G(PSDAT(F,IENS,4.2,"E"))
"RTN","PSOERXX5",34,0)
 S DBUMCQ=$G(PSDAT(F,IENS,4.4,"I"))
"RTN","PSOERXX5",35,0)
 S DBUC=$G(PSDAT(F,IENS,4.3,"E"))
"RTN","PSOERXX5",36,0)
 S BMQ=$G(PSDAT(F,IENS,4.5,"I"))
"RTN","PSOERXX5",37,0)
 S BMV=$G(PSDAT(F,IENS,4.6,"E"))
"RTN","PSOERXX5",38,0)
 S CDM=$G(PSDAT(F,IENS,4.7,"E"))
"RTN","PSOERXX5",39,0)
 S CDUMT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,4.8,"E")))
"RTN","PSOERXX5",40,0)
 S CDUMCQ=$G(PSDAT(F,IENS,4.11,"I"))
"RTN","PSOERXX5",41,0)
 S CDUMC=$G(PSDAT(F,IENS,4.9,"E"))
"RTN","PSOERXX5",42,0)
 S DBRM=$G(PSDAT(F,IENS,4.12,"I"))
"RTN","PSOERXX5",43,0)
 S VN=$G(PSDAT(F,IENS,5.1,"E"))
"RTN","PSOERXX5",44,0)
 S VNC=$G(PSDAT(F,IENS,5.2,"E"))
"RTN","PSOERXX5",45,0)
 S VNCQ=$G(PSDAT(F,IENS,5.3,"I"))
"RTN","PSOERXX5",46,0)
 S VQ=$G(PSDAT(F,IENS,5.4,"E"))
"RTN","PSOERXX5",47,0)
 S VUMT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,5.5,"E")))
"RTN","PSOERXX5",48,0)
 S VUMCQ=$G(PSDAT(F,IENS,5.7,"I"))
"RTN","PSOERXX5",49,0)
 S VUMC=$G(PSDAT(F,IENS,5.6,"E"))
"RTN","PSOERXX5",50,0)
 S MVM=$G(PSDAT(F,IENS,5.8,"I"))
"RTN","PSOERXX5",51,0)
 S RAT=$G(PSDAT(F,IENS,6.1,"E"))
"RTN","PSOERXX5",52,0)
 S RACQ=$G(PSDAT(F,IENS,6.3,"I"))
"RTN","PSOERXX5",53,0)
 S RAC=$G(PSDAT(F,IENS,6.2,"E"))
"RTN","PSOERXX5",54,0)
 S MRAM=$G(PSDAT(F,IENS,6.4,"I"))
"RTN","PSOERXX5",55,0)
 S SAT=$G(PSDAT(F,IENS,6.5,"E"))
"RTN","PSOERXX5",56,0)
 S SACQ=$G(PSDAT(F,IENS,6.7,"I"))
"RTN","PSOERXX5",57,0)
 S SAC=$G(PSDAT(F,IENS,6.7,"I"))
"RTN","PSOERXX5",58,0)
 S MATM=$G(PSDAT(F,IENS,6.8,"I"))
"RTN","PSOERXX5",59,0)
 S ATT=$G(PSDAT(F,IENS,7.1,"E"))
"RTN","PSOERXX5",60,0)
 S ATCQ=$G(PSDAT(F,IENS,7.3,"I"))
"RTN","PSOERXX5",61,0)
 S ATC=$G(PSDAT(F,IENS,7.2,"E"))
"RTN","PSOERXX5",62,0)
 S TMATM=$G(PSDAT(F,IENS,7.4,"I"))
"RTN","PSOERXX5",63,0)
 S RM=$G(PSDAT(F,IENS,7.5,"E"))
"RTN","PSOERXX5",64,0)
 S RUMT=$G(PSDAT(F,IENS,7.6,"E"))
"RTN","PSOERXX5",65,0)
 S RUMCQ=$G(PSDAT(F,IENS,7.8,"I"))
"RTN","PSOERXX5",66,0)
 S RUMC=$G(PSDAT(F,IENS,7.7,"E"))
"RTN","PSOERXX5",67,0)
 S TPBT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,8.1,"E")))
"RTN","PSOERXX5",68,0)
 S TPBCQ=$G(PSDAT(F,IENS,8.3,"I"))
"RTN","PSOERXX5",69,0)
 S TPBC=$G(PSDAT(F,IENS,8.2,"E"))
"RTN","PSOERXX5",70,0)
 S FNV=$G(PSDAT(F,IENS,8.4,"E"))
"RTN","PSOERXX5",71,0)
 S FUT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,8.5,"E")))
"RTN","PSOERXX5",72,0)
 S FUCQ=$G(PSDAT(F,IENS,8.7,"I"))
"RTN","PSOERXX5",73,0)
 S FUC=$G(PSDAT(F,IENS,8.6,"E"))
"RTN","PSOERXX5",74,0)
 S VFM=$G(PSDAT(F,IENS,8.8,"I"))
"RTN","PSOERXX5",75,0)
 S INV=$G(PSDAT(F,IENS,9.1,"E"))
"RTN","PSOERXX5",76,0)
 S IUT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,9.2,"E")))
"RTN","PSOERXX5",77,0)
 S IUCQ=$G(PSDAT(F,IENS,9.4,"I"))
"RTN","PSOERXX5",78,0)
 S IUC=$G(PSDAT(F,IENS,9.3,"E"))
"RTN","PSOERXX5",79,0)
 S VIM=$G(PSDAT(F,IENS,9.5,"I"))
"RTN","PSOERXX5",80,0)
 S DNV=$G(PSDAT(F,IENS,9.6,"E"))
"RTN","PSOERXX5",81,0)
 S DT=$G(PSDAT(F,IENS,9.7,"E"))
"RTN","PSOERXX5",82,0)
 S DTCQ=$G(PSDAT(F,IENS,9.9,"I"))
"RTN","PSOERXX5",83,0)
 S DTC=$G(PSDAT(F,IENS,9.8,"E"))
"RTN","PSOERXX5",84,0)
 S MDRNV=$G(PSDAT(F,IENS,10.1,"E"))
"RTN","PSOERXX5",85,0)
 S MDRUT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,10.2,"E")))
"RTN","PSOERXX5",86,0)
 S MDRCQ=$G(PSDAT(F,IENS,10.3,"I"))
"RTN","PSOERXX5",87,0)
 S MDRUC=$G(PSDAT(F,IENS,10.4,"E"))
"RTN","PSOERXX5",88,0)
 S MDRVN=$G(PSDAT(F,IENS,10.5,"E"))
"RTN","PSOERXX5",89,0)
 S MDRVUT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,10.6,"E")))
"RTN","PSOERXX5",90,0)
 S MDRVUCQ=$G(PSDAT(F,IENS,10.8,"I"))
"RTN","PSOERXX5",91,0)
 S MDRVUC=$G(PSDAT(F,IENS,10.7,"E"))
"RTN","PSOERXX5",92,0)
 S MDRVDM=$G(PSDAT(F,IENS,10.9,"I"))
"RTN","PSOERXX5",93,0)
 S IPT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,11.1,"E")))
"RTN","PSOERXX5",94,0)
 S IPCQ=$G(PSDAT(F,IENS,11.3,"I"))
"RTN","PSOERXX5",95,0)
 S IPC=$G(PSDAT(F,IENS,11.2,"E"))
"RTN","PSOERXX5",96,0)
 S IT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,11.4,"E")))
"RTN","PSOERXX5",97,0)
 S ITCQ=$G(PSDAT(F,IENS,11.6,"I"))
"RTN","PSOERXX5",98,0)
 S ITC=$G(PSDAT(F,IENS,11.5,"E"))
"RTN","PSOERXX5",99,0)
 S IVT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,12.1,"E")))
"RTN","PSOERXX5",100,0)
 S IVU=$G(PSDAT(F,IENS,12.2,"E"))
"RTN","PSOERXX5",101,0)
 S IVUMT=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,12.3,"E")))
"RTN","PSOERXX5",102,0)
 S IVUMCQ=$G(PSDAT(F,IENS,12.5,"I"))
"RTN","PSOERXX5",103,0)
 S IVUMC=$$SYMENC^MXMLUTL($G(PSDAT(F,IENS,12.4,"E")))
"RTN","PSOERXX5",104,0)
 S IVM=$G(PSDAT(F,IENS,12.6,"I"))
"RTN","PSOERXX5",105,0)
 S STOPI=$G(PSDAT(F,IENS,12.7,"I"))
"RTN","PSOERXX5",106,0)
 D C S @GBL@(CNT,0)="<StructuredSIG>"
"RTN","PSOERXX5",107,0)
 D C S @GBL@(CNT,0)="<RepeatingSIG>"
"RTN","PSOERXX5",108,0)
 D C S @GBL@(CNT,0)="<SigSequencePositionNumber>"_SSPN_"</SigSequencePositionNumber>"
"RTN","PSOERXX5",109,0)
 D C S @GBL@(CNT,0)="<MultipleSigModifier>"_MSM_"</MultipleSigModifier>"
"RTN","PSOERXX5",110,0)
 D C S @GBL@(CNT,0)="</RepeatingSIG>"
"RTN","PSOERXX5",111,0)
 D C S @GBL@(CNT,0)="<CodeSystem>"
"RTN","PSOERXX5",112,0)
 D C S @GBL@(CNT,0)="<SNOMEDVersion>"_SV_"</SNOMEDVersion>"
"RTN","PSOERXX5",113,0)
 D C S @GBL@(CNT,0)="<FMTVersion>"_FMTV_"</FMTVersion>"
"RTN","PSOERXX5",114,0)
 D C S @GBL@(CNT,0)="</CodeSystem>"
"RTN","PSOERXX5",115,0)
 D C S @GBL@(CNT,0)="<FreeText>"
"RTN","PSOERXX5",116,0)
 D C S @GBL@(CNT,0)="<SigFreeTextStringIndicator>"_SFTSI_"</SigFreeTextStringIndicator>"
"RTN","PSOERXX5",117,0)
 D C S @GBL@(CNT,0)="<SigFreeText>"_SFT_"</SigFreeText>"
"RTN","PSOERXX5",118,0)
 D C S @GBL@(CNT,0)="</FreeText>"
"RTN","PSOERXX5",119,0)
 D C S @GBL@(CNT,0)="<Dose>"
"RTN","PSOERXX5",120,0)
 D C S @GBL@(CNT,0)="<DoseCompositeIndicator>"_DCI_"</DoseCompositeIndicator>"
"RTN","PSOERXX5",121,0)
 D C S @GBL@(CNT,0)="<DoseDeliveryMethodText>"_DDM_"</DoseDeliveryMethodText>"
"RTN","PSOERXX5",122,0)
 I $L(DDMCQ) D C S @GBL@(CNT,0)="<DoseDeliveryMethodCodeQualifier>"_DDMCQ_"</DoseDeliveryMethodCodeQualifier>"
"RTN","PSOERXX5",123,0)
 D C S @GBL@(CNT,0)="<DoseDeliveryMethodCode>"_DDMC_"</DoseDeliveryMethodCode>"
"RTN","PSOERXX5",124,0)
 D C S @GBL@(CNT,0)="<DoseDeliveryMethodModifierText>"_DDMMT_"</DoseDeliveryMethodModifierText>"
"RTN","PSOERXX5",125,0)
 I $L(DDMMCQ) D C S @GBL@(CNT,0)="<DoseDeliveryMethodModifierCodeQualifier>"_DDMMCQ_"</DoseDeliveryMethodModifierCodeQualifier>"
"RTN","PSOERXX5",126,0)
 D C S @GBL@(CNT,0)="<DoseDeliveryMethodModifierCode>"_DDMMC_"</DoseDeliveryMethodModifierCode>"
"RTN","PSOERXX5",127,0)
 D C S @GBL@(CNT,0)="<DoseQuantity>"_DQ_"</DoseQuantity>"
"RTN","PSOERXX5",128,0)
 D C S @GBL@(CNT,0)="<DoseFormText>"_DFT_"</DoseFormText>"
"RTN","PSOERXX5",129,0)
 I $L(DFCQ) D C S @GBL@(CNT,0)="<DoseFormCodeQualifier>"_DFCQ_"</DoseFormCodeQualifier>"
"RTN","PSOERXX5",130,0)
 D C S @GBL@(CNT,0)="<DoseFormCode>"_DFC_"</DoseFormCode>"
"RTN","PSOERXX5",131,0)
 I $L(DRM) D C S @GBL@(CNT,0)="<DoseRangeModifier>"_DRM_"</DoseRangeModifier>"
"RTN","PSOERXX5",132,0)
 D C S @GBL@(CNT,0)="</Dose>"
"RTN","PSOERXX5",133,0)
 D C S @GBL@(CNT,0)="<DoseCalculation>"
"RTN","PSOERXX5",134,0)
 D C S @GBL@(CNT,0)="<DosingBasisNumericValue>"_DBMV_"</DosingBasisNumericValue>"
"RTN","PSOERXX5",135,0)
 D C S @GBL@(CNT,0)="<DosingBasisUnitofMeasureText>"_DBUM_"</DosingBasisUnitofMeasureText>"
"RTN","PSOERXX5",136,0)
 I $L(DBUMCQ) D C S @GBL@(CNT,0)="<DosingBasisUnitofMeasureCodeQualifier>"_DBUMCQ_"</DosingBasisUnitofMeasureCodeQualifier>"
"RTN","PSOERXX5",137,0)
 D C S @GBL@(CNT,0)="<DosingBasisUnitofMeasureCode>"_DBUC_"</DosingBasisUnitofMeasureCode>"
"RTN","PSOERXX5",138,0)
 I $L(BMQ) D C S @GBL@(CNT,0)="<BodyMetricQualifier>"_BMQ_"</BodyMetricQualifier>"
"RTN","PSOERXX5",139,0)
 D C S @GBL@(CNT,0)="<BodyMetricValue>"_BMV_"</BodyMetricValue>"
"RTN","PSOERXX5",140,0)
 D C S @GBL@(CNT,0)="<CalculatedDoseNumeric>"_CDM_"</CalculatedDoseNumeric>"
"RTN","PSOERXX5",141,0)
 D C S @GBL@(CNT,0)="<CalculatedDoseUnitofMeasureText>"_CDUMT_"</CalculatedDoseUnitofMeasureText>"
"RTN","PSOERXX5",142,0)
 I $L(CDUMCQ) D C S @GBL@(CNT,0)="<CalculatedDoseUnitofMeasureCodeQualifier>"_CDUMCQ_"</CalculatedDoseUnitofMeasureCodeQualifier>"
"RTN","PSOERXX5",143,0)
 D C S @GBL@(CNT,0)="<CalculatedDoseUnitofMeasureCode>"_CDUMC_"</CalculatedDoseUnitofMeasureCode>"
"RTN","PSOERXX5",144,0)
 D C S @GBL@(CNT,0)="<DosingBasisRangeModifier>"_DBRM_"</DosingBasisRangeModifier>"
"RTN","PSOERXX5",145,0)
 D C S @GBL@(CNT,0)="</DoseCalculation>"
"RTN","PSOERXX5",146,0)
 D C S @GBL@(CNT,0)="<Vehicle>"
"RTN","PSOERXX5",147,0)
 D C S @GBL@(CNT,0)="<VehicleName>"_VN_"</VehicleName>"
"RTN","PSOERXX5",148,0)
 I $L(VNCQ) D C S @GBL@(CNT,0)="<VehicleNameCodeQualifier>"_VNCQ_"</VehicleNameCodeQualifier>"
"RTN","PSOERXX5",149,0)
 D C S @GBL@(CNT,0)="<VehicleNameCode>"_VNC_"</VehicleNameCode>"
"RTN","PSOERXX5",150,0)
 D C S @GBL@(CNT,0)="<VehicleQuantity>"_VQ_"</VehicleQuantity>"
"RTN","PSOERXX5",151,0)
 D C S @GBL@(CNT,0)="<VehicleUnitOfMeasureText>"_VUMT_"</VehicleUnitOfMeasureText>"
"RTN","PSOERXX5",152,0)
 I $L(VUMCQ) D C S @GBL@(CNT,0)="<VehicleUnitOfMeasureCodeQualifier>"_VUMCQ_"</VehicleUnitOfMeasureCodeQualifier>"
"RTN","PSOERXX5",153,0)
 D C S @GBL@(CNT,0)="<VehicleUnitOfMeasureCode>"_VUMC_"</VehicleUnitOfMeasureCode>"
"RTN","PSOERXX5",154,0)
 D C S @GBL@(CNT,0)="<MultipleVehicleModifier>"_MVM_"</MultipleVehicleModifier>"
"RTN","PSOERXX5",155,0)
 D C S @GBL@(CNT,0)="</Vehicle>"
"RTN","PSOERXX5",156,0)
 D C S @GBL@(CNT,0)="<RouteofAdministration>"
"RTN","PSOERXX5",157,0)
 D C S @GBL@(CNT,0)="<RouteofAdministrationText>"_RAT_"</RouteofAdministrationText>"
"RTN","PSOERXX5",158,0)
 I $L(RACQ) D C S @GBL@(CNT,0)="<RouteofAdministrationCodeQualifier>"_RACQ_"</RouteofAdministrationCodeQualifier>"
"RTN","PSOERXX5",159,0)
 D C S @GBL@(CNT,0)="<RouteofAdministrationCode>"_RAC_"</RouteofAdministrationCode>"
"RTN","PSOERXX5",160,0)
 I $L(MRAM) D C S @GBL@(CNT,0)="<MultipleRouteofAdministrationModifier>"_MRAM_"</MultipleRouteofAdministrationModifier>"
"RTN","PSOERXX5",161,0)
 D C S @GBL@(CNT,0)="</RouteofAdministration>"
"RTN","PSOERXX5",162,0)
 D C S @GBL@(CNT,0)="<SiteofAdministration>"
"RTN","PSOERXX5",163,0)
 D C S @GBL@(CNT,0)="<SiteofAdministrationText>"_SAT_"</SiteofAdministrationText>"
"RTN","PSOERXX5",164,0)
 I $L(SACQ) D C S @GBL@(CNT,0)="<SiteofAdministrationCodeQualifier>"_SACQ_"</SiteofAdministrationCodeQualifier>"
"RTN","PSOERXX5",165,0)
 D C S @GBL@(CNT,0)="<SiteofAdministrationCode>"_SAC_"</SiteofAdministrationCode>"
"RTN","PSOERXX5",166,0)
 I $L(MATM) D C S @GBL@(CNT,0)="<MultipleAdministrationTimingModifier>"_MATM_"</MultipleAdministrationTimingModifier>"
"RTN","PSOERXX5",167,0)
 D C S @GBL@(CNT,0)="</SiteofAdministration>"
"RTN","PSOERXX5",168,0)
 D C S @GBL@(CNT,0)="<Timing>"
"RTN","PSOERXX5",169,0)
 D C S @GBL@(CNT,0)="<AdministrationTimingText>"_ATT_"</AdministrationTimingText>"
"RTN","PSOERXX5",170,0)
 I $L(ATCQ) D C S @GBL@(CNT,0)="<AdministrationTimingCodeQualifier>"_ATCQ_"</AdministrationTimingCodeQualifier>"
"RTN","PSOERXX5",171,0)
 D C S @GBL@(CNT,0)="<AdministrationTimingCode>"_ATC_"</AdministrationTimingCode>"
"RTN","PSOERXX5",172,0)
 I $L(TMATM) D C S @GBL@(CNT,0)="<MultipleAdministrationTimingModifier>"_TMATM_"</MultipleAdministrationTimingModifier>"
"RTN","PSOERXX5",173,0)
 D C S @GBL@(CNT,0)="<RateofAdministration>"_RM_"</RateofAdministration>"
"RTN","PSOERXX5",174,0)
 D C S @GBL@(CNT,0)="<RateUnitofMeasureText>"_RUMT_"</RateUnitofMeasureText>"
"RTN","PSOERXX5",175,0)
 I $L(RUMCQ) D C S @GBL@(CNT,0)="<RateUnitofMeasureCodeQualifier>"_RUMCQ_"</RateUnitofMeasureCodeQualifier>"
"RTN","PSOERXX5",176,0)
 D C S @GBL@(CNT,0)="<RateUnitofMeasureCode>"_RUMC_"</RateUnitofMeasureCode>"
"RTN","PSOERXX5",177,0)
 D C S @GBL@(CNT,0)="<TimePeriodBasisText>"_TPBT_"</TimePeriodBasisText>"
"RTN","PSOERXX5",178,0)
 I $L(TPBCQ) D C S @GBL@(CNT,0)="<TimePeriodBasisCodeQualifier>"_TPBCQ_"</TimePeriodBasisCodeQualifier>"
"RTN","PSOERXX5",179,0)
 D C S @GBL@(CNT,0)="<TimePeriodBasisCode>"_TPBC_"</TimePeriodBasisCode>"
"RTN","PSOERXX5",180,0)
 D C S @GBL@(CNT,0)="<FrequencyNumericValue>"_FNV_"</FrequencyNumericValue>"
"RTN","PSOERXX5",181,0)
 D C S @GBL@(CNT,0)="<FrequencyUnitsText>"_FUT_"</FrequencyUnitsText>"
"RTN","PSOERXX5",182,0)
 I $L(FUCQ) D C S @GBL@(CNT,0)="<FrequencyUnitsCodeQualifier>"_FUCQ_"</FrequencyUnitsCodeQualifier>"
"RTN","PSOERXX5",183,0)
 D C S @GBL@(CNT,0)="<FrequencyUnitsCode>"_FUC_"</FrequencyUnitsCode>"
"RTN","PSOERXX5",184,0)
 I $L(VFM) D C S @GBL@(CNT,0)="<VariableFrequencyModifier>"_VFM_"</VariableFrequencyModifier>"
"RTN","PSOERXX5",185,0)
 D C S @GBL@(CNT,0)="<IntervalNumericValue>"_INV_"</IntervalNumericValue>"
"RTN","PSOERXX5",186,0)
 D C S @GBL@(CNT,0)="<IntervalUnitsText>"_IUT_"</IntervalUnitsText>"
"RTN","PSOERXX5",187,0)
 I $L(IUCQ) D C S @GBL@(CNT,0)="<IntervalUnitsCodeQualifier>"_IUCQ_"</IntervalUnitsCodeQualifier>"
"RTN","PSOERXX5",188,0)
 D C S @GBL@(CNT,0)="<IntervalUnitsCode>"_IUC_"</IntervalUnitsCode>"
"RTN","PSOERXX5",189,0)
 I $L(VIM) D C S @GBL@(CNT,0)="<VariableIntervalModifier>"_VIM_"</VariableIntervalModifier>"
"RTN","PSOERXX5",190,0)
 D C S @GBL@(CNT,0)="</Timing>"
"RTN","PSOERXX5",191,0)
 D C S @GBL@(CNT,0)="<Duration>"
"RTN","PSOERXX5",192,0)
 D C S @GBL@(CNT,0)="<DurationNumericValue>"_DNV_"</DurationNumericValue>"
"RTN","PSOERXX5",193,0)
 D C S @GBL@(CNT,0)="<DurationText>"_DT_"</DurationText>"
"RTN","PSOERXX5",194,0)
 I $L(DTCQ) D C S @GBL@(CNT,0)="<DurationTextCodeQualifier>"_DTCQ_"</DurationTextCodeQualifier>"
"RTN","PSOERXX5",195,0)
 D C S @GBL@(CNT,0)="<DurationTextCode>"_DTC_"</DurationTextCode>"
"RTN","PSOERXX5",196,0)
 D C S @GBL@(CNT,0)="</Duration>"
"RTN","PSOERXX5",197,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestriction>"
"RTN","PSOERXX5",198,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionNumericValue>"_MDRNV_"</MaximumDoseRestrictionNumericValue>"
"RTN","PSOERXX5",199,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionUnitsText>"_MDRUT_"</MaximumDoseRestrictionUnitsText>"
"RTN","PSOERXX5",200,0)
 I $L(MDRCQ) D C S @GBL@(CNT,0)="<MaximumDoseRestrictionCodeQualifier>"_MDRCQ_"</MaximumDoseRestrictionCodeQualifier>"
"RTN","PSOERXX5",201,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionUnitsCode>"_MDRUC_"</MaximumDoseRestrictionUnitsCode>"
"RTN","PSOERXX5",202,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionVariableNumericValue>"_MDRVN_"</MaximumDoseRestrictionVariableNumericValue>"
"RTN","PSOERXX5",203,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionVariableUnitsText>"_MDRVUT_"</MaximumDoseRestrictionVariableUnitsText>"
"RTN","PSOERXX5",204,0)
 I $L(MDRVUCQ) D C S @GBL@(CNT,0)="<MaximumDoseRestrictionVariableUnitsCodeQualifier>"_MDRVUCQ_"</MaximumDoseRestrictionVariableUnitsCodeQualifier>"
"RTN","PSOERXX5",205,0)
 D C S @GBL@(CNT,0)="<MaximumDoseRestrictionVariableUnitsCode>"_MDRVUC_"</MaximumDoseRestrictionVariableUnitsCode>"
"RTN","PSOERXX5",206,0)
 I $L(MDRVDM) D C S @GBL@(CNT,0)="<MaximumDoseRestrictionVariableDurationModifier>"_MDRVDM_"</MaximumDoseRestrictionVariableDurationModifier>"
"RTN","PSOERXX5",207,0)
 D C S @GBL@(CNT,0)="</MaximumDoseRestriction>"
"RTN","PSOERXX5",208,0)
 D C S @GBL@(CNT,0)="<Indication>"
"RTN","PSOERXX5",209,0)
 D C S @GBL@(CNT,0)="<IndicationPrecursorText>"_IPT_"</IndicationPrecursorText>"
"RTN","PSOERXX5",210,0)
 I $L(IPCQ) D C S @GBL@(CNT,0)="<IndicationPrecursorCodeQualifier>"_IPCQ_"</IndicationPrecursorCodeQualifier>"
"RTN","PSOERXX5",211,0)
 D C S @GBL@(CNT,0)="<IndicationPrecursorCode>"_IPC_"</IndicationPrecursorCode>"
"RTN","PSOERXX5",212,0)
 D C S @GBL@(CNT,0)="<IndicationText>"_IT_"</IndicationText>"
"RTN","PSOERXX5",213,0)
 I $L(ITCQ) D C S @GBL@(CNT,0)="<IndicationTextCodeQualifier>"_ITCQ_"</IndicationTextCodeQualifier>"
"RTN","PSOERXX5",214,0)
 D C S @GBL@(CNT,0)="<IndicationTextCode>"_ITC_"</IndicationTextCode>"
"RTN","PSOERXX5",215,0)
 D C S @GBL@(CNT,0)="<IndicationValueText>"_IVT_"</IndicationValueText>"
"RTN","PSOERXX5",216,0)
 D C S @GBL@(CNT,0)="<IndicationValueUnit>"_IVU_"</IndicationValueUnit>"
"RTN","PSOERXX5",217,0)
 D C S @GBL@(CNT,0)="<IndicationValueUnitofMeasureText>"_IVUMT_"</IndicationValueUnitofMeasureText>"
"RTN","PSOERXX5",218,0)
 I $L(IVUMCQ) D C S @GBL@(CNT,0)="<IndicationValueUnitofMeasureCodeQualifier>"_IVUMCQ_"</IndicationValueUnitofMeasureCodeQualifier>"
"RTN","PSOERXX5",219,0)
 D C S @GBL@(CNT,0)="<IndicationValueUnitofMeasureCode>"_IVUMC_"</IndicationValueUnitofMeasureCode>"
"RTN","PSOERXX5",220,0)
 I $L(IVM) D C S @GBL@(CNT,0)="<IndicationVariableModifier>"_IVM_"</IndicationVariableModifier>"
"RTN","PSOERXX5",221,0)
 D C S @GBL@(CNT,0)="</Indication>"
"RTN","PSOERXX5",222,0)
 I $L(STOPI) D
"RTN","PSOERXX5",223,0)
 .D C S @GBL@(CNT,0)="<Stop>"
"RTN","PSOERXX5",224,0)
 .D C S @GBL@(CNT,0)="<StopIndicator>"_STOPI_"</StopIndicator>"
"RTN","PSOERXX5",225,0)
 .D C S @GBL@(CNT,0)="</Stop>"
"RTN","PSOERXX5",226,0)
 D C S @GBL@(CNT,0)="</StructuredSIG>"
"RTN","PSOERXX5",227,0)
 Q
"RTN","PSOERXX5",228,0)
C ;
"RTN","PSOERXX5",229,0)
 S CNT=$G(CNT)+1
"RTN","PSOERXX5",230,0)
 Q
"RTN","PSOORFI1")
0^21^B82061614^B79665537
"RTN","PSOORFI1",1,0)
PSOORFI1 ;BIR/SAB - finish OP orders from OE/RR continued ; 10/23/15 4:14pm
"RTN","PSOORFI1",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**7,15,23,27,32,44,51,46,71,90,108,131,152,186,210,222,258,260,225,391,408,444,467**;DEC 1997;Build 153
"RTN","PSOORFI1",3,0)
 ;Ref. ^PS(50.7 supp. DBIA 2223
"RTN","PSOORFI1",4,0)
 ;Ref. ^PSDRUG( supp. DBIA 221
"RTN","PSOORFI1",5,0)
 ;Ref. L^PSSLOCK supp. DBIA 2789
"RTN","PSOORFI1",6,0)
 ;Ref. ^PS(50.606 supp. DBIA 2174
"RTN","PSOORFI1",7,0)
 ;Ref. ^PS(55 supp. DBIA 2228
"RTN","PSOORFI1",8,0)
 ;Ref. ULK^ORX2 supp. DBIA 867
"RTN","PSOORFI1",9,0)
 ;
"RTN","PSOORFI1",10,0)
 ;PSO*186 add call to function $$DEACHK
"RTN","PSOORFI1",11,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORFI1",12,0)
 ;
"RTN","PSOORFI1",13,0)
 S SIGOK=1
"RTN","PSOORFI1",14,0)
DSPL K ^TMP("PSOPO",$J),CLOZPAT,PSOPRC,PSODSPL
"RTN","PSOORFI1",15,0)
 S (OI,PSODRUG("OI"))=$P(OR0,"^",8),PSODRUG("OIN")=$P(^PS(50.7,$P(OR0,"^",8),0),"^"),OID=$P(OR0,"^",9)
"RTN","PSOORFI1",16,0)
 I $P($G(OR0),"^",9) S POERR=1,DREN=$P(OR0,"^",9) D DRG^PSOORDRG K POERR G DRG
"RTN","PSOORFI1",17,0)
 I '$P(OR0,"^",9) D DREN^PSOORNW2
"RTN","PSOORFI1",18,0)
DRG I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),"CLOZ1")),"^")="PSOCLO1" D CLOZ^PSOORFI2
"RTN","PSOORFI1",19,0)
 ;PSO*186 modify If/Else below to use DEACHK
"RTN","PSOORFI1",20,0)
 I $G(PSODRUG("DEA"))]"" D
"RTN","PSOORFI1",21,0)
 .S PSOCS=0 K DIR,DIC,PSOX
"RTN","PSOORFI1",22,0)
 .N PSDEA,PSDAYS S PSDEA=PSODRUG("DEA"),PSDAYS=+$P(OR0,"^",22)
"RTN","PSOORFI1",23,0)
 .I $$DEACHK^PSOUTLA1("*",PSDEA,PSDAYS,$G(CLOZPAT),.PSOCS,.PSOMAX)
"RTN","PSOORFI1",24,0)
 E  D
"RTN","PSOORFI1",25,0)
 .S PSOMAX=$S($G(CLOZPAT)=2:3,$G(CLOZPAT)=1:1,1:$P(OR0,"^",11))
"RTN","PSOORFI1",26,0)
ISSDT S (PSOID,Y,PSONEW("ISSUE DATE"))=$S($G(PSONEW("ISSUE DATE")):PSONEW("ISSUE DATE"),$P($G(OR0),"^",6):$E($P(OR0,"^",6),1,7),1:DT)
"RTN","PSOORFI1",27,0)
 X ^DD("DD") S PSONEW("ISSUE DATE")=Y
"RTN","PSOORFI1",28,0)
 D USER^PSOORFI2($P(OR0,"^",4)) S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSORX("CLERK CODE")=USER1
"RTN","PSOORFI1",29,0)
 S (PSONEW("DFLG"),PSONEW("QFLG"))=0,PSODFN=$P(OR0,"^",2),PSONEW("QTY")=$P(OR0,"^",10),PSONEW("MAIL/WINDOW")=$S($P(OR0,"^",17)="M":"M",1:"W")
"RTN","PSOORFI1",30,0)
 S:$G(PSONEW("CLINIC"))']"" PSONEW("CLINIC")=+$P(OR0,"^",13),PSORX("CLINIC")=$S($D(^SC(PSONEW("CLINIC"),0)):$P(^SC(PSONEW("CLINIC"),0),"^"),1:"")
"RTN","PSOORFI1",31,0)
 S:$G(PSORX("CLINIC"))']"" PSORX("CLINIC")=$S($D(^SC(+$P(OR0,"^",13),0)):$P(^SC($P(OR0,"^",13),0),"^"),1:"")
"RTN","PSOORFI1",32,0)
 D USER^PSOORFI2($P(OR0,"^",5))
"RTN","PSOORFI1",33,0)
 S PSONEW("CLERK CODE")=$P(OR0,"^",4),PSONEW("PROVIDER")=$P(OR0,"^",5),PSONEW("PROVIDER NAME")=USER1
"RTN","PSOORFI1",34,0)
 S PSONEW("PATIENT STATUS")=$S(+$G(^PS(55,PSODFN,"PS")):+$G(^PS(55,PSODFN,"PS")),1:"")
"RTN","PSOORFI1",35,0)
 S PSONEW("CHCS NUMBER")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^")'="":$P($G(^("EXT")),"^"),1:"")
"RTN","PSOORFI1",36,0)
 S PSONEW("EXTERNAL SYSTEM")=$S($P($G(^PS(52.41,+$G(ORD),"EXT")),"^",3)'="":$P($G(^("EXT")),"^",3),1:"")
"RTN","PSOORFI1",37,0)
 I $P(OR0,"^",22)>0 S PSONEW("DAYS SUPPLY")=$P(OR0,"^",22) G DS
"RTN","PSOORFI1",38,0)
 S PSONEW("DAYS SUPPLY")=$S(+$G(^PS(55,PSODFN,"PS"))&($P($G(^PS(53,+$G(^PS(55,PSODFN,"PS")),0)),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:30)
"RTN","PSOORFI1",39,0)
DS ;
"RTN","PSOORFI1",40,0)
 S:$D(CLOZPAT) PSONEW("DAYS SUPPLY")=$S(CLOZPAT=2&(PSONEW("DAYS SUPPLY")>28):28,CLOZPAT=1&(PSONEW("DAYS SUPPLY")>14):14,'CLOZPAT&(PSONEW("DAYS SUPPLY")>7):7,1:PSONEW("DAYS SUPPLY"))
"RTN","PSOORFI1",41,0)
 S IEN=0 D OBX                ; Display Order Checks Information
"RTN","PSOORFI1",42,0)
 D LMDISP^PSOORFI5(+$G(ORD))  ; Display Flag/Unflag Information
"RTN","PSOORFI1",43,0)
 D DIN^PSONFI(PSODRUG("OI"),$S($D(PSODRUG("IEN")):PSODRUG("IEN"),1:"")) ;Setup for N/F & DIN indicator
"RTN","PSOORFI1",44,0)
 ; pso*7*467 - add display of erx information if the rx came from eRx
"RTN","PSOORFI1",45,0)
 N ERXIEN
"RTN","PSOORFI1",46,0)
 S ERXIEN=$$CHKERX^PSOERXU1(OR0) I ERXIEN D DERX1^PSOERXU1($NA(^TMP("PSOPO",$J)),ERXIEN,"",.IEN)
"RTN","PSOORFI1",47,0)
 ; pso*7*467 - end eRx enhancement
"RTN","PSOORFI1",48,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="*(1) Orderable Item: "_$P(^PS(50.7,PSODRUG("OI"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^")_NFIO
"RTN","PSOORFI1",49,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",50,0)
 ;
"RTN","PSOORFI1",51,0)
 K LST I $G(PSODRUG("NAME"))]"" D  G PST
"RTN","PSOORFI1",52,0)
 .S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)"_$S($D(^PSDRUG("AQ",PSODRUG("IEN"))):"      CMOP ",1:"           ")_"Drug: "_PSODRUG("NAME")_NFID
"RTN","PSOORFI1",53,0)
 .S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOPO",$J,IEN,0))-4)
"RTN","PSOORFI1",54,0)
 .I $P(^PSDRUG(PSODRUG("IEN"),0),"^",10)]"" S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Drug Message:" D DRGMSG^PSOORNEW
"RTN","PSOORFI1",55,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (2)           Drug: No Dispense Drug Selected"
"RTN","PSOORFI1",56,0)
PST D DOSE^PSOORFI4 K PSOINSFL
"RTN","PSOORFI1",57,0)
 S PSOINSFL=$P($G(^PS(52.41,ORD,"INS")),"^",2)
"RTN","PSOORFI1",58,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (4)   Pat Instruct:" D INST^PSOORFI4
"RTN","PSOORFI1",59,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="  Provider Comments:" S TY=3 D INST
"RTN","PSOORFI1",60,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="       Instructions:" S TY=2 D INST
"RTN","PSOORFI1",61,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="                SIG:" D SIG
"RTN","PSOORFI1",62,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (5) Patient Status: "_$P($G(^PS(53,+PSONEW("PATIENT STATUS"),0)),"^")
"RTN","PSOORFI1",63,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (6)     Issue Date: "_PSONEW("ISSUE DATE")
"RTN","PSOORFI1",64,0)
 S (Y,PSONEW("FILL DATE"))=$S($E($P(OR0,"^",6),1,7)<DT:DT,1:$E($P(OR0,"^",6),1,7)) X ^DD("DD") S PSORX("FILL DATE")=Y,^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"        (7) Fill Date: "_Y
"RTN","PSOORFI1",65,0)
 I $P(OR0,"^",18) D
"RTN","PSOORFI1",66,0)
 .S IEN=IEN+1,Y=$P(OR0,"^",18) X ^DD("DD") S $P(^TMP("PSOPO",$J,IEN,0)," ",39)="Effective Date: "_Y
"RTN","PSOORFI1",67,0)
 D:$D(CLOZPAT) ELIG^PSOORFI2,CLQTY^PSOORFI4
"RTN","PSOORFI1",68,0)
 N PSDAYS,MAXRF
"RTN","PSOORFI1",69,0)
 S PSDAYS=$S($G(PSONEW("DAYS SUPPLY")):PSONEW("DAYS SUPPLY"),+$G(^PS(55,PSODFN,"PS"))&($P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3)):$P(^PS(53,+$G(^PS(55,PSODFN,"PS")),0),"^",3),1:"")
"RTN","PSOORFI1",70,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)=" (8)    Days Supply: "_PSDAYS
"RTN","PSOORFI1",71,0)
 S RXPT=+$G(^PS(55,PSODFN,"PS"))
"RTN","PSOORFI1",72,0)
 ; Retrieving the Maximum Number of Refills allowed
"RTN","PSOORFI1",73,0)
 S MAXRF=$$MAXNUMRF^PSOUTIL(+$G(PSODRUG("IEN")),PSDAYS,RXPT,.CLOZPAT)
"RTN","PSOORFI1",74,0)
 S PSONEW("# OF REFILLS")=$S(+$P(OR0,"^",11)>MAXRF:MAXRF,1:+$P(OR0,"^",11))
"RTN","PSOORFI1",75,0)
 KILL RXPT
"RTN","PSOORFI1",76,0)
 ;
"RTN","PSOORFI1",77,0)
 S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"                (9)   QTY"_$S($P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)]"":" ("_$P($G(^PSDRUG(+$G(PSODRUG("IEN")),660)),"^",8)_")",1:" (  )")_": "_+$G(PSONEW("QTY"))
"RTN","PSOORFI1",78,0)
 I $P($G(^PSDRUG(+$G(PSODRUG("IEN")),5)),"^")]"" D
"RTN","PSOORFI1",79,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORFI1",80,0)
 .S ^TMP("PSOPO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG(PSODRUG("IEN"),5),"^") K RN
"RTN","PSOORFI1",81,0)
 S IEN=IEN+1
"RTN","PSOORFI1",82,0)
 I $P(OR0,"^",24) S ^TMP("PSOPO",$J,IEN,0)="   Provider ordered: days supply "_+$P(OR0,"^",22)_", quantity "_+$P(OR0,"^",10)_" & refills "_+$P(OR0,"^",11)
"RTN","PSOORFI1",83,0)
 E  S ^TMP("PSOPO",$J,IEN,0)="       Provider ordered "_+$P(OR0,"^",11)_" refills"
"RTN","PSOORFI1",84,0)
 D:$D(CLOZPAT) PQTY^PSOORFI4
"RTN","PSOORFI1",85,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(10)   # of Refills: "_PSONEW("# OF REFILLS")_$E("  ",$L(PSONEW("# OF REFILLS"))+1,2)_"               (11)   Routing: "_$S($G(PSONEW("MAIL/WINDOW"))="M":"MAIL",1:"WINDOW")
"RTN","PSOORFI1",86,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(12)         Clinic: "_PSORX("CLINIC")
"RTN","PSOORFI1",87,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(13)       Provider: "_PSONEW("PROVIDER NAME")
"RTN","PSOORFI1",88,0)
 I $G(PKI),+$G(PSODRUG("DEA"))>1,+$G(PSODRUG("DEA"))<6 D PRV^PSOORFI5($P(OR0,"^",5),$P(OR0,"^",9),$P(OR0,"^"))
"RTN","PSOORFI1",89,0)
 I $P($G(^VA(200,$S($G(PSONEW("PROVIDER")):PSONEW("PROVIDER"),1:$P(OR0,"^",5)),"PS")),"^",7)&($P($G(^("PS")),"^",8)) S PSONEW("COSIGNING PROVIDER")=$P(^("PS"),"^",8) D
"RTN","PSOORFI1",90,0)
 .D USER^PSOORFI2(PSONEW("COSIGNING PROVIDER"))
"RTN","PSOORFI1",91,0)
 .S IEN=IEN+1 S ^TMP("PSOPO",$J,IEN,0)="        Cos-Provider: "_USER1
"RTN","PSOORFI1",92,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(14)         Copies: 1"
"RTN","PSOORFI1",93,0)
 S PSONEW("REMARKS")=$S($P(OR0,"^",17)="C":"Administered in Clinic.",1:"")
"RTN","PSOORFI1",94,0)
 K PSONEW("ADMINCLINIC") S:$P(OR0,"^",17)="C" PSONEW("ADMINCLINIC")=1
"RTN","PSOORFI1",95,0)
 S IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="(15)        Remarks: "_$S($G(PSONEW("REMARKS"))]"":PSONEW("REMARKS"),1:"")
"RTN","PSOORFI1",96,0)
 D USER^PSOORFI2($P(OR0,"^",4))
"RTN","PSOORFI1",97,0)
 S $P(RN," ",35)=" ",IEN=IEN+1,^TMP("PSOPO",$J,IEN,0)="   Entry By: "_USER1_$E(RN,$L(USER1)+1,35)
"RTN","PSOORFI1",98,0)
 S Y=$P(OR0,"^",12) X ^DD("DD") S ^TMP("PSOPO",$J,IEN,0)=^TMP("PSOPO",$J,IEN,0)_"Entry Date: "_$E($P(OR0,"^",12),4,5)_"/"_$E($P(OR0,"^",12),6,7)_"/"_$E($P(OR0,"^",12),2,3)_" "_$P(Y,"@",2) K RN
"RTN","PSOORFI1",99,0)
 I $P(OR0,"^",24) S PSOACT=$S($D(^XUSEC("PSDRPH",DUZ)):"DEFX",$D(^XUSEC("PSORPH",DUZ)):"F",$P($G(PSOPAR),"^",2):"F",1:"") D
"RTN","PSOORFI1",100,0)
 .K PSOCSP S PSOCSP("NAME")=$G(PSODRUG("NAME")) M PSOCSP("DOSE")=PSONEW("DOSE"),PSOCSP("DOSE ORDERED")=PSONEW("DOSE ORDERED")
"RTN","PSOORFI1",101,0)
 .S PSOCSP("# OF REFILLS")=PSONEW("# OF REFILLS") ;track original data for dig. orders
"RTN","PSOORFI1",102,0)
 .S PSOCSP("ISSUE DATE")=$E($P(OR0,"^",6),1,7),PSOCSP("QTY")=PSONEW("QTY"),PSOCSP("DAYS SUPPLY")=PSONEW("DAYS SUPPLY")
"RTN","PSOORFI1",103,0)
 E  S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEFX",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",104,0)
 ; - PSOACTOV is used to force the Pending Order to be Read-Only (no updates) even if invoked by a Pharmacist
"RTN","PSOORFI1",105,0)
 I $G(PSOACTOV) S PSOACT=""
"RTN","PSOORFI1",106,0)
 D:'$G(ACP) EN^PSOLMPO S:$G(ACP) VALMBCK="Q" D:$G(PKI1)=2 DCP^PSOPKIV1
"RTN","PSOORFI1",107,0)
 Q
"RTN","PSOORFI1",108,0)
POST ;post patient selection
"RTN","PSOORFI1",109,0)
 D POST^PSOORFI2 Q
"RTN","PSOORFI1",110,0)
SIG ;displays possible sig
"RTN","PSOORFI1",111,0)
 D SIG^PSOORFI2 Q
"RTN","PSOORFI1",112,0)
INST ;displays provider comments and pharmacy instructions
"RTN","PSOORFI1",113,0)
 S INST=0 F  S INST=$O(^PS(52.41,ORD,TY,INST)) Q:'INST  D     ;PSO*210
"RTN","PSOORFI1",114,0)
 . S (MIG,INST(INST))=^PS(52.41,ORD,TY,INST,0)
"RTN","PSOORFI1",115,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOPO",$J)),20)
"RTN","PSOORFI1",116,0)
 K INST,TY,MIG,SG
"RTN","PSOORFI1",117,0)
 Q
"RTN","PSOORFI1",118,0)
OBX ;formats obx section
"RTN","PSOORFI1",119,0)
 D OBX^PSOORFI4
"RTN","PSOORFI1",120,0)
 Q
"RTN","PSOORFI1",121,0)
ST ;sort by route or patient
"RTN","PSOORFI1",122,0)
 W !!,"Enter 'PA' to process orders by patients",!,"      'RT' to process orders by route (mail/window)",!,"      'PR' to process orders by priority",!,"      'CL' to process orders by clinic"
"RTN","PSOORFI1",123,0)
 W !,"      'FL' to process flagged orders",!,"      'CS' to process digitally signed CS orders",!,"   or 'E' or '^' to exit" W ! Q
"RTN","PSOORFI1",124,0)
RT ;which route to sort by
"RTN","PSOORFI1",125,0)
 W !!,"Enter 'W' to process window orders first",!,"      'M' to process mail orders first",!,"      'C' to process orders administered in clinic first",!,"   or 'E' or '^' to exit" Q
"RTN","PSOORFI1",126,0)
PT ;process for all or one patient
"RTN","PSOORFI1",127,0)
 W !!,"Enter 'A' to process all patient orders",!,"      'S' to process orders for a patient",!,"      or 'E' or '^' to exit" Q
"RTN","PSOORFI1",128,0)
EP ;continue processing or not
"RTN","PSOORFI1",129,0)
 W !,"If you want to continue processing orders Press RETURN or enter '^' to exit" Q
"RTN","PSOORFI1",130,0)
LOCK S PSOPLCK=$$L^PSSLOCK(PAT,0) I '$G(PSOPLCK) D LOCK^PSOORCPY S POERR("QFLG")=1
"RTN","PSOORFI1",131,0)
 K PSOPLCK
"RTN","PSOORFI1",132,0)
 Q
"RTN","PSOORFI1",133,0)
ULK S X=PAT_";DPT(" D ULK^ORX2 S:$G(PSOQUIT) POERR("QFLG")=1 ; not called anymore
"RTN","PSOORFI1",134,0)
 Q
"RTN","PSOORFI1",135,0)
LOCK1 ;
"RTN","PSOORFI1",136,0)
 I $P($G(^PS(52.41,ORD,0)),"^",24) S PSOACT=$S($D(^XUSEC("PSDRPH",DUZ)):"DEFX",$D(^XUSEC("PSORPH",DUZ)):"F",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",137,0)
 E  S PSOACT=$S($D(^XUSEC("PSORPH",DUZ)):"DEFX",'$D(^XUSEC("PSORPH",DUZ))&($P($G(PSOPAR),"^",2)):"F",1:"")
"RTN","PSOORFI1",138,0)
 Q
"RTN","PSOORFI1",139,0)
EX K DRET,SIG,PSODRUG,PRC,PHI
"RTN","PSOORFI1",140,0)
 K DIR,DIRUT,DUOUT,DIRUT,X,Y,DIC,POERR,PSONEW,PSOSD,MAIL,CLI,WIN,OR0,OR1,OR2,ORD,SRT,PSRT,PSODFN,PSOFROM,T,OR3,PAT,%,%T,%Y,DI,DQ,DR,DRG,STA,I,T1,PSOSORT,PSOCSP
"RTN","PSOORFI1",141,0)
 K TO,TC,TZ,PSOCPAY,PSOBILL,PSOIBQS,GROUPCNT,AGROUP,AGROUP1,OBX,%,%I,%H,D0,DFN,PSORX,PSOPTPST,PSOQFLG,PT,RTN,TM,TM1,DIPGM,PSOID,PSOCNT,PSOLK,PSZFIN,PSZFZZ D KVA^VADPT
"RTN","PSOORFI1",142,0)
 K PSOFDR,PSOQUIT,PSOFIN,^TMP("PSOAO",$J),^TMP("PSODA",$J),^TMP("PSOPO",$J),^TMP("PSOPF",$J),^TMP("PSOPI",$J),^TMP("PSOHDR",$J),MEDA,MEDP
"RTN","PSOORFI1",143,0)
 K C,CC,CNT,CRIT,D,DGI,DGS,DREN,IT,JJ,LG,MM,NIEN,PSOD,PATA,PSDAYS,PSOACT,PSOBM,PSOCOU,PSOCOUU,PSOFLAG,PSON,PSONOOR,PSOOPT,PSOPF,PSOPI,PSRF,RXFL,SDA,SEG1,SER,SERS,SLPPL,STAT,Z,Z4,ZDA
"RTN","PSOORFI1",144,0)
 D FULL^VALM1
"RTN","PSOORFI1",145,0)
 Q
"RTN","PSOORNE2")
0^22^B111459106^B107853949
"RTN","PSOORNE2",1,0)
PSOORNE2 ;BIR/SAB - Display finished orders from backdoor ;7/15/16 2:30pm
"RTN","PSOORNE2",2,0)
 ;;7.0;OUTPATIENT PHARMACY;**11,21,23,27,32,37,46,84,103,117,131,146,156,210,148,222,238,264,281,289,251,379,391,313,282,427,454,446,467**;DEC 1997;Build 153
"RTN","PSOORNE2",3,0)
 ;
"RTN","PSOORNE2",4,0)
 ;^PSDRUG( -  221
"RTN","PSOORNE2",5,0)
 ;^YSCL(603.01 - 2697
"RTN","PSOORNE2",6,0)
 ;^PS(50.606 - 2174
"RTN","PSOORNE2",7,0)
 ;^PS(50.7 - 2223
"RTN","PSOORNE2",8,0)
 ;PSO*210 add call to WORDWRAP api
"RTN","PSOORNE2",9,0)
 ;$$DAWEXT^PSSDAWUT - 4708
"RTN","PSOORNE2",10,0)
 ;
"RTN","PSOORNE2",11,0)
SEL N ORN,ORD,PSORRBLD I '$G(PSOCNT),'$G(PSORCNT) S VALMSG="This patient has no Prescriptions!" S VALMBCK="" Q
"RTN","PSOORNE2",12,0)
 D K1^PSOORNE6 S DIR("A")="Select Orders by number",DIR(0)="LO^1:"_$S($G(PSORCNT):PSORCNT,1:PSOCNT) D ^DIR I $D(DIRUT) D KV^PSOVER1 S VALMBCK="" Q
"RTN","PSOORNE2",13,0)
NEWSEL N ORN,ORD D K2^PSOORNE6
"RTN","PSOORNE2",14,0)
 ;*282 Correct Patient Instructions Copy
"RTN","PSOORNE2",15,0)
 I +Y S PSOOELSE=1,PSLST=Y K PSOREEDT F ORD=1:1:$L(PSLST,",") Q:$P(PSLST,",",ORD)']""  D  D UL1 K ^TMP("PSORXPO",$J),PSORXED,PSONEW,PSOPINS I $G(PSOQUIT) K PSOQUIT Q
"RTN","PSOORNE2",16,0)
 .; bwf 1/21/2014 - replaced line below with the one that follows for remote rx data handling.
"RTN","PSOORNE2",17,0)
 .;S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",1:"PEN^PSOORNE5")
"RTN","PSOORNE2",18,0)
 .S ORN=+$P(PSLST,",",ORD) D @$S(+PSOLST(ORN)=52:"ACT",$P(PSOLST(ORN),"^")="R52":"RACT",1:"PEN^PSOORNE5")
"RTN","PSOORNE2",19,0)
 .K PSOREEDT,PSOSIGFL,PSONACT,SIGOK,PSOFDR,DRET,SIG,INS1
"RTN","PSOORNE2",20,0)
 K PRC,PHI,RTE I '$G(PSOOELSE) S VALMBCK=""
"RTN","PSOORNE2",21,0)
 K PSONACT,PSOOELSE,CLOZPAT
"RTN","PSOORNE2",22,0)
 ;
"RTN","PSOORNE2",23,0)
 ; Only rebuild remote if something changed
"RTN","PSOORNE2",24,0)
 I $G(PSORRBLD) W !!,"Updating prescription order list...",!! D REMOTERX^PSORRX1(PSODFN,PSOSITE) K PSORRBLD
"RTN","PSOORNE2",25,0)
 ;
"RTN","PSOORNE2",26,0)
 D ^PSOBUILD,BLD^PSOORUT1,K3^PSOORNE6
"RTN","PSOORNE2",27,0)
 Q
"RTN","PSOORNE2",28,0)
 ;
"RTN","PSOORNE2",29,0)
ACT N REF,RPHKEY,PKIND K ^TMP("PSOAO",$J),PCOMX,PDA,PHI,PRC,ACOM,ANS,PSOFDR,CLOZPAT,ANQREM,DUR,DRET
"RTN","PSOORNE2",30,0)
 S RXN=$P(PSOLST(ORN),"^",2),RX0=^PSRX(RXN,0),RX2=$G(^(2)),RX3=$G(^(3)),ST=+$G(^("STA")),RXOR=$G(^("OR1")),POE=$G(^("POE")),EXDT=$S($P($G(^(2)),"^",6)>DT:1,1:0)
"RTN","PSOORNE2",31,0)
 I 'RX3 S $P(RX3,"^",1)=$P(RX2,"^",2),$P(^PSRX(RXN,3),"^")=$P(RX2,"^",2)
"RTN","PSOORNE2",32,0)
 S PSODRG=+$P(RX0,"^",6),PSODRUG0=^PSDRUG(PSODRG,0),INDT=$G(^("I"))
"RTN","PSOORNE2",33,0)
 ;PSO*7*238;SET PSODRUG ARRAY ; PSOY KILLED AT END OF SET^PSODRG
"RTN","PSOORNE2",34,0)
 K PSODRUG
"RTN","PSOORNE2",35,0)
 S PSOY=PSODRG,PSOY(0)=PSODRUG0 D SET^PSODRG
"RTN","PSOORNE2",36,0)
 I 'RXOR,$P(^PSDRUG(PSODRG,2),"^") S $P(^PSRX(RXN,"OR1"),"^")=$P(^PSDRUG(PSODRG,2),"^"),RXOR=$P(^PSDRUG(PSODRG,2),"^")
"RTN","PSOORNE2",37,0)
 I $P($G(^PSDRUG(PSODRG,"CLOZ1")),"^")="PSOCLO1" D
"RTN","PSOORNE2",38,0)
 .S CLOZPAT=$O(^YSCL(603.01,"C",PSODFN,0)) Q:'CLOZPAT
"RTN","PSOORNE2",39,0)
 .;S CLOZPAT=$S($P(^YSCL(603.01,CLOZPAT,0),"^",3)="B":1,1:0)
"RTN","PSOORNE2",40,0)
 .S CLOZPAT=$P(^YSCL(603.01,CLOZPAT,0),"^",3)
"RTN","PSOORNE2",41,0)
 .S CLOZPAT=$S(CLOZPAT="M":2,CLOZPAT="B":1,1:0)
"RTN","PSOORNE2",42,0)
 S PKIND=$D(^PSRX(RXN,"PKI")),RPHKEY=$S('PKIND&($D(^XUSEC("PSORPH",DUZ))):1,PKIND&($D(^XUSEC("PSDRPH",DUZ))):1,1:0)
"RTN","PSOORNE2",43,0)
 I RPHKEY S RPH=1 D
"RTN","PSOORNE2",44,0)
 .S PSOACT=$S('ST&($G(INDT)]"")&(DT>$G(INDT)):"DHPLATC",ST=1!(ST=4):"DVE",ST=3:"DU",ST=5:"ELTD",ST=11:"ETDPCL",ST=12&EXDT:"EDCL",ST=12&'EXDT:"ECL",(ST=14!(ST=15))&'EXDT:"ECL",ST=13:"L",ST=16:"DL",1:"DHPEATCL")
"RTN","PSOORNE2",45,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",46,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" K SURX Q
"RTN","PSOORNE2",47,0)
 .S:ST'=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="DL",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",48,0)
 .S:ST=12&('$D(^PS(50.7,+$P(RXOR,"^"),0))) PSOACT="L",VALMSG="No Pharmacy Orderable Item !",PSONACT=1
"RTN","PSOORNE2",49,0)
 .S:ST=16 VALMSG="Rx Placed on HOLD by Provider."
"RTN","PSOORNE2",50,0)
 E  D
"RTN","PSOORNE2",51,0)
 .I ST=5 S SURX=$O(^PS(52.5,"B",RXN,0)) I SURX,$P($G(^PS(52.5,SURX,0)),"^",7)="L" S PSOACT="TL" Q
"RTN","PSOORNE2",52,0)
 .S PSOACT=$S(ST'<1&(ST'>4)!(ST>12):"",ST=12&EXDT&($P($G(PSOPAR),"^",2)):"CDPLT",1:"CPLT")
"RTN","PSOORNE2",53,0)
 .D GET^PSOORNE5 S PSOACT=PSOACT_$S(ACTREN:"N",1:""),PSOACT=PSOACT_$S(ACTREF:"R",1:"")
"RTN","PSOORNE2",54,0)
 .S:'$D(^PS(50.7,+$P(RXOR,"^"),0)) PSOACT="L",PSONACT=1,VALMSG="No Pharmacy Orderable Item !"
"RTN","PSOORNE2",55,0)
 ;K PSOLKFL D PSOL^PSSLOCK(RXN) I '$G(PSOMSG) K PSOMSG S PSOLKFL=1 S PSOACT="",VALMSG="This Order is being edited by another user."
"RTN","PSOORNE2",56,0)
 K PSOMSG S IEN=0,$P(RN," ",12)=" "
"RTN","PSOORNE2",57,0)
 D DIN^PSONFI(+RXOR,$P(RX0,"^",6))
"RTN","PSOORNE2",58,0)
 ; pso*7*467 - add display of erx information if the rx came from eRx
"RTN","PSOORNE2",59,0)
 N ERXIEN
"RTN","PSOORNE2",60,0)
 I $P(RXOR,U,2)]"" D
"RTN","PSOORNE2",61,0)
 .S ERXIEN=$$CHKERX^PSOERXU1($P(RXOR,U,2)) I ERXIEN D DERX1^PSOERXU1($NA(^TMP("PSOAO",$J)),ERXIEN,"",.IEN)
"RTN","PSOORNE2",62,0)
 ; pso*7*467 - end eRx enhancement
"RTN","PSOORNE2",63,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=$S($P($G(^PSRX(RXN,"TPB")),"^"):"            TPB Rx #: ",1:"                Rx #: ")
"RTN","PSOORNE2",64,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_$P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$$TITRX^PSOUTL(RXN)_$E(RN,$L($P(RX0,"^")_$S($G(^PSRX(RXN,"IB")):"$",1:"")_$$ECME^PSOBPSUT(RXN)_$$TITRX^PSOUTL(RXN))+1,12)
"RTN","PSOORNE2",65,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):1,1:"#")_")"_" *Orderable Item: "_$S($D(^PS(50.7,$P(+RXOR,"^"),0)):$P(^PS(50.7,$P(+RXOR,"^"),0),"^")_" "_$P(^PS(50.606,$P(^(0),"^",2),0),"^"),1:"")_NFIO
"RTN","PSOORNE2",66,0)
 S:NFIO["<DIN>" NFIO=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",67,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" ("_$S($P(PSOPAR,"^",3):2,1:"#")_")"_$S($D(^PSDRUG("AQ",$P(RX0,"^",6))):"       CMOP ",1:"            ")_"Drug: "_$P(^PSDRUG($P(RX0,"^",6),0),"^")_NFID
"RTN","PSOORNE2",68,0)
 S:NFID["<DIN>" NFID=IEN_","_($L(^TMP("PSOAO",$J,IEN,0))-4)
"RTN","PSOORNE2",69,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" "_$S('$P(PSOPAR,"^",3):"(2)",1:"   ")_"             NDC: "_$$GETNDC^PSONDCUT(RXN,0)
"RTN","PSOORNE2",70,0)
 S:$G(^PSRX(RXN,"TN"))]"" IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="          Trade Name: "_$G(^PSRX(RXN,"TN"))
"RTN","PSOORNE2",71,0)
 D DOSE^PSOORNE5
"RTN","PSOORNE2",72,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (4)Pat Instructions:" D INS^PSOORNE5
"RTN","PSOORNE2",73,0)
 D PC^PSOORNE5
"RTN","PSOORNE2",74,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="                 SIG:"
"RTN","PSOORNE2",75,0)
 I '$P($G(^PSRX(RXN,"SIG")),"^",2) S SIGOK=0 D  G PTST
"RTN","PSOORNE2",76,0)
 .S X=$P($G(^PSRX(RXN,"SIG")),"^") D SIGONE^PSOHELP S SIG=$E($G(INS1),2,250)
"RTN","PSOORNE2",77,0)
 .F SG=1:1:$L(SIG) S:$L(^TMP("PSOAO",$J,IEN,0)_" "_$P(SIG," ",SG))>80 IEN=IEN+1,$P(^TMP("PSOAO",$J,IEN,0)," ",21)=" " S:$P(SIG," ",SG)'="" ^TMP("PSOAO",$J,IEN,0)=$G(^TMP("PSOAO",$J,IEN,0))_" "_$P(SIG," ",SG)
"RTN","PSOORNE2",78,0)
 S SIGOK=1
"RTN","PSOORNE2",79,0)
 F I=0:0 S I=$O(^PSRX(RXN,"SIG1",I)) Q:'I  D                  ;PSO*210
"RTN","PSOORNE2",80,0)
 . S MIG=$P(^PSRX(RXN,"SIG1",I,0),"^")
"RTN","PSOORNE2",81,0)
 . D WORDWRAP^PSOUTLA2(MIG,.IEN,$NA(^TMP("PSOAO",$J)),21)
"RTN","PSOORNE2",82,0)
 S SIGOK=1 K MIG,SG
"RTN","PSOORNE2",83,0)
PTST S $P(RN," ",25)=" ",PTST=$S($G(^PS(53,+$P(RX0,"^",3),0))]"":$P($G(^PS(53,+$P(RX0,"^",3),0)),"^"),1:""),IEN=IEN+1
"RTN","PSOORNE2",84,0)
 S ^TMP("PSOAO",$J,IEN,0)=" (5)  Patient Status: "_PTST_$E(RN,$L(PTST)+1,25)
"RTN","PSOORNE2",85,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)=" (6)      Issue Date: "_$E($P(RX0,"^",13),4,5)_"/"_$E($P(RX0,"^",13),6,7)_"/"_$E($P(RX0,"^",13),2,3)
"RTN","PSOORNE2",86,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (7)  Fill Date: "_$E($P(RX2,"^",2),4,5)_"/"_$E($P(RX2,"^",2),6,7)_"/"_$E($P(RX2,"^",2),2,3)
"RTN","PSOORNE2",87,0)
 S ROU=$S($P(RX0,"^",11)="W":"Window",1:"Mail")
"RTN","PSOORNE2",88,0)
 S REFL=$P(RX0,"^",9),I=0 F  S I=$O(^PSRX(RXN,1,I)) Q:'I  S REFL=REFL-1,ROU=$S($P(^PSRX(RXN,1,I,0),"^",2)="W":"Window",1:"Mail")
"RTN","PSOORNE2",89,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="      Last Fill Date: "_$E($P(RX3,"^"),4,5)_"/"_$E($P(RX3,"^"),6,7)_"/"_$E($P(RX3,"^"),2,3)
"RTN","PSOORNE2",90,0)
 D CMOP^PSOORNE3
"RTN","PSOORNE2",91,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_" ("_ROU_$S($G(PSOCMOP)]"":", "_PSOCMOP,1:"")_")" K ROU,PSOCMOP
"RTN","PSOORNE2",92,0)
 ;*282 Correct return to stock/release display
"RTN","PSOORNE2",93,0)
 S IEN=IEN+1 D
"RTN","PSOORNE2",94,0)
 .S RLD=$S($P(RX2,"^",13):$E($P(RX2,"^",13),4,5)_"/"_$E($P(RX2,"^",13),6,7)_"/"_$E($P(RX2,"^",13),2,3),1:"")
"RTN","PSOORNE2",95,0)
 .I $O(^PSRX(RXN,1,0)) F I=0:0 S I=$O(^PSRX(RXN,1,I)) Q:'I  D
"RTN","PSOORNE2",96,0)
 ..I $P(^PSRX(RXN,1,I,0),"^",18) S RLD=$E($P(^(0),"^",18),4,5)_"/"_$E($P(^(0),"^",18),6,7)_"/"_$E($P(^(0),"^",18),2,3)
"RTN","PSOORNE2",97,0)
 .I $P(RX2,"^",15)&'$G(RLD) S ^TMP("PSOAO",$J,IEN,0)="   Returned to Stock: "_$E($P(RX2,"^",15),4,5)_"/"_$E($P(RX2,"^",15),6,7)_"/"_$E($P(RX2,"^",15),2,3)_$S($P(RX2,"^",14):" (Reprinted)",1:"")
"RTN","PSOORNE2",98,0)
 .E  S ^TMP("PSOAO",$J,IEN,0)="   Last Release Date: "_$S($G(RLD)]"":RLD,1:"        ")
"RTN","PSOORNE2",99,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"               (8)      Lot #: "_$P($G(RX2),"^",4)
"RTN","PSOORNE2",100,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="             Expires: "_$E($P(RX2,"^",6),4,5)_"/"_$E($P(RX2,"^",6),6,7)_"/"_$E($P(RX2,"^",6),2,3)
"RTN","PSOORNE2",101,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                          MFG: "_$P($G(RX2),"^",8)
"RTN","PSOORNE2",102,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(9)      Days Supply: "_$P(RX0,"^",8)_$S($L($P(RX0,"^",8))=1:" ",1:"")
"RTN","PSOORNE2",103,0)
 S ^TMP("PSOAO",$J,IEN,0)=^TMP("PSOAO",$J,IEN,0)_"                    (10)  QTY"_$S($P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)]"":" ("_$P($G(^PSDRUG($P(RX0,"^",6),660)),"^",8)_")",1:" (  )")_": "_$P(RX0,"^",7)
"RTN","PSOORNE2",104,0)
 I $P($G(^PSDRUG($P(RX0,"^",6),5)),"^")]"" D
"RTN","PSOORNE2",105,0)
 .S $P(RN," ",79)=" ",IEN=IEN+1
"RTN","PSOORNE2",106,0)
 .S ^TMP("PSOAO",$J,IEN,0)=$E(RN,$L("QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^"))+1,79)_"QTY DSP MSG: "_$P(^PSDRUG($P(RX0,"^",6),5),"^") K RN
"RTN","PSOORNE2",107,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(11)    # of Refills: "_$P(RX0,"^",9)_$S($L($P(RX0,"^",9))=1:" ",1:"")_"                          Remaining: "_REFL
"RTN","PSOORNE2",108,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(12)        Provider: "_$S($D(^VA(200,$P(RX0,"^",4),0)):$P(^VA(200,$P(RX0,"^",4),0),"^"),1:"UNKNOWN")
"RTN","PSOORNE2",109,0)
 I +$P($G(^PSDRUG($P(RX0,"^",6),0)),"^",3)>1,+$P($G(^PSDRUG($P(RX0,"^",6),0)),"^",3)<6 D PRV^PSOORNE5
"RTN","PSOORNE2",110,0)
 I $P(RX3,"^",3) S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="        Cos-Provider: "_$P(^VA(200,$S($G(PSORX("COSIGNING PROVIDER")):PSORX("COSIGNING PROVIDER"),1:$P(RX3,"^",3)),0),"^")
"RTN","PSOORNE2",111,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(13)         Routing: "_$S($P(RX0,"^",11)="M":"MAIL",1:"WINDOW")_"                  (14)     Copies: "_$S($P(RX0,"^",18):$P(RX0,"^",18),1:1)
"RTN","PSOORNE2",112,0)
 S:$P(RX0,"^",11)="W"&($P(PSOPAR,"^",12)) IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="    Method of Pickup: "_$G(^PSRX(RXN,"MP"))
"RTN","PSOORNE2",113,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(15)          Clinic: "_$S($D(^SC(+$P(RX0,"^",5),0)):$P(^SC($P(RX0,"^",5),0),"^"),1:"Not on File")
"RTN","PSOORNE2",114,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(16)        Division: "_$S($G(^PS(59,+$P(RX2,"^",9),0))]"":$P(^PS(59,$P(RX2,"^",9),0),"^")_" ("_$P(^(0),"^",6)_")",1:"UNKNOWN")
"RTN","PSOORNE2",115,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(17)      Pharmacist: "_$S($P(RX2,"^",3):$P(^VA(200,$P(RX2,"^",3),0),"^"),1:"")
"RTN","PSOORNE2",116,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(18)         Remarks:" D RMK^PSOORNE3
"RTN","PSOORNE2",117,0)
 S IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(19)      Counseling: "_$S($P($G(^PSRX(RXN,"PC")),"^"):"YES",1:"NO")_"                      "_$S($P($G(^PSRX(RXN,"PC")),"^"):"Was Counseling Understood: "_$S($P($G(^PSRX(RXN,"PC")),"^",2):"YES",1:"NO"),1:"")
"RTN","PSOORNE2",118,0)
 S:$O(^PSRX(RXN,1,0)) REF=1,IEN=IEN+1,^TMP("PSOAO",$J,IEN,0)="(20)     Refill Data"
"RTN","PSOORNE2",119,0)
 I $$STATUS^PSOBPSUT(RXN,0)'="" D
"RTN","PSOORNE2",120,0)
 . N DAW S IEN=IEN+1,DAW=$$GETDAW^PSODAWUT(RXN,0)
"RTN","PSOORNE2",121,0)
 . S ^TMP("PSOAO",$J,IEN,0)="(21)        DAW Code: "_DAW_" - "_$$DAWEXT^PSSDAWUT(DAW)
"RTN","PSOORNE2",122,0)
 D DISP^PSOORNE6
"RTN","PSOORNE2",123,0)
 I $G(PSOBEDT),PSOACT["E" S PSOACT="E"
"RTN","PSOORNE2",124,0)
 I $G(PSOBEDT),PSOACT'["E" S PSOACT=""
"RTN","PSOORNE2",125,0)
 Q:$G(PSORXED)!($G(COPY))!($G(UPMI))
"RTN","PSOORNE2",126,0)
 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1
"RTN","PSOORNE2",127,0)
RENERR S PSORERR=0 D ^PSOLMLST
"RTN","PSOORNE2",128,0)
 I PSORERR=1 S:$G(PSOBEDT) (PSOEDIT,PSORXED)=1 G RENERR
"RTN","PSOORNE2",129,0)
 K DRET,SIG
"RTN","PSOORNE2",130,0)
 Q
"RTN","PSOORNE2",131,0)
UL1 ;
"RTN","PSOORNE2",132,0)
 Q
"RTN","PSOORNE2",133,0)
 ; bwf 1/21/2014 - adding display of remote active orders.
"RTN","PSOORNE2",134,0)
RACT ; display remote active order
"RTN","PSOORNE2",135,0)
 N REMSITE,CNT,REMDATA,RSITENM,RRXNUM,RDETSTR,RSIGSTR,RDET,RSIG,REMSIEN,RXSTAT,SIGLOOP,DETLOOP,DONE,SRXSTAT,SDNAME,DNAME
"RTN","PSOORNE2",136,0)
 K ^TMP("PSOAO",$J)
"RTN","PSOORNE2",137,0)
 S (RSIG,RDET)=""
"RTN","PSOORNE2",138,0)
 S REMSITE=$P(PSOLST(ORN),U,4) Q:'REMSITE
"RTN","PSOORNE2",139,0)
 S REMSIEN=$O(^DIC(4,"D",REMSITE,""))
"RTN","PSOORNE2",140,0)
 S REMSIEN=$$FIND1^DIC(4,,"X",REMSITE,"D","I $P(^(0),U,11)=""N"",'$P($G(^(99)),U,4)") Q:'REMSIEN
"RTN","PSOORNE2",141,0)
 S RSITENM=$$GET1^DIQ(4,REMSIEN,.01,"E")
"RTN","PSOORNE2",142,0)
 ; do not continue if we are missing the remote order number for some reason
"RTN","PSOORNE2",143,0)
 S RRXNUM=$P(PSOLST(ORN),U,2) Q:'RRXNUM
"RTN","PSOORNE2",144,0)
 S DONE=0
"RTN","PSOORNE2",145,0)
 S RXSTAT="" F  S RXSTAT=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT)) Q:RXSTAT=""!DONE  D
"RTN","PSOORNE2",146,0)
 .S SRXSTAT=RXSTAT
"RTN","PSOORNE2",147,0)
 .S DNAME="" F  S DNAME=$O(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT,DNAME)) Q:DNAME=""!DONE  D
"RTN","PSOORNE2",148,0)
 ..S SDNAME=DNAME
"RTN","PSOORNE2",149,0)
 ..I $P(^XTMP("PSORRX1",$J,PSODFN,REMSITE,RXSTAT,DNAME,0),U,1)=RRXNUM S DONE=1 Q
"RTN","PSOORNE2",150,0)
 Q:$G(SRXSTAT)=""
"RTN","PSOORNE2",151,0)
 S REMDATA=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,0))
"RTN","PSOORNE2",152,0)
 S RDETSTR=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,"DETAIL"))
"RTN","PSOORNE2",153,0)
 S RSIGSTR=$G(^XTMP("PSORRX1",$J,PSODFN,REMSITE,SRXSTAT,SDNAME,"SIG"))
"RTN","PSOORNE2",154,0)
 S CNT=1
"RTN","PSOORNE2",155,0)
 S ^TMP("PSOAO",$J,CNT,0)="         Site #: "_REMSITE_"("_RSITENM_")",CNT=CNT+1
"RTN","PSOORNE2",156,0)
 S ^TMP("PSOAO",$J,CNT,0)="           Rx #: "_RRXNUM,CNT=CNT+1
"RTN","PSOORNE2",157,0)
 S ^TMP("PSOAO",$J,CNT,0)="      Drug Name: "_$P(REMDATA,U,11),CNT=CNT+1
"RTN","PSOORNE2",158,0)
 S ^TMP("PSOAO",$J,CNT,0)="    Days Supply: "_$S($E($P(REMDATA,U,4),1)?1A:$E($P(REMDATA,U,4),2,99),1:$P(REMDATA,U,4)),CNT=CNT+1
"RTN","PSOORNE2",159,0)
 S ^TMP("PSOAO",$J,CNT,0)="       Quantity: "_$P(REMDATA,U,2),CNT=CNT+1
"RTN","PSOORNE2",160,0)
 S ^TMP("PSOAO",$J,CNT,0)="        Refills: "_$P(REMDATA,U,3),CNT=CNT+1
"RTN","PSOORNE2",161,0)
 S ^TMP("PSOAO",$J,CNT,0)="Expiration Date: "_$$RDT($P($P(REMDATA,U,5),".")),CNT=CNT+1
"RTN","PSOORNE2",162,0)
 S ^TMP("PSOAO",$J,CNT,0)="     Issue Date: "_$$RDT($P($P(REMDATA,U,6),".")),CNT=CNT+1
"RTN","PSOORNE2",163,0)
 S ^TMP("PSOAO",$J,CNT,0)="      Stop Date: "_$$RDT($P($P(REMDATA,U,7),".")),CNT=CNT+1
"RTN","PSOORNE2",164,0)
 S ^TMP("PSOAO",$J,CNT,0)=" Last Fill Date: "_$$RDT($P($P(REMDATA,U,8),".")),CNT=CNT+1
"RTN","PSOORNE2",165,0)
 ;D RCHUNK(.RDET,RDETSTR),RCHUNK(.RSIG,RSIGSTR)
"RTN","PSOORNE2",166,0)
 ;S ^TMP("PSOAO",$J,CNT,0)="         Detail: "_$G(RDET(1)),CNT=CNT+1
"RTN","PSOORNE2",167,0)
 ;S DETLOOP=1 F  S DETLOOP=$O(RDET(DETLOOP)) Q:'DETLOOP  D
"RTN","PSOORNE2",168,0)
 ;.S ^TMP("PSOAO",$J,CNT,0)="               "_RDET(DETLOOP),CNT=CNT+1
"RTN","PSOORNE2",169,0)
 D RCHUNK(.RSIG,RSIGSTR)
"RTN","PSOORNE2",170,0)
 S ^TMP("PSOAO",$J,CNT,0)="            Sig: "_$G(RSIG(1))
"RTN","PSOORNE2",171,0)
 S SIGLOOP=1 F  S SIGLOOP=$O(RSIG(SIGLOOP)) Q:'SIGLOOP  D
"RTN","PSOORNE2",172,0)
 .S CNT=CNT+1,^TMP("PSOAO",$J,CNT,0)="               "_RSIG(SIGLOOP)
"RTN","PSOORNE2",173,0)
 ; ^PSOLMLST is the local order template
"RTN","PSOORNE2",174,0)
 D EN^PSOROS
"RTN","PSOORNE2",175,0)
 Q
"RTN","PSOORNE2",176,0)
RCHUNK(ARR,STR) ;
"RTN","PSOORNE2",177,0)
 N START,END,I,C,ROOM
"RTN","PSOORNE2",178,0)
 S ROOM=60
"RTN","PSOORNE2",179,0)
 ; if there is enough room for 1 line, no wrapping needed
"RTN","PSOORNE2",180,0)
 I $L(STR)'>ROOM S ARR(1)=STR Q
"RTN","PSOORNE2",181,0)
 ; add a space to the end of the string to avoid dropping last character
"RTN","PSOORNE2",182,0)
 S START=1,END=ROOM,STR=STR_" "
"RTN","PSOORNE2",183,0)
 F C=1:1 D  Q:$L(STR)<START  ; stop if we have made it to the end of the data string
"RTN","PSOORNE2",184,0)
 .; start at the end and work backwards until you find a blank space, cut the line there and move on to the next line 
"RTN","PSOORNE2",185,0)
 .F I=END:-1:START I $E(STR,I)=" " S ARR(C)=$E(STR,START,I),START=I+1,END=ROOM+START Q
"RTN","PSOORNE2",186,0)
 .; make sure there wasn't a really long string without spaces
"RTN","PSOORNE2",187,0)
 .I I=START S ARR(C)=$E(STR,START,END),START=END+1,END=ROOM+START
"RTN","PSOORNE2",188,0)
 Q
"RTN","PSOORNE2",189,0)
RDT(DATE) ;
"RTN","PSOORNE2",190,0)
 N Y,M,D
"RTN","PSOORNE2",191,0)
 S Y=$E(DATE,3,4),M=$E(DATE,5,6),D=$E(DATE,7,8)
"RTN","PSOORNE2",192,0)
 Q M_"/"_D_"/"_Y
"SEC","^DIC",52.45,52.45,0,"AUDIT")
@
"SEC","^DIC",52.45,52.45,0,"DD")
@
"SEC","^DIC",52.45,52.45,0,"DEL")
@
"SEC","^DIC",52.45,52.45,0,"LAYGO")
@
"SEC","^DIC",52.45,52.45,0,"RD")
@
"SEC","^DIC",52.45,52.45,0,"WR")
@
"SEC","^DIC",52.46,52.46,0,"AUDIT")
@
"SEC","^DIC",52.46,52.46,0,"DD")
@
"SEC","^DIC",52.46,52.46,0,"DEL")
@
"SEC","^DIC",52.46,52.46,0,"LAYGO")
@
"SEC","^DIC",52.46,52.46,0,"RD")
@
"SEC","^DIC",52.46,52.46,0,"WR")
@
"SEC","^DIC",52.47,52.47,0,"AUDIT")
@
"SEC","^DIC",52.47,52.47,0,"DD")
@
"SEC","^DIC",52.47,52.47,0,"DEL")
@
"SEC","^DIC",52.47,52.47,0,"LAYGO")
@
"SEC","^DIC",52.47,52.47,0,"RD")
@
"SEC","^DIC",52.47,52.47,0,"WR")
@
"SEC","^DIC",52.48,52.48,0,"AUDIT")
@
"SEC","^DIC",52.48,52.48,0,"DD")
@
"SEC","^DIC",52.48,52.48,0,"DEL")
@
"SEC","^DIC",52.48,52.48,0,"LAYGO")
@
"SEC","^DIC",52.48,52.48,0,"RD")
@
"SEC","^DIC",52.48,52.48,0,"WR")
@
"SEC","^DIC",52.49,52.49,0,"AUDIT")
@
"SEC","^DIC",52.49,52.49,0,"DD")
@
"SEC","^DIC",52.49,52.49,0,"DEL")
@
"SEC","^DIC",52.49,52.49,0,"LAYGO")
@
"SEC","^DIC",52.49,52.49,0,"RD")
@
"SEC","^DIC",52.49,52.49,0,"WR")
@
"VER")
8.0^22.2
"^DD",50,50,22,0)
PSNDF VA PRODUCT NAME ENTRY^P50.68O^PSNDF(50.68,^ND;3^Q
"^DD",50,50,22,1,0)
^.1
"^DD",50,50,22,1,1,0)
50^APN2^MUMPS
"^DD",50,50,22,1,1,1)
S X(1)=$P($G(^PSDRUG(DA,2)),"^",6) I X(1) S X(2)=$P($G(^("ND")),"^") I X(2)]"" S ^PSDRUG("APN",X(1),X(2)_"A"_X,DA)=""
"^DD",50,50,22,1,1,2)
S X(1)=$P($G(^PSDRUG(DA,2)),"^",6) I X(1) S X(2)=$P($G(^("ND")),"^") I X(2)]"" K ^PSDRUG("APN",X(1),X(2)_"A"_X,DA)
"^DD",50,50,22,1,1,3)
Needed by Inpatient Medications
"^DD",50,50,22,1,1,"%D",0)
^^2^2^2910807^
"^DD",50,50,22,1,1,"%D",1,0)
  Used by Inpatient Medications as a gateway from Primary Drug to National
"^DD",50,50,22,1,1,"%D",2,0)
Drug File.
"^DD",50,50,22,1,1,"DT")
2910807
"^DD",50,50,22,1,2,0)
50^APR
"^DD",50,50,22,1,2,1)
S ^PSDRUG("APR",$E(X,1,30),DA)=""
"^DD",50,50,22,1,2,2)
K ^PSDRUG("APR",$E(X,1,30),DA)
"^DD",50,50,22,1,2,"%D",0)
^^1^1^3160805^
"^DD",50,50,22,1,2,"%D",1,0)
This cross reference indexes the drug with the VA PRODUCT in file #50.67.
"^DD",50,50,22,1,2,"DT")
3160805
"^DD",50,50,22,2)
S Y(0)=Y D FORM^PSNOUT
"^DD",50,50,22,2.1)
D FORM^PSNOUT
"^DD",50,50,22,3)

"^DD",50,50,22,8.5)
^
"^DD",50,50,22,9)
^
"^DD",50,50,22,20,0)
^.3LA^1^1
"^DD",50,50,22,20,1,0)
PSN
"^DD",50,50,22,21,0)
^^1^1^2980919^^
"^DD",50,50,22,21,1,0)
This is the pointer to the VA Product file in the National Drug File package.
"^DD",50,50,22,"DT")
3160805
"^DD",52.45,52.45,0)
FIELD^^.001^5
"^DD",52.45,52.45,0,"DT")
3170404
"^DD",52.45,52.45,0,"ID",.02)
W "   ",$P(^(0),U,2)
"^DD",52.45,52.45,0,"IX","B",52.45,.01)

"^DD",52.45,52.45,0,"IX","D",52.45,.02)

"^DD",52.45,52.45,0,"IX","TYPE",52.45,.03)

"^DD",52.45,52.45,0,"NM","ERX SERVICE REASON CODES")

"^DD",52.45,52.45,0,"PT",52.49,1)

"^DD",52.45,52.45,0,"PT",52.49,4.11)

"^DD",52.45,52.45,0,"PT",52.49,10.3)

"^DD",52.45,52.45,0,"PT",52.4916,.01)

"^DD",52.45,52.45,0,"PT",52.4916,.02)

"^DD",52.45,52.45,0,"PT",52.4916,.03)

"^DD",52.45,52.45,0,"PT",52.4916,.05)

"^DD",52.45,52.45,0,"PT",52.4919,.02)

"^DD",52.45,52.45,0,"PT",52.4928,.02)

"^DD",52.45,52.45,.001,0)
NUMBER^NJ4,0^^ ^K:+X'=X!(X>9999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.45,52.45,.001,3)
Enter the numeric identifier for this eRx code. Type a number between 1 and 9999, 0 decimal digits.
"^DD",52.45,52.45,.001,21,0)
^^1^1^3170329^
"^DD",52.45,52.45,.001,21,1,0)
This field contains the internal record number of the code.
"^DD",52.45,52.45,.001,"DT")
3170329
"^DD",52.45,52.45,.01,0)
SERVICE REASON CODE^RF^^0;1^K:$L(X)>10!($L(X)<1)!'(X'?1P.E) X
"^DD",52.45,52.45,.01,1,0)
^.1
"^DD",52.45,52.45,.01,1,1,0)
52.45^B
"^DD",52.45,52.45,.01,1,1,1)
S ^PS(52.45,"B",$E(X,1,30),DA)=""
"^DD",52.45,52.45,.01,1,1,2)
K ^PS(52.45,"B",$E(X,1,30),DA)
"^DD",52.45,52.45,.01,3)
Enter the code associated with this action. Answer must be 1-10 characters in length.
"^DD",52.45,52.45,.01,21,0)
^.001^1^1^3170328^^
"^DD",52.45,52.45,.01,21,1,0)
This is the eRx service reason code.
"^DD",52.45,52.45,.01,"DT")
3170328
"^DD",52.45,52.45,.02,0)
BRIEF DESCRIPTION^F^^0;2^K:$L(X)>50!($L(X)<3) X
"^DD",52.45,52.45,.02,1,0)
^.1
"^DD",52.45,52.45,.02,1,1,0)
52.45^D
"^DD",52.45,52.45,.02,1,1,1)
S ^PS(52.45,"D",$E(X,1,30),DA)=""
"^DD",52.45,52.45,.02,1,1,2)
K ^PS(52.45,"D",$E(X,1,30),DA)
"^DD",52.45,52.45,.02,1,1,"%D",0)
^^2^2^3170626^
"^DD",52.45,52.45,.02,1,1,"%D",1,0)
Index for this description so file manager can display information when
"^DD",52.45,52.45,.02,1,1,"%D",2,0)
doing a lookup.
"^DD",52.45,52.45,.02,1,1,"DT")
3170329
"^DD",52.45,52.45,.02,3)
Enter the brief description for the eRx service reason code. Answer must be 3-50 characters in length.
"^DD",52.45,52.45,.02,21,0)
^^1^1^3161207^
"^DD",52.45,52.45,.02,21,1,0)
This is the brief description of the eRx service reason code.
"^DD",52.45,52.45,.02,"DT")
3170329
"^DD",52.45,52.45,.03,0)
CODE TYPE^S^REA:SERVICE REASON;RES:SERVICE RESULT;PSC:PROFESSIONAL SERVICE;ERX:ERX STATUS;DCS:DRUG COVERAGE STATUS;PAV:PRIOR AUTHORIZATION VALUE;CAQ:CO-AGENT QUALIFIER;REJ:REJECT REASON;REM:REMOVAL REASON;DDB:DRUG DB QUAL;^0;3^Q
"^DD",52.45,52.45,.03,1,0)
^.1
"^DD",52.45,52.45,.03,1,1,0)
52.45^TYPE
"^DD",52.45,52.45,.03,1,1,1)
S ^PS(52.45,"TYPE",$E(X,1,30),DA)=""
"^DD",52.45,52.45,.03,1,1,2)
K ^PS(52.45,"TYPE",$E(X,1,30),DA)
"^DD",52.45,52.45,.03,1,1,"%D",0)
^^1^1^3170516^
"^DD",52.45,52.45,.03,1,1,"%D",1,0)
This creates an index by type and IEN.
"^DD",52.45,52.45,.03,1,1,"DT")
3170516
"^DD",52.45,52.45,.03,3)
Enter the type associated with the eRx service code.
"^DD",52.45,52.45,.03,21,0)
^^1^1^3170506^
"^DD",52.45,52.45,.03,21,1,0)
This is the type of the service reason code.
"^DD",52.45,52.45,.03,"DT")
3170516
"^DD",52.45,52.45,1,0)
FULL DESCRIPTION^52.451^^1;0
"^DD",52.45,52.451,0)
FULL DESCRIPTION SUB-FIELD^^.01^1
"^DD",52.45,52.451,0,"DT")
3161207
"^DD",52.45,52.451,0,"NM","FULL DESCRIPTION")

"^DD",52.45,52.451,0,"UP")
52.45
"^DD",52.45,52.451,.01,0)
FULL DESCRIPTION^Wx^^0;1^Q
"^DD",52.45,52.451,.01,3)
Enter the full description of the service reason code.
"^DD",52.45,52.451,.01,21,0)
^^1^1^3161207^
"^DD",52.45,52.451,.01,21,1,0)
This is the full description associated with the eRx service reason code.
"^DD",52.45,52.451,.01,"DT")
3161207
"^DD",52.46,52.46,0)
FIELD^^1.7^23
"^DD",52.46,52.46,0,"DT")
3170426
"^DD",52.46,52.46,0,"ID",.08)
W:$D(^(1)) "   ",$$FMTE^DILIBF($P(^(1),U,4),6)
"^DD",52.46,52.46,0,"ID",1.4)
W:$D(^(2)) "   ",$P(^(2),U,4)
"^DD",52.46,52.46,0,"IX","B",52.46,.01)

"^DD",52.46,52.46,0,"IX","DOB",52.46,.08)

"^DD",52.46,52.46,0,"IX","SSN",52.46,1.4)

"^DD",52.46,52.46,0,"NM","ERX EXTERNAL PATIENT")

"^DD",52.46,52.46,0,"PT",52.49,.04)

"^DD",52.46,52.46,.01,0)
NAME^RF^^0;1^K:$L(X)>107!($L(X)<3)!'(X'?1P.E) X
"^DD",52.46,52.46,.01,1,0)
^.1^^-1
"^DD",52.46,52.46,.01,1,1,0)
52.46^B
"^DD",52.46,52.46,.01,1,1,1)
S ^PS(52.46,"B",$E(X,1,30),DA)=""
"^DD",52.46,52.46,.01,1,1,2)
K ^PS(52.46,"B",$E(X,1,30),DA)
"^DD",52.46,52.46,.01,3)
Enter the name of the eRx External patient. Answer must be 3-107 characters in length.
"^DD",52.46,52.46,.01,21,0)
^.001^1^1^3161214^^^
"^DD",52.46,52.46,.01,21,1,0)
This is the name of the eRx external pharmacy patient.
"^DD",52.46,52.46,.01,"DT")
3170726
"^DD",52.46,52.46,.02,0)
LAST NAME^RF^^0;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,.02,3)
Enter the last name of the eRx external patient. Answer must be 3-35 characters in length.
"^DD",52.46,52.46,.02,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.02,21,1,0)
This is the last name of the eRx external patient.
"^DD",52.46,52.46,.02,"DT")
3161214
"^DD",52.46,52.46,.03,0)
FIRST NAME^RF^^0;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,.03,3)
Enter the first name of the eRx external patient. Answer must be 3-35 characters in length.
"^DD",52.46,52.46,.03,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.03,21,1,0)
This is the first name of the external pharmacy patient.
"^DD",52.46,52.46,.03,"DT")
3161214
"^DD",52.46,52.46,.04,0)
MIDDLE NAME^F^^0;4^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,.04,3)
Enter the middle name of the eRx external patient. Answer must be 3-35 characters in length.
"^DD",52.46,52.46,.04,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.04,21,1,0)
This is the middle name of the eRx external patient.
"^DD",52.46,52.46,.04,"DT")
3161214
"^DD",52.46,52.46,.05,0)
SUFFIX^F^^1;1^K:$L(X)>10!($L(X)<1) X
"^DD",52.46,52.46,.05,3)
Enter the suffix for the eRx external patient. Answer must be 1-10 characters in length.
"^DD",52.46,52.46,.05,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.05,21,1,0)
This is the suffix associated with the eRx external patient.
"^DD",52.46,52.46,.05,"DT")
3161214
"^DD",52.46,52.46,.06,0)
PREFIX^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",52.46,52.46,.06,3)
Enter the prefix for the eRx external patient. Answer must be 1-10 characters in length.
"^DD",52.46,52.46,.06,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.06,21,1,0)
This is the prefix for the eRx external patient.
"^DD",52.46,52.46,.06,"DT")
3161214
"^DD",52.46,52.46,.07,0)
GENDER^S^M:MALE;F:FEMALE;O:OTHER;N:NOT IDENTIFIED;^1;3^Q
"^DD",52.46,52.46,.07,3)
Enter the gender associated with the eRx external patient.
"^DD",52.46,52.46,.07,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.07,21,1,0)
This is the patient gender.
"^DD",52.46,52.46,.07,"DT")
3161214
"^DD",52.46,52.46,.08,0)
DATE OF BIRTH^D^^1;4^S %DT="E" D ^%DT S X=Y K:Y<1 X
"^DD",52.46,52.46,.08,1,0)
^.1
"^DD",52.46,52.46,.08,1,1,0)
52.46^DOB
"^DD",52.46,52.46,.08,1,1,1)
S ^PS(52.46,"DOB",$E(X,1,30),DA)=""
"^DD",52.46,52.46,.08,1,1,2)
K ^PS(52.46,"DOB",$E(X,1,30),DA)
"^DD",52.46,52.46,.08,1,1,"%D",0)
^^1^1^3170516^
"^DD",52.46,52.46,.08,1,1,"%D",1,0)
This indexes patients by DOB.
"^DD",52.46,52.46,.08,1,1,"DT")
3170516
"^DD",52.46,52.46,.08,3)
Enter the date of birth for the eRx external patient.
"^DD",52.46,52.46,.08,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.08,21,1,0)
The eRx patient date of birth.
"^DD",52.46,52.46,.08,"DT")
3170516
"^DD",52.46,52.46,.09,0)
ERX EXTERNAL PHARMACY^F^^1;5^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.46,.09,3)
Enter the eRx external pharmacy associated with this patient. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,.09,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,.09,21,1,0)
This is the eRx external pharmacy that is associated with this patient.
"^DD",52.46,52.46,.09,"DT")
3161214
"^DD",52.46,52.46,1.1,0)
FILE ID^F^^2;1^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.46,1.1,3)
Enter the file id for this patient. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,1.1,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,1.1,21,1,0)
This is the file id for the external patient.
"^DD",52.46,52.46,1.1,"DT")
3161214
"^DD",52.46,52.46,1.2,0)
MEDICAL RECORD ID #^F^^2;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.46,1.2,3)
Enter the medical record identification number. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,1.2,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,1.2,21,1,0)
This is the medical identification number for this eRx patient.
"^DD",52.46,52.46,1.2,"DT")
3161214
"^DD",52.46,52.46,1.3,0)
ACCOUNT NUMBER^F^^2;3^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.46,1.3,3)
Enter the account number associated with this eRx patient. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,1.3,21,0)
^^1^1^3161214^
"^DD",52.46,52.46,1.3,21,1,0)
This is the patient account number.
"^DD",52.46,52.46,1.3,"DT")
3161214
"^DD",52.46,52.46,1.4,0)
SSN^F^^2;4^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.46,1.4,1,0)
^.1
"^DD",52.46,52.46,1.4,1,1,0)
52.46^SSN
"^DD",52.46,52.46,1.4,1,1,1)
S ^PS(52.46,"SSN",$E(X,1,30),DA)=""
"^DD",52.46,52.46,1.4,1,1,2)
K ^PS(52.46,"SSN",$E(X,1,30),DA)
"^DD",52.46,52.46,1.4,1,1,"%D",0)
^^1^1^3170516^
"^DD",52.46,52.46,1.4,1,1,"%D",1,0)
This indexes the patient by his/her social security number.
"^DD",52.46,52.46,1.4,1,1,"DT")
3170516
"^DD",52.46,52.46,1.4,3)
Enter the SSN for the eRx external patient. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,1.4,21,0)
^.001^1^1^3170501^^
"^DD",52.46,52.46,1.4,21,1,0)
The SSN sent in for the eRx external patient.
"^DD",52.46,52.46,1.4,"DT")
3170516
"^DD",52.46,52.46,1.5,0)
LINKED VISTA PATIENT^P2'^DPT(^2;5^Q
"^DD",52.46,52.46,1.5,3)
Enter the Vista patient that matches this eRx external patient.
"^DD",52.46,52.46,1.5,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,1.5,21,1,0)
This is the vista patient that matches the incoming eRx external patient.
"^DD",52.46,52.46,1.5,"DT")
3161215
"^DD",52.46,52.46,1.6,0)
PLACE/LOCATION QUALIFIER^F^^2;6^K:$L(X)>3!($L(X)<1) X
"^DD",52.46,52.46,1.6,3)
Enter the place/location qualifier associated with this eRx patient. Answer must be 1-3 characters in length.
"^DD",52.46,52.46,1.6,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,1.6,21,1,0)
This is the place/location qualifier as passed in by the external source.
"^DD",52.46,52.46,1.6,"DT")
3161215
"^DD",52.46,52.46,1.7,0)
PATIENT RELATIONSHIP^S^1:MEMBER;2:SPOUSE;3:CHILD/DEPENDENT;4:OTHER;^1;7^Q
"^DD",52.46,52.46,1.7,3)
Enter the patient relationship to the cardholder.
"^DD",52.46,52.46,1.7,21,0)
^^1^1^3170417^
"^DD",52.46,52.46,1.7,21,1,0)
This is the relationship of the patient to the cardholder.
"^DD",52.46,52.46,1.7,"DT")
3170417
"^DD",52.46,52.46,2,0)
COMMUNICATION^52.462A^^3;0
"^DD",52.46,52.46,2,21,0)
^.001^1^1^3170705^^
"^DD",52.46,52.46,2,21,1,0)
This multiple holds the communication values for an eRx external person.
"^DD",52.46,52.46,3.1,0)
ADDRESS LINE 1^F^^4;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,3.1,3)
Enter the first line of the address. Answer must be 1-35 characters in length.
"^DD",52.46,52.46,3.1,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,3.1,21,1,0)
Address line 1 for the eRx patient.
"^DD",52.46,52.46,3.1,"DT")
3161215
"^DD",52.46,52.46,3.2,0)
ADDRESS LINE 2^F^^4;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,3.2,3)
Enter address line 2 for the eRx patient. Answer must be 3-35 characters in length.
"^DD",52.46,52.46,3.2,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,3.2,21,1,0)
Address line 2 for the eRx patient.
"^DD",52.46,52.46,3.2,"DT")
3161215
"^DD",52.46,52.46,3.3,0)
CITY^F^^4;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.46,52.46,3.3,3)
Enter the city associated with the eRx patient. Answer must be 3-35 characters in length.
"^DD",52.46,52.46,3.3,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,3.3,21,1,0)
This is the city identified for the eRx patient.
"^DD",52.46,52.46,3.3,"DT")
3161215
"^DD",52.46,52.46,3.4,0)
STATE^P5'^DIC(5,^4;4^Q
"^DD",52.46,52.46,3.4,3)
Enter the state where this patient resides.
"^DD",52.46,52.46,3.4,21,0)
^^1^1^3161215^
"^DD",52.46,52.46,3.4,21,1,0)
This is the state associated with the eRx external patient.
"^DD",52.46,52.46,3.4,"DT")
3161215
"^DD",52.46,52.46,3.5,0)
ZIP CODE^F^^4;5^K:$L(X)>9!($L(X)<5) X
"^DD",52.46,52.46,3.5,3)
Enter the zip code associated with the incoming eRx patient. Answer must be 5-9 characters in length.
"^DD",52.46,52.46,3.5,21,0)
^.001^1^1^3170426^^^
"^DD",52.46,52.46,3.5,21,1,0)
This is the zip code for the eRx external patient.
"^DD",52.46,52.46,3.5,"DT")
3170426
"^DD",52.46,52.46,5,0)
IDENTIFICATION^52.465A^^5;0
"^DD",52.46,52.46,5,21,0)
^^2^2^3170705^
"^DD",52.46,52.46,5,21,1,0)
This multiple contains the identification values for an eRx external 
"^DD",52.46,52.46,5,21,2,0)
person.
"^DD",52.46,52.462,0)
COMMUNICATION SUB-FIELD^^.02^2
"^DD",52.46,52.462,0,"DT")
3170403
"^DD",52.46,52.462,0,"IX","B",52.462,.01)

"^DD",52.46,52.462,0,"IX","C",52.462,.02)

"^DD",52.46,52.462,0,"NM","COMMUNICATION")

"^DD",52.46,52.462,0,"UP")
52.46
"^DD",52.46,52.462,.01,0)
VALUE^F^^0;1^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.462,.01,1,0)
^.1
"^DD",52.46,52.462,.01,1,1,0)
52.462^B
"^DD",52.46,52.462,.01,1,1,1)
S ^PS(52.46,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",52.46,52.462,.01,1,1,2)
K ^PS(52.46,DA(1),3,"B",$E(X,1,30),DA)
"^DD",52.46,52.462,.01,3)
Enter the communication value for this patient. Answer must be 1-35 characters in length.
"^DD",52.46,52.462,.01,21,0)
^^2^2^3161215^
"^DD",52.46,52.462,.01,21,1,0)
This is the value such as phone number or cellular number for the eRx 
"^DD",52.46,52.462,.01,21,2,0)
patient.
"^DD",52.46,52.462,.01,"DT")
3161215
"^DD",52.46,52.462,.02,0)
TYPE^S^BN:BEEPER;CP:CELLULAR;EM:ELECTRONIC MAIL;FX:FAX;HP:HOME PHONE;NP:NIGHT PHONE;TE:TELEPHONE;WP:WORK PHONE;^0;2^Q
"^DD",52.46,52.462,.02,1,0)
^.1
"^DD",52.46,52.462,.02,1,1,0)
52.462^C
"^DD",52.46,52.462,.02,1,1,1)
S ^PS(52.46,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",52.46,52.462,.02,1,1,2)
K ^PS(52.46,DA(1),3,"C",$E(X,1,30),DA)
"^DD",52.46,52.462,.02,1,1,"%D",0)
^^1^1^3161219^
"^DD",52.46,52.462,.02,1,1,"%D",1,0)
This index provides an index on the communication type.
"^DD",52.46,52.462,.02,1,1,"DT")
3161219
"^DD",52.46,52.462,.02,3)
Select the communication type for this communication value.
"^DD",52.46,52.462,.02,21,0)
^.001^1^1^3170403^^^^
"^DD",52.46,52.462,.02,21,1,0)
This is the type associated with the communication value.
"^DD",52.46,52.462,.02,"DT")
3170403
"^DD",52.46,52.465,0)
IDENTIFICATION SUB-FIELD^^.02^2
"^DD",52.46,52.465,0,"DT")
3170306
"^DD",52.46,52.465,0,"IX","B",52.465,.01)

"^DD",52.46,52.465,0,"NM","IDENTIFICATION")

"^DD",52.46,52.465,0,"UP")
52.46
"^DD",52.46,52.465,.01,0)
ID NAME/TYPE^F^^0;1^K:$L(X)>50!($L(X)<3) X
"^DD",52.46,52.465,.01,1,0)
^.1
"^DD",52.46,52.465,.01,1,1,0)
52.465^B
"^DD",52.46,52.465,.01,1,1,1)
S ^PS(52.46,DA(1),5,"B",$E(X,1,30),DA)=""
"^DD",52.46,52.465,.01,1,1,2)
K ^PS(52.46,DA(1),5,"B",$E(X,1,30),DA)
"^DD",52.46,52.465,.01,3)
Enter the identification name/type. Answer must be 3-50 characters in length.
"^DD",52.46,52.465,.01,21,0)
^.001^1^1^3170306^^
"^DD",52.46,52.465,.01,21,1,0)
This is the identification name/type for the incoming eRx patient.
"^DD",52.46,52.465,.01,"DT")
3170306
"^DD",52.46,52.465,.02,0)
ID VALUE^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.46,52.465,.02,3)
Enter the identification value. Answer must be 1-35 characters in length.
"^DD",52.46,52.465,.02,21,0)
^^1^1^3170306^
"^DD",52.46,52.465,.02,21,1,0)
This is the value associated with the identification name/type.
"^DD",52.46,52.465,.02,"DT")
3170306
"^DD",52.47,52.47,0)
FIELD^^2^16
"^DD",52.47,52.47,0,"DT")
3170814
"^DD",52.47,52.47,0,"NM","ERX EXTERNAL PHARMACY")

"^DD",52.47,52.47,0,"PT",52.48,1.3)

"^DD",52.47,52.47,.01,0)
NAME^RF^^0;1^K:$L(X)>35!($L(X)<3)!'(X'?1P.E) X
"^DD",52.47,52.47,.01,1,0)
^.1^^0
"^DD",52.47,52.47,.01,3)
Enter the name of the eRx external pharmacy. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,.01,21,0)
^.001^1^1^3170814^^^
"^DD",52.47,52.47,.01,21,1,0)
This is the name of the eRx external pharmacy.
"^DD",52.47,52.47,.01,"DT")
3170814
"^DD",52.47,52.47,.02,0)
NCPDP ID^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.47,52.47,.02,3)
Enter the NCPDP identifier. Answer must be 1-35 characters in length.
"^DD",52.47,52.47,.02,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,.02,21,1,0)
This is the NCPDP identifier for this pharmacy.
"^DD",52.47,52.47,.02,"DT")
3160831
"^DD",52.47,52.47,.03,0)
NPI^F^^0;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,.03,3)
Enter the NPI for this external pharmacy. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,.03,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,.03,21,1,0)
This is the NPI for the external pharmacy.
"^DD",52.47,52.47,.03,"DT")
3160831
"^DD",52.47,52.47,.04,0)
DEA NUMBER^F^^0;4^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,.04,3)
Enter the DEA number for this external pharmacy. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,.04,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,.04,21,1,0)
The DEA Number for the external pharmacy.
"^DD",52.47,52.47,.04,"DT")
3160831
"^DD",52.47,52.47,.05,0)
STORE NAME^F^^0;5^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,.05,3)
Enter the name of the pharmacy/store. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,.05,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,.05,21,1,0)
This is the name of the pharmacy/store, such as CSV, WALGREENS, etc.
"^DD",52.47,52.47,.05,"DT")
3160831
"^DD",52.47,52.47,1.1,0)
ADDRESS LINE 1^F^^1;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,1.1,3)
Enter address line 1 for this external pharmacy. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,1.1,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,1.1,21,1,0)
Address line 1 for the external pharmacy/store.
"^DD",52.47,52.47,1.1,"DT")
3160831
"^DD",52.47,52.47,1.2,0)
ADDRESS LINE 2^F^^1;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,1.2,3)
Enter address line 2 for this external pharmacy. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,1.2,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,1.2,21,1,0)
Address line 2 for the external pharmacy/store.
"^DD",52.47,52.47,1.2,"DT")
3160831
"^DD",52.47,52.47,1.3,0)
CITY^F^^1;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.47,52.47,1.3,3)
Enter the City where this external pharmacy resides. Answer must be 3-35 characters in length.
"^DD",52.47,52.47,1.3,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,1.3,21,1,0)
This is the city associated with the external pharmacy/store.
"^DD",52.47,52.47,1.3,"DT")
3160831
"^DD",52.47,52.47,1.4,0)
STATE^P5'^DIC(5,^1;4^Q
"^DD",52.47,52.47,1.4,3)
Enter the state associated with the external pharmacy/store.
"^DD",52.47,52.47,1.4,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,1.4,21,1,0)
This is the state in which the external pharmacy/store resides.
"^DD",52.47,52.47,1.4,"DT")
3160831
"^DD",52.47,52.47,1.5,0)
ZIP^F^^1;5^K:$L(X)>9!($L(X)<5) X
"^DD",52.47,52.47,1.5,3)
Enter the zip code for this pharmacy/store. Answer must be 5-9 characters in length.
"^DD",52.47,52.47,1.5,21,0)
^.001^1^1^3170426^^
"^DD",52.47,52.47,1.5,21,1,0)
The zip code for the pharmacy/store.
"^DD",52.47,52.47,1.5,"DT")
3170426
"^DD",52.47,52.47,1.6,0)
TYPE^S^VA:VA FACILITY;EF:EXTERNAL FACILITY;EP:EXTERNAL PHARMACY;OP:OTHER FACILITY;^1;6^Q
"^DD",52.47,52.47,1.6,3)
Enter the type for this pharmacy/store.
"^DD",52.47,52.47,1.6,21,0)
^.001^1^1^3161020^^
"^DD",52.47,52.47,1.6,21,1,0)
This is the type of the pharmacy/store.
"^DD",52.47,52.47,1.6,"DT")
3161020
"^DD",52.47,52.47,1.7,0)
PLACE/LOCATION QUALIFIER^F^^1;7^K:$L(X)>3!($L(X)<1) X
"^DD",52.47,52.47,1.7,3)
Enter the place/location qualifier for this pharmacy/store. Answer must be 1-3 characters in length.
"^DD",52.47,52.47,1.7,21,0)
^^1^1^3160831^
"^DD",52.47,52.47,1.7,21,1,0)
Enter the place/location qualifier for this pharmacy/store.
"^DD",52.47,52.47,1.7,"DT")
3160831
"^DD",52.47,52.47,1.8,0)
SPECIALTY^F^^1;8^K:$L(X)>10!($L(X)<1) X
"^DD",52.47,52.47,1.8,3)
Enter the specialty for the eRx Pharmacy. Answer must be 1-10 characters in length.
"^DD",52.47,52.47,1.8,21,0)
^^1^1^3161107^
"^DD",52.47,52.47,1.8,21,1,0)
This is the pharmacy specialty for the incoming eRx Pharmacy.
"^DD",52.47,52.47,1.8,"DT")
3161107
"^DD",52.47,52.47,2,0)
IDENTIFICATION^52.472A^^2;0
"^DD",52.47,52.47,2,21,0)
^^2^2^3170626^
"^DD",52.47,52.47,2,21,1,0)
This sub-file holds the identification elements passed in with the 
"^DD",52.47,52.47,2,21,2,0)
incoming eRx.
"^DD",52.47,52.47,3,0)
COMMUNICATION^52.473A^^3;0
"^DD",52.47,52.47,3,21,0)
^.001^2^2^3170705^^^^
"^DD",52.47,52.47,3,21,1,0)
This sub-file holds the communication values and types for an eRx 
"^DD",52.47,52.47,3,21,2,0)
external pharmacy.
"^DD",52.47,52.47,4,0)
ASSOCIATED ERX PERSON^P52.48'^PS(52.48,^4;1^Q
"^DD",52.47,52.47,4,3)
Enter the person from the eRx external person file that is associated with this eRx external pharmacy.
"^DD",52.47,52.47,4,21,0)
^^1^1^3170626^
"^DD",52.47,52.47,4,21,1,0)
This holds the person(s) associated with the eRx external pharmacy.
"^DD",52.47,52.47,4,"DT")
3160831
"^DD",52.47,52.472,0)
IDENTIFICATION SUB-FIELD^^.02^2
"^DD",52.47,52.472,0,"DT")
3170307
"^DD",52.47,52.472,0,"IX","B",52.472,.01)

"^DD",52.47,52.472,0,"NM","IDENTIFICATION")

"^DD",52.47,52.472,0,"UP")
52.47
"^DD",52.47,52.472,.01,0)
ID TYPE^F^^0;1^K:$L(X)>50!($L(X)<3) X
"^DD",52.47,52.472,.01,1,0)
^.1
"^DD",52.47,52.472,.01,1,1,0)
52.472^B
"^DD",52.47,52.472,.01,1,1,1)
S ^PS(52.47,DA(1),2,"B",$E(X,1,30),DA)=""
"^DD",52.47,52.472,.01,1,1,2)
K ^PS(52.47,DA(1),2,"B",$E(X,1,30),DA)
"^DD",52.47,52.472,.01,3)
Enter the identification type. Answer must be 3-50 characters in length.
"^DD",52.47,52.472,.01,21,0)
^^1^1^3170307^
"^DD",52.47,52.472,.01,21,1,0)
This is the identification type, such as NCPDP ID, NPI, or DEA #.
"^DD",52.47,52.472,.01,"DT")
3170307
"^DD",52.47,52.472,.02,0)
ID VALUE^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.47,52.472,.02,3)
Enter the identification value. Answer must be 1-35 characters in length.
"^DD",52.47,52.472,.02,21,0)
^^1^1^3170307^
"^DD",52.47,52.472,.02,21,1,0)
This is the value associated with the identification type.
"^DD",52.47,52.472,.02,"DT")
3170307
"^DD",52.47,52.473,0)
COMMUNICATION SUB-FIELD^^.02^2
"^DD",52.47,52.473,0,"DT")
3161012
"^DD",52.47,52.473,0,"IX","B",52.473,.01)

"^DD",52.47,52.473,0,"NM","COMMUNICATION")

"^DD",52.47,52.473,0,"UP")
52.47
"^DD",52.47,52.473,.01,0)
COMMUNICATION^F^^0;1^K:$L(X)>80!($L(X)<1) X
"^DD",52.47,52.473,.01,1,0)
^.1
"^DD",52.47,52.473,.01,1,1,0)
52.473^B
"^DD",52.47,52.473,.01,1,1,1)
S ^PS(52.47,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",52.47,52.473,.01,1,1,2)
K ^PS(52.47,DA(1),3,"B",$E(X,1,30),DA)
"^DD",52.47,52.473,.01,3)
Enter the value for the communication method. Answer must be 1-80 characters in length.
"^DD",52.47,52.473,.01,21,0)
^^1^1^3170626^
"^DD",52.47,52.473,.01,21,1,0)
This field contains the communication value for an eRx external pharmacy.
"^DD",52.47,52.473,.01,"DT")
3161012
"^DD",52.47,52.473,.02,0)
TYPE^S^BN:BEEPER;CP:CELLULAR;EM:ELECTRONIC MAIL;FX:FAX;HP:HOME PHONE;NP:NIGHT-TIME PHONE;TE:TELEPHONE;WP:WORK PHONE;^0;2^Q
"^DD",52.47,52.473,.02,3)
Enter the type associated with the supplied communication value.
"^DD",52.47,52.473,.02,21,0)
^^1^1^3161012^
"^DD",52.47,52.473,.02,21,1,0)
This is the type associated with the communication value supplied.
"^DD",52.47,52.473,.02,"DT")
3161012
"^DD",52.48,52.48,0)
FIELD^^6^28
"^DD",52.48,52.48,0,"DT")
3170426
"^DD",52.48,52.48,0,"ID",1.5)
W:$D(^(1)) "   ",$P(^(1),U,5)
"^DD",52.48,52.48,0,"ID",1.6)
W:$D(^(1)) "   ",$P(^(1),U,6)
"^DD",52.48,52.48,0,"IX","B",52.48,.01)

"^DD",52.48,52.48,0,"IX","C",52.48,1.5)

"^DD",52.48,52.48,0,"IX","D",52.48,1.6)

"^DD",52.48,52.48,0,"NM","ERX EXTERNAL PERSON")

"^DD",52.48,52.48,0,"PT",52.47,4)

"^DD",52.48,52.48,.01,0)
NAME^RF^^0;1^K:$L(X)>107!($L(X)<3)!'(X'?1P.E) X
"^DD",52.48,52.48,.01,1,0)
^.1^^-1
"^DD",52.48,52.48,.01,1,1,0)
52.48^B
"^DD",52.48,52.48,.01,1,1,1)
S ^PS(52.48,"B",$E(X,1,30),DA)=""
"^DD",52.48,52.48,.01,1,1,2)
K ^PS(52.48,"B",$E(X,1,30),DA)
"^DD",52.48,52.48,.01,3)
Enter the name of the eRx external person. Last Name, First Name Middle Name. Answer must be 3-107 characters in length.
"^DD",52.48,52.48,.01,21,0)
^.001^2^2^3170626^^^
"^DD",52.48,52.48,.01,21,1,0)
This is the name of the external person (pharmacist, provider, 
"^DD",52.48,52.48,.01,21,2,0)
supervisor).
"^DD",52.48,52.48,.01,"DT")
3170706
"^DD",52.48,52.48,.02,0)
LAST NAME^F^^0;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,.02,1,0)
^.1^^0
"^DD",52.48,52.48,.02,3)
Enter the eRx external person last name. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,.02,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,.02,21,1,0)
The last name of the eRx external person.
"^DD",52.48,52.48,.02,"DT")
3170405
"^DD",52.48,52.48,.03,0)
FIRST NAME^F^^0;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,.03,3)
Enter the first name of the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,.03,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,.03,21,1,0)
The fist name of the eRx external person.
"^DD",52.48,52.48,.03,"DT")
3161215
"^DD",52.48,52.48,.04,0)
MIDDLE NAME^F^^0;4^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,.04,3)
Enter the middle name of the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,.04,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,.04,21,1,0)
This is the middle name of the eRx external person.
"^DD",52.48,52.48,.04,"DT")
3161215
"^DD",52.48,52.48,.05,0)
SUFFIX^F^^0;5^K:$L(X)>10!($L(X)<1) X
"^DD",52.48,52.48,.05,3)
Enter the suffix for the eRx external person. Answer must be 1-10 characters in length.
"^DD",52.48,52.48,.05,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,.05,21,1,0)
The suffix portion of the name for the eRx external person.
"^DD",52.48,52.48,.05,"DT")
3161215
"^DD",52.48,52.48,.06,0)
PREFIX^F^^0;6^K:$L(X)>10!($L(X)<1) X
"^DD",52.48,52.48,.06,3)
Enter the prefix for the eRx external person. Answer must be 1-10 characters in length.
"^DD",52.48,52.48,.06,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,.06,21,1,0)
The prefix portion of the eRx external person name.
"^DD",52.48,52.48,.06,"DT")
3161215
"^DD",52.48,52.48,1.1,0)
PERSON TYPE^S^P:PHARMACIST;PR:PROVIDER;S:SUPERVISOR;O:OTHER;^1;1^Q
"^DD",52.48,52.48,1.1,3)
Enter the type for the eRx external person.
"^DD",52.48,52.48,1.1,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.1,21,1,0)
This is the type associated with the eRx external person.
"^DD",52.48,52.48,1.1,"DT")
3161215
"^DD",52.48,52.48,1.2,0)
SPECIALTY^F^^1;2^K:$L(X)>10!($L(X)<1) X
"^DD",52.48,52.48,1.2,3)
Enter the specialty of the eRx external person. Answer must be 1-10 characters in length.
"^DD",52.48,52.48,1.2,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.2,21,1,0)
The is the specialty of the eRx external person.
"^DD",52.48,52.48,1.2,"DT")
3161215
"^DD",52.48,52.48,1.3,0)
ASSOCIATED ERX PHARMACY^P52.47'^PS(52.47,^1;3^Q
"^DD",52.48,52.48,1.3,3)
Enter the eRx external pharmacy associated with this eRx external person.
"^DD",52.48,52.48,1.3,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.3,21,1,0)
This is the eRx external pharmacy associated with the eRx external person.
"^DD",52.48,52.48,1.3,"DT")
3161215
"^DD",52.48,52.48,1.4,0)
NCPDP ID^F^^1;4^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,1.4,3)
Enter the NCPDP ID for this eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,1.4,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.4,21,1,0)
The NCPDP ID of the eRx external person.
"^DD",52.48,52.48,1.4,"DT")
3161215
"^DD",52.48,52.48,1.5,0)
NPI^F^^1;5^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,1.5,1,0)
^.1
"^DD",52.48,52.48,1.5,1,1,0)
52.48^C
"^DD",52.48,52.48,1.5,1,1,1)
S ^PS(52.48,"C",$E(X,1,30),DA)=""
"^DD",52.48,52.48,1.5,1,1,2)
K ^PS(52.48,"C",$E(X,1,30),DA)
"^DD",52.48,52.48,1.5,1,1,"%D",0)
^^1^1^3170406^
"^DD",52.48,52.48,1.5,1,1,"%D",1,0)
This indexes the provider by the incoming NPI value for the provider.
"^DD",52.48,52.48,1.5,1,1,"DT")
3170406
"^DD",52.48,52.48,1.5,3)
Enter the NPI for the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,1.5,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.5,21,1,0)
This is the NPI associated with the eRx external person.
"^DD",52.48,52.48,1.5,"DT")
3170406
"^DD",52.48,52.48,1.6,0)
DEA #^F^^1;6^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,1.6,1,0)
^.1
"^DD",52.48,52.48,1.6,1,1,0)
52.48^D
"^DD",52.48,52.48,1.6,1,1,1)
S ^PS(52.48,"D",$E(X,1,30),DA)=""
"^DD",52.48,52.48,1.6,1,1,2)
K ^PS(52.48,"D",$E(X,1,30),DA)
"^DD",52.48,52.48,1.6,1,1,"%D",0)
^^1^1^3170406^
"^DD",52.48,52.48,1.6,1,1,"%D",1,0)
This indexes the provider IEN by the DEA number.
"^DD",52.48,52.48,1.6,1,1,"DT")
3170406
"^DD",52.48,52.48,1.6,3)
Enter the DEA # associated with the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,1.6,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.6,21,1,0)
This is the DEA# for the eRx external person.
"^DD",52.48,52.48,1.6,"DT")
3170406
"^DD",52.48,52.48,1.7,0)
HIN^F^^1;7^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,1.7,3)
Enter the HIN associated with this eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,1.7,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.7,21,1,0)
This is the HIN associated with the incoming eRx external person entry.
"^DD",52.48,52.48,1.7,"DT")
3161215
"^DD",52.48,52.48,1.8,0)
STATE LICENSE NUMBER^F^^1;8^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,1.8,3)
Enter the state license number associated with the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,1.8,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,1.8,21,1,0)
This is the state license number for the eRx external person.
"^DD",52.48,52.48,1.8,"DT")
3161215
"^DD",52.48,52.48,2.1,0)
CLINIC NAME^F^^2;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,2.1,3)
Enter the clinic name that this eRx external person is associated with. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,2.1,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,2.1,21,1,0)
This is the clinic the eRx external person is associated with.
"^DD",52.48,52.48,2.1,"DT")
3161215
"^DD",52.48,52.48,2.2,0)
PLACE/LOCATION QUALIFIER^F^^2;2^K:$L(X)>3!($L(X)<1) X
"^DD",52.48,52.48,2.2,3)
Enter the place/location qualifier for the eRx external person. Answer must be 1-3 characters in length.
"^DD",52.48,52.48,2.2,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,2.2,21,1,0)
The place/location qualifier for the eRx external person.
"^DD",52.48,52.48,2.2,"DT")
3161215
"^DD",52.48,52.48,3,0)
COMMUNICATION^52.483A^^3;0
"^DD",52.48,52.48,3,21,0)
^.001^2^2^3170626^^^
"^DD",52.48,52.48,3,21,1,0)
This sub-file holds the communication values and type for an eRx external 
"^DD",52.48,52.48,3,21,2,0)
person.
"^DD",52.48,52.48,4.1,0)
STREET ADDRESS LINE 1^F^^4;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,4.1,3)
Enter street address line for for this eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,4.1,21,0)
^^1^1^3170626^
"^DD",52.48,52.48,4.1,21,1,0)
This is street address line 1 for the eRx external patient.
"^DD",52.48,52.48,4.1,"DT")
3161215
"^DD",52.48,52.48,4.2,0)
ADDRESS LINE 2^F^^4;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,4.2,3)
Enter street address line 2 for the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,4.2,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,4.2,21,1,0)
Street address line 2 for the eRx external person
"^DD",52.48,52.48,4.2,"DT")
3161215
"^DD",52.48,52.48,4.3,0)
CITY^F^^4;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,4.3,3)
Enter the city associated with the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,4.3,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,4.3,21,1,0)
This is the city associated with the eRx external person.
"^DD",52.48,52.48,4.3,"DT")
3161215
"^DD",52.48,52.48,4.4,0)
STATE^P5'^DIC(5,^4;4^Q
"^DD",52.48,52.48,4.4,3)
Select the state associated with the eRx external person.
"^DD",52.48,52.48,4.4,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,4.4,21,1,0)
This is the state associated with the eRx external person.
"^DD",52.48,52.48,4.4,"DT")
3161215
"^DD",52.48,52.48,4.5,0)
ZIP CODE^F^^4;5^K:$L(X)>9!($L(X)<5) X
"^DD",52.48,52.48,4.5,3)
Enter the zip code associated with the external person. Answer must be 5-9 characters in length.
"^DD",52.48,52.48,4.5,21,0)
^.001^1^1^3170426^^
"^DD",52.48,52.48,4.5,21,1,0)
This is the mailing zip code for the eRx external person.
"^DD",52.48,52.48,4.5,"DT")
3170426
"^DD",52.48,52.48,5.1,0)
AGENT LAST NAME^F^^5;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,5.1,3)
Enter the agents last name. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,5.1,21,0)
^^2^2^3161215^
"^DD",52.48,52.48,5.1,21,1,0)
This is the last name of the agent associated with the eRx external 
"^DD",52.48,52.48,5.1,21,2,0)
person.
"^DD",52.48,52.48,5.1,"DT")
3161215
"^DD",52.48,52.48,5.2,0)
AGENT FIRST NAME^F^^5;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,5.2,3)
Enter the last name of the agent associated with the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,5.2,21,0)
^^2^2^3161215^
"^DD",52.48,52.48,5.2,21,1,0)
This is the last name of the agent associated with the eRx external 
"^DD",52.48,52.48,5.2,21,2,0)
person.
"^DD",52.48,52.48,5.2,"DT")
3161215
"^DD",52.48,52.48,5.3,0)
AGENT MIDDLE NAME^F^^5;3^K:$L(X)>35!($L(X)<3) X
"^DD",52.48,52.48,5.3,3)
Enter the middle name of the agent associated with the eRx external person. Answer must be 3-35 characters in length.
"^DD",52.48,52.48,5.3,21,0)
^^2^2^3161215^
"^DD",52.48,52.48,5.3,21,1,0)
This is the middle name of the agent associated with the eRx external 
"^DD",52.48,52.48,5.3,21,2,0)
person.
"^DD",52.48,52.48,5.3,"DT")
3161215
"^DD",52.48,52.48,5.4,0)
AGENT SUFFIX^F^^5;4^K:$L(X)>10!($L(X)<1) X
"^DD",52.48,52.48,5.4,3)
Enter the suffix for the agent. Answer must be 1-10 characters in length.
"^DD",52.48,52.48,5.4,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,5.4,21,1,0)
This is the suffix for the agent associated with the eRx external person.
"^DD",52.48,52.48,5.4,"DT")
3161215
"^DD",52.48,52.48,5.5,0)
AGENT PREFIX^F^^5;5^K:$L(X)>10!($L(X)<1) X
"^DD",52.48,52.48,5.5,3)
Enter the prefix for the agent. Answer must be 1-10 characters in length.
"^DD",52.48,52.48,5.5,21,0)
^^1^1^3161215^
"^DD",52.48,52.48,5.5,21,1,0)
This is the prefix for the agent associated with the eRx external person.
"^DD",52.48,52.48,5.5,"DT")
3161215
"^DD",52.48,52.48,6,0)
IDENTIFICATION^52.486A^^6;0
"^DD",52.48,52.48,6,21,0)
^^2^2^3170306^
"^DD",52.48,52.48,6,21,1,0)
This multiple holds the identification values associated with this 
"^DD",52.48,52.48,6,21,2,0)
external eRx person entry.
"^DD",52.48,52.483,0)
COMMUNICATION SUB-FIELD^^.02^2
"^DD",52.48,52.483,0,"DT")
3170405
"^DD",52.48,52.483,0,"IX","B",52.483,.01)

"^DD",52.48,52.483,0,"IX","C",52.483,.02)

"^DD",52.48,52.483,0,"NM","COMMUNICATION")

"^DD",52.48,52.483,0,"UP")
52.48
"^DD",52.48,52.483,.01,0)
COMMUNICATION^F^^0;1^K:$L(X)>80!($L(X)<1) X
"^DD",52.48,52.483,.01,1,0)
^.1
"^DD",52.48,52.483,.01,1,1,0)
52.483^B
"^DD",52.48,52.483,.01,1,1,1)
S ^PS(52.48,DA(1),3,"B",$E(X,1,30),DA)=""
"^DD",52.48,52.483,.01,1,1,2)
K ^PS(52.48,DA(1),3,"B",$E(X,1,30),DA)
"^DD",52.48,52.483,.01,3)
Enter the communication value for the eRx external person. Answer must be 1-80 characters in length.
"^DD",52.48,52.483,.01,21,0)
^.001^2^2^3170626^^
"^DD",52.48,52.483,.01,21,1,0)
This is the communication value for the eRx external person, such as 
"^DD",52.48,52.483,.01,21,2,0)
phone number, cellular number, work phone, or other.
"^DD",52.48,52.483,.01,"DT")
3161215
"^DD",52.48,52.483,.02,0)
TYPE^S^BN:BEEPER;CP:CELLULAR;EM:ELECTRONIC MAIL;HP:HOME PHONE;NP:NIGHT PHONE;TE:TELEPHONE;WP:WORK PHONE;FX:FAX;^0;2^Q
"^DD",52.48,52.483,.02,1,0)
^.1
"^DD",52.48,52.483,.02,1,1,0)
52.483^C
"^DD",52.48,52.483,.02,1,1,1)
S ^PS(52.48,DA(1),3,"C",$E(X,1,30),DA)=""
"^DD",52.48,52.483,.02,1,1,2)
K ^PS(52.48,DA(1),3,"C",$E(X,1,30),DA)
"^DD",52.48,52.483,.02,1,1,"%D",0)
^^2^2^3170405^
"^DD",52.48,52.483,.02,1,1,"%D",1,0)
This cross reference provides quick reference to a communication value 
"^DD",52.48,52.483,.02,1,1,"%D",2,0)
based on type.
"^DD",52.48,52.483,.02,1,1,"DT")
3170405
"^DD",52.48,52.483,.02,3)
Enter the type associated with the communication value.
"^DD",52.48,52.483,.02,21,0)
^.001^2^2^3170405^^
"^DD",52.48,52.483,.02,21,1,0)
This field indicates the type associated with eRx external communication 
"^DD",52.48,52.483,.02,21,2,0)
value.
"^DD",52.48,52.483,.02,"DT")
3170405
"^DD",52.48,52.486,0)
IDENTIFICATION SUB-FIELD^^.02^2
"^DD",52.48,52.486,0,"DT")
3170306
"^DD",52.48,52.486,0,"IX","B",52.486,.01)

"^DD",52.48,52.486,0,"NM","IDENTIFICATION")

"^DD",52.48,52.486,0,"UP")
52.48
"^DD",52.48,52.486,.01,0)
ID NAME^F^^0;1^K:$L(X)>50!($L(X)<3) X
"^DD",52.48,52.486,.01,1,0)
^.1
"^DD",52.48,52.486,.01,1,1,0)
52.486^B
"^DD",52.48,52.486,.01,1,1,1)
S ^PS(52.48,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",52.48,52.486,.01,1,1,2)
K ^PS(52.48,DA(1),6,"B",$E(X,1,30),DA)
"^DD",52.48,52.486,.01,3)
Enter the identification name. Answer must be 3-50 characters in length.
"^DD",52.48,52.486,.01,21,0)
^^1^1^3170306^
"^DD",52.48,52.486,.01,21,1,0)
This is the ID name or type as received in the xml.
"^DD",52.48,52.486,.01,"DT")
3170306
"^DD",52.48,52.486,.02,0)
ID VALUE^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.48,52.486,.02,3)
Enter the ID value. Answer must be 3-35 characters in length.
"^DD",52.48,52.486,.02,21,0)
^^1^1^3170306^
"^DD",52.48,52.486,.02,21,1,0)
This is the value associated with the ID NAME (type).
"^DD",52.48,52.486,.02,"DT")
3170306
"^DD",52.49,52.49,0)
FIELD^^44^114
"^DD",52.49,52.49,0,"DDA")
N
"^DD",52.49,52.49,0,"DT")
3170906
"^DD",52.49,52.49,0,"IX","B",52.49,.01)

"^DD",52.49,52.49,0,"IX","C",52.49,1)

"^DD",52.49,52.49,0,"IX","D",52.49,.05)

"^DD",52.49,52.49,0,"IX","ORN",52.49,.12)

"^DD",52.49,52.49,0,"NM","ERX HOLDING QUEUE")

"^DD",52.49,52.49,.01,0)
ERX HUB ID^RNJ14,0^^0;1^K:+X'=X!(X>99999999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,.01,.1)
eRx Hub Number
"^DD",52.49,52.49,.01,1,0)
^.1^^-1
"^DD",52.49,52.49,.01,1,1,0)
52.49^B
"^DD",52.49,52.49,.01,1,1,1)
S ^PS(52.49,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.49,.01,1,1,2)
K ^PS(52.49,"B",$E(X,1,30),DA)
"^DD",52.49,52.49,.01,3)
Enter the eRx processing hub identification number. Type a number between 1 and 99999999999999, 0 decimal digits.
"^DD",52.49,52.49,.01,21,0)
^^1^1^3170510^
"^DD",52.49,52.49,.01,21,1,0)
This is the unique message identifier from the eRx processing hub.
"^DD",52.49,52.49,.01,"DT")
3170711
"^DD",52.49,52.49,.02,0)
RELATED OR PARENT MESSAGE ID^F^^0;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.49,52.49,.02,3)
Answer must be 3-35 characters in length.
"^DD",52.49,52.49,.02,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,.02,21,1,0)
This is the message ID of any related or parent messages that may be 
"^DD",52.49,52.49,.02,21,2,0)
associated with this eRx Holding Queue message.
"^DD",52.49,52.49,.02,"DT")
3160829
"^DD",52.49,52.49,.03,0)
MESSAGE DATE/TIME^RD^^0;3^S %DT="ESTR" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,.03,3)
Enter the Date/Time of the incoming ERX message.
"^DD",52.49,52.49,.03,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,.03,21,1,0)
This is the date/time that the incoming eRx message was added to the eRx 
"^DD",52.49,52.49,.03,21,2,0)
Holding Queue file.
"^DD",52.49,52.49,.03,"DT")
3170726
"^DD",52.49,52.49,.04,0)
EXTERNAL PATIENT IDENTIFIER^P52.46'^PS(52.46,^0;4^Q
"^DD",52.49,52.49,.04,3)
Enter the patient associated with the incoming eRx.
"^DD",52.49,52.49,.04,21,0)
^.001^1^1^3170626^^^
"^DD",52.49,52.49,.04,21,1,0)
This is the external patient identifier.
"^DD",52.49,52.49,.04,"DT")
3170610
"^DD",52.49,52.49,.05,0)
VISTA PATIENT^P2'^DPT(^0;5^Q
"^DD",52.49,52.49,.05,1,0)
^.1
"^DD",52.49,52.49,.05,1,1,0)
52.49^D
"^DD",52.49,52.49,.05,1,1,1)
S ^PS(52.49,"D",$E(X,1,30),DA)=""
"^DD",52.49,52.49,.05,1,1,2)
K ^PS(52.49,"D",$E(X,1,30),DA)
"^DD",52.49,52.49,.05,1,1,"%D",0)
^^2^2^3161121^
"^DD",52.49,52.49,.05,1,1,"%D",1,0)
This cross reference indexes the patient identifier with the erx holding 
"^DD",52.49,52.49,.05,1,1,"%D",2,0)
queue entry.
"^DD",52.49,52.49,.05,1,1,"DT")
3161121
"^DD",52.49,52.49,.05,3)
Enter the patient associated with this incoming eRx message.
"^DD",52.49,52.49,.05,21,0)
^^1^1^3160829^
"^DD",52.49,52.49,.05,21,1,0)
This is the Vista linked patient. Pointer to file #2.
"^DD",52.49,52.49,.05,"DT")
3161121
"^DD",52.49,52.49,.06,0)
INSTITUTION^RP4'^DIC(4,^0;6^Q
"^DD",52.49,52.49,.06,3)
Enter the Hospital location associated with this eRx prescription request.
"^DD",52.49,52.49,.06,21,0)
^.001^2^2^3170626^^
"^DD",52.49,52.49,.06,21,1,0)
The institution associated with this eRx request. Pointer to the 
"^DD",52.49,52.49,.06,21,2,0)
INSTITUTION file (#4).
"^DD",52.49,52.49,.06,"DT")
3160829
"^DD",52.49,52.49,.07,0)
PHARMACY SYSTEM^P59.7'^PS(59.7,^0;7^Q
"^DD",52.49,52.49,.07,3)
Enter the pharmacy system associated with this incoming eRx message.
"^DD",52.49,52.49,.07,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,.07,21,1,0)
This is the pharmacy system associated with the incoming eRx message.
"^DD",52.49,52.49,.07,"DT")
3160829
"^DD",52.49,52.49,.08,0)
MESSAGE TYPE^S^R:REFILL;P:PARTIAL FILL;CA:CANCEL;CH:CHANGE REQUEST;^0;8^Q
"^DD",52.49,52.49,.08,3)
Enter the message type associated with this incoming eRx message.
"^DD",52.49,52.49,.08,21,0)
^.001^2^2^3170626^^
"^DD",52.49,52.49,.08,21,1,0)
This is the message type associated with this incoming eRx request 
"^DD",52.49,52.49,.08,21,2,0)
(Change, Cancel, Refill, Partial Fill, etc).
"^DD",52.49,52.49,.08,"DT")
3160829
"^DD",52.49,52.49,.09,0)
EXTERNAL/PROVIDER ORDER NUMBER^F^^0;9^K:$L(X)>30!($L(X)<3) X
"^DD",52.49,52.49,.09,3)
Enter the external/provider order number, if applicable. Answer must be 3-30 characters in length.
"^DD",52.49,52.49,.09,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,.09,21,1,0)
This is the external or provider order number associated with this 
"^DD",52.49,52.49,.09,21,2,0)
incoming eRx message.
"^DD",52.49,52.49,.09,"DT")
3160829
"^DD",52.49,52.49,.1,0)
VISTA PENDING OUTPATIENT ORDER^NJ15,0^^0;10^K:+X'=X!(X>999999999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,.1,3)
Enter the vista pending outpatient order IEN. Type a number between 0 and 999999999999999, 0 decimal digits.
"^DD",52.49,52.49,.1,21,0)
^.001^2^2^3170711^^^
"^DD",52.49,52.49,.1,21,1,0)
This is the associated Vista order as stored in the PENDING OUTPATIENT 
"^DD",52.49,52.49,.1,21,2,0)
ORDERS file (#52.41).
"^DD",52.49,52.49,.1,"DT")
3170626
"^DD",52.49,52.49,.12,0)
OE/RR ORDER NUMBER^P100'^OR(100,^0;11^Q
"^DD",52.49,52.49,.12,1,0)
^.1
"^DD",52.49,52.49,.12,1,1,0)
52.49^ORN
"^DD",52.49,52.49,.12,1,1,1)
S ^PS(52.49,"ORN",$E(X,1,30),DA)=""
"^DD",52.49,52.49,.12,1,1,2)
K ^PS(52.49,"ORN",$E(X,1,30),DA)
"^DD",52.49,52.49,.12,1,1,"%D",0)
^^1^1^3170408^
"^DD",52.49,52.49,.12,1,1,"%D",1,0)
This indexes the OE/RR order number to the eRx IEN.
"^DD",52.49,52.49,.12,1,1,"DT")
3170408
"^DD",52.49,52.49,.12,3)
Enter the OE/RR Order number associated with the incoming eRx message.
"^DD",52.49,52.49,.12,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,.12,21,1,0)
This is the OE/RR order number from the ORDERS file (#100) associated 
"^DD",52.49,52.49,.12,21,2,0)
with this incoming eRx message.
"^DD",52.49,52.49,.12,"DT")
3170408
"^DD",52.49,52.49,.13,0)
PHARMACY PRESCRIPTION NUMBER^P52'^PSRX(^0;12^Q
"^DD",52.49,52.49,.13,3)
Enter the pharmacy Rx number.
"^DD",52.49,52.49,.13,21,0)
^.001^2^2^3170711^^^^
"^DD",52.49,52.49,.13,21,1,0)
This is the prescription file entry (#52) associated with this incoming 
"^DD",52.49,52.49,.13,21,2,0)
eRx message.
"^DD",52.49,52.49,.13,"DT")
3170626
"^DD",52.49,52.49,1,0)
ERX ORDER STATUS^P52.45'^PS(52.45,^1;1^Q
"^DD",52.49,52.49,1,1,0)
^.1
"^DD",52.49,52.49,1,1,1,0)
52.49^C
"^DD",52.49,52.49,1,1,1,1)
S ^PS(52.49,"C",$E(X,1,30),DA)=""
"^DD",52.49,52.49,1,1,1,2)
K ^PS(52.49,"C",$E(X,1,30),DA)
"^DD",52.49,52.49,1,1,1,"%D",0)
^^2^2^3161115^
"^DD",52.49,52.49,1,1,1,"%D",1,0)
This index will is used to hold the Electronic Rx status. This will be 
"^DD",52.49,52.49,1,1,1,"%D",2,0)
used to look up entries by status.
"^DD",52.49,52.49,1,1,1,"DT")
3161115
"^DD",52.49,52.49,1,3)
Enter the ERX status appropriate for this eRx.
"^DD",52.49,52.49,1,21,0)
^.001^1^1^3170207^^^^
"^DD",52.49,52.49,1,21,1,0)
This is the status for the incoming eRx message.
"^DD",52.49,52.49,1,"DT")
3170726
"^DD",52.49,52.49,1.11,0)
DRUG VALIDATED BY^P200'^VA(200,^1;11^Q
"^DD",52.49,52.49,1.11,3)
Enter the person who manually validated the drug for the incoming eRx.
"^DD",52.49,52.49,1.11,21,0)
^^1^1^3170130^
"^DD",52.49,52.49,1.11,21,1,0)
This is the person who manually validated the drug.
"^DD",52.49,52.49,1.11,"DT")
3170130
"^DD",52.49,52.49,1.12,0)
DRUG VALIDATED DATE/TIME^D^^1;12^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,1.12,3)
Enter the date/time the drug was validated.
"^DD",52.49,52.49,1.12,21,0)
^^1^1^3170130^
"^DD",52.49,52.49,1.12,21,1,0)
The date/time of the manually validation of the drug for the eRx.
"^DD",52.49,52.49,1.12,"DT")
3170130
"^DD",52.49,52.49,1.13,0)
PATIENT VALIDATED BY^P200'^VA(200,^1;13^Q
"^DD",52.49,52.49,1.13,3)
Enter the person who manually validated the patient.
"^DD",52.49,52.49,1.13,21,0)
^^2^2^3170130^
"^DD",52.49,52.49,1.13,21,1,0)
This is the person who manually evaluated the patient for the incoming 
"^DD",52.49,52.49,1.13,21,2,0)
eRx.
"^DD",52.49,52.49,1.13,"DT")
3170130
"^DD",52.49,52.49,1.14,0)
PATIENT VALIDATED DATE/TIME^D^^1;14^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,1.14,3)
Enter the date/time the patient was validated.
"^DD",52.49,52.49,1.14,21,0)
^^1^1^3170130^
"^DD",52.49,52.49,1.14,21,1,0)
The date/time the patient was manually validated.
"^DD",52.49,52.49,1.14,"DT")
3170130
"^DD",52.49,52.49,1.2,0)
PROV STAT (AUTO VALIDATION)^S^1:VALIDATED;0:NOT VALIDATED;^1;2^Q
"^DD",52.49,52.49,1.2,3)
Enter the auto-validation status for the provider associated with the incoming eRx prescription request.
"^DD",52.49,52.49,1.2,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,1.2,21,1,0)
This is the auto-validation status for a provider associated with the 
"^DD",52.49,52.49,1.2,21,2,0)
incoming eRx prescription request.
"^DD",52.49,52.49,1.2,"DT")
3160829
"^DD",52.49,52.49,1.3,0)
PROV STAT (MANUAL VALIDATION)^S^1:VALIDATED;0:NOT VALIDATED;^1;3^Q
"^DD",52.49,52.49,1.3,3)
Enter the status for manual validation of the provider associated with this eRx prescription request.
"^DD",52.49,52.49,1.3,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,1.3,21,1,0)
This is the manual validation status of the provider associated with the 
"^DD",52.49,52.49,1.3,21,2,0)
incoming eRx prescription request.
"^DD",52.49,52.49,1.3,"DT")
3160829
"^DD",52.49,52.49,1.4,0)
DRUG STAT (AUTO VALIDATION)^S^1:VALIDATED;0:NOT VALIDATED;^1;4^Q
"^DD",52.49,52.49,1.4,3)
Enter the auto validation status for the drug associated with this eRx prescription request.
"^DD",52.49,52.49,1.4,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,1.4,21,1,0)
This is the drug validation status for the drug associated with this 
"^DD",52.49,52.49,1.4,21,2,0)
incoming eRx prescription request.
"^DD",52.49,52.49,1.4,"DT")
3160829
"^DD",52.49,52.49,1.5,0)
DRUG STAT (MANUAL VALIDATION)^S^1:VALIDATED;0:NOT VALIDATED;^1;5^Q
"^DD",52.49,52.49,1.5,3)
Enter the manual validation status for the drug associated with this incoming eRx prescription request.
"^DD",52.49,52.49,1.5,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,1.5,21,1,0)
This is the manual validation status for the drug associated with the 
"^DD",52.49,52.49,1.5,21,2,0)
incoming eRx prescription request.
"^DD",52.49,52.49,1.5,"DT")
3160829
"^DD",52.49,52.49,1.6,0)
PATIENT STATUS (AUTO VAL)^S^1:VALIDATED;0:NOT VALIDATED;^1;6^Q
"^DD",52.49,52.49,1.6,3)
This is the auto validation status for the patient associated with this eRx prescription request.
"^DD",52.49,52.49,1.6,21,0)
^^1^1^3160829^
"^DD",52.49,52.49,1.6,21,1,0)
Patient status for auto validation.
"^DD",52.49,52.49,1.6,"DT")
3160829
"^DD",52.49,52.49,1.7,0)
PATIENT STATUS (MANUAL VAL)^S^1:VALIDATED;0:NOT VALIDATED;^1;7^Q
"^DD",52.49,52.49,1.7,3)
Enter the manual validation status for the patient associated with this incoming eRx prescription request.
"^DD",52.49,52.49,1.7,21,0)
^^2^2^3160829^
"^DD",52.49,52.49,1.7,21,1,0)
This is the manual validation status for the patient associated with the 
"^DD",52.49,52.49,1.7,21,2,0)
incoming eRx prescription.
"^DD",52.49,52.49,1.7,"DT")
3160829
"^DD",52.49,52.49,1.8,0)
PROVIDER VALIDATED BY^P200'^VA(200,^1;8^Q
"^DD",52.49,52.49,1.8,3)
Enter the person who validated the provider for the incoming eRx.
"^DD",52.49,52.49,1.8,21,0)
^^1^1^3170130^
"^DD",52.49,52.49,1.8,21,1,0)
This is the person who manually validated the provider for the eRx.
"^DD",52.49,52.49,1.8,"DT")
3170130
"^DD",52.49,52.49,1.9,0)
PROVIDER VALIDATED DATE/TIME^D^^1;9^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,1.9,3)
Enter the date/time the provider was validated.
"^DD",52.49,52.49,1.9,21,0)
^^1^1^3170130^
"^DD",52.49,52.49,1.9,21,1,0)
This is the date/time the provider was validated.
"^DD",52.49,52.49,1.9,"DT")
3170130
"^DD",52.49,52.49,2.1,0)
EXTERNAL PROVIDER^P52.48'^PS(52.48,^2;1^Q
"^DD",52.49,52.49,2.1,3)
Enter the name of the external provider for this eRx holding queue entry.
"^DD",52.49,52.49,2.1,21,0)
^^1^1^3160902^
"^DD",52.49,52.49,2.1,21,1,0)
The external provider for this incoming prescription.
"^DD",52.49,52.49,2.1,"DT")
3160902
"^DD",52.49,52.49,2.2,0)
EXTERNAL PHARMACIST^P52.48'^PS(52.48,^2;2^Q
"^DD",52.49,52.49,2.2,3)
Enter the name of the external pharmacist associated with this erx holding queue entry.
"^DD",52.49,52.49,2.2,21,0)
^^2^2^3160902^
"^DD",52.49,52.49,2.2,21,1,0)
This is the external pharmacist associated with the incoming prescription 
"^DD",52.49,52.49,2.2,21,2,0)
message.
"^DD",52.49,52.49,2.2,"DT")
3160902
"^DD",52.49,52.49,2.3,0)
VA MATCHED PROVIDER^P200'^VA(200,^2;3^Q
"^DD",52.49,52.49,2.3,3)
Enter the VA provider associated with the eRx incoming message.
"^DD",52.49,52.49,2.3,21,0)
^^3^3^3160902^
"^DD",52.49,52.49,2.3,21,1,0)
The VA (matched) provider. This is the provider found in the NEW PERSON 
"^DD",52.49,52.49,2.3,21,2,0)
file which matches the incoming provider information associated with the 
"^DD",52.49,52.49,2.3,21,3,0)
eRx message.
"^DD",52.49,52.49,2.3,"DT")
3160902
"^DD",52.49,52.49,2.4,0)
TO/FROM QUALIFIER^S^P:PHARMACY;C:CLINIC;M:MAILBOX;D:PRESCRIBER;ZZZ:MUTUALLY DEFINED;^2;4^Q
"^DD",52.49,52.49,2.4,3)
Enter the to/from qualifier for this eRx incoming prescription message.
"^DD",52.49,52.49,2.4,21,0)
^^1^1^3160902^
"^DD",52.49,52.49,2.4,21,1,0)
This is the to/from qualifier for the incoming eRx message.
"^DD",52.49,52.49,2.4,"DT")
3160902
"^DD",52.49,52.49,2.5,0)
ERX EXTERNAL PHARMACY^P52.47'^PS(52.47,^2;5^Q
"^DD",52.49,52.49,2.5,3)
Enter the external pharmacy associated with this eRx prescription.
"^DD",52.49,52.49,2.5,21,0)
^^1^1^3161125^
"^DD",52.49,52.49,2.5,21,1,0)
This is the external pharmacy associated with the incoming eRx.
"^DD",52.49,52.49,2.5,"DT")
3161125
"^DD",52.49,52.49,2.6,0)
ERX EXTERNAL SUPERVISOR^P52.48'^PS(52.48,^2;6^Q
"^DD",52.49,52.49,2.6,3)
Enter the Supervisor associated with the incoming eRx prescription.
"^DD",52.49,52.49,2.6,21,0)
^^1^1^3161128^
"^DD",52.49,52.49,2.6,21,1,0)
This is the supervisor associated with the incoming eRx prescription.
"^DD",52.49,52.49,2.6,"DT")
3161128
"^DD",52.49,52.49,3.1,0)
EXTERNAL DRUG/SUPPLY^F^^3;1^K:$L(X)>125!($L(X)<1) X
"^DD",52.49,52.49,3.1,3)
Enter the name of the Drug or Supply item. Answer must be 1-125 characters in length.
"^DD",52.49,52.49,3.1,21,0)
^.001^1^1^3170826^^
"^DD",52.49,52.49,3.1,21,1,0)
This is the incoming drug/supply item for the eRx holding queue entry.
"^DD",52.49,52.49,3.1,"DT")
3170826
"^DD",52.49,52.49,3.2,0)
MATCHED DRUG/SUPPLY^P50'^PSDRUG(^3;2^Q
"^DD",52.49,52.49,3.2,3)
Enter the drug/supply item that matches the external drug/supply item.
"^DD",52.49,52.49,3.2,21,0)
^^2^2^3160906^
"^DD",52.49,52.49,3.2,21,1,0)
This is the VA matched drug from the DRUG file (#50), that is the 
"^DD",52.49,52.49,3.2,21,2,0)
equivalent to the incoming external drug/supply item passed in.
"^DD",52.49,52.49,3.2,"DT")
3160906
"^DD",52.49,52.49,4.1,0)
PRODUCT CODE^F^^4;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.49,52.49,4.1,3)
Enter the Product code associated with the incoming eRx prescription. Answer must be 3-35 characters in length.
"^DD",52.49,52.49,4.1,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,4.1,21,1,0)
This is the incoming product code.
"^DD",52.49,52.49,4.1,"DT")
3160906
"^DD",52.49,52.49,4.11,0)
DRUG DB CODE QUALIFIER^P52.45'^PS(52.45,^4;10^Q
"^DD",52.49,52.49,4.11,3)
Enter the Drug DB Code Qualifier for this incoming Erx.
"^DD",52.49,52.49,4.11,21,0)
^^1^1^3170404^
"^DD",52.49,52.49,4.11,21,1,0)
The drug db code qualifier for the incoming eRx.
"^DD",52.49,52.49,4.11,"DT")
3170404
"^DD",52.49,52.49,4.2,0)
PRODUCT CODE QUALIFIER^S^ND:NATIONAL DRUG CODE (NDC);MF:MANUFACTURER;UP:UNIVERSAL PRODUCT CODE (UPC);^4;2^Q
"^DD",52.49,52.49,4.2,3)
Enter the product code qualifier associated with the eRx product code.
"^DD",52.49,52.49,4.2,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,4.2,21,1,0)
This is the product code qualifier associated with the product code.
"^DD",52.49,52.49,4.2,"DT")
3160906
"^DD",52.49,52.49,4.3,0)
STRENGTH^F^^4;3^K:$L(X)>70!($L(X)<1) X
"^DD",52.49,52.49,4.3,3)
Enter the strength associated with the drug/supply item. Answer must be 1-70 characters in length.
"^DD",52.49,52.49,4.3,21,0)
^.001^1^1^3170626^^
"^DD",52.49,52.49,4.3,21,1,0)
This is the strength for the drug/supply item.
"^DD",52.49,52.49,4.3,"DT")
3160906
"^DD",52.49,52.49,4.4,0)
DRUG DB CODE^F^^4;4^K:$L(X)>35!($L(X)<3) X
"^DD",52.49,52.49,4.4,3)
Answer must be 3-35 characters in length.
"^DD",52.49,52.49,4.4,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,4.4,21,1,0)
This is the drug db code for the incoming eRx.
"^DD",52.49,52.49,4.4,"DT")
3160906
"^DD",52.49,52.49,4.5,0)
FORM SOURCE CODE^S^AA:NCI PHARMACEUTICAL DOSAGE FORM;AB:NCI UNITS OF PRESENTATION;AC:NCI POTENCY UNIT;^4;5^Q
"^DD",52.49,52.49,4.5,3)
Enter the Form Source code for this eRx prescription.
"^DD",52.49,52.49,4.5,21,0)
^.001^2^2^3170711^^^^
"^DD",52.49,52.49,4.5,21,1,0)
This is the form source code from the external source for the incoming 
"^DD",52.49,52.49,4.5,21,2,0)
eRx prescription.
"^DD",52.49,52.49,4.5,"DT")
3170214
"^DD",52.49,52.49,4.6,0)
FORM CODE^F^^4;6^K:$L(X)>15!($L(X)<2) X
"^DD",52.49,52.49,4.6,3)
Enter the form code for the incoming eRx prescription. Answer must be 2-15 characters in length.
"^DD",52.49,52.49,4.6,21,0)
^^2^2^3160906^
"^DD",52.49,52.49,4.6,21,1,0)
This is the incoming form code value from the external source for the 
"^DD",52.49,52.49,4.6,21,2,0)
incoming eRx prescription.
"^DD",52.49,52.49,4.6,"DT")
3160906
"^DD",52.49,52.49,4.7,0)
STRENGTH SOURCE CODE^S^AA:NCI PHARMACEUTICAL DOSAGE FORM;AB:NCI UNITS OF PRESENTATION;AC:NCI POTENCY UNIT;^4;7^Q
"^DD",52.49,52.49,4.7,3)
Enter the strength source code for the eRx drug/supply item.
"^DD",52.49,52.49,4.7,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.49,4.7,21,1,0)
The strength source code for the incoming eRx drug or supply item.
"^DD",52.49,52.49,4.7,"DT")
3170213
"^DD",52.49,52.49,4.8,0)
STRENGTH CODE^F^^4;8^K:$L(X)>15!($L(X)<2) X
"^DD",52.49,52.49,4.8,3)
Enter the strength code for the drug/supply item. Answer must be 2-15 characters in length.
"^DD",52.49,52.49,4.8,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,4.8,21,1,0)
The strength code associated with the eRx drug/supply item.
"^DD",52.49,52.49,4.8,"DT")
3160906
"^DD",52.49,52.49,4.9,0)
DEA SCHEDULE^F^^4;9^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.49,4.9,3)
Enter the DEA schedule for this drug/supply item. Answer must be 1-15 characters in length.
"^DD",52.49,52.49,4.9,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,4.9,21,1,0)
This is the schedule for the eRx incoming prescription (drug/supply item).
"^DD",52.49,52.49,4.9,"DT")
3160906
"^DD",52.49,52.49,5.1,0)
QUANTITY^NJ17,5^^5;1^K:+X'=X!(X>99999999999)!(X<1)!(X?.E1"."6N.N) X
"^DD",52.49,52.49,5.1,3)
Enter the quantity for the eRx prescribed medication. Type a number between 1 and 99999999999, 5 decimal digits.
"^DD",52.49,52.49,5.1,21,0)
^.001^1^1^3170826^^
"^DD",52.49,52.49,5.1,21,1,0)
This is the quantity for the drug/supply item.
"^DD",52.49,52.49,5.1,"DT")
3170826
"^DD",52.49,52.49,5.2,0)
CODE LIST QUALIFIER^S^38:ORIGINAL QUANTITY;40:REMAINING QUANTITY;87:QUANTITY RECEIVED;QS:QUANTIFY SUFFICIENT;^5;2^Q
"^DD",52.49,52.49,5.2,3)
Enter the code list qualifier for the incoming drug/supply item.
"^DD",52.49,52.49,5.2,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,5.2,21,1,0)
The code list qualifier for the incoming eRx drug/supply item.
"^DD",52.49,52.49,5.2,"DT")
3160906
"^DD",52.49,52.49,5.3,0)
UNIT SOURCE CODE^S^AA:NCI PHARMACEUTICAL DOSAGE FORM;AB:NCI UNITS OF PRESENTATION;AC:NCI VALUES OF PROPERTY OR ;AC:NCI POTENCY UNIT;^5;3^Q
"^DD",52.49,52.49,5.3,3)
Enter the unit source code for this eRx drug/supply item.
"^DD",52.49,52.49,5.3,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.49,5.3,21,1,0)
The unit source value for the incoming eRx drug/supply item.
"^DD",52.49,52.49,5.3,"DT")
3170213
"^DD",52.49,52.49,5.4,0)
POTENCY UNIT CODE^F^^5;4^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.49,5.4,3)
Enter the potency unit code associated with the eRx drug/supply item. Answer must be 1-15 characters in length.
"^DD",52.49,52.49,5.4,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,5.4,21,1,0)
The potency unit code for the drug/supply item.
"^DD",52.49,52.49,5.4,"DT")
3160906
"^DD",52.49,52.49,5.5,0)
DAYS SUPPLY^NJ3,0^^5;5^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,5.5,3)
Enter the days supply for this drug/supply item. Answer must be a number between 1 and 999, 0 decimal digits.
"^DD",52.49,52.49,5.5,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,5.5,21,1,0)
The days supply for the incoming eRx drug or supply item.
"^DD",52.49,52.49,5.5,"DT")
3160906
"^DD",52.49,52.49,5.6,0)
REFILLS^NJ2,0^^5;6^K:+X'=X!(X>11)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,5.6,3)
Enter the number of refills for the incoming eRx drug/supply item. Answer must be a number between 1 and 11, 0 decimal digits.
"^DD",52.49,52.49,5.6,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,5.6,21,1,0)
This is the number of refills for the incoming eRx prescription.
"^DD",52.49,52.49,5.6,"DT")
3160906
"^DD",52.49,52.49,5.7,0)
REFILL QUALIFIER^S^R:NUMBER OF REFILLS;PRN:REFILLS FOR 1 YEAR;^5;7^Q
"^DD",52.49,52.49,5.7,3)
Enter the refill qualifier associated with the eRx prescription.
"^DD",52.49,52.49,5.7,21,0)
^^2^2^3160906^
"^DD",52.49,52.49,5.7,21,1,0)
This is the refill qualifier associated with the eRx incoming 
"^DD",52.49,52.49,5.7,21,2,0)
prescription.
"^DD",52.49,52.49,5.7,"DT")
3160906
"^DD",52.49,52.49,5.8,0)
SUBSTITUTIONS^S^0:NO PRODUCT SELECTION INDICATED;1:SUBSTITUTION NOT ALLOWED BY PRESCRIBER;^5;8^Q
"^DD",52.49,52.49,5.8,3)
Enter the substitution value, if applicable.
"^DD",52.49,52.49,5.8,21,0)
^^2^2^3160906^
"^DD",52.49,52.49,5.8,21,1,0)
Substitution definition, as needed. This holds the information regarding 
"^DD",52.49,52.49,5.8,21,2,0)
substitutions for a drug/supply item.
"^DD",52.49,52.49,5.8,"DT")
3160906
"^DD",52.49,52.49,5.9,0)
WRITTEN DATE^D^^5;9^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,5.9,3)
Enter the date that the eRx prescription was written by the provider.
"^DD",52.49,52.49,5.9,21,0)
^^2^2^3160906^
"^DD",52.49,52.49,5.9,21,1,0)
This is the date that the eRx incoming prescription was written by the 
"^DD",52.49,52.49,5.9,21,2,0)
provider.
"^DD",52.49,52.49,5.9,"DT")
3160906
"^DD",52.49,52.49,6.1,0)
LAST FILL DATE^D^^6;1^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.1,3)
Enter the last date the this eRx was filled.
"^DD",52.49,52.49,6.1,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.1,21,1,0)
This is the last fill date of the eRx prescription.
"^DD",52.49,52.49,6.1,"DT")
3160906
"^DD",52.49,52.49,6.2,0)
EXPIRATION DATE^D^^6;2^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.2,3)
Enter the expiration date for the eRx prescription.
"^DD",52.49,52.49,6.2,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.2,21,1,0)
The eRx prescription expiration date.
"^DD",52.49,52.49,6.2,"DT")
3160906
"^DD",52.49,52.49,6.3,0)
EFFECTIVE DATE^D^^6;3^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.3,3)
Enter the effective date for the eRx prescription.
"^DD",52.49,52.49,6.3,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.3,21,1,0)
The effective date of the eRx prescription.
"^DD",52.49,52.49,6.3,"DT")
3160906
"^DD",52.49,52.49,6.4,0)
PERIOD END^D^^6;4^S %DT="ESTXR" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.4,3)
Enter the period end date and time.
"^DD",52.49,52.49,6.4,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.4,21,1,0)
The period end for the incoming eRx prescription.
"^DD",52.49,52.49,6.4,"DT")
3160906
"^DD",52.49,52.49,6.5,0)
DELIVERED ON DATE^D^^6;5^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.5,3)
Enter the date the prescription was delivered.
"^DD",52.49,52.49,6.5,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.5,21,1,0)
This is the delivery date of the eRx prescription.
"^DD",52.49,52.49,6.5,"DT")
3160906
"^DD",52.49,52.49,6.6,0)
DATE VALIDATED^D^^6;6^S %DT="EX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,6.6,3)
Enter the date the prescription was validated.
"^DD",52.49,52.49,6.6,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,6.6,21,1,0)
This is the validation date of the eRx prescription.
"^DD",52.49,52.49,6.6,"DT")
3160906
"^DD",52.49,52.49,7,0)
DIRECTIONS^F^^7;1^K:$L(X)>140!($L(X)<3) X
"^DD",52.49,52.49,7,3)
Enter the directions associated with this eRx prescription. Answer must be 3-140 characters in length.
"^DD",52.49,52.49,7,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,7,21,1,0)
The directions for the eRx prescription.
"^DD",52.49,52.49,7,"DT")
3160906
"^DD",52.49,52.49,8,0)
NOTES^F^^8;1^K:$L(X)>240!($L(X)<1) X
"^DD",52.49,52.49,8,3)
Enter the notes for this eRx prescription. Answer must be 1-240 characters in length.
"^DD",52.49,52.49,8,21,0)
^^1^1^3160906^
"^DD",52.49,52.49,8,21,1,0)
The notes associated with the eRx prescription.
"^DD",52.49,52.49,8,"DT")
3160906
"^DD",52.49,52.49,9,0)
DIAGNOSIS^52.499^^9;0
"^DD",52.49,52.49,9,21,0)
^.001^1^1^3170826^^^
"^DD",52.49,52.49,9,21,1,0)
The diagnosis values associated with the eRx patient/prescription.
"^DD",52.49,52.49,9,"V",0)
^.12P
"^DD",52.49,52.49,10.2,0)
PRIOR AUTHORIZATION^F^^10;2^K:$L(X)>35!($L(X)<3) X
"^DD",52.49,52.49,10.2,3)
Enter the prior authorization value for the eRx prescription. Answer must be 3-35 characters in length.
"^DD",52.49,52.49,10.2,21,0)
^^1^1^3160907^
"^DD",52.49,52.49,10.2,21,1,0)
The prior authorization value for the eRx prescription.
"^DD",52.49,52.49,10.2,"DT")
3160907
"^DD",52.49,52.49,10.3,0)
PRIOR AUTHORIZATION QUALIFIER^P52.45'^PS(52.45,^10;3^Q
"^DD",52.49,52.49,10.3,3)
Enter the prior authorization qualifier for the eRx prescription.
"^DD",52.49,52.49,10.3,21,0)
^.001^1^1^3170310^^
"^DD",52.49,52.49,10.3,21,1,0)
This is the prior authorization qualifier for the eRx prescription.
"^DD",52.49,52.49,10.3,"DT")
3170310
"^DD",52.49,52.49,10.4,0)
PRIOR AUTHORIZATION STATUS^S^A:APPROVED;D:DENIED;R:REQUESTED;N:NOT REQUIRED;F:DEFERRED;^10;4^Q
"^DD",52.49,52.49,10.4,3)
Enter the prior authorization status for the eRx authorization.
"^DD",52.49,52.49,10.4,21,0)
^^1^1^3160907^
"^DD",52.49,52.49,10.4,21,1,0)
The prior authorization status for the eRx authorization.
"^DD",52.49,52.49,10.4,"DT")
3160907
"^DD",52.49,52.49,10.5,0)
DO NOT FILL^S^1:YES;^10;5^Q
"^DD",52.49,52.49,10.5,3)
Enter the value for the do not fill field.
"^DD",52.49,52.49,10.5,21,0)
^^3^3^3160907^
"^DD",52.49,52.49,10.5,21,1,0)
Y - Yes - Used for medications ordered by a prescriber not requiring 
"^DD",52.49,52.49,10.5,21,2,0)
dispensing, but available for reference and drug-to-drug interaction 
"^DD",52.49,52.49,10.5,21,3,0)
checking.
"^DD",52.49,52.49,10.5,"DT")
3160907
"^DD",52.49,52.49,10.6,0)
NEEDED NO LATER THAN^D^^10;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,10.6,3)
Enter the date/time the prescription is needed by.
"^DD",52.49,52.49,10.6,21,0)
^^1^1^3160907^
"^DD",52.49,52.49,10.6,21,1,0)
This is the date/time that the prescription is needed by.
"^DD",52.49,52.49,10.6,"DT")
3160907
"^DD",52.49,52.49,10.7,0)
TIMEZONE^F^^10;7^K:$L(X)>10!($L(X)<3) X
"^DD",52.49,52.49,10.7,3)
Enter the time zone associated with the needed by value. Answer must be 3-10 characters in length.
"^DD",52.49,52.49,10.7,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,10.7,21,1,0)
This is the time zone associated with the needed by date/time.
"^DD",52.49,52.49,10.7,"DT")
3160907
"^DD",52.49,52.49,10.8,0)
TIME ZONE DIFFERENCE QUANTITY^F^^10;8^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.49,10.8,3)
Enter the time zone difference quantity associated with the needed by timezone value. Answer must be 1-10 characters in length.
"^DD",52.49,52.49,10.8,21,0)
^^2^2^3170626^
"^DD",52.49,52.49,10.8,21,1,0)
This is the time zone difference quantity related to the needed by
"^DD",52.49,52.49,10.8,21,2,0)
time zone value.
"^DD",52.49,52.49,10.8,"DT")
3170711
"^DD",52.49,52.49,10.9,0)
NEEDED NO LATER THAN REASON^F^^10;9^K:$L(X)>70!($L(X)<3) X
"^DD",52.49,52.49,10.9,3)
Enter the reason associated with the needed no later than value (date/time). Answer must be 3-70 characters in length.
"^DD",52.49,52.49,10.9,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,10.9,21,1,0)
Enter the reason for the needed by date/time.
"^DD",52.49,52.49,10.9,"DT")
3160907
"^DD",52.49,52.49,11,0)
STRUCTURED SIG^52.4911A^^11;0
"^DD",52.49,52.49,11,21,0)
^.001^2^2^3170711^^
"^DD",52.49,52.49,11,21,1,0)
This sub-file holds the structured SIG information from the incoming XML 
"^DD",52.49,52.49,11,21,2,0)
message.
"^DD",52.49,52.49,12,0)
ORDER CHECKS^52.4912A^^12;0
"^DD",52.49,52.49,12,21,0)
^.001^1^1^3170711^^^
"^DD",52.49,52.49,12,21,1,0)
This multiple contains the order check information.
"^DD",52.49,52.49,13.1,0)
PATIENT FACILITY UNIT^F^^13;1^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49,13.1,3)
Enter the patient location facility unit. Answer must be 1-35 characters in length.
"^DD",52.49,52.49,13.1,21,0)
^.001^2^2^3170626^^
"^DD",52.49,52.49,13.1,21,1,0)
This the patient location facility unit associated with the incoming eRx 
"^DD",52.49,52.49,13.1,21,2,0)
prescription.
"^DD",52.49,52.49,13.1,"DT")
3161019
"^DD",52.49,52.49,13.2,0)
BED^F^^13;2^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.49,13.2,3)
Enter the bed the patient is in. Answer must be 1-10 characters in length.
"^DD",52.49,52.49,13.2,21,0)
^^1^1^3161019^
"^DD",52.49,52.49,13.2,21,1,0)
The physical bed that the patient is occupying.
"^DD",52.49,52.49,13.2,"DT")
3161019
"^DD",52.49,52.49,13.3,0)
ROOM^F^^13;3^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.49,13.3,3)
Enter the room where the patient is located. Answer must be 1-10 characters in length.
"^DD",52.49,52.49,13.3,21,0)
^^1^1^3161019^
"^DD",52.49,52.49,13.3,21,1,0)
The room where the patient is physically located.
"^DD",52.49,52.49,13.3,"DT")
3161019
"^DD",52.49,52.49,14,0)
OBSERVATION^52.4914A^^14;0
"^DD",52.49,52.49,14,21,0)
^^2^2^3170711^
"^DD",52.49,52.49,14,21,1,0)
This is the observation multiple that holds all observations received for 
"^DD",52.49,52.49,14,21,2,0)
an eRx prescription.
"^DD",52.49,52.49,15,0)
OBSERVATION NOTES^F^^15;1^K:$L(X)>140!($L(X)<1) X
"^DD",52.49,52.49,15,3)
Enter the observation notes associated with the incoming eRx prescription. Answer must be 1-140 characters in length.
"^DD",52.49,52.49,15,21,0)
^^1^1^3161019^
"^DD",52.49,52.49,15,21,1,0)
The observation notes associated with the eRx prescription.
"^DD",52.49,52.49,15,"DT")
3161019
"^DD",52.49,52.49,16,0)
DRUG USE EVALUATION^52.4916PA^^16;0
"^DD",52.49,52.49,16,21,0)
^^2^2^3170711^
"^DD",52.49,52.49,16,21,1,0)
This sub-file holds the drug use evaluation information for an incoming 
"^DD",52.49,52.49,16,21,2,0)
eRx prescription.
"^DD",52.49,52.49,17.1,0)
EXTERNAL PHARMACY^P52.47'^PS(52.47,^17;1^Q
"^DD",52.49,52.49,17.1,3)
Enter the external pharmacy that sent the incoming eRx prescription.
"^DD",52.49,52.49,17.1,21,0)
^^1^1^3160907^
"^DD",52.49,52.49,17.1,21,1,0)
This is the external pharmacy that sent the eRx prescription to the VA.
"^DD",52.49,52.49,17.1,"DT")
3160907
"^DD",52.49,52.49,17.2,0)
EXTERNAL PHARMACIST^P52.48'^PS(52.48,^17;2^Q
"^DD",52.49,52.49,17.2,3)
Enter the external pharmacist or person who sent the prescription to the VA.
"^DD",52.49,52.49,17.2,21,0)
^^2^2^3160907^
"^DD",52.49,52.49,17.2,21,1,0)
This is the external pharmacist associated with the incoming eRx 
"^DD",52.49,52.49,17.2,21,2,0)
prescription.
"^DD",52.49,52.49,17.2,"DT")
3160907
"^DD",52.49,52.49,17.3,0)
TRANSFERRED TO VA PHARMACY^P4'^DIC(4,^17;3^Q
"^DD",52.49,52.49,17.3,3)
Enter the VA institution where the prescription was transferred.
"^DD",52.49,52.49,17.3,21,0)
^^1^1^3160907^
"^DD",52.49,52.49,17.3,21,1,0)
The external VA institution where the prescription was transferred.
"^DD",52.49,52.49,17.3,"DT")
3160907
"^DD",52.49,52.49,17.4,0)
XFER TO EXTERNAL PHARMACY^P52.47'^PS(52.47,^17;4^Q
"^DD",52.49,52.49,17.4,3)
Enter the external pharmacy to where this eRx was transferred.
"^DD",52.49,52.49,17.4,21,0)
^^2^2^3170626^
"^DD",52.49,52.49,17.4,21,1,0)
This is the external pharmacy to where the eRx prescription was 
"^DD",52.49,52.49,17.4,21,2,0)
transferred.
"^DD",52.49,52.49,17.4,"DT")
3160907
"^DD",52.49,52.49,18,0)
PAYER INFORMATION^52.4918A^^18;0
"^DD",52.49,52.49,18,21,0)
^.001^1^1^3170901^^^^
"^DD",52.49,52.49,18,21,1,0)
The payer/cardholder information for the associated eRx prescription.
"^DD",52.49,52.49,19,0)
STATUS HISTORY^52.4919DA^^19;0
"^DD",52.49,52.49,19,21,0)
^.001^1^1^3170711^^
"^DD",52.49,52.49,19,21,1,0)
This multiple tracks the status changes that have occurred for an eRx.
"^DD",52.49,52.49,20.1,0)
VISTA QUANTITY^NJ11,2^^20;1^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",52.49,52.49,20.1,3)
Enter a whole number between 0 and 99999999 inclusive.  Alpha characters are not allowed, and the entry cannot exceed 11 characters, or contain more than two fractional decimal places (i.e.; .01).
"^DD",52.49,52.49,20.1,21,0)
^.001^2^2^3170828^^^^
"^DD",52.49,52.49,20.1,21,1,0)
This is the Vista quantity for the eRx prescription. This is the quantity 
"^DD",52.49,52.49,20.1,21,2,0)
needed for a prescription in Vista.
"^DD",52.49,52.49,20.1,"DT")
3170828
"^DD",52.49,52.49,20.2,0)
VISTA DAYS SUPPLY^NJ3,0^^20;2^K:+X'=X!(X>365)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,20.2,3)
Enter the Vista Days supply for the prescription. Type a number between 1 and 365, 0 decimal digits.
"^DD",52.49,52.49,20.2,21,0)
^^1^1^3170828^
"^DD",52.49,52.49,20.2,21,1,0)
This is the VistA Days supply value associated with the incoming eRx.
"^DD",52.49,52.49,20.2,"DT")
3170826
"^DD",52.49,52.49,20.3,0)
VISTA VERB^F^^20;3^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.49,20.3,3)
Enter the Verb for this medication. Answer must be 1-10 characters in length.
"^DD",52.49,52.49,20.3,21,0)
^.001^1^1^3170130^^
"^DD",52.49,52.49,20.3,21,1,0)
This is the medication instruction (verb) for the eRx.
"^DD",52.49,52.49,20.3,"DT")
3170130
"^DD",52.49,52.49,20.4,0)
VISTA ROUTING^S^M:MAIL;W:WINDOW;^20;4^Q
"^DD",52.49,52.49,20.4,3)
Enter the routing method for the incoming eRx prescription.
"^DD",52.49,52.49,20.4,21,0)
^^1^1^3170315^
"^DD",52.49,52.49,20.4,21,1,0)
This is the routing method for the incoming eRx. Mail or Window.
"^DD",52.49,52.49,20.4,"DT")
3170315
"^DD",52.49,52.49,20.5,0)
VISTA REFILLS^NJ2,0^^20;5^K:+X'=X!(X>11)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,20.5,3)
Enter the number of refills for this eRx. Type a number between 0 and 11, 0 decimal digits.
"^DD",52.49,52.49,20.5,21,0)
^.001^1^1^3170811^^
"^DD",52.49,52.49,20.5,21,1,0)
The number of vista refills for this incoming eRx.
"^DD",52.49,52.49,20.5,"DT")
3170811
"^DD",52.49,52.49,20.6,0)
VISTA CLINIC^P44'^SC(^20;6^Q
"^DD",52.49,52.49,20.6,3)
Enter the vista clinic associated with this eRx.
"^DD",52.49,52.49,20.6,21,0)
^^1^1^3170407^
"^DD",52.49,52.49,20.6,21,1,0)
The vista clinic associated with the incoming eRx.
"^DD",52.49,52.49,20.6,"DT")
3170407
"^DD",52.49,52.49,21,0)
QUANTITY/TIMING^52.4921A^^21;0
"^DD",52.49,52.49,21,21,0)
^^2^2^3170626^
"^DD",52.49,52.49,21,21,1,0)
This is the quantity/timing sub-file which holds information about dosing 
"^DD",52.49,52.49,21,21,2,0)
for a medication.
"^DD",52.49,52.49,22.1,0)
FROM^F^^22;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.49,22.1,3)
Enter the 'From' value, as passed in the XML 'From' element. Answer must be 1-50 characters in length.
"^DD",52.49,52.49,22.1,21,0)
^^1^1^3170307^
"^DD",52.49,52.49,22.1,21,1,0)
The FROM value as passed from the incoming XML.
"^DD",52.49,52.49,22.1,"DT")
3170307
"^DD",52.49,52.49,22.2,0)
FROM QUALIFIER^S^P:PHARMACY;D:PRESCRIBER;^22;2^Q
"^DD",52.49,52.49,22.2,3)
Enter the From Qualifier for the incoming eRx.
"^DD",52.49,52.49,22.2,21,0)
^.001^1^1^3170405^^
"^DD",52.49,52.49,22.2,21,1,0)
The from qualifier attribute associated with this eRx.
"^DD",52.49,52.49,22.2,"DT")
3170405
"^DD",52.49,52.49,22.3,0)
TO^F^^22;3^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.49,22.3,3)
Enter the 'To' value as passed in within the incoming eRx XML. Answer must be 1-50 characters in length.
"^DD",52.49,52.49,22.3,21,0)
^^2^2^3170626^
"^DD",52.49,52.49,22.3,21,1,0)
This is the 'To' value as passed in as part of the header portion of the 
"^DD",52.49,52.49,22.3,21,2,0)
eRx XML message.
"^DD",52.49,52.49,22.3,"DT")
3170307
"^DD",52.49,52.49,22.4,0)
TO QUALIFIER^S^P:PHARMACY;D:PRESCRIBER;^22;4^Q
"^DD",52.49,52.49,22.4,3)
Enter the To Qualifier for the incoming eRx.
"^DD",52.49,52.49,22.4,21,0)
^.001^2^2^3170405^^
"^DD",52.49,52.49,22.4,21,1,0)
This is the 'To' qualifier attribute that is passed within the incoming 
"^DD",52.49,52.49,22.4,21,2,0)
XML. This To qualifier is found in the 'Header' parent of the XML.
"^DD",52.49,52.49,22.4,"DT")
3170405
"^DD",52.49,52.49,22.5,0)
CH SENT DATE/TIME^D^^22;5^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49,22.5,3)
Enter the date/time the eRx was received into the Vista system.
"^DD",52.49,52.49,22.5,21,0)
^^1^1^3170318^
"^DD",52.49,52.49,22.5,21,1,0)
This is the date time the eRx was received by the vista system.
"^DD",52.49,52.49,22.5,"DT")
3170510
"^DD",52.49,52.49,24.1,0)
RELATED INSTITUTION^P4'^DIC(4,^24;1^Q
"^DD",52.49,52.49,24.1,3)
Enter the institution related to this incoming eRx.
"^DD",52.49,52.49,24.1,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,24.1,21,1,0)
This is the institution that the incoming eRx belongs to.
"^DD",52.49,52.49,24.1,"DT")
3170726
"^DD",52.49,52.49,24.2,0)
DIVISION^P40.8'^DG(40.8,^24;2^Q
"^DD",52.49,52.49,24.2,3)
Enter the division associated with this incoming eRx.
"^DD",52.49,52.49,24.2,21,0)
^^1^1^3170321^
"^DD",52.49,52.49,24.2,21,1,0)
This is the medical center division associated to the incoming eRx.
"^DD",52.49,52.49,24.2,"DT")
3170321
"^DD",52.49,52.49,24.3,0)
SENDER SECONDARY ID^F^^24;3^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49,24.3,3)
Enter the sender secondary identification. Answer must be 1-35 characters in length.
"^DD",52.49,52.49,24.3,21,0)
^^1^1^3170523^
"^DD",52.49,52.49,24.3,21,1,0)
This is the senders secondary identification value.
"^DD",52.49,52.49,24.3,"DT")
3170523
"^DD",52.49,52.49,24.4,0)
SENDER TERTIARY ID^F^^24;4^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49,24.4,3)
Enter the senders tertiary identification. Answer must be 1-35 characters in length.
"^DD",52.49,52.49,24.4,21,0)
^^1^1^3170523^
"^DD",52.49,52.49,24.4,21,1,0)
This is the senders tertiary identification value.
"^DD",52.49,52.49,24.4,"DT")
3170523
"^DD",52.49,52.49,24.5,0)
RECEIVER SECONDARY ID^F^^24;5^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49,24.5,3)
Enter the receivers secondary identification value. Answer must be 1-35 characters in length.
"^DD",52.49,52.49,24.5,21,0)
^^1^1^3170523^
"^DD",52.49,52.49,24.5,21,1,0)
This is the receiver secondary identification value.
"^DD",52.49,52.49,24.5,"DT")
3170523
"^DD",52.49,52.49,24.6,0)
RECEIVER TERTIARY ID^F^^24;6^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49,24.6,3)
Enter the receivers tertiary identification value. Answer must be 1-35 characters in length.
"^DD",52.49,52.49,24.6,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,24.6,21,1,0)
This is the receiver tertiary identification.
"^DD",52.49,52.49,24.6,"DT")
3170523
"^DD",52.49,52.49,25,0)
CH MESSAGE ID^F^^25;1^K:$L(X)>35!($L(X)<3) X
"^DD",52.49,52.49,25,3)
Enter the Change Healthcare message identification value. Answer must be 3-35 characters in length.
"^DD",52.49,52.49,25,21,0)
^.001^2^2^3170510^^
"^DD",52.49,52.49,25,21,1,0)
This is the eRx processing hub numeric identifier. This is a unique 
"^DD",52.49,52.49,25,21,2,0)
number created by the processing hub for tracking/management of an eRx.
"^DD",52.49,52.49,25,"DT")
3170510
"^DD",52.49,52.49,25.2,0)
PENDING OUTPATIENT ORDER#^NJ10,0^^25;2^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49,25.2,3)
Enter the pending outpatient order IEN associated with this eRx. Type a number between 1 and 999999999, 0 decimal digits.
"^DD",52.49,52.49,25.2,21,0)
^.001^2^2^3170407^^^
"^DD",52.49,52.49,25.2,21,1,0)
This is the pending outpatient order in file 52.41, once the eRx has been 
"^DD",52.49,52.49,25.2,21,2,0)
sent to the file.
"^DD",52.49,52.49,25.2,"DT")
3170331
"^DD",52.49,52.49,26,0)
VA DISPENSING INSTRUCTIONS^52.4926A^^SIG;0
"^DD",52.49,52.49,26,21,0)
^.001^2^2^3170711^^
"^DD",52.49,52.49,26,21,1,0)
This field holds the VA SIG information, which will be sent to pending 
"^DD",52.49,52.49,26,21,2,0)
outpatient orders as the SIG.
"^DD",52.49,52.49,26,"DT")
3170614
"^DD",52.49,52.49,27,0)
VA PATIENT INSTRUCTIONS^F^^INS;1^K:$L(X)>240!($L(X)<1) X
"^DD",52.49,52.49,27,3)
Enter the patient instructions for this eRx. Answer must be 1-240 characters in length.
"^DD",52.49,52.49,27,21,0)
^^4^4^3170325^
"^DD",52.49,52.49,27,21,1,0)
This field holds the patient instructions for an eRx. This field will be 
"^DD",52.49,52.49,27,21,2,0)
transferred to the pending outpatient orders file upon acceptance of an 
"^DD",52.49,52.49,27,21,3,0)
eRx. This field is the equivalent to the patient instructions field in 
"^DD",52.49,52.49,27,21,4,0)
the pending outpatient orders file.
"^DD",52.49,52.49,27,"DT")
3170325
"^DD",52.49,52.49,28,0)
DRUG COVERAGE STATUS^52.4928A^^28;0
"^DD",52.49,52.49,28,21,0)
^^1^1^3170329^
"^DD",52.49,52.49,28,21,1,0)
The drug coverage status multiple to hold the drug coverage status values.
"^DD",52.49,52.49,30,0)
VA PROVIDER COMMENTS^F^^30;1^K:$L(X)>240!($L(X)<1) X
"^DD",52.49,52.49,30,3)
Enter the VA Provider comments for this eRx. Answer must be 1-240 characters in length.
"^DD",52.49,52.49,30,21,0)
^.001^3^3^3170906^^
"^DD",52.49,52.49,30,21,1,0)
This is the VA provider comments. This represents the provider comments 
"^DD",52.49,52.49,30,21,2,0)
for a prescription, which is the VA's version of the 'DIRECTIONS' that 
"^DD",52.49,52.49,30,21,3,0)
are received with an eRx.
"^DD",52.49,52.49,30,"DT")
3170906
"^DD",52.49,52.49,31,0)
VA UNEXPANDED SIG^52.4931^^31;0
"^DD",52.49,52.49,31,21,0)
^^1^1^3170711^
"^DD",52.49,52.49,31,21,1,0)
The un-expanded SIG for the eRx prescription.
"^DD",52.49,52.49,41,0)
EXTERNAL FORM CODE^F^^41;1^K:$L(X)>70!($L(X)<1) X
"^DD",52.49,52.49,41,3)
Enter the external form Code. Answer must be 1-70 characters in length.
"^DD",52.49,52.49,41,21,0)
^^1^1^3170619^
"^DD",52.49,52.49,41,21,1,0)
The external form code for the medication being prescribed.
"^DD",52.49,52.49,41,"DT")
3170619
"^DD",52.49,52.49,42,0)
EXTERNAL POTENCY UNIT CODE^F^^42;1^K:$L(X)>70!($L(X)<1) X
"^DD",52.49,52.49,42,3)
Enter the external value of the potency unit code. Answer must be 1-70 characters in length.
"^DD",52.49,52.49,42,21,0)
^^1^1^3170619^
"^DD",52.49,52.49,42,21,1,0)
This is the external form of the potency unit code.
"^DD",52.49,52.49,42,"DT")
3170619
"^DD",52.49,52.49,43,0)
EXTERNAL STRENTH CODE^F^^43;1^K:$L(X)>70!($L(X)<1) X
"^DD",52.49,52.49,43,3)
Enter the external value for the strength code. Answer must be 1-70 characters in length.
"^DD",52.49,52.49,43,21,0)
^^1^1^3170626^
"^DD",52.49,52.49,43,21,1,0)
This is the external value of the strength code. 
"^DD",52.49,52.49,43,"DT")
3170619
"^DD",52.49,52.49,44,0)
PAYER CARDHOLDER ID CONVERTED?^S^1:YES;^44;1^Q
"^DD",52.49,52.49,44,3)
Enter 'Yes' if the Payer cardholder id values have been converted for this eRx.
"^DD",52.49,52.49,44,21,0)
^^6^6^3170901^
"^DD",52.49,52.49,44,21,1,0)
If this flag is set to yes, the payer cardholder ID values have been 
"^DD",52.49,52.49,44,21,2,0)
converted into the new format. This needs to be set if the conversion has 
"^DD",52.49,52.49,44,21,3,0)
taken place so no futher conversion attempts will occur on this record. 
"^DD",52.49,52.49,44,21,4,0)
The cardholder id field is not a required field on an incoming eRx and 
"^DD",52.49,52.49,44,21,5,0)
was previously being used as the .01 field. This has been changed to now 
"^DD",52.49,52.49,44,21,6,0)
be a sequence value, and cardholder ID has been moved into field #7.
"^DD",52.49,52.49,44,"DT")
3170901
"^DD",52.49,52.49,100,0)
PROCESSING ERRORS^52.49101A^^100;0
"^DD",52.49,52.49,100,21,0)
^^2^2^3170626^
"^DD",52.49,52.49,100,21,1,0)
This sub-file contains the processing errors associated with the eRx
"^DD",52.49,52.49,100,21,2,0)
entry.
"^DD",52.49,52.49101,0)
PROCESSING ERRORS SUB-FIELD^^1^7
"^DD",52.49,52.49101,0,"DT")
3170307
"^DD",52.49,52.49101,0,"IX","B",52.49101,.01)

"^DD",52.49,52.49101,0,"NM","PROCESSING ERRORS")

"^DD",52.49,52.49101,0,"UP")
52.49
"^DD",52.49,52.49101,.01,0)
PROCESSING ERRORS^NJ5,0^^0;1^K:+X'=X!(X>99999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.49101,.01,1,0)
^.1
"^DD",52.49,52.49101,.01,1,1,0)
52.49101^B
"^DD",52.49,52.49101,.01,1,1,1)
S ^PS(52.49,DA(1),100,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.49101,.01,1,1,2)
K ^PS(52.49,DA(1),100,"B",$E(X,1,30),DA)
"^DD",52.49,52.49101,.01,3)
Enter the Error ID. Answer must be a number between 1 and 99999, 0 decimal digits.
"^DD",52.49,52.49101,.01,21,0)
^.001^1^1^3170626^^
"^DD",52.49,52.49101,.01,21,1,0)
The processing error ID.
"^DD",52.49,52.49101,.01,"DT")
3161205
"^DD",52.49,52.49101,.02,0)
ERROR TYPE^S^D:DRUG;PR:PROVIDER;PA:PATIENT;A:ALLERGY;O:ORDER CHECK;T:TRANSFER;^0;2^Q
"^DD",52.49,52.49101,.02,3)
Enter the error type associated with this eRx entry.
"^DD",52.49,52.49101,.02,21,0)
^^1^1^3161205^
"^DD",52.49,52.49101,.02,21,1,0)
The error type related to the incoming eRx.
"^DD",52.49,52.49101,.02,"DT")
3161205
"^DD",52.49,52.49101,.03,0)
ERROR SOURCE^S^V:VISTA;E:ERX PROCESSING HUB;^0;3^Q
"^DD",52.49,52.49101,.03,3)
Enter the source of the error. This is the origination source of the error.
"^DD",52.49,52.49101,.03,21,0)
^^1^1^3161205^
"^DD",52.49,52.49101,.03,21,1,0)
The origination point/source of the processing error.
"^DD",52.49,52.49101,.03,"DT")
3161205
"^DD",52.49,52.49101,.04,0)
STATUS^S^R:RESOLVE;R:RESOLVED;P:PENDING;^0;4^Q
"^DD",52.49,52.49101,.04,3)
Enter the status of the processing error.
"^DD",52.49,52.49101,.04,21,0)
^^1^1^3161205^
"^DD",52.49,52.49101,.04,21,1,0)
This is the current status of the processing error.
"^DD",52.49,52.49101,.04,"DT")
3161205
"^DD",52.49,52.49101,.05,0)
RESOLVED BY^P200'^VA(200,^0;5^Q
"^DD",52.49,52.49101,.05,3)
Enter the person who resolved this error.
"^DD",52.49,52.49101,.05,21,0)
^^1^1^3161205^
"^DD",52.49,52.49101,.05,21,1,0)
The person who resolved the processing error.
"^DD",52.49,52.49101,.05,"DT")
3161205
"^DD",52.49,52.49101,.06,0)
DATE/TIME RESOLVED^D^^0;6^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.49101,.06,3)
Enter the date/time the processing error was resolved.
"^DD",52.49,52.49101,.06,21,0)
^^1^1^3161205^
"^DD",52.49,52.49101,.06,21,1,0)
The date/time of the processing error resolution.
"^DD",52.49,52.49101,.06,"DT")
3161205
"^DD",52.49,52.49101,1,0)
ERROR TEXT^F^^1;1^K:$L(X)>250!($L(X)<1) X
"^DD",52.49,52.49101,1,3)
Enter the error text for this eRx. Answer must be 1-150 characters in length.
"^DD",52.49,52.49101,1,21,0)
^^2^2^3170307^
"^DD",52.49,52.49101,1,21,1,0)
This is the error description/text that identifies the reason for the 
"^DD",52.49,52.49101,1,21,2,0)
error.
"^DD",52.49,52.49101,1,"DT")
3170307
"^DD",52.49,52.4911,0)
STRUCTURED SIG SUB-FIELD^^2.7^92
"^DD",52.49,52.4911,0,"DT")
3170213
"^DD",52.49,52.4911,0,"NM","STRUCTURED SIG")

"^DD",52.49,52.4911,0,"UP")
52.49
"^DD",52.49,52.4911,.01,0)
SIG SEQUENCE POSITION NUMBER^RNJ3,0x^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,.01,3)
Enter the Sig sequence position number. Answer must be between 1 and 999, 0 decimal digits.
"^DD",52.49,52.4911,.01,21,0)
^^1^1^3161017^
"^DD",52.49,52.4911,.01,21,1,0)
This is the Sig sequence position number.
"^DD",52.49,52.4911,.01,"DT")
3161017
"^DD",52.49,52.4911,.02,0)
MULTIPLE SIG MODIFIER^S^A:AND;O:OR;T:THEN;^0;2^Q
"^DD",52.49,52.4911,.02,3)
Enter the multiple sig modifier.
"^DD",52.49,52.4911,.02,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,.02,21,1,0)
This is the multiple sig modifier for the structured sig.
"^DD",52.49,52.4911,.02,"DT")
3161018
"^DD",52.49,52.4911,.03,0)
SNOMED VERSION^F^^0;3^K:$L(X)>14!($L(X)<1) X
"^DD",52.49,52.4911,.03,3)
Enter the SNOMED version. Answer must be 1-14 characters in length.
"^DD",52.49,52.4911,.03,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,.03,21,1,0)
This is the SNOMED version associated with the structured SIG.
"^DD",52.49,52.4911,.03,"DT")
3161018
"^DD",52.49,52.4911,.04,0)
FMT VERSION^F^^0;4^K:$L(X)>14!($L(X)<1) X
"^DD",52.49,52.4911,.04,3)
Enter the FMT version for the structured SIG. Answer must be 1-14 characters in length.
"^DD",52.49,52.4911,.04,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,.04,21,1,0)
This is the FMT Version for the structured SIG.
"^DD",52.49,52.4911,.04,"DT")
3161018
"^DD",52.49,52.4911,.05,0)
FREE TEXT STRING INDICATOR^F^^0;5^K:$L(X)>1!($L(X)<1) X
"^DD",52.49,52.4911,.05,3)
Enter the free text string indicator. Answer must be 1 character in length.
"^DD",52.49,52.4911,.05,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,.05,21,1,0)
This is the free text string indicator for the SIG.
"^DD",52.49,52.4911,.05,"DT")
3161018
"^DD",52.49,52.4911,1,0)
SIG FREE TEXT^F^^1;1^K:$L(X)>140!($L(X)<1) X
"^DD",52.49,52.4911,1,3)
Enter the SIG free text for this incoming eRx message. Answer must be 1-140 characters in length.
"^DD",52.49,52.4911,1,21,0)
^.001^1^1^3170626^^
"^DD",52.49,52.4911,1,21,1,0)
This is the free text SIG for the incoming eRx.
"^DD",52.49,52.4911,1,"DT")
3161018
"^DD",52.49,52.4911,2.1,0)
DOSE COMPOSITE INDICATOR^NJ1,0^^2;1^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,2.1,3)
Enter the dose composite indicator for this eRx. Type a number between 1 and 4, 0 decimal digits.
"^DD",52.49,52.4911,2.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,2.1,21,1,0)
This is the dose composite indicator for the incoming eRx SIG.
"^DD",52.49,52.4911,2.1,"DT")
3161018
"^DD",52.49,52.4911,2.2,0)
DD METHOD TEXT^F^^2;2^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,2.2,3)
Enter the drug delivery method text. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,2.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,2.2,21,1,0)
The dose delivery method text for the eRx.
"^DD",52.49,52.4911,2.2,"DT")
3161018
"^DD",52.49,52.4911,2.3,0)
DD METHOD CODE QUALIFIER^S^1:SNOMED;2:FMT;^2;3^Q
"^DD",52.49,52.4911,2.3,3)
Enter the dose delivery method code qualifier.
"^DD",52.49,52.4911,2.3,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,2.3,21,1,0)
The dose delivery method code qualifier for the eRx SIG.
"^DD",52.49,52.4911,2.3,"DT")
3170213
"^DD",52.49,52.4911,2.4,0)
DOSE DELIVERY METHOD CODE^F^^2;4^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,2.4,3)
Enter the dose delivery method code. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,2.4,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,2.4,21,1,0)
The dose delivery method code for the eRx SIG.
"^DD",52.49,52.4911,2.4,"DT")
3161018
"^DD",52.49,52.4911,2.5,0)
DD METHOD MODIFIER TEXT^F^^2;5^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,2.5,3)
Enter the dose delivery method modifier text. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,2.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,2.5,21,1,0)
The dose delivery method modifier text for the eRx.
"^DD",52.49,52.4911,2.5,"DT")
3161018
"^DD",52.49,52.4911,2.6,0)
DD METHOD MOD CODE^F^^2;6^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,2.6,3)
Enter the dose delivery method modifier code. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,2.6,21,0)
^^1^1^3170626^
"^DD",52.49,52.4911,2.6,21,1,0)
The dose delivery method modifier code for the incoming eRx prescription.
"^DD",52.49,52.4911,2.6,"DT")
3161018
"^DD",52.49,52.4911,2.7,0)
DD METHOD MOD CODE QUAL^S^1:SNOMED;2:FMT;^2;7^Q
"^DD",52.49,52.4911,2.7,3)
Enter the dose delivery method modifier code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,2.7,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,2.7,21,1,0)
The dose delivery method modifier code qualifier for the incoming eRx 
"^DD",52.49,52.4911,2.7,21,2,0)
prescription.
"^DD",52.49,52.4911,2.7,"DT")
3170213
"^DD",52.49,52.4911,3.1,0)
DOSE QUANTITY^NJ10,0^^3;1^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,3.1,3)
Enter the dose quantity. Type a number between 1 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,3.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,3.1,21,1,0)
The dose quantity for the incoming eRx prescription.
"^DD",52.49,52.4911,3.1,"DT")
3161018
"^DD",52.49,52.4911,3.2,0)
DOSE FORM TEXT^F^^3;2^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,3.2,3)
Enter the dose form text. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,3.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,3.2,21,1,0)
The dose form text for the incoming eRx prescription.
"^DD",52.49,52.4911,3.2,"DT")
3161018
"^DD",52.49,52.4911,3.3,0)
DOSE FORM CODE^F^^3;3^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,3.3,3)
Enter the dose for code for the eRx. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,3.3,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,3.3,21,1,0)
The dose form code for the incoming eRx.
"^DD",52.49,52.4911,3.3,"DT")
3161018
"^DD",52.49,52.4911,3.4,0)
DOSE FORM CODE QUALIFIER^S^1:SNOMED;2:FMT;^3;4^Q
"^DD",52.49,52.4911,3.4,3)
Enter the dose form code qualifier for this eRx prescription.
"^DD",52.49,52.4911,3.4,21,0)
^.001^1^1^3170213^^^
"^DD",52.49,52.4911,3.4,21,1,0)
The dose form code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,3.4,"DT")
3170213
"^DD",52.49,52.4911,3.5,0)
DOSE RANGE MODIFIER^S^T:TO;O:OR;^3;5^Q
"^DD",52.49,52.4911,3.5,3)
Enter the dose range modifier for this eRx prescription.
"^DD",52.49,52.4911,3.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,3.5,21,1,0)
The dose range modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,3.5,"DT")
3161018
"^DD",52.49,52.4911,4.1,0)
DC BASIS NUMERIC VALUE^NJ10,0^^4;1^K:+X'=X!(X>9999999999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,4.1,3)
Enter the dosing basis numeric value for this eRx. Type a number between 1 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,4.1,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,4.1,21,1,0)
The dose calculation - dosing basis numeric value for the eRx 
"^DD",52.49,52.4911,4.1,21,2,0)
prescription.
"^DD",52.49,52.4911,4.1,"DT")
3161018
"^DD",52.49,52.4911,4.11,0)
DC CALC DOSE UM CODE QUALIFIER^S^1:SNOMED;2:FMT;^4;10^Q
"^DD",52.49,52.4911,4.11,3)
Enter the dose calculation calculated dose unit of measure code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,4.11,21,0)
^.001^2^2^3170213^^^
"^DD",52.49,52.4911,4.11,21,1,0)
This is the dose calculation - calculated dose unit of measure code 
"^DD",52.49,52.4911,4.11,21,2,0)
qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,4.11,"DT")
3170213
"^DD",52.49,52.4911,4.12,0)
DC CALC DOSING BASIS RANGE MOD^S^T:TO;O:OR;^4;11^Q
"^DD",52.49,52.4911,4.12,3)
Enter the dose calculation dosing basis range modifier for this incoming eRx prescription.
"^DD",52.49,52.4911,4.12,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,4.12,21,1,0)
This is the dose calculation - dosing basis range modifier for the 
"^DD",52.49,52.4911,4.12,21,2,0)
incoming eRx prescription.
"^DD",52.49,52.4911,4.12,"DT")
3161018
"^DD",52.49,52.4911,4.2,0)
DC DOSING UM TEXT^F^^4;2^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,4.2,3)
Enter the dosing basis unit of measure text for this eRx. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,4.2,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,4.2,21,1,0)
This is the dose calculation - dosing basis unit of measure text for the 
"^DD",52.49,52.4911,4.2,21,2,0)
incoming eRx prescription.
"^DD",52.49,52.4911,4.2,"DT")
3161018
"^DD",52.49,52.4911,4.3,0)
DC DOSING UM CODE^F^^4;3^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,4.3,3)
Enter the dose calculation dosing basis unit of measure code for this eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,4.3,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,4.3,21,1,0)
The dose calculation - dosing basis unit of measure code for the incoming
"^DD",52.49,52.4911,4.3,21,2,0)
eRx prescription.
"^DD",52.49,52.4911,4.3,"DT")
3161018
"^DD",52.49,52.4911,4.4,0)
DC DOSING UM CODE MODIFIER^S^1:SNOMED;2:FMT;^4;4^Q
"^DD",52.49,52.4911,4.4,3)
Enter the dose calculation dosing basis unit of measure code qualifier for this eRx prescription.
"^DD",52.49,52.4911,4.4,21,0)
^.001^2^2^3170213^^^
"^DD",52.49,52.4911,4.4,21,1,0)
This is the dose calculation - dosing basis unit of measure code 
"^DD",52.49,52.4911,4.4,21,2,0)
qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,4.4,"DT")
3170213
"^DD",52.49,52.4911,4.5,0)
DC BODY METRIC QUALIFIER^S^1:KILOGRAM;2:METER SQUARED;^4;5^Q
"^DD",52.49,52.4911,4.5,3)
Enter the body metric qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,4.5,21,0)
^.001^2^2^3170711^^^^
"^DD",52.49,52.4911,4.5,21,1,0)
This is the dose calculation - body metric qualifier for the incoming eRx 
"^DD",52.49,52.4911,4.5,21,2,0)
prescription.
"^DD",52.49,52.4911,4.5,"DT")
3170213
"^DD",52.49,52.4911,4.6,0)
DC BODY METRIC VALUE^NJ10,0^^4;6^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,4.6,3)
Enter the dose calculation body metric value. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,4.6,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,4.6,21,1,0)
This is the dose calculation - body metric value for the incoming eRx 
"^DD",52.49,52.4911,4.6,21,2,0)
prescription.
"^DD",52.49,52.4911,4.6,"DT")
3161018
"^DD",52.49,52.4911,4.7,0)
DC CALC DOSE NUMERIC^NJ10,0^^4;7^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,4.7,3)
Enter the dose calculation calculated dose numeric for this incoming eRx prescription. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,4.7,21,0)
^^2^2^3170626^
"^DD",52.49,52.4911,4.7,21,1,0)
This is the dose calculation - calculated dose numeric for the incoming 
"^DD",52.49,52.4911,4.7,21,2,0)
eRx prescription.
"^DD",52.49,52.4911,4.7,"DT")
3161018
"^DD",52.49,52.4911,4.8,0)
DC CALC DOSE UM TEXT^F^^4;8^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,4.8,3)
Enter the dose calculation calculated dose unit of measure text. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,4.8,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,4.8,21,1,0)
This is the dose calculation - calculated dose unit of measure text for 
"^DD",52.49,52.4911,4.8,21,2,0)
the incoming eRx prescription.
"^DD",52.49,52.4911,4.8,"DT")
3161018
"^DD",52.49,52.4911,4.9,0)
DC CALC DOSE UM CODE^F^^4;9^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,4.9,3)
Enter the dose calculation calculated dose unit of measure code. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,4.9,21,0)
^.001^2^2^3170213^^^
"^DD",52.49,52.4911,4.9,21,1,0)
This is the dose calculation - calculated dose unit of measure code for 
"^DD",52.49,52.4911,4.9,21,2,0)
the incoming eRx prescription.
"^DD",52.49,52.4911,4.9,"DT")
3161018
"^DD",52.49,52.4911,5.1,0)
VEHICLE NAME^F^^5;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,5.1,3)
Enter the dose vehicle name for this incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,5.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.1,21,1,0)
This is the dose - vehicle name for the incoming eRx prescription.
"^DD",52.49,52.4911,5.1,"DT")
3161018
"^DD",52.49,52.4911,5.2,0)
VEHICLE NAME CODE^F^^5;2^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,5.2,3)
Enter the dose vehicle name code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,5.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.2,21,1,0)
This is the vehicle name code for the incoming eRx prescription.
"^DD",52.49,52.4911,5.2,"DT")
3161018
"^DD",52.49,52.4911,5.3,0)
VEHICLE NAME CODE QUALIFIER^S^1:SNOMED;2:FMT;^5;3^Q
"^DD",52.49,52.4911,5.3,3)
Enter the vehicle name code qualifier for this incoming eRx prescription.
"^DD",52.49,52.4911,5.3,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,5.3,21,1,0)
This is the dose vehicle name code qualifier for the incoming eRx 
"^DD",52.49,52.4911,5.3,21,2,0)
prescription.
"^DD",52.49,52.4911,5.3,"DT")
3170213
"^DD",52.49,52.4911,5.4,0)
VEHICLE QUANTITY^NJ10,0^^5;4^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,5.4,3)
Enter the dose vehicle quantity for the incoming eRx prescription. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,5.4,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.4,21,1,0)
The dose - vehicle quantity for the incoming eRx prescription.
"^DD",52.49,52.4911,5.4,"DT")
3161018
"^DD",52.49,52.4911,5.5,0)
VEHICLE UNIT OF MEASURE TEXT^F^^5;5^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,5.5,3)
Enter the dose - vehicle unit of measure text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,5.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.5,21,1,0)
The dose - vehicle unit of measure text for the incoming eRx prescription.
"^DD",52.49,52.4911,5.5,"DT")
3161018
"^DD",52.49,52.4911,5.6,0)
VEHICLE UNIT OF MEASURE CODE^F^^5;6^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,5.6,3)
Enter the vehicle unit of measure code for this incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,5.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.6,21,1,0)
This is the vehicl unit of measure code for the incoming eRx prescription.
"^DD",52.49,52.4911,5.6,"DT")
3161018
"^DD",52.49,52.4911,5.7,0)
VEHICLE UM CODE QUALIFIER^S^1:SNOMED;2:FMT;^5;7^Q
"^DD",52.49,52.4911,5.7,3)
Enter the vehicle unit of measure code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,5.7,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,5.7,21,1,0)
The vehicle unit of measure code qualifier for the incoming eRx 
"^DD",52.49,52.4911,5.7,21,2,0)
prescription.
"^DD",52.49,52.4911,5.7,"DT")
3170213
"^DD",52.49,52.4911,5.8,0)
MULTIPLE VEHICLE MODIFIER^S^A:AND;O:OR;^5;8^Q
"^DD",52.49,52.4911,5.8,3)
Enter the multiple vehicle modifier for this incoming eRx prescription.
"^DD",52.49,52.4911,5.8,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,5.8,21,1,0)
The multiple vehicle modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,5.8,"DT")
3161018
"^DD",52.49,52.4911,6.1,0)
ROUTE ADMIN TEXT^F^^6;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,6.1,3)
Enter the route of administration text for this incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,6.1,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,6.1,21,1,0)
This is the route of administration text for the incoming eRx 
"^DD",52.49,52.4911,6.1,21,2,0)
prescription.
"^DD",52.49,52.4911,6.1,"DT")
3161018
"^DD",52.49,52.4911,6.2,0)
ROUTE ADMIN CODE^F^^6;2^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,6.2,3)
Enter the route of administration code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,6.2,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,6.2,21,1,0)
This is the route of administration code for the incoming eRx 
"^DD",52.49,52.4911,6.2,21,2,0)
prescription.
"^DD",52.49,52.4911,6.2,"DT")
3161018
"^DD",52.49,52.4911,6.3,0)
ROUTE ADMIN CODE QUALIFIER^S^1:SNOMED;2:FMT;^6;3^Q
"^DD",52.49,52.4911,6.3,3)
Enter the route of administration code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,6.3,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,6.3,21,1,0)
This is the route of administration code qualifier for the incoming eRx 
"^DD",52.49,52.4911,6.3,21,2,0)
prescription.
"^DD",52.49,52.4911,6.3,"DT")
3170213
"^DD",52.49,52.4911,6.4,0)
MULT ROUTE ADMIN MODIFIER^S^A:AND;O:OR;^6;4^Q
"^DD",52.49,52.4911,6.4,3)
Enter the multiple route of administration modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,6.4,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,6.4,21,1,0)
This is the multiple route of administration modifier for the incoming 
"^DD",52.49,52.4911,6.4,21,2,0)
eRx prescription.
"^DD",52.49,52.4911,6.4,"DT")
3161018
"^DD",52.49,52.4911,6.5,0)
SITE ADMIN TEXT^F^^6;5^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,6.5,3)
Enter the site of administration text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,6.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,6.5,21,1,0)
This is the site of administration text for the incoming eRx prescription.
"^DD",52.49,52.4911,6.5,"DT")
3161018
"^DD",52.49,52.4911,6.6,0)
SITE ADMIN CODE^F^^6;6^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,6.6,3)
Enter the site of administration code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,6.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,6.6,21,1,0)
This is the site of administration code for the incoming eRx prescription.
"^DD",52.49,52.4911,6.6,"DT")
3161018
"^DD",52.49,52.4911,6.7,0)
SITE ADMIN CODE QUALIFIER^S^1:SNOMED;2:FMT;^6;7^Q
"^DD",52.49,52.4911,6.7,3)
Enter the site of administration code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,6.7,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,6.7,21,1,0)
This is the site of administration code qualifier for the incoming eRx 
"^DD",52.49,52.4911,6.7,21,2,0)
prescription.
"^DD",52.49,52.4911,6.7,"DT")
3170213
"^DD",52.49,52.4911,6.8,0)
MULT ADMIN TIMING MODIFIER^S^A:AND;O:OR;N:NOT;^6;8^Q
"^DD",52.49,52.4911,6.8,3)
Enter the multiple administration timing modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,6.8,21,0)
^^2^2^3170711^
"^DD",52.49,52.4911,6.8,21,1,0)
This is the multiple administration timing modifier for the incoming eRx 
"^DD",52.49,52.4911,6.8,21,2,0)
prescription.
"^DD",52.49,52.4911,6.8,"DT")
3161018
"^DD",52.49,52.4911,7.1,0)
ADMIN TIMING TEXT^F^^7;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,7.1,3)
Enter the administration timing text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,7.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,7.1,21,1,0)
This is the administration timing text for the incoming eRx prescription.
"^DD",52.49,52.4911,7.1,"DT")
3161018
"^DD",52.49,52.4911,7.2,0)
ADMIN TIMING CODE^F^^7;2^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,7.2,3)
Enter the administration timing code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,7.2,21,0)
^^1^1^3170626^
"^DD",52.49,52.4911,7.2,21,1,0)
This is the administration timing code for the incoming eRx prescription.
"^DD",52.49,52.4911,7.2,"DT")
3161018
"^DD",52.49,52.4911,7.3,0)
ADMIN TIMING CODE QUALIFIER^S^1:SNOMED;2:FMT;^7;3^Q
"^DD",52.49,52.4911,7.3,3)
Enter the administration timing code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,7.3,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,7.3,21,1,0)
This is the administration timing code qualifier for the incoming eRx 
"^DD",52.49,52.4911,7.3,21,2,0)
prescription.
"^DD",52.49,52.4911,7.3,"DT")
3170213
"^DD",52.49,52.4911,7.4,0)
MULTIPLE ADMIN TIMING MODIFIER^S^A:AND;O:OR;^7;4^Q
"^DD",52.49,52.4911,7.4,3)
Enter the multiple administration timing modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,7.4,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,7.4,21,1,0)
This is the multiple administration timing modifier for the incoming eRx 
"^DD",52.49,52.4911,7.4,21,2,0)
prescription.
"^DD",52.49,52.4911,7.4,"DT")
3161018
"^DD",52.49,52.4911,7.5,0)
RATE OF ADMINISTRATION^F^^7;5^K:$L(X)>11!($L(X)<1) X
"^DD",52.49,52.4911,7.5,3)
Enter the rate of administration for this incoming eRx prescription. Answer must be 1-11 characters in length.
"^DD",52.49,52.4911,7.5,21,0)
^.001^1^1^3170626^^
"^DD",52.49,52.4911,7.5,21,1,0)
The rate of administration for the incoming eRx prescription.
"^DD",52.49,52.4911,7.5,"DT")
3161018
"^DD",52.49,52.4911,7.6,0)
RATE UNIT MEASURE TEXT^F^^7;6^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,7.6,3)
Enter the rate unit of measure text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,7.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,7.6,21,1,0)
This is the rate unit of measure text for the incoming eRx prescription.
"^DD",52.49,52.4911,7.6,"DT")
3161018
"^DD",52.49,52.4911,7.7,0)
RATE UNIT MEASURE CODE^F^^7;7^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,7.7,3)
Enter the rate unit of measure code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,7.7,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,7.7,21,1,0)
This is the rate unit of measure code for the incoming eRx prescription.
"^DD",52.49,52.4911,7.7,"DT")
3161018
"^DD",52.49,52.4911,7.8,0)
RATE UNIT OF MEASURE CODE QUAL^S^1:SNOMED;2:FMT;^7;8^Q
"^DD",52.49,52.4911,7.8,3)
Enter the rate unit of measure code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,7.8,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,7.8,21,1,0)
This is the rate unit of measure code qualifier for the incoming eRx 
"^DD",52.49,52.4911,7.8,21,2,0)
prescription.
"^DD",52.49,52.4911,7.8,"DT")
3170213
"^DD",52.49,52.4911,8.1,0)
TP BASIS TEXT^F^^8;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,8.1,3)
Enter the time period basis text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,8.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.1,21,1,0)
This is the time period basis text for the incoming eRx prescription.
"^DD",52.49,52.4911,8.1,"DT")
3161018
"^DD",52.49,52.4911,8.2,0)
TP BASIS CODE^F^^8;2^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,8.2,3)
Enter the time period basis code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,8.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.2,21,1,0)
This is the time period basis code for the incoming eRx prescription.
"^DD",52.49,52.4911,8.2,"DT")
3161018
"^DD",52.49,52.4911,8.3,0)
TB BASIS CODE QUALIFIER^S^1:SNOMED;2:FMT;^8;3^Q
"^DD",52.49,52.4911,8.3,3)
Enter the time period basis code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,8.3,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,8.3,21,1,0)
This is the time period basis code qualifier for the incoming eRx 
"^DD",52.49,52.4911,8.3,21,2,0)
prescription.
"^DD",52.49,52.4911,8.3,"DT")
3170213
"^DD",52.49,52.4911,8.4,0)
FREQ NUMERIC VALUE^F^^8;4^K:$L(X)>11!($L(X)<1) X
"^DD",52.49,52.4911,8.4,3)
Enter the frequency numeric value for the incoming eRx prescription. Answer must be 1-11 characters in length.
"^DD",52.49,52.4911,8.4,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.4,21,1,0)
The frequency numeric value for the incoming eRx prescription.
"^DD",52.49,52.4911,8.4,"DT")
3161018
"^DD",52.49,52.4911,8.5,0)
FREQ UNITS TEXT^F^^8;5^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,8.5,3)
Enter the frequency units text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,8.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.5,21,1,0)
The frequency units text for the incoming eRx prescription.
"^DD",52.49,52.4911,8.5,"DT")
3161018
"^DD",52.49,52.4911,8.6,0)
FREQ UNITS CODE^F^^8;6^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,8.6,3)
Enter the frequency units code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,8.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.6,21,1,0)
The frequency units code for the incoming eRx prescription.
"^DD",52.49,52.4911,8.6,"DT")
3161018
"^DD",52.49,52.4911,8.7,0)
FREQ UNITS CODE QUALIFIER^S^1:SNOMED;2:FMT;^8;7^Q
"^DD",52.49,52.4911,8.7,3)
Enter the frequency units code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,8.7,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,8.7,21,1,0)
The frequency units code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,8.7,"DT")
3170213
"^DD",52.49,52.4911,8.8,0)
VARIABLE FREQ MODIFIER^S^A:AND;O:OR;T:TO;^8;8^Q
"^DD",52.49,52.4911,8.8,3)
Enter the variable frequency modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,8.8,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,8.8,21,1,0)
The variable frequency modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,8.8,"DT")
3161018
"^DD",52.49,52.4911,9.1,0)
INTERVAL NUMERIC VALUE^F^^9;1^K:$L(X)>18!($L(X)<1) X
"^DD",52.49,52.4911,9.1,3)
Enter the interval numeric value for this incoming eRx prescription. Answer must be 1-18 characters in length.
"^DD",52.49,52.4911,9.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.1,21,1,0)
The interval numeric value for the incoming eRx prescription.
"^DD",52.49,52.4911,9.1,"DT")
3161018
"^DD",52.49,52.4911,9.2,0)
INTERVAL UNITS TEXT^F^^9;2^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,9.2,3)
Enter the interval units text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,9.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.2,21,1,0)
The interval units text for the incoming eRx prescription.
"^DD",52.49,52.4911,9.2,"DT")
3161018
"^DD",52.49,52.4911,9.3,0)
INTERVAL UNITS CODE^F^^9;3^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,9.3,3)
Enter the interval units code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,9.3,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.3,21,1,0)
The interval units code for the incoming eRx prescription.
"^DD",52.49,52.4911,9.3,"DT")
3161018
"^DD",52.49,52.4911,9.4,0)
INTERVAL UNITS CODE QUAL^S^1:SNOMED;2:FMT;^9;4^Q
"^DD",52.49,52.4911,9.4,3)
Enter the interval units code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.4,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,9.4,21,1,0)
The interval units code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.4,"DT")
3170213
"^DD",52.49,52.4911,9.5,0)
VARIABLE INTERVAL MODIFIER^S^A:AND;O:OR;T:TO;^9;5^Q
"^DD",52.49,52.4911,9.5,3)
Enter the variable interval modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.5,21,1,0)
The variable interval modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.5,"DT")
3161018
"^DD",52.49,52.4911,9.6,0)
DUR NUMERIC VALUE^F^^9;6^K:$L(X)>11!($L(X)<1) X
"^DD",52.49,52.4911,9.6,3)
Enter the duration numeric value for the incoming eRx prescription. Answer must be 1-11 characters in length.
"^DD",52.49,52.4911,9.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.6,21,1,0)
The duration numeric value for the incoming eRx prescription.
"^DD",52.49,52.4911,9.6,"DT")
3161018
"^DD",52.49,52.4911,9.7,0)
DUR TEXT^F^^9;7^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,9.7,3)
Enter the duration text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,9.7,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.7,21,1,0)
The duration text for the incoming eRx prescription.
"^DD",52.49,52.4911,9.7,"DT")
3161018
"^DD",52.49,52.4911,9.8,0)
DUR TEXT CODE^F^^9;8^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,9.8,3)
Enter the duration text code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,9.8,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,9.8,21,1,0)
The duration text code for the incoming eRx prescription.
"^DD",52.49,52.4911,9.8,"DT")
3161018
"^DD",52.49,52.4911,9.9,0)
DUR TEXT CODE QUALIFIER^S^1:SNOMED;2:FMT;^9;9^Q
"^DD",52.49,52.4911,9.9,3)
Enter the duration text code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.9,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,9.9,21,1,0)
The duration text code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,9.9,"DT")
3170213
"^DD",52.49,52.4911,10.1,0)
MDR NUMERIC VALUE^NJ10,0^^10;1^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,10.1,3)
Enter the maximum dose restriction numeric value. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,10.1,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,10.1,21,1,0)
The maximum dose restriction numeric value for the incoming eRx 
"^DD",52.49,52.4911,10.1,21,2,0)
prescription.
"^DD",52.49,52.4911,10.1,"DT")
3161018
"^DD",52.49,52.4911,10.2,0)
MDR UNITS TEXT^F^^10;2^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,10.2,3)
Enter the maximum dose restriction units text. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,10.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,10.2,21,1,0)
The maximum dose restriction units text for the incoming eRx prescription.
"^DD",52.49,52.4911,10.2,"DT")
3161018
"^DD",52.49,52.4911,10.3,0)
MDR CODE QUALIFIER^S^1:SNOMED;2:FMT;^10;3^Q
"^DD",52.49,52.4911,10.3,3)
Enter the maximum dose restriction code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,10.3,21,0)
^.001^2^2^3170217^^^^
"^DD",52.49,52.4911,10.3,21,1,0)
The maximum dose restriction code qualifier for the incoming eRx 
"^DD",52.49,52.4911,10.3,21,2,0)
prescription.
"^DD",52.49,52.4911,10.3,"DT")
3170213
"^DD",52.49,52.4911,10.4,0)
MDR UNITS CODE^F^^10;4^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,10.4,3)
Enter the maximum dose restriction units code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,10.4,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,10.4,21,1,0)
The maximum dose restriction units code for the incoming eRx prescription.
"^DD",52.49,52.4911,10.4,"DT")
3161018
"^DD",52.49,52.4911,10.5,0)
MDR VAR NUMERIC VALUE^NJ10,0^^10;5^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,10.5,3)
Enter the maximum dose restriction variable numeric value for the incoming eRx prescription. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,10.5,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,10.5,21,1,0)
The maximum dose restriction variable numeric value for the incoming eRx 
"^DD",52.49,52.4911,10.5,21,2,0)
prescription.
"^DD",52.49,52.4911,10.5,"DT")
3161018
"^DD",52.49,52.4911,10.6,0)
MDR VAR UNITS TEXT^F^^10;6^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,10.6,3)
Enter the maximum dose restriction variable units text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,10.6,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,10.6,21,1,0)
The maximum dose restriction variable units text for the incoming eRx 
"^DD",52.49,52.4911,10.6,21,2,0)
prescription.
"^DD",52.49,52.4911,10.6,"DT")
3161018
"^DD",52.49,52.4911,10.7,0)
MDR VARIABLE UNITS CODE^F^^10;7^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,10.7,3)
Enter the maximum dose restriction variable units code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,10.7,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,10.7,21,1,0)
The maximum dose restriction variable units code for the incoming eRx 
"^DD",52.49,52.4911,10.7,21,2,0)
prescription.
"^DD",52.49,52.4911,10.7,"DT")
3161018
"^DD",52.49,52.4911,10.8,0)
MDR VAR UNITS CODE QUALIFIER^S^1:SNOMED;2:FMT;^10;8^Q
"^DD",52.49,52.4911,10.8,3)
Enter the maximum dose restriction variable units code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,10.8,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,10.8,21,1,0)
The maximum dose restriction variable units code qualifier for the 
"^DD",52.49,52.4911,10.8,21,2,0)
incoming eRx prescription.
"^DD",52.49,52.4911,10.8,"DT")
3170213
"^DD",52.49,52.4911,10.9,0)
MDR VAR DURATION MODIFIER^S^A:AND;O:OR;^10;9^Q
"^DD",52.49,52.4911,10.9,3)
Enter the maximum dose restriction variable duration modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,10.9,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,10.9,21,1,0)
The maximum dose restriction variable duration modifier for the incoming 
"^DD",52.49,52.4911,10.9,21,2,0)
eRx prescription.
"^DD",52.49,52.4911,10.9,"DT")
3161018
"^DD",52.49,52.4911,11.1,0)
IP TEXT^F^^11;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,11.1,3)
Enter the indication precursor text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,11.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,11.1,21,1,0)
The indication precursor text for the incoming eRx prescription.
"^DD",52.49,52.4911,11.1,"DT")
3161018
"^DD",52.49,52.4911,11.2,0)
IP CODE^F^^11;2^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,11.2,3)
Enter the indication precursor code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,11.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,11.2,21,1,0)
The indication precursor code for the incoming eRx prescription.
"^DD",52.49,52.4911,11.2,"DT")
3161018
"^DD",52.49,52.4911,11.3,0)
IP CODE QUALIFIER^S^1:SNOMED;2:FMT;^11;3^Q
"^DD",52.49,52.4911,11.3,3)
Enter the indication precursor code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,11.3,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,11.3,21,1,0)
The indication precursor code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,11.3,"DT")
3170213
"^DD",52.49,52.4911,11.4,0)
INDICATION TEXT^F^^11;4^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,11.4,3)
Enter the indication text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,11.4,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,11.4,21,1,0)
The indication text for the incoming eRx prescription.
"^DD",52.49,52.4911,11.4,"DT")
3161018
"^DD",52.49,52.4911,11.5,0)
INDICATION TEXT CODE^F^^11;5^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,11.5,3)
Enter the indication text code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,11.5,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,11.5,21,1,0)
The indication text code for the incoming eRx prescription.
"^DD",52.49,52.4911,11.5,"DT")
3161018
"^DD",52.49,52.4911,11.6,0)
INDICATION TEXT CODE QUALIFIER^S^1:SNOMED;2:FMT;^11;6^Q
"^DD",52.49,52.4911,11.6,3)
Enter the indication text code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,11.6,21,0)
^.001^1^1^3170213^^
"^DD",52.49,52.4911,11.6,21,1,0)
The indication text code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,11.6,"DT")
3170213
"^DD",52.49,52.4911,12.1,0)
INDICATION VALUE TEXT^F^^12;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,12.1,3)
Enter the indication value text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,12.1,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,12.1,21,1,0)
The indication value text for the incoming eRx prescription.
"^DD",52.49,52.4911,12.1,"DT")
3161018
"^DD",52.49,52.4911,12.2,0)
INDICATION VALUE UNIT^NJ10,0^^12;2^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4911,12.2,3)
Enter the indication value unit for the incoming eRx prescription. Type a number between 0 and 9999999999, 0 decimal digits.
"^DD",52.49,52.4911,12.2,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,12.2,21,1,0)
The indication value unit for the incoming eRx prescription.
"^DD",52.49,52.4911,12.2,"DT")
3161018
"^DD",52.49,52.4911,12.3,0)
IV UNIT OF MEASURE TEXT^F^^12;3^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.4911,12.3,3)
Enter the indication value unit of measure text for the incoming eRx prescription. Answer must be 1-50 characters in length.
"^DD",52.49,52.4911,12.3,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,12.3,21,1,0)
The indication value unit of measure text for the incoming eRx 
"^DD",52.49,52.4911,12.3,21,2,0)
prescription.
"^DD",52.49,52.4911,12.3,"DT")
3161018
"^DD",52.49,52.4911,12.4,0)
IV UNIT OF MEAURE CODE^F^^12;4^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4911,12.4,3)
Enter the indication value unit of measure code for the incoming eRx prescription. Answer must be 1-15 characters in length.
"^DD",52.49,52.4911,12.4,21,0)
^^2^2^3161018^
"^DD",52.49,52.4911,12.4,21,1,0)
The indication value unit of measure code for the incoming eRx 
"^DD",52.49,52.4911,12.4,21,2,0)
prescription.
"^DD",52.49,52.4911,12.4,"DT")
3161018
"^DD",52.49,52.4911,12.5,0)
IV UNIT OF MEASURE CODE QUAL^S^1:SNOMED;2:FMT;^12;5^Q
"^DD",52.49,52.4911,12.5,3)
Enter the indication value unit of measure code qualifier for the incoming eRx prescription.
"^DD",52.49,52.4911,12.5,21,0)
^.001^2^2^3170213^^
"^DD",52.49,52.4911,12.5,21,1,0)
The indication value unit of measure code qualifier for the incoming eRx 
"^DD",52.49,52.4911,12.5,21,2,0)
prescription.
"^DD",52.49,52.4911,12.5,"DT")
3170213
"^DD",52.49,52.4911,12.6,0)
INDICATION VARIABLE MODIFIER^S^A:AND;O:OR;T:TO;^12;6^Q
"^DD",52.49,52.4911,12.6,3)
Enter the indication variable modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,12.6,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,12.6,21,1,0)
The indication variable modifier for the incoming eRx prescription.
"^DD",52.49,52.4911,12.6,"DT")
3161018
"^DD",52.49,52.4911,12.7,0)
STOP INDICATOR^S^Y:YES;N:NO;^12;7^Q
"^DD",52.49,52.4911,12.7,3)
Enter the stop indicator for the incoming eRx prescription.
"^DD",52.49,52.4911,12.7,21,0)
^^1^1^3161018^
"^DD",52.49,52.4911,12.7,21,1,0)
The stop indicator for the incoming eRx prescription.
"^DD",52.49,52.4911,12.7,"DT")
3161018
"^DD",52.49,52.4912,0)
ORDER CHECKS SUB-FIELD^^2^3
"^DD",52.49,52.4912,0,"DT")
3160907
"^DD",52.49,52.4912,0,"IX","B",52.4912,.01)

"^DD",52.49,52.4912,0,"NM","ORDER CHECKS")

"^DD",52.49,52.4912,0,"UP")
52.49
"^DD",52.49,52.4912,.01,0)
ORDER CHECK NARRATIVE^F^^0;1^K:$L(X)>245!($L(X)<1) X
"^DD",52.49,52.4912,.01,1,0)
^.1
"^DD",52.49,52.4912,.01,1,1,0)
52.4912^B
"^DD",52.49,52.4912,.01,1,1,1)
S ^PS(52.49,DA(1),12,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4912,.01,1,1,2)
K ^PS(52.49,DA(1),12,"B",$E(X,1,30),DA)
"^DD",52.49,52.4912,.01,3)
Enter the order check narrative. Answer must be 1-245 characters in length.
"^DD",52.49,52.4912,.01,21,0)
^.001^1^1^3160907^^
"^DD",52.49,52.4912,.01,21,1,0)
This is the text which describes the order check.
"^DD",52.49,52.4912,.01,"DT")
3160907
"^DD",52.49,52.4912,1,0)
OVERRIDING PROVIDER^F^^1;1^K:$L(X)>45!($L(X)<1) X
"^DD",52.49,52.4912,1,3)
Enter the overriding provider. Answer must be 1-45 characters in length.
"^DD",52.49,52.4912,1,21,0)
^^1^1^3160907^
"^DD",52.49,52.4912,1,21,1,0)
This is the provider that has seen the order check.
"^DD",52.49,52.4912,1,"DT")
3160907
"^DD",52.49,52.4912,2,0)
OVERRIDING REASON^52.49122^^2;0
"^DD",52.49,52.4912,2,21,0)
^^2^2^3170711^
"^DD",52.49,52.4912,2,21,1,0)
This is the over-riding reason of the order check for this eRx 
"^DD",52.49,52.4912,2,21,2,0)
prescription.
"^DD",52.49,52.49122,0)
OVERRIDING REASON SUB-FIELD^^.01^1
"^DD",52.49,52.49122,0,"DT")
3160907
"^DD",52.49,52.49122,0,"NM","OVERRIDING REASON")

"^DD",52.49,52.49122,0,"UP")
52.4912
"^DD",52.49,52.49122,.01,0)
OVERRIDING REASON^Wx^^0;1^Q
"^DD",52.49,52.49122,.01,3)
Enter the overriding reason. Word processing.
"^DD",52.49,52.49122,.01,21,0)
^.001^1^1^3170711^^
"^DD",52.49,52.49122,.01,21,1,0)
This is the reason given by the provider to override the order check.
"^DD",52.49,52.49122,.01,"DT")
3160907
"^DD",52.49,52.4914,0)
OBSERVATION SUB-FIELD^^.07^7
"^DD",52.49,52.4914,0,"DT")
3161019
"^DD",52.49,52.4914,0,"IX","B",52.4914,.01)

"^DD",52.49,52.4914,0,"NM","OBSERVATION")

"^DD",52.49,52.4914,0,"UP")
52.49
"^DD",52.49,52.4914,.01,0)
SEQUENCE^NJ2,0^^0;1^K:+X'=X!(X>10)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4914,.01,1,0)
^.1
"^DD",52.49,52.4914,.01,1,1,0)
52.4914^B
"^DD",52.49,52.4914,.01,1,1,1)
S ^PS(52.49,DA(1),14,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4914,.01,1,1,2)
K ^PS(52.49,DA(1),14,"B",$E(X,1,30),DA)
"^DD",52.49,52.4914,.01,3)
Enter the sequence number for the observation measurement. Type a number between 1 and 10, 0 decimal digits.
"^DD",52.49,52.4914,.01,21,0)
^.001^2^2^3161019^^
"^DD",52.49,52.4914,.01,21,1,0)
This is the sequence number associated with the observation measurement 
"^DD",52.49,52.4914,.01,21,2,0)
of the incoming eRx prescription.
"^DD",52.49,52.4914,.01,"DT")
3161019
"^DD",52.49,52.4914,.02,0)
DIMENSION^F^^0;2^K:$L(X)>4!($L(X)<2) X
"^DD",52.49,52.4914,.02,3)
Enter the dimension for this observation. Answer must be 2-4 characters in length.
"^DD",52.49,52.4914,.02,21,0)
^^2^2^3161019^
"^DD",52.49,52.4914,.02,21,1,0)
This is the dimension associated with an observation for the eRx 
"^DD",52.49,52.4914,.02,21,2,0)
prescription.
"^DD",52.49,52.4914,.02,"DT")
3161019
"^DD",52.49,52.4914,.03,0)
VALUE^NJ10,0^^0;3^K:+X'=X!(X>9999999999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4914,.03,3)
Enter the value associated with the current observation. Type a number between 0 and 999999999, 0 decimal digits.
"^DD",52.49,52.4914,.03,21,0)
^^1^1^3161019^
"^DD",52.49,52.4914,.03,21,1,0)
The value for the current observation of the eRx prescription.
"^DD",52.49,52.4914,.03,"DT")
3161019
"^DD",52.49,52.4914,.04,0)
OBSERVATION DATE^D^^0;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.4914,.04,3)
Enter the date/time for the observation.
"^DD",52.49,52.4914,.04,21,0)
^^1^1^3161019^
"^DD",52.49,52.4914,.04,21,1,0)
The date time the observation was made for the current observation.
"^DD",52.49,52.4914,.04,"DT")
3161019
"^DD",52.49,52.4914,.05,0)
MEASURMENT DATA QUALIFIER^NJ1,0^^0;5^K:+X'=X!(X>4)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4914,.05,3)
Enter the measurement data qualifier for the current observation. Type a number between 1 and 4, 0 decimal digits.
"^DD",52.49,52.4914,.05,21,0)
^^2^2^3161019^
"^DD",52.49,52.4914,.05,21,1,0)
This is the measurement data qualifier for the observation of the eRx 
"^DD",52.49,52.4914,.05,21,2,0)
prescription.
"^DD",52.49,52.4914,.05,"DT")
3161019
"^DD",52.49,52.4914,.06,0)
MEASUREMENT SOURCE CODE^F^^0;6^K:$L(X)>2!($L(X)<2) X
"^DD",52.49,52.4914,.06,3)
Enter the measurement source code associated with the eRx observation. Answer must be 2 characters in length.
"^DD",52.49,52.4914,.06,21,0)
^^2^2^3161019^
"^DD",52.49,52.4914,.06,21,1,0)
The measurement source code for the current observation of the eRx 
"^DD",52.49,52.4914,.06,21,2,0)
prescription.
"^DD",52.49,52.4914,.06,"DT")
3161019
"^DD",52.49,52.4914,.07,0)
MEASUREMENT UNIT CODE^F^^0;7^K:$L(X)>15!($L(X)<1) X
"^DD",52.49,52.4914,.07,3)
Enter the measurement unit code for the current observation. Answer must be 1-15 characters in length.
"^DD",52.49,52.4914,.07,21,0)
^^2^2^3161019^
"^DD",52.49,52.4914,.07,21,1,0)
This is the measurement unit code associated with the current observation 
"^DD",52.49,52.4914,.07,21,2,0)
of the eRx prescription.
"^DD",52.49,52.4914,.07,"DT")
3161019
"^DD",52.49,52.4916,0)
DRUG USE EVALUATION SUB-FIELD^^.06^7
"^DD",52.49,52.4916,0,"DT")
3170211
"^DD",52.49,52.4916,0,"IX","B",52.4916,.01)

"^DD",52.49,52.4916,0,"NM","DRUG USE EVALUATION")

"^DD",52.49,52.4916,0,"UP")
52.49
"^DD",52.49,52.4916,.01,0)
SERVICE REASON CODE^P52.45'^PS(52.45,^0;1^Q
"^DD",52.49,52.4916,.01,1,0)
^.1
"^DD",52.49,52.4916,.01,1,1,0)
52.4916^B
"^DD",52.49,52.4916,.01,1,1,1)
S ^PS(52.49,DA(1),16,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4916,.01,1,1,2)
K ^PS(52.49,DA(1),16,"B",$E(X,1,30),DA)
"^DD",52.49,52.4916,.01,3)
Enter the Drug Use Evaluation Service Reason Code.
"^DD",52.49,52.4916,.01,21,0)
^^1^1^3170211^
"^DD",52.49,52.4916,.01,21,1,0)
The service reason code associated with this drug use evaluation entry.
"^DD",52.49,52.4916,.01,"DT")
3170211
"^DD",52.49,52.4916,.02,0)
PROFESSIONAL SERVICE CODE^P52.45'^PS(52.45,^0;2^Q
"^DD",52.49,52.4916,.02,3)
Enter the professional service code.
"^DD",52.49,52.4916,.02,21,0)
^^2^2^3170211^
"^DD",52.49,52.4916,.02,21,1,0)
This is the professional service code associated with this drug use 
"^DD",52.49,52.4916,.02,21,2,0)
evaluation entry.
"^DD",52.49,52.4916,.02,"DT")
3170211
"^DD",52.49,52.4916,.03,0)
SERVICE RESULT CODE^P52.45'^PS(52.45,^0;3^Q
"^DD",52.49,52.4916,.03,3)
Enter the service result code.
"^DD",52.49,52.4916,.03,21,0)
^^1^1^3170211^
"^DD",52.49,52.4916,.03,21,1,0)
The service result code associated with this drug use evaluation entry.
"^DD",52.49,52.4916,.03,"DT")
3170211
"^DD",52.49,52.4916,.04,0)
COAGENT ID^F^^0;4^K:$L(X)>19!($L(X)<1) X
"^DD",52.49,52.4916,.04,3)
Enter the Co-agent ID for this drug use evaluation. Answer must be 1-19 characters in length.
"^DD",52.49,52.4916,.04,21,0)
^^1^1^3170211^
"^DD",52.49,52.4916,.04,21,1,0)
This is the co-agent ID for the drug use evaluation entry.
"^DD",52.49,52.4916,.04,"DT")
3170211
"^DD",52.49,52.4916,.05,0)
COAGENT QUALIFIER^P52.45'^PS(52.45,^0;5^Q
"^DD",52.49,52.4916,.05,3)
Enter the Co-agent qualifier associated with the co-agent ID.
"^DD",52.49,52.4916,.05,21,0)
^^1^1^3170211^
"^DD",52.49,52.4916,.05,21,1,0)
This is the co-agent qualifier for the co-agent ID.
"^DD",52.49,52.4916,.05,"DT")
3170211
"^DD",52.49,52.4916,.06,0)
CLINICAL SIGNIFICANCE CODE^S^1:MAJOR;2:MODERATE;3:MINOR;9:TBD**;^0;6^Q
"^DD",52.49,52.4916,.06,3)
Enter the clinical significance code for this drug use evaluation entry.
"^DD",52.49,52.4916,.06,21,0)
^^2^2^3170211^
"^DD",52.49,52.4916,.06,21,1,0)
This is the clinical significance code associated with the drug use 
"^DD",52.49,52.4916,.06,21,2,0)
evaluation entry.
"^DD",52.49,52.4916,.06,"DT")
3170211
"^DD",52.49,52.4916,1,0)
ACKNOWLEDGEMENT REASON^F^^1;1^K:$L(X)>100!($L(X)<1) X
"^DD",52.49,52.4916,1,3)
Enter the Acknowledgement reason for this drug use evaluation. Answer must be 1-100 characters in length.
"^DD",52.49,52.4916,1,21,0)
^^1^1^3170211^
"^DD",52.49,52.4916,1,21,1,0)
The acknowledgement reason for this drug use evaluation.
"^DD",52.49,52.4916,1,"DT")
3170211
"^DD",52.49,52.4918,0)
PAYER INFORMATION SUB-FIELD^^7^11
"^DD",52.49,52.4918,0,"DT")
3170901
"^DD",52.49,52.4918,0,"IX","B",52.4918,.01)

"^DD",52.49,52.4918,0,"NM","PAYER INFORMATION")

"^DD",52.49,52.4918,0,"UP")
52.49
"^DD",52.49,52.4918,.01,0)
SEQUENCE^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.4918,.01,1,0)
^.1
"^DD",52.49,52.4918,.01,1,1,0)
52.4918^B
"^DD",52.49,52.4918,.01,1,1,1)
S ^PS(52.49,DA(1),18,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4918,.01,1,1,2)
K ^PS(52.49,DA(1),18,"B",$E(X,1,30),DA)
"^DD",52.49,52.4918,.01,1,1,"DT")
3170901
"^DD",52.49,52.4918,.01,3)
Enter the sequence/entry number for this erx payer record. Type a number between 0 and 999, 0 decimal digits.
"^DD",52.49,52.4918,.01,21,0)
^.001^1^1^3170901^^
"^DD",52.49,52.4918,.01,21,1,0)
This is the sequence number for this payer/benefits coordination entry.
"^DD",52.49,52.4918,.01,"DT")
3170901
"^DD",52.49,52.4918,.02,0)
GROUP ID^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,.02,3)
Enter the group ID. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,.02,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,.02,21,1,0)
The Group ID for the payer/cardholder.
"^DD",52.49,52.4918,.02,"DT")
3160907
"^DD",52.49,52.4918,.03,0)
PAYER NAME^F^^0;3^K:$L(X)>135!($L(X)<1) X
"^DD",52.49,52.4918,.03,3)
Enter the payer/cardholder name. Answer must be 1-135 characters in length.
"^DD",52.49,52.4918,.03,21,0)
^.001^1^1^3160907^^
"^DD",52.49,52.4918,.03,21,1,0)
Payer/Cardholder full name.
"^DD",52.49,52.4918,.03,"DT")
3160907
"^DD",52.49,52.4918,.04,0)
PAYER IDENTIFICATION NUMBER^F^^0;4^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,.04,3)
Enter the payer identification value. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,.04,21,0)
^^1^1^3161107^
"^DD",52.49,52.4918,.04,21,1,0)
This is the payer identification value/ payer ID.
"^DD",52.49,52.4918,.04,"DT")
3161107
"^DD",52.49,52.4918,1,0)
LAST NAME^F^^1;1^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,1,3)
Enter the last name of the payer/cardholder. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,1,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,1,21,1,0)
Payer last name.
"^DD",52.49,52.4918,1,"DT")
3160907
"^DD",52.49,52.4918,2,0)
FIRST NAME^F^^1;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,2,3)
Enter the first name of the payer/cardholder. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,2,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,2,21,1,0)
Payer first name.
"^DD",52.49,52.4918,2,"DT")
3160907
"^DD",52.49,52.4918,3,0)
PAYER MIDDLE NAME^F^^1;3^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,3,3)
Enter the middle name of the payer. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,3,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,3,21,1,0)
Payer middle name.
"^DD",52.49,52.4918,3,"DT")
3160907
"^DD",52.49,52.4918,4,0)
PAYER SUFFIX^F^^1;4^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.4918,4,3)
Enter the suffix of the payer/cardholder. Answer must be 1-10 characters in length.
"^DD",52.49,52.4918,4,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,4,21,1,0)
Payer suffix.
"^DD",52.49,52.4918,4,"DT")
3160907
"^DD",52.49,52.4918,5,0)
PAYER PREFIX^F^^1;5^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.4918,5,3)
Enter the prefix of the payer/cardholder. Answer must be 1-10 characters in length.
"^DD",52.49,52.4918,5,21,0)
^^1^1^3160907^
"^DD",52.49,52.4918,5,21,1,0)
Payer prefix.
"^DD",52.49,52.4918,5,"DT")
3160907
"^DD",52.49,52.4918,6,0)
IDENTIFICATION^52.49186A^^6;0
"^DD",52.49,52.4918,6,21,0)
^^2^2^3170711^
"^DD",52.49,52.4918,6,21,1,0)
This sub-file holds the payer identification information associated with 
"^DD",52.49,52.4918,6,21,2,0)
an eRx prescription.
"^DD",52.49,52.4918,7,0)
CARDHOLDER ID^F^^2;1^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.4918,7,3)
Enter the card holder ID. Answer must be 1-35 characters in length.
"^DD",52.49,52.4918,7,21,0)
^^1^1^3170901^
"^DD",52.49,52.4918,7,21,1,0)
The card holder/payer identification number.
"^DD",52.49,52.4918,7,"DT")
3170901
"^DD",52.49,52.49186,0)
IDENTIFICATION SUB-FIELD^^.02^2
"^DD",52.49,52.49186,0,"DT")
3170307
"^DD",52.49,52.49186,0,"IX","B",52.49186,.01)

"^DD",52.49,52.49186,0,"NM","IDENTIFICATION")

"^DD",52.49,52.49186,0,"UP")
52.4918
"^DD",52.49,52.49186,.01,0)
ID TYPE^F^^0;1^K:$L(X)>50!($L(X)<1) X
"^DD",52.49,52.49186,.01,1,0)
^.1
"^DD",52.49,52.49186,.01,1,1,0)
52.49186^B
"^DD",52.49,52.49186,.01,1,1,1)
S ^PS(52.49,DA(2),18,DA(1),6,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.49186,.01,1,1,2)
K ^PS(52.49,DA(2),18,DA(1),6,"B",$E(X,1,30),DA)
"^DD",52.49,52.49186,.01,3)
Enter the identification type. Answer must be 1-50 characters in length.
"^DD",52.49,52.49186,.01,21,0)
^^1^1^3170711^
"^DD",52.49,52.49186,.01,21,1,0)
This is the identification type for the payer.
"^DD",52.49,52.49186,.01,"DT")
3170307
"^DD",52.49,52.49186,.02,0)
ID VALUE^F^^0;2^K:$L(X)>35!($L(X)<1) X
"^DD",52.49,52.49186,.02,3)
Enter the identification value. Answer must be 1-35 characters in length.
"^DD",52.49,52.49186,.02,21,0)
^^1^1^3170307^
"^DD",52.49,52.49186,.02,21,1,0)
The value associated with the identification type.
"^DD",52.49,52.49186,.02,"DT")
3170307
"^DD",52.49,52.4919,0)
STATUS HISTORY SUB-FIELD^^1^4
"^DD",52.49,52.4919,0,"DT")
3170219
"^DD",52.49,52.4919,0,"IX","B",52.4919,.01)

"^DD",52.49,52.4919,0,"NM","STATUS HISTORY")

"^DD",52.49,52.4919,0,"UP")
52.49
"^DD",52.49,52.4919,.01,0)
STATUS DATE/TIME^D^^0;1^S %DT="ESTX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.4919,.01,1,0)
^.1
"^DD",52.49,52.4919,.01,1,1,0)
52.4919^B
"^DD",52.49,52.4919,.01,1,1,1)
S ^PS(52.49,DA(1),19,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4919,.01,1,1,2)
K ^PS(52.49,DA(1),19,"B",$E(X,1,30),DA)
"^DD",52.49,52.4919,.01,3)
Enter the date/time of the status change.
"^DD",52.49,52.4919,.01,21,0)
^.001^1^1^3170711^^
"^DD",52.49,52.4919,.01,21,1,0)
The date of the status change that occurred on this eRx.
"^DD",52.49,52.4919,.01,"DT")
3170219
"^DD",52.49,52.4919,.02,0)
STATUS^P52.45'^PS(52.45,^0;2^Q
"^DD",52.49,52.4919,.02,3)
Enter the eRx status.
"^DD",52.49,52.4919,.02,21,0)
^^1^1^3170219^
"^DD",52.49,52.4919,.02,21,1,0)
This is the eRx status that was identified by the user.
"^DD",52.49,52.4919,.02,"DT")
3170219
"^DD",52.49,52.4919,.03,0)
ENTERED BY^P200'^VA(200,^0;3^Q
"^DD",52.49,52.4919,.03,3)
Select the user who entered this status for the eRx.
"^DD",52.49,52.4919,.03,21,0)
^^1^1^3170219^
"^DD",52.49,52.4919,.03,21,1,0)
This is the person that set the status for this eRx.
"^DD",52.49,52.4919,.03,"DT")
3170219
"^DD",52.49,52.4919,1,0)
STATUS COMMENTS^F^^1;1^K:$L(X)>200!($L(X)<1) X
"^DD",52.49,52.4919,1,3)
Enter the comments associated with this eRx status change. Answer must be 1-200 characters in length.
"^DD",52.49,52.4919,1,21,0)
^^2^2^3170219^
"^DD",52.49,52.4919,1,21,1,0)
The comments associated with an eRx status change. This will generally 
"^DD",52.49,52.4919,1,21,2,0)
only be used for 'hold' type status values.
"^DD",52.49,52.4919,1,"DT")
3170219
"^DD",52.49,52.4921,0)
QUANTITY/TIMING SUB-FIELD^^13^13
"^DD",52.49,52.4921,0,"DT")
3170104
"^DD",52.49,52.4921,0,"IX","B",52.4921,.01)

"^DD",52.49,52.4921,0,"NM","QUANTITY/TIMING")

"^DD",52.49,52.4921,0,"UP")
52.49
"^DD",52.49,52.4921,.01,0)
QUANTITY/FORM^F^^0;1^K:$L(X)>200!($L(X)<1) X
"^DD",52.49,52.4921,.01,1,0)
^.1
"^DD",52.49,52.4921,.01,1,1,0)
52.4921^B
"^DD",52.49,52.4921,.01,1,1,1)
S ^PS(52.49,DA(1),21,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4921,.01,1,1,2)
K ^PS(52.49,DA(1),21,"B",$E(X,1,30),DA)
"^DD",52.49,52.4921,.01,3)
Enter the quantity/form for this incoming eRx. Answer must be 1-200 characters in length.
"^DD",52.49,52.4921,.01,21,0)
^^4^4^3170104^
"^DD",52.49,52.4921,.01,21,1,0)
This field usually contains the amount to be given as entered through 
"^DD",52.49,52.4921,.01,21,2,0)
CPRS. In this case, this will be the amount given as passed in through an 
"^DD",52.49,52.4921,.01,21,3,0)
incoming XML message generated from Change Healthcare. It can also 
"^DD",52.49,52.4921,.01,21,4,0)
possibly contain the Dose Form of the medication.
"^DD",52.49,52.4921,.01,"DT")
3170104
"^DD",52.49,52.4921,1,0)
SCHEDULE^F^^1;1^K:$L(X)>20!($L(X)<1) X
"^DD",52.49,52.4921,1,3)
Enter the schedule for the eRx prescription. Answer must be 1-20 characters in length.
"^DD",52.49,52.4921,1,21,0)
^^3^3^3170104^
"^DD",52.49,52.4921,1,21,1,0)
This is the schedule for the medication, as passed in via the Change 
"^DD",52.49,52.4921,1,21,2,0)
Healthcare XML. This is the equivalent of the schedule field in the 
"^DD",52.49,52.4921,1,21,3,0)
pending outpatient orders file.
"^DD",52.49,52.4921,1,"DT")
3170104
"^DD",52.49,52.4921,2,0)
DURATION^F^^1;2^K:$L(X)>40!($L(X)<1) X
"^DD",52.49,52.4921,2,3)
Enter the duration for the medication. Answer must be 1-40 characters in length.
"^DD",52.49,52.4921,2,21,0)
^^2^2^3170104^
"^DD",52.49,52.4921,2,21,1,0)
This is the duration that the medication is to be given for, as passed in 
"^DD",52.49,52.4921,2,21,2,0)
by Change Healthcare.
"^DD",52.49,52.4921,2,"DT")
3170104
"^DD",52.49,52.4921,3,0)
START DATE/TIME^D^^1;3^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.4921,3,3)
Enter the start date/time for the medication.
"^DD",52.49,52.4921,3,21,0)
^^1^1^3170104^
"^DD",52.49,52.4921,3,21,1,0)
This is the start date/time of the medication.
"^DD",52.49,52.4921,3,"DT")
3170104
"^DD",52.49,52.4921,4,0)
END DATE/TIME^D^^1;4^S %DT="ETX" D ^%DT S X=Y K:Y<1 X
"^DD",52.49,52.4921,4,3)
Enter the end date/time for the medication.
"^DD",52.49,52.4921,4,21,0)
^^1^1^3170104^
"^DD",52.49,52.4921,4,21,1,0)
This is the end date/time of the medication.
"^DD",52.49,52.4921,4,"DT")
3170104
"^DD",52.49,52.4921,6,0)
CONJUNCTION^S^S:THEN;A:AND;X:EXCEPT;^1;6^Q
"^DD",52.49,52.4921,6,3)
Enter the conjunction for this medication.
"^DD",52.49,52.4921,6,21,0)
^^4^4^3170104^
"^DD",52.49,52.4921,6,21,1,0)
This is a code used to help build a possible sig for a complex medication 
"^DD",52.49,52.4921,6,21,2,0)
dose. This code usually expands to an "and", a "then", or an "except". 
"^DD",52.49,52.4921,6,21,3,0)
This is the equivalent of the conjunction field in the pending outpatient 
"^DD",52.49,52.4921,6,21,4,0)
orders file, quantity/timing sub-file.
"^DD",52.49,52.4921,6,"DT")
3170104
"^DD",52.49,52.4921,7,0)
SEQUENCING^F^^1;7^K:$L(X)>30!($L(X)<1) X
"^DD",52.49,52.4921,7,3)
Enter the sequencing instructions for this medication. Answer must be 1-30 characters in length.
"^DD",52.49,52.4921,7,21,0)
^^2^2^3170104^
"^DD",52.49,52.4921,7,21,1,0)
This field contains any special sequencing instructions for the 
"^DD",52.49,52.4921,7,21,2,0)
medication.
"^DD",52.49,52.4921,7,"DT")
3170104
"^DD",52.49,52.4921,8,0)
DOSAGE ORDERED^F^^2;1^K:$L(X)>122!($L(X)<1) X
"^DD",52.49,52.4921,8,3)
Enter the amount of medication the patient will receive for this prescription order. Answer must be 1-122 characters in length.
"^DD",52.49,52.4921,8,21,0)
^^2^2^3170104^
"^DD",52.49,52.4921,8,21,1,0)
This is a single dose of the medication the patient will receive for this 
"^DD",52.49,52.4921,8,21,2,0)
prescription order.
"^DD",52.49,52.4921,8,"DT")
3170104
"^DD",52.49,52.4921,9,0)
DISPENSE UNITS PER DOSE^NJ11,2^^2;2^K:+X'=X!(X>99999999)!(X<0)!(X?.E1"."3N.N) X
"^DD",52.49,52.4921,9,3)
Enter the units per dose value for this dosing instruction. Type a number between 0 and 99999999, 2 decimal digits.
"^DD",52.49,52.4921,9,21,0)
^^2^2^3170104^
"^DD",52.49,52.4921,9,21,1,0)
This field represents the number of dispense units the patient will 
"^DD",52.49,52.4921,9,21,2,0)
receive for a single dose of the medication.
"^DD",52.49,52.4921,9,"DT")
3170104
"^DD",52.49,52.4921,10,0)
MED ROUTE^P51.2'^PS(51.2,^1;8^Q
"^DD",52.49,52.4921,10,3)
Enter the Med Route that the medication is to be administered by.
"^DD",52.49,52.4921,10,21,0)
^^1^1^3170104^
"^DD",52.49,52.4921,10,21,1,0)
This is the Med Route that the medication is to be administered by.
"^DD",52.49,52.4921,10,"DT")
3170104
"^DD",52.49,52.4921,11,0)
UNITS^P50.607'^PS(50.607,^1;9^Q
"^DD",52.49,52.4921,11,3)
Enter the unit associated with the Dosage ordered.
"^DD",52.49,52.4921,11,21,0)
^^2^2^3170104^
"^DD",52.49,52.4921,11,21,1,0)
This is the unit of measure associated with the Dosage ordered. It is a 
"^DD",52.49,52.4921,11,21,2,0)
pointer to the DRUG UNITS file (#50.607).
"^DD",52.49,52.4921,11,"DT")
3170104
"^DD",52.49,52.4921,12,0)
NOUN^F^^1;5^K:$L(X)>30!($L(X)<1) X
"^DD",52.49,52.4921,12,3)
Enter the noun that is associated with this dosing sequence. Answer must be 1-30 characters in length.
"^DD",52.49,52.4921,12,21,0)
^^3^3^3170104^
"^DD",52.49,52.4921,12,21,1,0)
This is the noun that is associated with this dosing sequence for this 
"^DD",52.49,52.4921,12,21,2,0)
pending order. It will be used to be the possible SIG for orders that are 
"^DD",52.49,52.4921,12,21,3,0)
sent from Change Healthcare.
"^DD",52.49,52.4921,12,"DT")
3170104
"^DD",52.49,52.4921,13,0)
VERB^F^^1;10^K:$L(X)>10!($L(X)<1) X
"^DD",52.49,52.4921,13,3)
Enter the verb used to describe how the medication is to be taken/used. Answer must be 1-10 characters in length.
"^DD",52.49,52.4921,13,21,0)
^^1^1^3170104^
"^DD",52.49,52.4921,13,21,1,0)
This verb will be used to describe how the medication is taken/used.
"^DD",52.49,52.4921,13,"DT")
3170104
"^DD",52.49,52.4926,0)
VA DISPENSING INSTRUCTIONS SUB-FIELD^^.01^1
"^DD",52.49,52.4926,0,"DT")
3170325
"^DD",52.49,52.4926,0,"IX","B",52.4926,.01)

"^DD",52.49,52.4926,0,"NM","VA DISPENSING INSTRUCTIONS")

"^DD",52.49,52.4926,0,"UP")
52.49
"^DD",52.49,52.4926,.01,0)
VA DISPENSING INSTRUCTIONS^F^^0;1^K:$L(X)>200!($L(X)<1) X
"^DD",52.49,52.4926,.01,1,0)
^.1
"^DD",52.49,52.4926,.01,1,1,0)
52.4926^B
"^DD",52.49,52.4926,.01,1,1,1)
S ^PS(52.49,DA(1),"SIG","B",$E(X,1,30),DA)=""
"^DD",52.49,52.4926,.01,1,1,2)
K ^PS(52.49,DA(1),"SIG","B",$E(X,1,30),DA)
"^DD",52.49,52.4926,.01,3)
Enter the SIG for the incoming eRx. Answer must be 1-200 characters in length.
"^DD",52.49,52.4926,.01,21,0)
^^2^2^3170325^
"^DD",52.49,52.4926,.01,21,1,0)
This is the possible sig for the incoming eRx, built from the information 
"^DD",52.49,52.4926,.01,21,2,0)
entered into the Quantity/Timing multiple.
"^DD",52.49,52.4926,.01,"DT")
3170325
"^DD",52.49,52.4928,0)
DRUG COVERAGE STATUS SUB-FIELD^^.02^2
"^DD",52.49,52.4928,0,"DT")
3170329
"^DD",52.49,52.4928,0,"IX","B",52.4928,.01)

"^DD",52.49,52.4928,0,"NM","DRUG COVERAGE STATUS")

"^DD",52.49,52.4928,0,"UP")
52.49
"^DD",52.49,52.4928,.01,0)
SEQUENCE NUMBER^NJ3,0^^0;1^K:+X'=X!(X>999)!(X<1)!(X?.E1"."1N.N) X
"^DD",52.49,52.4928,.01,1,0)
^.1
"^DD",52.49,52.4928,.01,1,1,0)
52.4928^B
"^DD",52.49,52.4928,.01,1,1,1)
S ^PS(52.49,DA(1),28,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.4928,.01,1,1,2)
K ^PS(52.49,DA(1),28,"B",$E(X,1,30),DA)
"^DD",52.49,52.4928,.01,3)
Enter the drug coverage status sequence number. Type a number between 1 and 999, 0 decimal digits.
"^DD",52.49,52.4928,.01,21,0)
^^1^1^3170329^
"^DD",52.49,52.4928,.01,21,1,0)
The sequence number of the drug coverage status.
"^DD",52.49,52.4928,.01,"DT")
3170329
"^DD",52.49,52.4928,.02,0)
DRUG COVERAGE STATUS^P52.45'^PS(52.45,^0;2^Q
"^DD",52.49,52.4928,.02,3)
Enter the drug coverage status for this eRx.
"^DD",52.49,52.4928,.02,21,0)
^^1^1^3170329^
"^DD",52.49,52.4928,.02,21,1,0)
The drug coverage status value for the eRx.
"^DD",52.49,52.4928,.02,"DT")
3170329
"^DD",52.49,52.4931,0)
VA UNEXPANDED SIG SUB-FIELD^^.01^1
"^DD",52.49,52.4931,0,"DT")
3170614
"^DD",52.49,52.4931,0,"NM","VA UNEXPANDED SIG")

"^DD",52.49,52.4931,0,"UP")
52.49
"^DD",52.49,52.4931,.01,0)
VA UNEXPANDED SIG^Wx^^0;1^Q
"^DD",52.49,52.4931,.01,3)
Enter the VA unexpanded sig.
"^DD",52.49,52.4931,.01,21,0)
^^1^1^3170614^
"^DD",52.49,52.4931,.01,21,1,0)
This is the unexpanded sig built from the dosage information.
"^DD",52.49,52.4931,.01,"DT")
3170614
"^DD",52.49,52.499,0)
DIAGNOSIS SUB-FIELD^^.06^6
"^DD",52.49,52.499,0,"DT")
3170826
"^DD",52.49,52.499,0,"IX","B",52.499,.01)

"^DD",52.49,52.499,0,"NM","DIAGNOSIS")

"^DD",52.49,52.499,0,"UP")
52.49
"^DD",52.49,52.499,.01,0)
SEQUENCE^MRNJ2,0^^0;1^K:+X'=X!(X>99)!(X<0)!(X?.E1"."1N.N) X
"^DD",52.49,52.499,.01,1,0)
^.1
"^DD",52.49,52.499,.01,1,1,0)
52.499^B
"^DD",52.49,52.499,.01,1,1,1)
S ^PS(52.49,DA(1),9,"B",$E(X,1,30),DA)=""
"^DD",52.49,52.499,.01,1,1,2)
K ^PS(52.49,DA(1),9,"B",$E(X,1,30),DA)
"^DD",52.49,52.499,.01,3)
Enter the sequence number of this diagnosis. Type a number between 0 and 99, 0 decimal digits.
"^DD",52.49,52.499,.01,21,0)
^^2^2^3170826^
"^DD",52.49,52.499,.01,21,1,0)
This is the sequence number of the incoming Diagnosis related to the eRx 
"^DD",52.49,52.499,.01,21,2,0)
prescription/patient.
"^DD",52.49,52.499,.01,"DT")
3170826
"^DD",52.49,52.499,.02,0)
CLINICAL INFORMATION QUALIFIER^S^1:PRESCRIBER/PRESCRIBER SUPPLIED;2:PHARMACY INFERRED;^0;2^Q
"^DD",52.49,52.499,.02,3)
Enter the clinical information qualifier for this diagnosis.
"^DD",52.49,52.499,.02,21,0)
^^1^1^3160906^
"^DD",52.49,52.499,.02,21,1,0)
The clinical qualifier for the supplied diagnosis.
"^DD",52.49,52.499,.02,"DT")
3160906
"^DD",52.49,52.499,.03,0)
PRIMARY DX QUALIFIER^S^E:MICROMEDEX/MEDICAL ECONOMICS;F:FIRST DATABANK;M:MEDI-SPAN PRODUCT LINE;ABF:ICD-10-CM;DX:ICD-9-CM;ICD9:ICD9;ICD10:ICD10;^0;3^Q
"^DD",52.49,52.499,.03,3)
Enter the diagnosis qualifier for the diagnosis.
"^DD",52.49,52.499,.03,21,0)
^^1^1^3170826^
"^DD",52.49,52.499,.03,21,1,0)
The primary diagnosis qualifier for the eRx diagnosis.
"^DD",52.49,52.499,.03,"DT")
3170826
"^DD",52.49,52.499,.04,0)
PRIMARY DX VALUE^F^^0;4^K:$L(X)>17!($L(X)<1) X
"^DD",52.49,52.499,.04,3)
Enter the primary diagnosis code/value. Answer must be 1-17 characters in length.
"^DD",52.49,52.499,.04,21,0)
^^1^1^3170826^
"^DD",52.49,52.499,.04,21,1,0)
The diagnosis value associated with the primary qualifier.
"^DD",52.49,52.499,.04,"DT")
3170826
"^DD",52.49,52.499,.05,0)
SECONDARY DX QUALIFIER^S^E:MICROMEDEX/MEDICAL ECONOMICS;F:FIRST DATABANK;M:MEDI-SPAN PRODUCT LINE;ABF:ICD-10-CM;DX:ICD-9-CM;ICD9:ICD9;ICD10:ICD10;^0;5^Q
"^DD",52.49,52.499,.05,3)
Enter the diagnosis qualifier for the diagnosis.
"^DD",52.49,52.499,.05,21,0)
^^1^1^3170826^
"^DD",52.49,52.499,.05,21,1,0)
The diagnosis qualifier associated with the secondary diagnosis.
"^DD",52.49,52.499,.05,"DT")
3170826
"^DD",52.49,52.499,.06,0)
SECONDARY DX VALUE^F^^0;6^K:$L(X)>17!($L(X)<1) X
"^DD",52.49,52.499,.06,3)
Enter the secondary diagnosis code/value. Answer must be 1-17 characters in length.
"^DD",52.49,52.499,.06,21,0)
^^1^1^3170826^
"^DD",52.49,52.499,.06,21,1,0)
This the the secondary diagnosis code/value.
"^DD",52.49,52.499,.06,"DT")
3170826
"^DD",59,59,10,0)
DEFAULT ERX CLINIC^P44'^SC(^10;1^Q
"^DD",59,59,10,3)
Enter the default eRx clinic for this Outpatient Site.
"^DD",59,59,10,21,0)
^^2^2^3170613^
"^DD",59,59,10,21,1,0)
This is the default eRx clinic, used to hold the eRx clinic that will be 
"^DD",59,59,10,21,2,0)
associated with an eRx prescription.
"^DD",59,59,10,"DT")
3170613
"^DIC",52.45,52.45,0)
ERX SERVICE REASON CODES^52.45
"^DIC",52.45,52.45,0,"GL")
^PS(52.45,
"^DIC",52.45,52.45,"%D",0)
^1.001^1^1^3170711^^
"^DIC",52.45,52.45,"%D",1,0)
This file holds various codes needed by eRx package.
"^DIC",52.45,"B","ERX SERVICE REASON CODES",52.45)

"^DIC",52.46,52.46,0)
ERX EXTERNAL PATIENT^52.46
"^DIC",52.46,52.46,0,"GL")
^PS(52.46,
"^DIC",52.46,52.46,"%D",0)
^^2^2^3170705^
"^DIC",52.46,52.46,"%D",1,0)
This file holds the eRx external patient information as received from
"^DIC",52.46,52.46,"%D",2,0)
Change Healthcare.
"^DIC",52.46,"B","ERX EXTERNAL PATIENT",52.46)

"^DIC",52.47,52.47,0)
ERX EXTERNAL PHARMACY^52.47
"^DIC",52.47,52.47,0,"GL")
^PS(52.47,
"^DIC",52.47,52.47,"%D",0)
^^1^1^3170705^
"^DIC",52.47,52.47,"%D",1,0)
This file holds the eRx pharmacy information.
"^DIC",52.47,"B","ERX EXTERNAL PHARMACY",52.47)

"^DIC",52.48,52.48,0)
ERX EXTERNAL PERSON^52.48
"^DIC",52.48,52.48,0,"GL")
^PS(52.48,
"^DIC",52.48,52.48,"%D",0)
^^1^1^3170705^
"^DIC",52.48,52.48,"%D",1,0)
This file holds the eRx external prescriber and supervisor information.
"^DIC",52.48,"B","ERX EXTERNAL PERSON",52.48)

"^DIC",52.49,52.49,0)
ERX HOLDING QUEUE^52.49
"^DIC",52.49,52.49,0,"GL")
^PS(52.49,
"^DIC",52.49,52.49,"%D",0)
^1.001^1^1^3170711^^
"^DIC",52.49,52.49,"%D",1,0)
This file holds the eRx prescriptions received from Change Healthcare.
"^DIC",52.49,"B","ERX HOLDING QUEUE",52.49)

"BLD",9579,6)
^414
**END**
**END**

