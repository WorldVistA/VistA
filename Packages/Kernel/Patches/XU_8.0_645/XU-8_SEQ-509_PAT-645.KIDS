EMERGENCY Released XU*8*645 SEQ #509
Extracted from mail message
**KIDS**:XU*8.0*645^

**INSTALL NAME**
XU*8.0*645
"BLD",1526,0)
XU*8.0*645^KERNEL^0^3140613^y
"BLD",1526,1,0)
^^2^2^3140612^
"BLD",1526,1,1,0)
Please see the patch description on FORUM, in the National Patch Module.
"BLD",1526,1,2,0)

"BLD",1526,4,0)
^9.64PA^^
"BLD",1526,6.3)
1
"BLD",1526,"KRN",0)
^9.67PA^9002226^22
"BLD",1526,"KRN",.4,0)
.4
"BLD",1526,"KRN",.401,0)
.401
"BLD",1526,"KRN",.402,0)
.402
"BLD",1526,"KRN",.403,0)
.403
"BLD",1526,"KRN",.5,0)
.5
"BLD",1526,"KRN",.84,0)
.84
"BLD",1526,"KRN",3.6,0)
3.6
"BLD",1526,"KRN",3.8,0)
3.8
"BLD",1526,"KRN",9.2,0)
9.2
"BLD",1526,"KRN",9.8,0)
9.8
"BLD",1526,"KRN",9.8,"NM",0)
^9.68A^1^1
"BLD",1526,"KRN",9.8,"NM",1,0)
XUSTERM^^0^B21697739
"BLD",1526,"KRN",9.8,"NM","B","XUSTERM",1)

"BLD",1526,"KRN",19,0)
19
"BLD",1526,"KRN",19.1,0)
19.1
"BLD",1526,"KRN",101,0)
101
"BLD",1526,"KRN",409.61,0)
409.61
"BLD",1526,"KRN",771,0)
771
"BLD",1526,"KRN",779.2,0)
779.2
"BLD",1526,"KRN",870,0)
870
"BLD",1526,"KRN",8989.51,0)
8989.51
"BLD",1526,"KRN",8989.51,"NM",0)
^9.68A^1^1
"BLD",1526,"KRN",8989.51,"NM",1,0)
XU645^^0
"BLD",1526,"KRN",8989.51,"NM","B","XU645",1)

"BLD",1526,"KRN",8989.52,0)
8989.52
"BLD",1526,"KRN",8989.52,"NM",0)
^9.68A^^
"BLD",1526,"KRN",8993,0)
8993
"BLD",1526,"KRN",8994,0)
8994
"BLD",1526,"KRN",9002226,0)
9002226
"BLD",1526,"KRN","B",.4,.4)

"BLD",1526,"KRN","B",.401,.401)

"BLD",1526,"KRN","B",.402,.402)

"BLD",1526,"KRN","B",.403,.403)

"BLD",1526,"KRN","B",.5,.5)

"BLD",1526,"KRN","B",.84,.84)

"BLD",1526,"KRN","B",3.6,3.6)

"BLD",1526,"KRN","B",3.8,3.8)

"BLD",1526,"KRN","B",9.2,9.2)

"BLD",1526,"KRN","B",9.8,9.8)

"BLD",1526,"KRN","B",19,19)

"BLD",1526,"KRN","B",19.1,19.1)

"BLD",1526,"KRN","B",101,101)

"BLD",1526,"KRN","B",409.61,409.61)

"BLD",1526,"KRN","B",771,771)

"BLD",1526,"KRN","B",779.2,779.2)

"BLD",1526,"KRN","B",870,870)

"BLD",1526,"KRN","B",8989.51,8989.51)

"BLD",1526,"KRN","B",8989.52,8989.52)

"BLD",1526,"KRN","B",8993,8993)

"BLD",1526,"KRN","B",8994,8994)

"BLD",1526,"KRN","B",9002226,9002226)

"BLD",1526,"QDEF")
^^^^NO^^^^NO^^NO
"BLD",1526,"QUES",0)
^9.62^^
"BLD",1526,"REQB",0)
^9.611^^
"KRN",8989.51,318,-1)
0^1
"KRN",8989.51,318,0)
XU645^Patch 645 Switch^0^^Purge terminated user information
"KRN",8989.51,318,1)
Y^^Enter 'No' to preserve terminated user information
"KRN",8989.51,318,20,0)
^8989.512^5^5^3140612^^
"KRN",8989.51,318,20,1,0)
This parameter determines if a terminated user information should be deleted.
"KRN",8989.51,318,20,2,0)
 A 'No' value means you do not want to purge the terminated user information.
"KRN",8989.51,318,20,3,0)
 This was requested by the OIG when they want all user information preserved.
"KRN",8989.51,318,20,4,0)
 A 'Yes' value means to purge the information, which is normal operating procedure.
"KRN",8989.51,318,20,5,0)

"KRN",8989.51,318,30,0)
^8989.513I^1^1
"KRN",8989.51,318,30,1,0)
1^4.2
"MBREQ")
0
"ORD",20,8989.51)
8989.51;20;;;PAR1E1^XPDTA2;PAR1F1^XPDIA3;PAR1E1^XPDIA3;PAR1F2^XPDIA3;;PAR1DEL^XPDIA3(%)
"ORD",20,8989.51,0)
PARAMETER DEFINITION
"PKG",3,-1)
1^1
"PKG",3,0)
KERNEL^XU^SIGN-ON, SECURITY, MENU DRIVER, DEVICES, TASKMAN^
"PKG",3,22,0)
^9.49I^1^1
"PKG",3,22,1,0)
8.0^3090706^3090706^6
"PKG",3,22,1,"PAH",1,0)
645^3140613
"PKG",3,22,1,"PAH",1,1,0)
^^2^2^3140613
"PKG",3,22,1,"PAH",1,1,1,0)
Please see the patch description on FORUM, in the National Patch Module.
"PKG",3,22,1,"PAH",1,1,2,0)

"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
1
"RTN","XUSTERM")
0^1^B21697739^B20794964
"RTN","XUSTERM",1,0)
XUSTERM ;SEA/AMF/WDE - DEACTIVATE USER ;01/04/12
"RTN","XUSTERM",2,0)
 ;;8.0;KERNEL;**36,73,135,148,169,222,313,384,489,527,588,645**;Jul 10, 1995;Build 1
"RTN","XUSTERM",3,0)
 ;;"Per VHA Directive 2004-038, this routine should not be modified".
"RTN","XUSTERM",4,0)
LKUP N DIRUT,DIC,DIR,XUDA,DA
"RTN","XUSTERM",5,0)
 S DIC=200,DIC("S")="I $L($P(^(0),U,3))",DIC(0)="AEQMZ",DIC("A")="Select USER to be deactivated: "
"RTN","XUSTERM",6,0)
 D ^DIC K DIC G END:Y<0 S XUDA=+Y
"RTN","XUSTERM",7,0)
 D INQ Q:$D(DIRUT)
"RTN","XUSTERM",8,0)
 S DA=XUDA,DIE=200,DR="["_$$GET^XUPARAM("XUSERDEACT","N")_"]" D GET,XUDIE^XUS5
"RTN","XUSTERM",9,0)
 S XUDT=$P(^VA(200,DA,0),U,11),XUACT=XUDT&(XUDT>DT) G END:'XUDT
"RTN","XUSTERM",10,0)
 G:XUACT WHEN G NOW
"RTN","XUSTERM",11,0)
 ;
"RTN","XUSTERM",12,0)
WHEN W !!,XUNAM," will be deactivated on date specified."
"RTN","XUSTERM",13,0)
 S ZTDTH=XUDT,ZTRTN="DQ1^XUSTERM1",ZTDESC="DEACTIVATE USER",ZTSAVE("XUDA")="",ZTIO="" D ^%ZTLOAD
"RTN","XUSTERM",14,0)
 G END
"RTN","XUSTERM",15,0)
 ;
"RTN","XUSTERM",16,0)
NOW S DIR("A")=XUNAM_" will be deactivated now.  Do you wish to proceed",DIR("B")="YES",DIR("??")="XUUSER-DEACT",DIR(0)="Y"
"RTN","XUSTERM",17,0)
 D ^DIR I "Yy"'[$E(X_U) S XUDT=$$NOW^XLFDT G WHEN
"RTN","XUSTERM",18,0)
 W ! S XUVE=1 D ACT
"RTN","XUSTERM",19,0)
 G END
"RTN","XUSTERM",20,0)
 ;
"RTN","XUSTERM",21,0)
INQ ;Ask to show User Inquiry
"RTN","XUSTERM",22,0)
 N DIR,DIC,FLDS,BY,FR,TO,Y,L
"RTN","XUSTERM",23,0)
 S DIR(0)="Y",DIR("A")="View/Print User Inquiry Data",DIR("B")="Yes" D ^DIR Q:$D(DIRUT)!('Y)
"RTN","XUSTERM",24,0)
 S L=0,DIC=200,FLDS="[XUSERINQ]",BY="NUMBER",(TO,FR)=XUDA D EN1^DIP K DIC
"RTN","XUSTERM",25,0)
 K DIR S DIR(0)="E" D ^DIR
"RTN","XUSTERM",26,0)
 Q
"RTN","XUSTERM",27,0)
 ;
"RTN","XUSTERM",28,0)
GET ;XUGRP=mail group, XUKEY=keys, XUSUR=mail surrogates, XUJ=# baskets, XUK=# mail msg, XUIN=# in-basket msg
"RTN","XUSTERM",29,0)
 ;XUTX1, XUTX2 used in edit templates
"RTN","XUSTERM",30,0)
 K XUGRP,XUKEY,XUSUR,XUTX1,XUTX2 N %,XU10,XU11,XU20,XU21,XU30,XU31
"RTN","XUSTERM",31,0)
 S (XU10,XU20)=0,(XU11,XU21,XU31)=""
"RTN","XUSTERM",32,0)
 S DA=XUDA,XUNAM=$P(^VA(200,XUDA,0),U,1)
"RTN","XUSTERM",33,0)
 F XUI=0:0 S XUI=$O(^XMB(3.8,"AB",XUDA,XUI)) Q:XUI'>0  D  ;Mail groups
"RTN","XUSTERM",34,0)
 . S XUK=$G(^XMB(3.8,XUI,0)) I XUK="" Q  S:'$L($P(XUK,U,2)) $P(XUK,U,2)="PU" ;588 added $G and I XUK="" Q
"RTN","XUSTERM",35,0)
 . S XUGRP(XUI)=$P(XUK,U,1,2)_U_$S('$D(^XMB(3.8,XUI,3)):0,1:^(3)=XUDA)
"RTN","XUSTERM",36,0)
 . S XU10=XU10+1 S:$L(XU11)<70 XU11=XU11_","_$P(XUK,U)
"RTN","XUSTERM",37,0)
 F XUI=0:0 S XUI=$O(^VA(200,XUDA,51,XUI)) Q:XUI'>0  D  ;Get keys
"RTN","XUSTERM",38,0)
 . S %=$G(^DIC(19.1,XUI,0)),XU20=XU20+1
"RTN","XUSTERM",39,0)
 . S:$L(XU21)<70 XU21=XU21_","_$P(%,U)
"RTN","XUSTERM",40,0)
 . Q:$P(%,U,4)="y"  ;Don't count keep at terminate keys
"RTN","XUSTERM",41,0)
 . S XUKEY(XUI)=""
"RTN","XUSTERM",42,0)
 F XUI=0:0 S XUI=$O(^XMB(3.7,"AB",XUDA,XUI)) Q:XUI'>0  D
"RTN","XUSTERM",43,0)
 . S XUSUR(XUI)="" S:$L(XU31)<70 XU31=XU31_","_$P(^VA(200,XUI,0),U)
"RTN","XUSTERM",44,0)
 S (XUJ,XUK,XUIN,XUNUM)=0
"RTN","XUSTERM",45,0)
 F I=.9:0 S I=$O(^XMB(3.7,XUDA,2,I)) Q:I'>0  D
"RTN","XUSTERM",46,0)
 . S XUJ=XUJ+1,XUNUM=$P($G(^XMB(3.7,XUDA,2,I,1,0)),U,4)
"RTN","XUSTERM",47,0)
 . S:XUNUM>0 XUK=XUK+XUNUM S:I=1 XUIN=XUNUM
"RTN","XUSTERM",48,0)
 . Q
"RTN","XUSTERM",49,0)
 S XUTX1(1)="User has "_XUK_" messages in "_XUJ_" baskets, Member of "_XU10_" Mail Groups."
"RTN","XUSTERM",50,0)
 S:XU10 XUTX1(2)="Mail Groups: "_$E(XU11,2,80) S:$L(XU31) XUTX1(3)="Surrogate for: "_$E(XU31,2,80)
"RTN","XUSTERM",51,0)
 S XUTX2(1)="User has "_XU20_" keys" S:XU20 XUTX2(2)=$E(XU21,2,80)
"RTN","XUSTERM",52,0)
 S XUEMP='($D(XUSUR)!$D(XUKEY)!$D(XUGRP)!XUJ!XUK!XUIN!$L($P(^VA(200,XUDA,0),U,3)))
"RTN","XUSTERM",53,0)
 Q
"RTN","XUSTERM",54,0)
ACT ;First let others clean-up, Then do our part.
"RTN","XUSTERM",55,0)
 ;D ^XUSTERM2 ;Cleanup by other packages.
"RTN","XUSTERM",56,0)
 N DIC,DA,DIE,DR
"RTN","XUSTERM",57,0)
 L +^VA(200,XUDA,0):6
"RTN","XUSTERM",58,0)
 ;Delete Verify code, prevents user from logging on p645
"RTN","XUSTERM",59,0)
 ;need Access code for XUSTERM1 to find terminated users
"RTN","XUSTERM",60,0)
 S DIE=200,DA=XUDA,DR="11///@" D ^DIE
"RTN","XUSTERM",61,0)
 ;check Purge flag, quit if no p645
"RTN","XUSTERM",62,0)
 I '$$GET^XPAR("SYS","XU645",1,"Q") L -^VA(200,XUDA,0) Q 
"RTN","XUSTERM",63,0)
 ;Delete other fields
"RTN","XUSTERM",64,0)
 ;Access code;Verify Code;PAC;Last signon;SMD delegate;electronic signature,Primary menu,Hinq Employee #
"RTN","XUSTERM",65,0)
 S DIE=200,DA=XUDA,DR="2///@;11///@;14///@;1.1///@;19///@;19.2///@;20.4///@;201///@;14.9///@" D ^DIE
"RTN","XUSTERM",66,0)
 L -^VA(200,XUDA,0)
"RTN","XUSTERM",67,0)
 D DEQUE^XUSERP(XUDA,3) ;Cleanup by other packages.
"RTN","XUSTERM",68,0)
 ;
"RTN","XUSTERM",69,0)
 K DIC S DA=XUDA,XUJ=^VA(200,XUDA,0),XUNAM=$P(XUJ,U,1),XUACT(19)=$S($D(^VA(200,XUDA,19)):^(19),1:"") F XUI=5,6,10 S XUACT(XUI)=$P(XUJ,U,XUI)
"RTN","XUSTERM",70,0)
ACT1 K ^DISV(XUDA) ; WARNING: This only gets ^DISV entries on current CPU
"RTN","XUSTERM",71,0)
 ;keys
"RTN","XUSTERM",72,0)
 I XUACT(6)'="n" F XUI=0:0 S XUI=$O(^VA(200,XUDA,51,XUI)) Q:XUI'>0  I $P($G(^DIC(19.1,XUI,0)),U,4)'="y" S DA=XUI,DA(1)=XUDA,DIK="^VA(200,XUDA,51," D ^DIK W:XUVE "..."
"RTN","XUSTERM",73,0)
 ;delegated keys
"RTN","XUSTERM",74,0)
 I XUACT(6)'="n" F XUI=0:0 S XUI=$O(^VA(200,XUDA,52,XUI)) Q:XUI'>0  S DA=XUI,DA(1)=XUDA,DIK="^VA(200,XUDA,52," D ^DIK W:XUVE "..."
"RTN","XUSTERM",75,0)
 ;Delegated options
"RTN","XUSTERM",76,0)
 S DIK="^VA(200,XUDA,19.5,",DA(1)=XUDA F XUI=0:0 S XUI=$O(^VA(200,XUDA,19.5,XUI)) Q:XUI'>0  S DA=XUI D ^DIK
"RTN","XUSTERM",77,0)
 ;Menu templates
"RTN","XUSTERM",78,0)
 S DIK="^VA(200,XUDA,19.8,",DA(1)=XUDA F XUI=0:0 S XUI=$O(^VA(200,XUDA,19.8,XUI)) Q:XUI'>0  S DA=XUI D ^DIK
"RTN","XUSTERM",79,0)
 ;Secondary Menus
"RTN","XUSTERM",80,0)
 S DIK="^VA(200,XUDA,203,",DA(1)=XUDA F XUI=0:0 S XUI=$O(^VA(200,XUDA,203,XUI)) Q:XUI'>0  S DA=XUI D ^DIK
"RTN","XUSTERM",81,0)
 S DA=0,DA(1)=XUDA D D2^XUFILE1 ;Remove all access to files.
"RTN","XUSTERM",82,0)
 ;Terminate Person Class
"RTN","XUSTERM",83,0)
 D TERM^XUA4A72(XUDA,XUDT)
"RTN","XUSTERM",84,0)
 ;Remove all parameters for the user.
"RTN","XUSTERM",85,0)
 D DELUSR^XPAR3(XUDA)
"RTN","XUSTERM",86,0)
 ;
"RTN","XUSTERM",87,0)
ACT2 ;XUACT(5) All Mail access,  Mail groups
"RTN","XUSTERM",88,0)
 D MAIL
"RTN","XUSTERM",89,0)
 D SEND^XUSTERM1
"RTN","XUSTERM",90,0)
 W:XUVE "... DONE"
"RTN","XUSTERM",91,0)
 Q
"RTN","XUSTERM",92,0)
 ;
"RTN","XUSTERM",93,0)
END K C,D,D0,DI,DR,DIC,DIE,DA,DIR,XUEMP,XUDA,XUI,XUJ,XUK,XUACT,XUKEY,XUGRP,XUSUR,XUNAM,XUF,XUDT,XUIN,DIC,XUDB,XUDC,XUDP,XUGP,XUNUM,XUVE,Y
"RTN","XUSTERM",94,0)
 K XUTX1,XUTX2,DIRUT,DIR
"RTN","XUSTERM",95,0)
 Q
"RTN","XUSTERM",96,0)
MAIL ;Remove mail access
"RTN","XUSTERM",97,0)
 I XUACT(5)'="n" D TERMINAT^XMUTERM1(XUDA)
"RTN","XUSTERM",98,0)
 Q
"VER")
8.0^22.0
**END**
**END**

