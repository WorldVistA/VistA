Released PSJ*5*304 SEQ #267
Extracted from mail message
**KIDS**:PSJ*5.0*304^

**INSTALL NAME**
PSJ*5.0*304
"BLD",9500,0)
PSJ*5.0*304^INPATIENT MEDICATIONS^0^3141031^y
"BLD",9500,1,0)
^^7^7^3141030^
"BLD",9500,1,1,0)
This patch will resolve the following issues:
"BLD",9500,1,2,0)
1)      An UNDEFINED error when editing the Infusion Rate for a 
"BLD",9500,1,3,0)
           non-verified IV order.
"BLD",9500,1,4,0)
2)      Automated Tablet Counter (ATC) interface issue with Extra Units 
"BLD",9500,1,5,0)
           Dispensed option.
"BLD",9500,1,6,0)
3)      Pharmacists are getting locked out of the system.
"BLD",9500,1,7,0)
4)      Message display issues with Non-Verified/Pending order screen
"BLD",9500,4,0)
^9.64PA^55^1
"BLD",9500,4,55,0)
55
"BLD",9500,4,55,2,0)
^9.641^55.01^1
"BLD",9500,4,55,2,55.01,0)
IV  (sub-file)
"BLD",9500,4,55,2,55.01,1,0)
^9.6411^.03^1
"BLD",9500,4,55,2,55.01,1,.03,0)
STOP DATE/TIME
"BLD",9500,4,55,222)
y^n^p^^^^n^^n
"BLD",9500,4,55,224)

"BLD",9500,4,"APDD",55,55.01)

"BLD",9500,4,"APDD",55,55.01,.03)

"BLD",9500,4,"B",55,55)

"BLD",9500,6.3)
22
"BLD",9500,"INID")
^n
"BLD",9500,"INIT")
QUE^PSJ304PO
"BLD",9500,"KRN",0)
^9.67PA^779.2^20
"BLD",9500,"KRN",.4,0)
.4
"BLD",9500,"KRN",.401,0)
.401
"BLD",9500,"KRN",.402,0)
.402
"BLD",9500,"KRN",.403,0)
.403
"BLD",9500,"KRN",.5,0)
.5
"BLD",9500,"KRN",.84,0)
.84
"BLD",9500,"KRN",3.6,0)
3.6
"BLD",9500,"KRN",3.8,0)
3.8
"BLD",9500,"KRN",9.2,0)
9.2
"BLD",9500,"KRN",9.8,0)
9.8
"BLD",9500,"KRN",9.8,"NM",0)
^9.68A^7^5
"BLD",9500,"KRN",9.8,"NM",3,0)
PSGSICH^^0^B43620389
"BLD",9500,"KRN",9.8,"NM",4,0)
PSGEUD^^0^B31070056
"BLD",9500,"KRN",9.8,"NM",5,0)
PSGVBW^^0^B97694806
"BLD",9500,"KRN",9.8,"NM",6,0)
PSIVACT^^0^B30388063
"BLD",9500,"KRN",9.8,"NM",7,0)
PSGVBW0^^0^B41945132
"BLD",9500,"KRN",9.8,"NM","B","PSGEUD",4)

"BLD",9500,"KRN",9.8,"NM","B","PSGSICH",3)

"BLD",9500,"KRN",9.8,"NM","B","PSGVBW",5)

"BLD",9500,"KRN",9.8,"NM","B","PSGVBW0",7)

"BLD",9500,"KRN",9.8,"NM","B","PSIVACT",6)

"BLD",9500,"KRN",19,0)
19
"BLD",9500,"KRN",19.1,0)
19.1
"BLD",9500,"KRN",101,0)
101
"BLD",9500,"KRN",409.61,0)
409.61
"BLD",9500,"KRN",771,0)
771
"BLD",9500,"KRN",779.2,0)
779.2
"BLD",9500,"KRN",870,0)
870
"BLD",9500,"KRN",8989.51,0)
8989.51
"BLD",9500,"KRN",8989.52,0)
8989.52
"BLD",9500,"KRN",8994,0)
8994
"BLD",9500,"KRN","B",.4,.4)

"BLD",9500,"KRN","B",.401,.401)

"BLD",9500,"KRN","B",.402,.402)

"BLD",9500,"KRN","B",.403,.403)

"BLD",9500,"KRN","B",.5,.5)

"BLD",9500,"KRN","B",.84,.84)

"BLD",9500,"KRN","B",3.6,3.6)

"BLD",9500,"KRN","B",3.8,3.8)

"BLD",9500,"KRN","B",9.2,9.2)

"BLD",9500,"KRN","B",9.8,9.8)

"BLD",9500,"KRN","B",19,19)

"BLD",9500,"KRN","B",19.1,19.1)

"BLD",9500,"KRN","B",101,101)

"BLD",9500,"KRN","B",409.61,409.61)

"BLD",9500,"KRN","B",771,771)

"BLD",9500,"KRN","B",779.2,779.2)

"BLD",9500,"KRN","B",870,870)

"BLD",9500,"KRN","B",8989.51,8989.51)

"BLD",9500,"KRN","B",8989.52,8989.52)

"BLD",9500,"KRN","B",8994,8994)

"BLD",9500,"QDEF")
^^^^NO^^^^^^NO
"BLD",9500,"QUES",0)
^9.62^^
"BLD",9500,"REQB",0)
^9.611^4^3
"BLD",9500,"REQB",1,0)
PSJ*5.0*164^2
"BLD",9500,"REQB",2,0)
PSJ*5.0*254^2
"BLD",9500,"REQB",4,0)
PSJ*5.0*275^2
"BLD",9500,"REQB","B","PSJ*5.0*164",1)

"BLD",9500,"REQB","B","PSJ*5.0*254",2)

"BLD",9500,"REQB","B","PSJ*5.0*275",4)

"FIA",55)
PHARMACY PATIENT
"FIA",55,0)
^PS(55,
"FIA",55,0,0)
55P
"FIA",55,0,1)
y^n^p^^^^n^^n
"FIA",55,0,10)

"FIA",55,0,11)

"FIA",55,0,"RLRO")

"FIA",55,0,"VR")
5.0^PSJ
"FIA",55,55)
1
"FIA",55,55.01)
1
"FIA",55,55.01,.03)

"INIT")
QUE^PSJ304PO
"IX",55,55,"ACRIV",0)
55^ACRIV^Clinical Reminders index.^MU^^R^IR^W^55.01^^^^^A
"IX",55,55,"ACRIV",.1,0)
^^8^8^3041215
"IX",55,55,"ACRIV",.1,1,0)
This cross-reference builds two indexes, one for finding
"IX",55,55,"ACRIV",.1,2,0)
all patients with a particular drug and one for
"IX",55,55,"ACRIV",.1,3,0)
finding all the drugs a patient has. The indexes are
"IX",55,55,"ACRIV",.1,4,0)
stored in the Clinical Reminders index global as:
"IX",55,55,"ACRIV",.1,5,0)
 ^PXRMINDX(55,"IP",DRUG,DFN,START,STOP,DAS)
"IX",55,55,"ACRIV",.1,6,0)
 ^PXRMINDX(55,"PI",DFN,DRUG,START,STOP,DAS)
"IX",55,55,"ACRIV",.1,7,0)
respectively. START is the start date and STOP is the stop date.
"IX",55,55,"ACRIV",.1,8,0)
For all the details, see the Clinical Reminders Index Technical Guide/Programmer's Manual.
"IX",55,55,"ACRIV",1)
D SPSPA^PSJXRFS(.X,.DA,"IV")
"IX",55,55,"ACRIV",1.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRIV",2)
D KPSPA^PSJXRFK(.X,.DA,"IV")
"IX",55,55,"ACRIV",2.4)
S X=$$PATCH^XPDUTL("PXRM*1.5*12")
"IX",55,55,"ACRIV",2.5)
K ^PXRMINDX(55)
"IX",55,55,"ACRIV",11.1,0)
^.114IA^2^2
"IX",55,55,"ACRIV",11.1,1,0)
1^F^55.01^.02^^1^F
"IX",55,55,"ACRIV",11.1,2,0)
2^F^55.01^.03^^2^F
"IX",55,55,"AIVC",0)
55^AIVC^List of patients with orders associated with clinic appointments.^R^^R^IR^W^55.01^^^^^S
"IX",55,55,"AIVC",1)
S ^PS(55,"AIVC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)=""
"IX",55,55,"AIVC",2)
K ^PS(55,"AIVC",$E(X(1),1,20),$E(X(2),1,20),DA(1),DA)
"IX",55,55,"AIVC",2.5)
K ^PS(55,"AIVC")
"IX",55,55,"AIVC",11.1,0)
^.114IA^3^2
"IX",55,55,"AIVC",11.1,2,0)
1^F^55.01^.03^20^1^F
"IX",55,55,"AIVC",11.1,3,0)
2^F^55.01^136^20^2^F
"IX",55,55.01,"AIN",0)
55.01^AIN^Clinic cross-reference.^R^^R^IR^I^55.01^^^^^S
"IX",55,55.01,"AIN",.1,0)
^^2^2^3040729^
"IX",55,55.01,"AIN",.1,1,0)
This cross-reference is used to easily determine if a specific patient 
"IX",55,55.01,"AIN",.1,2,0)
has clinic orders.
"IX",55,55.01,"AIN",1)
S ^PS(55,DA(1),"IV","AIN",X(1),X(2),DA)=""
"IX",55,55.01,"AIN",2)
K ^PS(55,DA(1),"IV","AIN",X(1),X(2),DA)
"IX",55,55.01,"AIN",2.5)
K ^PS(55,DA(1),"IV","AIN")
"IX",55,55.01,"AIN",11.1,0)
^.114IA^2^2
"IX",55,55.01,"AIN",11.1,1,0)
1^F^55.01^.03^^1^F
"IX",55,55.01,"AIN",11.1,1,3)

"IX",55,55.01,"AIN",11.1,2,0)
2^F^55.01^136^^2^F
"IX",55,55.01,"AIN",11.1,2,3)

"IX",55,55.01,"CIMOI",0)
55.01^CIMOI^CIMOI - PS(55,PATIENT,"IV","CIMOI",CLINIC,STOP DATE/TIME,ORDER)^R^^R^IR^I^55.01^^^^^LS
"IX",55,55.01,"CIMOI",.1,0)
^^10^10^3130626^
"IX",55,55.01,"CIMOI",.1,1,0)
This cross reference is used during enhanced order checks for quick 
"IX",55,55.01,"CIMOI",.1,2,0)
access to clinic order information for IV orders.  IV sub-file cross 
"IX",55,55.01,"CIMOI",.1,3,0)
referenced by CLINIC, STOP DATE/TIME and ORDER NUMBER.
"IX",55,55.01,"CIMOI",.1,4,0)
 
"IX",55,55.01,"CIMOI",.1,5,0)
As orders are placed, this cross reference will be defined when YES is
"IX",55,55.01,"CIMOI",.1,6,0)
answered for the ADMINISTER INPATIENT MEDS parameter under the SET UP A
"IX",55,55.01,"CIMOI",.1,7,0)
CLINIC [SDBUILD] option and appointment date/time is defined.
"IX",55,55.01,"CIMOI",.1,8,0)
 
"IX",55,55.01,"CIMOI",.1,9,0)
Using the same criteria, this cross reference will be defined if a clinic
"IX",55,55.01,"CIMOI",.1,10,0)
is added or edited using the CLINIC DEFINITION [PSJ CD] option.
"IX",55,55.01,"CIMOI",1)
S ^PS(55,DA(1),"IV","CIMOI",X(1),X(2),DA)=""
"IX",55,55.01,"CIMOI",1.4)
S X=$$CHECK2^PSJIMO1() I X
"IX",55,55.01,"CIMOI",2)
K ^PS(55,DA(1),"IV","CIMOI",X(1),X(2),DA)
"IX",55,55.01,"CIMOI",2.5)
K ^PS(55,DA(1),"IV","CIMOI")
"IX",55,55.01,"CIMOI",11.1,0)
^.114IA^2^2
"IX",55,55.01,"CIMOI",11.1,1,0)
1^F^55.01^136^^1^F
"IX",55,55.01,"CIMOI",11.1,2,0)
2^F^55.01^.03^^2^F
"MBREQ")
0
"PKG",471,-1)
1^1
"PKG",471,0)
INPATIENT MEDICATIONS^PSJ^UNIT DOSE AND IVS
"PKG",471,20,0)
^9.402P^^
"PKG",471,22,0)
^9.49I^1^1
"PKG",471,22,1,0)
5.0^2971215^2990325^66481
"PKG",471,22,1,"PAH",1,0)
304^3141031
"PKG",471,22,1,"PAH",1,1,0)
^^7^7^3141031
"PKG",471,22,1,"PAH",1,1,1,0)
This patch will resolve the following issues:
"PKG",471,22,1,"PAH",1,1,2,0)
1)      An UNDEFINED error when editing the Infusion Rate for a 
"PKG",471,22,1,"PAH",1,1,3,0)
           non-verified IV order.
"PKG",471,22,1,"PAH",1,1,4,0)
2)      Automated Tablet Counter (ATC) interface issue with Extra Units 
"PKG",471,22,1,"PAH",1,1,5,0)
           Dispensed option.
"PKG",471,22,1,"PAH",1,1,6,0)
3)      Pharmacists are getting locked out of the system.
"PKG",471,22,1,"PAH",1,1,7,0)
4)      Message display issues with Non-Verified/Pending order screen
"QUES","XPF1",0)
Y
"QUES","XPF1","??")
^D REP^XPDH
"QUES","XPF1","A")
Shall I write over your |FLAG| File
"QUES","XPF1","B")
YES
"QUES","XPF1","M")
D XPF1^XPDIQ
"QUES","XPF2",0)
Y
"QUES","XPF2","??")
^D DTA^XPDH
"QUES","XPF2","A")
Want my data |FLAG| yours
"QUES","XPF2","B")
YES
"QUES","XPF2","M")
D XPF2^XPDIQ
"QUES","XPI1",0)
YO
"QUES","XPI1","??")
^D INHIBIT^XPDH
"QUES","XPI1","A")
Want KIDS to INHIBIT LOGONs during the install
"QUES","XPI1","B")
NO
"QUES","XPI1","M")
D XPI1^XPDIQ
"QUES","XPM1",0)
PO^VA(200,:EM
"QUES","XPM1","??")
^D MG^XPDH
"QUES","XPM1","A")
Enter the Coordinator for Mail Group '|FLAG|'
"QUES","XPM1","B")

"QUES","XPM1","M")
D XPM1^XPDIQ
"QUES","XPO1",0)
Y
"QUES","XPO1","??")
^D MENU^XPDH
"QUES","XPO1","A")
Want KIDS to Rebuild Menu Trees Upon Completion of Install
"QUES","XPO1","B")
NO
"QUES","XPO1","M")
D XPO1^XPDIQ
"QUES","XPZ1",0)
Y
"QUES","XPZ1","??")
^D OPT^XPDH
"QUES","XPZ1","A")
Want to DISABLE Scheduled Options, Menu Options, and Protocols
"QUES","XPZ1","B")
NO
"QUES","XPZ1","M")
D XPZ1^XPDIQ
"QUES","XPZ2",0)
Y
"QUES","XPZ2","??")
^D RTN^XPDH
"QUES","XPZ2","A")
Want to MOVE routines to other CPUs
"QUES","XPZ2","B")
NO
"QUES","XPZ2","M")
D XPZ2^XPDIQ
"RTN")
6
"RTN","PSGEUD")
0^4^B31070056^B27762235
"RTN","PSGEUD",1,0)
PSGEUD ;BIR/CML3-EXTRA UNITS DISPENSED ;17 SEP 97 /  1:41 PM
"RTN","PSGEUD",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**31,41,50,111,150,164,304**;16 DEC 97;Build 22
"RTN","PSGEUD",3,0)
 ;
"RTN","PSGEUD",4,0)
 ; Reference to ^PSDRUG( is supported by DBIA 2192.
"RTN","PSGEUD",5,0)
 ; Reference to ^PS(50.7 is supported by DBIA 2180.
"RTN","PSGEUD",6,0)
 ; Reference to ^PS(51.2 is supported by DBIA 2178.
"RTN","PSGEUD",7,0)
 ; Reference to ^PS(55 is supported by DBIA 2191.
"RTN","PSGEUD",8,0)
 ;
"RTN","PSGEUD",9,0)
 N PSJNEW,PSGPTMP,PPAGE,PSGEFN S PSJNEW=1
"RTN","PSGEUD",10,0)
 D ENCV^PSGSETU Q:$D(XQUIT)  S (PSGONNV,PSGRETF)=1 K PSGPRP
"RTN","PSGEUD",11,0)
 ;
"RTN","PSGEUD",12,0)
GP ;
"RTN","PSGEUD",13,0)
 S PSGP="",DFN=""
"RTN","PSGEUD",14,0)
 D ENDPT^PSGP G:(PSGP'>0)&(DFN'>0)!('$D(PSJPAD)) DONE S:PSGP<1 PSGP=DFN I '$O(^PS(55,PSGP,5,"AUS",+PSJPAD)) W $C(7),!,"(Patient has NO active or old orders.)" G GP
"RTN","PSGEUD",15,0)
 D ENL^PSGOU G:"^N"[PSGOL GP S PSGPTMP=0,PPAGE=1 D ^PSGO G:'PSGON GP S PSGLMT=PSGON,(PSGONC,PSGONR)=0
"RTN","PSGEUD",16,0)
 F  W !!,"Select ORDER",$E("S",PSGON>1)," 1-",PSGON,": " R X:DTIME W:'$T $C(7) S:'$T X="^" Q:"^"[X  D:X?1."?" H I X'?1."?" D ENCHK^PSGON W:'$D(X) $C(7),"  ??" Q:$D(X)
"RTN","PSGEUD",17,0)
 G:"^"[X GP F PSGRET=1:1:PSGODDD F PSGRET1=1:1 S PSGRET2=$P(PSGODDD(PSGRET),",",PSGRET1) Q:'PSGRET2  S PSGORD=^TMP("PSJON",$J,PSGRET2) D R G:$D(DTOUT) GP
"RTN","PSGEUD",18,0)
 G GP
"RTN","PSGEUD",19,0)
 ;
"RTN","PSGEUD",20,0)
DONE ;
"RTN","PSGEUD",21,0)
 D ENKV^PSGSETU K ^TMP("PSJON",$J),DO,DRGN,MR,OD,PSGLMT,PSGODDD,PSGEUD,PSGEUDA,PSGOL,PSGON,PSGONC,PSGONR,PSGONV,PSGONNV,PSGORD,PSGQ,PSGRET,PSGRET1,PSGRET2,PSGRETF,PSGSPD,SCH,WG,Z,CST Q
"RTN","PSGEUD",22,0)
 ;
"RTN","PSGEUD",23,0)
R ;
"RTN","PSGEUD",24,0)
 S MR=$P($G(^PS(55,PSGP,5,+PSGORD,0)),"^",3),Y=$G(^(.2)),SCH=$P($G(^(2)),"^"),DO=$P(Y,"^",2),DRG=$P(Y,"^"),DRG=$S(DRG'=+DRG:"NOT FOUND",'$D(^PS(50.7,DRG,0)):DRG,$P(^(0),"^")]"":$P(^(0),"^"),1:DRG_";PS(50.7,")
"RTN","PSGEUD",25,0)
 S:MR]"" MR=$S(MR'=MR:MR,'$D(^PS(51.2,MR,0)):MR,$P(^(0),"^",3)]"":$P(^(0),"^",3),$P(^(0),"^")]"":$P(^(0),"^"),1:MR_";PS(51.2,") W !!,"----------------------------------------",!,DRG,!,"Give: " D
"RTN","PSGEUD",26,0)
 .N LN,MARX D TXT^PSGMUTL(DO_" "_MR_" "_SCH,65)
"RTN","PSGEUD",27,0)
 .S LN="" F  S LN=$O(MARX(LN)) Q:LN=""  W:LN>1 ! W ?6,MARX(LN)
"RTN","PSGEUD",28,0)
 I '$O(^PS(55,PSGP,5,+PSGORD,1,0)) D  Q
"RTN","PSGEUD",29,0)
 .W !!,"No Dispense drugs have been entered for this order. At least one Dispense drugs",!,"must be associated with an order before dispensing information may be entered.",!!
"RTN","PSGEUD",30,0)
 .N DIR S DIR(0)="E" D ^DIR S Y=$S(Y:0,1:1)
"RTN","PSGEUD",31,0)
 S PSGEUD=0,WG=$O(^PS(57.5,"AB",+PSJPWD,0)) F DRG=0:0 S DRG=$O(^PS(55,PSGP,5,+PSGORD,1,DRG)) Q:'DRG  S X=$G(^(DRG,0)) I X D  Q:$D(DTOUT)
"RTN","PSGEUD",32,0)
 .S UD=$P(X,"^",2),DRGN=$$ENDDN^PSGMI(+X) Q:DRGN=""  S:'$D(^PSDRUG(+X,212,"AC",+WG)) WG=""
"RTN","PSGEUD",33,0)
 .I ($P(X,"^",3)?7N)&($P(PSGDT,".")'<$P(X,"^",3)) W !!,"Dispense drug: ",DRGN," **ORDER INACTIVE**" Q
"RTN","PSGEUD",34,0)
 .I ($G(^PSDRUG(+X,"I"))?7N)&($P(PSGDT,".")'<$G(^PSDRUG(+X,"I"))) W !!,"Dispense drug: ",DRGN," **DRUG INACTIVE**" Q
"RTN","PSGEUD",35,0)
 .W !!,"Dispense drug: ",DRGN,"  (U/D: ",$S('UD:1,1:UD),")"
"RTN","PSGEUD",36,0)
 .K DA,DR S DA=+DRG,DA(2)=PSGP,DA(1)=+PSGORD,DIE="^PS(55,"_PSGP_",5,"_+PSGORD_",1,",DR=.11 S:$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),"^",11) $P(^(0),"^",11)=""
"RTN","PSGEUD",37,0)
 .D ^DIE S PSGEUD=PSGEUD+$P($G(^PS(55,PSGP,5,+PSGORD,1,DA,0)),U,11)
"RTN","PSGEUD",38,0)
 I PSGEUD,WG D QS
"RTN","PSGEUD",39,0)
 Q
"RTN","PSGEUD",40,0)
 ;
"RTN","PSGEUD",41,0)
QS ;
"RTN","PSGEUD",42,0)
 W !!,"THIS DRUG IS AN ATC ITEM." S Y=$G(^PS(57.5,WG,3)) I $P(Y,"^",3)="" W $C(7),"  BUT THE ATC DEVICE CANNOT BE FOUND!" S Y=0 Q
"RTN","PSGEUD",43,0)
 S IOP="`"_$P(Y,"^",3),PSGSPD=$P(Y,"^",2) F  W !,"Do you want to dispense ",$S(PSGEUD>1:"these",1:"this")," extra unit",$E("s",PSGEUD>1)," through the ATC" S %=2 D YN^DICN Q:%  D QSH
"RTN","PSGEUD",44,0)
 S Y=0 Q:%'=1  K %ZIS,IO("Q") S %ZIS="NQ",PSGION=ION,IOP=IOP_";255" D ^%ZIS I POP S IOP=PSGION D ^%ZIS W $C(7),!!?10,"** THE ATC MACHINE CANNOT BE FOUND! **" S Y=0 Q
"RTN","PSGEUD",45,0)
 K ZTSAVE S PSGTIR="ENQ^PSGEUD",PSGTID=$H,ZTDESC="EXTRA UNITS TO ATC" F X="PSGP","PSGORD","PSGP(0)","PSGSPD" S ZTSAVE(X)=""
"RTN","PSGEUD",46,0)
 D ENTSK^PSGTI W "...DONE" S Y=0 Q
"RTN","PSGEUD",47,0)
 ;
"RTN","PSGEUD",48,0)
ENQ ;
"RTN","PSGEUD",49,0)
 N PSGTAG
"RTN","PSGEUD",50,0)
 D NOW^%DTC S DFN=PSGP D PID^VADPT
"RTN","PSGEUD",51,0)
 S %=%_"0000000000000",BLKS="                    ",PN=$E($P(PSGP(0),"^")_BLKS,1,20),PID=$E(VA("PID")_BLKS,1,12),PL=$E($S($D(^DPT(PSGP,.1)):^(.1),1:"*N/F*")_BLKS,1,12)
"RTN","PSGEUD",52,0)
 X ^%ZOSF("LABOFF") F PSGDRG=0:0 S PSGDRG=$O(^PS(55,PSGP,5,+PSGORD,1,PSGDRG)) Q:'PSGDRG  S X=$G(^(PSGDRG,0)) I X D
"RTN","PSGEUD",53,0)
 .S C=$P(X,U,11),PSGEUDA=$P($G(^PSDRUG(+X,8.5)),U,2) Q:(PSGEUDA="")!('C)
"RTN","PSGEUD",54,0)
 .;NETWORK CHANNEL
"RTN","PSGEUD",55,0)
 .;S PSGEUDA=$E(PSGEUDA_BLKS,1,15) S:$L(C)<3 C=$E("000",1,3-$L(C))_C S C=C_$E(%,4,5)_$E(%,6,7)_$E(%,2,3)_$E(%,9,10)_$E(%,11,12) D @$S(PSGSPD:"S2",1:"S1")
"RTN","PSGEUD",56,0)
 .S PSGEUDA=$E(PSGEUDA_BLKS,1,15) S:$L(C)<3 C=$E("000",1,3-$L(C))_C S C=C_$E(%,4,5)_$E(%,6,7)_$E(%,2,3)_$E(%,9,10)_$E(%,11,12) S PSGTAG=$S(IOT="CHAN":"S3",PSGSPD:"S2",1:"S1") D @PSGTAG
"RTN","PSGEUD",57,0)
 Q
"RTN","PSGEUD",58,0)
 ;
"RTN","PSGEUD",59,0)
S1 ;
"RTN","PSGEUD",60,0)
 W $C(48) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",61,0)
 E  Q
"RTN","PSGEUD",62,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",63,0)
 Q
"RTN","PSGEUD",64,0)
 ;
"RTN","PSGEUD",65,0)
S2 ;
"RTN","PSGEUD",66,0)
 W $C(48) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",67,0)
 E  Q
"RTN","PSGEUD",68,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13) F Q=1:1:75 R X:$S(Q<15:1,1:5) G:$A(X)=49 S2 I $A(X)=48 Q
"RTN","PSGEUD",69,0)
 Q
"RTN","PSGEUD",70,0)
 ;
"RTN","PSGEUD",71,0)
S3 ;Added ! to clear WR buffer for network channel
"RTN","PSGEUD",72,0)
 W $C(48),! F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",73,0)
 E  Q
"RTN","PSGEUD",74,0)
 W $C(50),$C(52),PN_PID_PL_"IMD"_PSGEUDA_"1 ",$C(53),$C(54),C,$C(55),$C(13),! F Q=1:1:75 R *X:$S(Q<15:1,1:5) G:X=49 S1 I X=48 Q
"RTN","PSGEUD",75,0)
 Q
"RTN","PSGEUD",76,0)
 ;
"RTN","PSGEUD",77,0)
QSH ;
"RTN","PSGEUD",78,0)
 W !!?2,"This drug can be dispensed through the ATC machine.  Enter 'Y' to do so now.  Enter 'N' if you do not want to do so.",! Q
"RTN","PSGEUD",79,0)
 ;
"RTN","PSGEUD",80,0)
H ;
"RTN","PSGEUD",81,0)
 W !!?2,"Select the orders (by number) for which you want to enter extra units",!,"dispensed." D:X'="?" H2^PSGON
"RTN","PSGEUD",82,0)
 Q
"RTN","PSGSICH")
0^3^B43620389^B43509537
"RTN","PSGSICH",1,0)
PSGSICH ;BIR/JCH-PROVIDER & PHARMACY OVERRIDE UTILITIES ; 08/19/11 1:02pm
"RTN","PSGSICH",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**254,304**;16 DEC 97;Build 22
"RTN","PSGSICH",3,0)
 ;
"RTN","PSGSICH",4,0)
 ; Reference to ^APSPQA(32.4 is supported by DBIA #2179
"RTN","PSGSICH",5,0)
 ;
"RTN","PSGSICH",6,0)
NAME(TMPDUZ,NAME,INIT) ;
"RTN","PSGSICH",7,0)
 ;TMPDUZ = IEN or Name in VA(200
"RTN","PSGSICH",8,0)
 ;NAME = Return IEN in VA(200
"RTN","PSGSICH",9,0)
 ;INIT = Return the initial
"RTN","PSGSICH",10,0)
 NEW IEN,DIC,Y,X S X=TMPDUZ
"RTN","PSGSICH",11,0)
 S DIC="^VA(200,",DIC(0)="NZ" D ^DIC
"RTN","PSGSICH",12,0)
 S IEN=+Y,NAME=$G(Y(0,0)),INIT=$P($G(Y(0)),U,2)
"RTN","PSGSICH",13,0)
 Q
"RTN","PSGSICH",14,0)
 ;
"RTN","PSGSICH",15,0)
HLD ; Prompt user to continue or exit
"RTN","PSGSICH",16,0)
 K DIR
"RTN","PSGSICH",17,0)
 S DIR(0)="E",DIR("A")="Press RETURN to Continue or '^' to Exit "
"RTN","PSGSICH",18,0)
 D ^DIR K DIR I 'Y S PSJQUITD=1
"RTN","PSGSICH",19,0)
 W @IOF
"RTN","PSGSICH",20,0)
 Q
"RTN","PSGSICH",21,0)
 ; 
"RTN","PSGSICH",22,0)
ORDEXIST(PSGP,PSGORD) ; Has order been filed?
"RTN","PSGSICH",23,0)
 Q:'$G(PSGP) 0
"RTN","PSGSICH",24,0)
 I $G(PSGORD)["P",$D(^PS(53.1,+PSGORD,0)) Q 1
"RTN","PSGSICH",25,0)
 I $G(PSGORD)["U",$D(^PS(55,PSGP,5,+PSGORD,0)) Q 1
"RTN","PSGSICH",26,0)
 I $G(PSGORD)["V",$D(^PS(55,PSGP,"IV",+PSGORD,0)) Q 1
"RTN","PSGSICH",27,0)
 Q 0
"RTN","PSGSICH",28,0)
 ;
"RTN","PSGSICH",29,0)
OROICHK(DFN,ORDER,PSJOVRAR) ; Find the CPRS order number associated with the last Orderable Item edit
"RTN","PSGSICH",30,0)
 N OCI,TMPOI,CURROI,TMPORDER,PSJOCDT K CURRCPRS
"RTN","PSGSICH",31,0)
 I '$G(DFN)!'$G(ORDER) Q 0
"RTN","PSGSICH",32,0)
 S CURROI=$S(ORDER["P":+$G(^PS(53.1,+ORDER,.2)),ORDER["U":+$G(^PS(55,DFN,5,+ORDER,.2)),ORDER["V":+$G(^PS(55,DFN,"IV",+ORDER,.2)),1:"")
"RTN","PSGSICH",33,0)
 Q:'CURROI 0
"RTN","PSGSICH",34,0)
 S PSJOCDT="" F  S PSJOCDT=$O(PSJOVRAR(DFN,ORDER,PSJOCDT),-1) Q:PSJOCDT=""!$G(CURRCPRS)  S OCI="" F  S OCI=$O(PSJOVRAR(DFN,ORDER,PSJOCDT,OCI)) Q:'OCI!$G(CURRCPRS)  S TMPORDER=$G(PSJOVRAR(DFN,ORDER,PSJOCDT,OCI)) I TMPORDER D
"RTN","PSGSICH",35,0)
 .S TMPOI=$S(TMPORDER["P":+$G(^PS(53.1,+TMPORDER,.2)),TMPORDER["U":+$G(^PS(55,DFN,5,+TMPORDER,.2)),ORDER["V":+$G(^PS(55,DFN,"IV",+TMPORDER,.2)),1:"")
"RTN","PSGSICH",36,0)
 .Q:'TMPOI  I TMPOI'=CURROI S CURRCPRS=$S(TMPORDER["P":$P($G(^PS(53.1,+TMPORDER,0)),"^",21),TMPORDER["U":$P($G(^PS(55,DFN,5,+TMPORDER,0)),"^",21),TMPORDER["V":$P($G(^PS(55,DFN,"IV",+TMPORDER,0)),"^",21),1:"")
"RTN","PSGSICH",37,0)
 Q +$G(CURRCPRS)
"RTN","PSGSICH",38,0)
 ;
"RTN","PSGSICH",39,0)
ONEINTER(INTER,PSJORDER,PSJIDTM,OUTARRAY) ; Accept one intervention IEN and return OUTARRAY with formatted intervention information
"RTN","PSGSICH",40,0)
 ; INPUT: INTER = Intervention IEN from ^APSPQA(32.4
"RTN","PSGSICH",41,0)
 ;     PSJORDER = Inpatient Order
"RTN","PSGSICH",42,0)
 ;      PSJIDTM = Order Date/Time
"RTN","PSGSICH",43,0)
 ;     OUTARRAY = Array containing CPRS overrides and pharmacy interventions 
"RTN","PSGSICH",44,0)
 Q:'$G(INTER)  Q:'$D(^APSPQA(32.4,+INTER))
"RTN","PSGSICH",45,0)
 D INTRDICO^PSGSICH2(+INTER)
"RTN","PSGSICH",46,0)
 S INT=0 F  S INT=$O(^UTILITY("DIQ1",$J,9009032.4,INT)) Q:'INT  D INTROUT^PSGSICH2(INT,PSJIDTM,$S($G(PSJORDER):PSJORDER,1:0),.OUTARRAY)
"RTN","PSGSICH",47,0)
 K ^UTILITY("DIQ1",$J)
"RTN","PSGSICH",48,0)
 Q
"RTN","PSGSICH",49,0)
 ;
"RTN","PSGSICH",50,0)
CHKADD(PSJINTER,PSGP,PSJIVORN) ; Check for existence of Intervention Orderable Item in IV Additives
"RTN","PSGSICH",51,0)
 N NXTADD,PSJINTOK,ADDOI,DIC,DR,DA,NXTSOL,SOLOI
"RTN","PSGSICH",52,0)
 Q:'$G(PSJINTER) 1
"RTN","PSGSICH",53,0)
 K ^UTILITY("DIQ1",$J,9009032.4) S DIC="^APSPQA(32.4,",DR=".05",DA=PSJINTER,DIQ(0)="I" D EN^DIQ1
"RTN","PSGSICH",54,0)
 S PSJINTOI=$G(^UTILITY("DIQ1",$J,9009032.4,PSJINTER,.05,"I")),PSJINTOI=+$G(^PSDRUG(+PSJINTOI,2)) K ^UTILITY("DIQ1",$J,9009032.4)
"RTN","PSGSICH",55,0)
 I 'PSJINTOI Q 1
"RTN","PSGSICH",56,0)
 I PSJIVORN["V" S NXTADD=0 F  S NXTADD=$O(^PS(55,PSGP,"IV",+PSJIVORN,"AD",NXTADD)) Q:'NXTADD!$G(PSJINTOK)  D
"RTN","PSGSICH",57,0)
 .N ADDIEN S ADDIEN=+$G(^PS(55,PSGP,"IV",+PSJIVORN,"AD",NXTADD,0))
"RTN","PSGSICH",58,0)
 .S ADDOI=$P($G(^PS(52.6,+ADDIEN,0)),"^",11) I ADDOI=PSJINTOI S PSJINTOK=1
"RTN","PSGSICH",59,0)
 I PSJIVORN["V",'$G(PSJINTOK) S NXTSOL=0 F  S NXTSOL=$O(^PS(55,PSGP,"IV",+PSJIVORN,"SOL",NXTSOL)) Q:'NXTSOL!$G(PSJINTOK)  D
"RTN","PSGSICH",60,0)
 .N SOLIEN S SOLIEN=+$G(^PS(55,PSGP,"IV",+PSJIVORN,"SOL",NXTSOL,0))
"RTN","PSGSICH",61,0)
 .S SOLOI=$P($G(^PS(52.7,+SOLIEN,0)),"^",11) I SOLOI=PSJINTOI S PSJINTOK=1
"RTN","PSGSICH",62,0)
 I PSJIVORN["P" S NXTADD=0 F  S NXTADD=$O(^PS(53.1,+PSJIVORN,"AD",NXTADD)) Q:'NXTADD!$G(PSJINTOK)  D
"RTN","PSGSICH",63,0)
 .N ADDIEN S ADDIEN=+$G(^PS(53.1,+PSJIVORN,"AD",NXTADD,0))
"RTN","PSGSICH",64,0)
 .S ADDOI=$P($G(^PS(52.6,+ADDIEN,0)),"^",11) I ADDOI=PSJINTOI S PSJINTOK=1
"RTN","PSGSICH",65,0)
 I PSJIVORN["P",'$G(PSJINTOK) S NXTSOL=0 F  S NXTSOL=$O(^PS(53.1,+PSJIVORN,"SOL",NXTSOL)) Q:'NXTSOL!$G(PSJINTOK)  D
"RTN","PSGSICH",66,0)
 .N SOLIEN S SOLIEN=+$G(^PS(53.1,+PSJIVORN,"SOL",NXTSOL,0))
"RTN","PSGSICH",67,0)
 .S SOLOI=$P($G(^PS(52.7,+SOLIEN,0)),"^",11) I SOLOI=PSJINTOI S PSJINTOK=1
"RTN","PSGSICH",68,0)
 Q $S($G(PSJINTOK):1,1:0)
"RTN","PSGSICH",69,0)
 ;
"RTN","PSGSICH",70,0)
SETIVIN2(PSJI1,PSJI2) ; Store Intervention pointers in the IV Intervention multiple
"RTN","PSGSICH",71,0)
 N PSJOLDOI,PSJNEWOI,DINUM,PSJICNT,PSJINTDT
"RTN","PSGSICH",72,0)
 Q:'$G(DFN)
"RTN","PSGSICH",73,0)
 I $D(^TMP("PSJINTER",$J)) D STOREINT^PSGSICH1 K ^TMP("PSJINTER",$J) Q
"RTN","PSGSICH",74,0)
 I ($G(PSJI1)["P"),$G(PSJI2)["V" I $O(^PS(53.1,+$G(PSJI1),11,0)) D  Q
"RTN","PSGSICH",75,0)
 .S PSJNEWOI=+$G(^PS(55,DFN,"IV",+PSJI2,.2)),PSJOLDOI=+$G(^PS(53.1,+PSJI1,.2)) Q:'PSJNEWOI  Q:(PSJNEWOI'=PSJOLDOI)
"RTN","PSGSICH",76,0)
 .N PSJINCNT,PSJNXTI,PSJINTER,DO K DA,DIC S PSJINCNT=+$P($G(^PS(55,DFN,"IV",+PSJI2,8,0)),"^",3)
"RTN","PSGSICH",77,0)
 .S PSJNXTI="B" F  S PSJNXTI=$O(^PS(53.1,+$G(PSJI1),11,PSJNXTI),-1) Q:'PSJNXTI  D
"RTN","PSGSICH",78,0)
 ..S PSJINTER=$G(^PS(53.1,+$G(PSJI1),11,PSJNXTI,0)) Q:'PSJINTER  Q:$D(^PS(55,DFN,"IV",+$G(PSJI2),8,"B",+PSJINTER))
"RTN","PSGSICH",79,0)
 ..S PSJICNT=$G(PSJICNT)+1 I PSJICNT=1 S PSJINTDT=$P(PSJINTER,"^",2)
"RTN","PSGSICH",80,0)
 ..I $G(PSJINTDT) Q:(PSJINTDT'=$P(PSJINTER,"^",2))
"RTN","PSGSICH",81,0)
 ..Q:'$$CHKADD(+PSJINTER,DFN,PSJI2)
"RTN","PSGSICH",82,0)
 ..S PSJINCNT=$G(PSJINCNT)+1
"RTN","PSGSICH",83,0)
 ..S DIC="^PS(55,"_+DFN_",""IV"","_+PSJI2_",8,",DIC(0)="L",DIC("P")="55.1153PA",DA(1)=+PSJI2,DA(2)=DFN,(DINUM,X)=+PSJINCNT
"RTN","PSGSICH",84,0)
 ..S DIC("DR")=".01////"_+PSJINTER_";1////"_$P(PSJINTER,"^",2)_";" D FILE^DICN
"RTN","PSGSICH",85,0)
 .K DIC,DA
"RTN","PSGSICH",86,0)
 I ($G(PSJI1)["V"),($G(PSJI2)["P") I $O(^PS(55,DFN,"IV",+PSJI1,8,0)) D  Q
"RTN","PSGSICH",87,0)
 .S PSJOLDOI=+$G(^PS(55,DFN,"IV",+PSJI1,.2)),PSJNEWOI=+$G(^PS(53.1,+PSJI2,.2)) I $G(PSJNEWOI)  Q:(PSJNEWOI'=PSJOLDOI)
"RTN","PSGSICH",88,0)
 .N PSJINCNT,PSJNXTI,PSJINTER K DA,DIC S PSJINCNT=+$P($G(^PS(53.1,+PSJI2,11,0)),"^",3)
"RTN","PSGSICH",89,0)
 .S PSJNXTI="B" F  S PSJNXTI=$O(^PS(55,DFN,"IV",+$G(PSJI1),8,PSJNXTI),-1) Q:'PSJNXTI  D
"RTN","PSGSICH",90,0)
 ..S PSJINTER=$G(^PS(55,DFN,"IV",+$G(PSJI1),8,PSJNXTI,0)) Q:'PSJINTER  Q:$D(^PS(53.1,+PSJI2,11,"B",+PSJINTER))
"RTN","PSGSICH",91,0)
 ..S PSJICNT=$G(PSJICNT)+1 I PSJICNT=1 S PSJINTDT=$P(PSJINTER,"^",2)
"RTN","PSGSICH",92,0)
 ..I $G(PSJINTDT) Q:(PSJINTDT'=$P(PSJINTER,"^",2))
"RTN","PSGSICH",93,0)
 ..I $D(^PS(53.1,+PSJI2,"AD")) Q:'$$CHKADD(+PSJINTER,DFN,PSJI2)
"RTN","PSGSICH",94,0)
 ..N IC,IG S (IG,IC)=0 F  Q:$G(IG)  S IC=$O(^PS(53.1,+PSJI2,11,IC)) Q:'IC!$G(IG)  S:(+$G(^PS(53.1,+PSJI2,11,IC,0))=+PSJINTER) IG=1
"RTN","PSGSICH",95,0)
 ..Q:$G(IG)  S PSJINCNT=$G(PSJINCNT)+1 S DIC="^PS(53.1,"_+PSJI2_",11,",DIC(0)="L",DIC("P")="53.13PA",DA(2)=+PSJI2,X=+PSJINTER,(DINUM,DA(1))=+PSJINCNT
"RTN","PSGSICH",96,0)
 ..S DIC("DR")=".01////"_+PSJINTER_";1////"_$P(PSJINTER,"^",2)_";" D FILE^DICN
"RTN","PSGSICH",97,0)
 I ($G(PSJI1)["P"),($G(PSJI2)["P") I $O(^PS(53.1,+PSJI1,11,0)) D  Q
"RTN","PSGSICH",98,0)
 .S PSJOLDOI=+$G(^PS(53.1,+PSJI1,.2)),PSJNEWOI=+$G(^PS(53.1,+PSJI2,.2)) I $G(PSJNEWOI)  Q:(PSJNEWOI'=PSJOLDOI)
"RTN","PSGSICH",99,0)
 .I PSJI1=PSJI2 Q:$G(ON)'["P"  Q:'$D(^PS(53.1,+ON,0))  S PSJI2=ON
"RTN","PSGSICH",100,0)
 .N PSJINCNT,PSJNXTI,PSJINTER K DA,DIC S PSJINCNT=+$P($G(^PS(53.1,+PSJI2,11,0)),"^",3)
"RTN","PSGSICH",101,0)
 .S PSJNXTI="B" F  S PSJNXTI=$O(^PS(53.1,+PSJI1,11,PSJNXTI),-1) Q:'PSJNXTI  D
"RTN","PSGSICH",102,0)
 ..S PSJINTER=$G(^PS(53.1,+PSJI1,11,PSJNXTI,0)) Q:'PSJINTER  Q:$D(^PS(53.1,+PSJI2,"B",+PSJINTER))
"RTN","PSGSICH",103,0)
 ..S PSJICNT=$G(PSJICNT)+1 I PSJICNT=1 S PSJINTDT=$P(PSJINTER,"^",2)
"RTN","PSGSICH",104,0)
 ..I $G(PSJINTDT) Q:(PSJINTDT'=$P(PSJINTER,"^",2))
"RTN","PSGSICH",105,0)
 ..I $D(^PS(53.1,+PSJI2,"AD")) Q:'$$CHKADD(PSJINTER,DFN,PSJI2)
"RTN","PSGSICH",106,0)
 ..N IC,IG S (IG,IC)=0 F  Q:$G(IG)  S IC=$O(^PS(53.1,+PSJI2,11,IC)) Q:'IC!$G(IG)  S:(+$G(^PS(53.1,+PSJI2,11,IC,0))=+PSJINTER) IG=1
"RTN","PSGSICH",107,0)
 ..Q:$G(IG)  Q:$D(^PS(53.1,+PSJI2,11,"B",+PSJINTER))  S PSJINCNT=$G(PSJINCNT)+1
"RTN","PSGSICH",108,0)
 ..S DIC="^PS(53.1,"_+PSJI2_",11,",DIC(0)="L",DIC("P")="53.13PA",DA(2)=+PSJI2,X=+PSJINTER,(DINUM,DA(1))=+PSJINCNT
"RTN","PSGSICH",109,0)
 ..S DIC("DR")=".01////"_+PSJINTER_";1////"_$P(PSJINTER,"^",2)_";" K DO D FILE^DICN K DO
"RTN","PSGSICH",110,0)
 Q
"RTN","PSGVBW")
0^5^B97694806^B97529412
"RTN","PSGVBW",1,0)
PSGVBW ;BIR/CML3,MV - VERIFY ORDERS BY WARD, WARD GROUP, PATIENT, OR PRIORITY ;10/22/98 3:14 PM
"RTN","PSGVBW",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**5,16,39,59,62,67,58,81,80,110,111,133,139,155,241,243,265,275,304**;DEC 16, 1997;Build 22
"RTN","PSGVBW",3,0)
 ;
"RTN","PSGVBW",4,0)
 ; Reference to ^PS(55 is supported by DBIA #2191
"RTN","PSGVBW",5,0)
 ; Reference to ^PS(51.1 is supported by DBIA #2177
"RTN","PSGVBW",6,0)
 ; Reference to ^DPT is supported by DBIA #10035
"RTN","PSGVBW",7,0)
 ;
"RTN","PSGVBW",8,0)
 N PSJNEW,PSGPTMP,PPAGE,CL,CG S PSJNEW=1
"RTN","PSGVBW",9,0)
START ; Lookup patient by ward group, ward, priority, or patient; depending on value of PSGSS
"RTN","PSGVBW",10,0)
 ; 
"RTN","PSGVBW",11,0)
 D ENCV^PSGSETU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",12,0)
 D ^PSIVXU I $D(XQUIT) K XQUIT Q
"RTN","PSGVBW",13,0)
 D NOW^%DTC S PSGDT=%
"RTN","PSGVBW",14,0)
 I '$D(^XTMP("PSJPVNV")) D
"RTN","PSGVBW",15,0)
 .K DIR S DIR(0)="Y",DIR("A")="Display an Order Summary",DIR("B")="NO"
"RTN","PSGVBW",16,0)
 .S DIR("?",1)="Enter 'YES' to see a summary of orders by type and ward group",DIR("?")="or 'NO' to go directly to patient selection."
"RTN","PSGVBW",17,0)
 .D ^DIR K DIR Q:$D(DIRUT)!$D(DUOUT)  I Y D CNTORDRS^PSGVBWU
"RTN","PSGVBW",18,0)
 K ^TMP("PSJ",$J) S PSGPXN=0 D GTOOP G:$D(DIRUT) DONE L +^PS(53.45,PSJSYSP):1 E  D LOCKERR^PSJOE G DONE
"RTN","PSGVBW",19,0)
 S PSGSSH="VBW",PSGPXN=0,PSJPROT=$S($P(PSJSYSU,";",3)=3:3,$G(PSJRNF):3,$G(PSJIRNF):3,1:1)
"RTN","PSGVBW",20,0)
 S PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING")
"RTN","PSGVBW",21,0)
 F  K ^TMP("PSJSELECT",$J) D PRI^PSGSEL Q:"^"[PSGSS  F  S (PSGP,WD,WG)=0 S PSGPTMP=0,PPAGE=1 K PSGPRIF D @PSGSS Q:+Y'>0  D GO
"RTN","PSGVBW",22,0)
 ;
"RTN","PSGVBW",23,0)
DONE ; Cleanup
"RTN","PSGVBW",24,0)
 D DONE2
"RTN","PSGVBW",25,0)
 K SETWDN,PTPRI,SETTM,SETPN,SUBS,TMPWD,STATUS
"RTN","PSGVBW",26,0)
 K CHK,D0,DRGI,FQC,J,ND,ON,PN,PSGODT,PSGOEA,PSGOP,PSGSS,PSGSSH,RB,SD,ST,TM,WD,WDN,WG,PRI,PSJPNV,PSJCT,PSGCLF,PSGPRIF,LIDT,WDNAME,IFPRI
"RTN","PSGVBW",27,0)
 K PSGODDD,PSGOEORF,PSJORL,PSJORPCL,PSJORTOU,PSJORVP,PSGTOL,PSJTOO,PSGUOW,PSGONV,PX,PSGOEAV,PSGPX,PSGVBWTO,PSGVBWW,PSJOPC,PSGOENOF,PSJPROT,PSJLM,PSJASK
"RTN","PSGVBW",28,0)
 K PSJPAC,PSJINDEX,PSJCNT,PSIVSN,PSGWORP1,PSGWORP2,PSGVBY,PSGVBWN,PSGVBTM,PSGVBPN,PSGPXN,PSGPRIN,PSGPRD,PSGINWD,PSGINCL,PRDON,PRDNS,PRD,PPN,ORDT
"RTN","PSGVBW",29,0)
 L -^PS(53.45,PSJSYSP) G:$G(PSGPXN) ^PSGPER1 D ENKV^PSGSETU K ND Q
"RTN","PSGVBW",30,0)
 ;
"RTN","PSGVBW",31,0)
DONE2 ; Partial Cleanup
"RTN","PSGVBW",32,0)
 K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J),^TMP("PSGVBW3",$J),^TMP("PSJSELECT",$J),^TMP("PSJLIST",$J),^TMP("PSJON",$J)
"RTN","PSGVBW",33,0)
 K PRD
"RTN","PSGVBW",34,0)
 Q
"RTN","PSGVBW",35,0)
 ;
"RTN","PSGVBW",36,0)
GO ; Find and display matching patients
"RTN","PSGVBW",37,0)
 I PSGSS'="P" W !,"...a few moments, please..." K ^TMP("PSGVBW",$J),^TMP("PSGVBW2",$J) D ARRAY K CHK,ON,PN,RB,SD,TM,WD,WDN,WG,X,Y
"RTN","PSGVBW",38,0)
 I PSGSS'="P",'$D(^TMP("PSGVBW",$J)) W !,$C(7),"NO ",PSGVBWW," ORDERS FOR ",$S(PSGSS="P":"PATIENT",PSGSS="L":"CLINIC GROUP",PSGSS="C":"CLINIC",PSGSS="PR":"PRIORITY",1:"WARD"),$S(PSGSS="G":" GROUP",1:"")," SELECTED." Q
"RTN","PSGVBW",39,0)
 D ^PSGVBW0,DONE2 Q
"RTN","PSGVBW",40,0)
 ;
"RTN","PSGVBW",41,0)
G ; Select a Ward Group
"RTN","PSGVBW",42,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD GROUP: "
"RTN","PSGVBW",43,0)
 S DIR("?")="^D GDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",44,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",45,0)
GDIC ; Ward Group lookup
"RTN","PSGVBW",46,0)
 K DIC S DIC="^PS(57.5,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 WG=+Y
"RTN","PSGVBW",47,0)
 W:X["?" !!,"Enter ""^OTHER"" to include all orders from the wards that do not",!,"belong to a ward group, or orders that have neither a ward nor a clinic.",! ;PSJ*5*241: Updated help text
"RTN","PSGVBW",48,0)
 Q
"RTN","PSGVBW",49,0)
C ; Select a Clinic
"RTN","PSGVBW",50,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC: "
"RTN","PSGVBW",51,0)
 S DIR("?")="^D CDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",52,0)
CDIC ; Clinic lookup
"RTN","PSGVBW",53,0)
 K DIC S DIC="^SC(",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 CL=+Y
"RTN","PSGVBW",54,0)
 W:X["?" !!,"Enter the clinic you want to use to select patients for processing.",!
"RTN","PSGVBW",55,0)
 Q
"RTN","PSGVBW",56,0)
L ; Select a Clinic Group
"RTN","PSGVBW",57,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select CLINIC GROUP: "
"RTN","PSGVBW",58,0)
 S DIR("?")="^D LDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",59,0)
LDIC ; Clinic Group lookup
"RTN","PSGVBW",60,0)
 K DIC S DIC="^PS(57.8,",DIC(0)="QEMI" D ^DIC K DIC S:+Y>0 CG=+Y
"RTN","PSGVBW",61,0)
 W:X["?" !!,"Enter the name of the clinic group you want to use to select patients for processing."
"RTN","PSGVBW",62,0)
 Q
"RTN","PSGVBW",63,0)
W ; Select a Ward
"RTN","PSGVBW",64,0)
 K DIR S DIR(0)="FAO",DIR("A")="Select WARD: "
"RTN","PSGVBW",65,0)
 S DIR("?")="^D WDIC^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",66,0)
 I Y="^OTHER" D OUTPT^PSGVBW1 Q
"RTN","PSGVBW",67,0)
WDIC ; Ward lookup
"RTN","PSGVBW",68,0)
 K DIC S DIC="^DIC(42,",DIC(0)="QEMIZ" D ^DIC K DIC S:+Y>0 WD=+Y
"RTN","PSGVBW",69,0)
 W:X["?" !!,"Enter ""^OTHER"" for Outpatient IV orders",!
"RTN","PSGVBW",70,0)
 Q
"RTN","PSGVBW",71,0)
PR ; Select order priority
"RTN","PSGVBW",72,0)
 K DIR S DIR(0)="SO^1:STAT;2:ASAP;3:ROUTINE"
"RTN","PSGVBW",73,0)
 S DIR("A")="Select 1-3 ",DIR("?")="        Choose a Priority."
"RTN","PSGVBW",74,0)
 S DIR("?",1)="Enter a PRIORITY to include all patients with orders containing that PRIORITY"
"RTN","PSGVBW",75,0)
 D ^DIR S:Y>0 PRD=+Y S:+Y>0 WDN=$S(PRD=1:"STAT",PRD=2:"ASAP",3:"ROUTINE")
"RTN","PSGVBW",76,0)
 Q
"RTN","PSGVBW",77,0)
P ; Select patient
"RTN","PSGVBW",78,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1 F  D ^PSJP Q:PSGP<0  D
"RTN","PSGVBW",79,0)
 .S PSJNV=0
"RTN","PSGVBW",80,0)
 .NEW ON,XX F ON=0:0 S ON=$O(^PS(53.1,"AS","N",PSGP,ON)) Q:'ON  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX S PSJNV=1 Q
"RTN","PSGVBW",81,0)
 .;S PSJNV=$O(^PS(53.1,"AS","N",+PSGP,0)),PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",82,0)
 .S PSJPEN=$O(^PS(53.1,"AS","P",+PSGP,0))
"RTN","PSGVBW",83,0)
 .I 'PSJNV D ^PSJAC D
"RTN","PSGVBW",84,0)
 ..I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",85,0)
 ..S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",86,0)
 ..I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD!PSJNV  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  S PSJNV=1 Q
"RTN","PSGVBW",87,0)
 ..I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD!(SD'=+SD)  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D" D IFT2 I  S PSJNV=1 Q
"RTN","PSGVBW",88,0)
 .S X=$S(PSJTOO=1:PSJNV,PSJTOO=2:PSJPEN,1:(PSJNV+PSJPEN))
"RTN","PSGVBW",89,0)
 .I X D SETPN S ^TMP("PSJSELECT",$J,PSJCNT)=PN,^TMP("PSJSELECT",$J,"B",$P(PN,U),PSJCNT)="",PSJCNT=PSJCNT+1 Q
"RTN","PSGVBW",90,0)
 .W !,"No ",PSGVBWW," orders found for this patient."
"RTN","PSGVBW",91,0)
 S:$D(^TMP("PSJSELECT",$J)) Y=1
"RTN","PSGVBW",92,0)
 Q
"RTN","PSGVBW",93,0)
ARRAY ; put patient(s) with non-verified orders into array
"RTN","PSGVBW",94,0)
 I '$D(PSGDT) D NOW^%DTC S PSGDT=$E(%,1,12)
"RTN","PSGVBW",95,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1),PSGVBWW=$S(PSJTOO=1:"NON-VERIFIED",PSJTOO=2:"PENDING",1:"NON-VERIFIED AND/OR PENDING") I PSGSS="P" D IF S:$T ^TMP("PSGVBW",$J)=$P(PSGP(0),"^")_"^"_PSGP Q
"RTN","PSGVBW",96,0)
 G CG:PSGSS="L",CL:PSGSS="C",WD:PSGSS="W",PRI:PSGSS="PR" S WD=0 F  S WD=$O(^PS(57.5,"AC",WG,WD)) Q:'WD  D WD
"RTN","PSGVBW",97,0)
 Q
"RTN","PSGVBW",98,0)
 ;
"RTN","PSGVBW",99,0)
CG ; Find all clinics in selected clinic group
"RTN","PSGVBW",100,0)
 S CL="" F  S CL=$O(^PS(57.8,"AD",CG,CL)) Q:CL=""  D CL
"RTN","PSGVBW",101,0)
 Q
"RTN","PSGVBW",102,0)
CL ; Find all patients in selected clinic
"RTN","PSGVBW",103,0)
 S WDN=$S($D(^SC(CL,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",104,0)
 S PSGP="",PSGCLF=1 F  S PSGP=$O(^PS(53.1,"AD",CL,PSGP)) Q:PSGP=""  D ^PSJAC,IF
"RTN","PSGVBW",105,0)
 K PSGCLF
"RTN","PSGVBW",106,0)
 Q
"RTN","PSGVBW",107,0)
WD ; Find all patients in selected ward
"RTN","PSGVBW",108,0)
 S WDN=$S($D(^DIC(42,WD,0)):$P(^(0),"^"),1:"")
"RTN","PSGVBW",109,0)
 I WDN]"" S PSGP=0 F  S PSGP=$O(^DPT("CN",WDN,PSGP)) Q:'PSGP  D
"RTN","PSGVBW",110,0)
 .I $S($D(^PS(55,"APV",PSGP)):1,$D(^PS(55,"APIV",PSGP)):1,$O(^PS(55,PSGP,5,"AUS",PSGDT)):1,1:$D(^PS(53.1,"AC",PSGP))) D ^PSJAC,IF
"RTN","PSGVBW",111,0)
 Q
"RTN","PSGVBW",112,0)
PRI ; Find orders with selected Priority
"RTN","PSGVBW",113,0)
 ; Once a patient is identified in any status index ("I", "N", or "P"), all orders for that patient are checked in the 
"RTN","PSGVBW",114,0)
 ; IF subroutine. To prevent unnecessary duplication of processing, "PSGVBW3" node of ^TMP, sorted by patient, will be 
"RTN","PSGVBW",115,0)
 ; set when a patient's orders are processed, and checked for each status index. If patient exists in the "PSGVBW3" node,
"RTN","PSGVBW",116,0)
 ; patient has already been processed, so quit.
"RTN","PSGVBW",117,0)
 N NDP2,PSGALL,ND0,PSGPRIFZ K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",118,0)
 S PSGPRIF=1 F STATUS="I","N","P" S PSGP=0 F  S PSGP=$O(^PS(53.1,"AS",STATUS,PSGP)) Q:'PSGP  Q:($D(^TMP("PSGVBW3",$J,PSGP)))  D ^PSJAC,IF
"RTN","PSGVBW",119,0)
 K ^TMP("PSGVBW3",$J)
"RTN","PSGVBW",120,0)
 Q
"RTN","PSGVBW",121,0)
IF ;BHW;PSJ*5*155;Added PSGCLF and PS(53.1,"AD" Check below.  If called from CL subroutine and the order Doesn't exist for that Clinic, then QUIT.;PSJ*5*241:Changed quit conditions
"RTN","PSGVBW",122,0)
 W "." I PSJTOO'=1 S ON=0 F  S ON=$O(^PS(53.1,"AS","P",PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  D
"RTN","PSGVBW",123,0)
 .Q:(($G(PSGCLF))&('$D(^PS(53.1,"AD",+$G(CL),PSGP,+$G(ON)))))  ;PSJ*5*265 - move quit condition inside loop
"RTN","PSGVBW",124,0)
 .S X=$P($G(^PS(53.1,ON,0)),U,4),IFPRI=0,Y=0 I "FIU"[X D  D:Y SET
"RTN","PSGVBW",125,0)
 ..I $G(PSGPRIF) D  Q:'IFPRI
"RTN","PSGVBW",126,0)
 ...N PRIO S PRIO=$P($G(^PS(53.1,+ON,.2)),"^",4),PRIO=$S(PRIO="S":1,PRIO="A":2,1:3) S IFPRI=$S(PRD=PRIO:1,1:"")
"RTN","PSGVBW",127,0)
 ..I PSJPAC=3 S Y=1 Q
"RTN","PSGVBW",128,0)
 ..I PSJPAC=2 S Y=X'="U" Q
"RTN","PSGVBW",129,0)
 ..I PSJPAC=1 S Y=X="U"
"RTN","PSGVBW",130,0)
 I PSJTOO=2 D  Q
"RTN","PSGVBW",131,0)
 .I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",132,0)
 F X="N","I" I $D(^PS(53.1,"AS",X,PSGP)) NEW XX S XX=0 D  I XX D SET K ON
"RTN","PSGVBW",133,0)
 . NEW PRIOAR F ON=0:0 S ON=$O(^PS(53.1,"AS",X,PSGP,ON)) Q:'ON!(($G(WDN)="ZZ")&(+$P($G(^PS(53.1,+$G(ON),"DSS")),U,1)'=0))  S ND=$P($G(^PS(53.1,ON,0)),U,4) S XX=$S(ND="U"&(PSJPAC'=2):1,ND'="U"&(PSJPAC'=1):1,1:0) I XX D  Q:($G(PRD)&$G(XX))
"RTN","PSGVBW",134,0)
 .. S PRIOAR=$P($G(^PS(53.1,+$G(ON),.2)),U,4) S PRIOAR=$S(PRIOAR="S":"S",PRIOAR="A":"A",1:"R")
"RTN","PSGVBW",135,0)
 .. I $G(PRD) S XX=$S(PRD=1&(PRIOAR="S"):1,PRD=2&(PRIOAR="A"):1,PRD=3&(PRIOAR="R"):1,1:0) Q
"RTN","PSGVBW",136,0)
 .. S PRIOAR(PRIOAR)=ON
"RTN","PSGVBW",137,0)
 . Q:$G(PRD)  S ON=$S($G(PRIOAR("S")):PRIOAR("S"),$G(PRIOAR("A")):PRIOAR("A"),1:$G(PRIOAR("R")))
"RTN","PSGVBW",138,0)
 S X1=$P(PSGDT,"."),X2=-2 D C^%DTC S PSGODT=X_(PSGDT#1)
"RTN","PSGVBW",139,0)
 I PSJPAC'=2 F ST="C","O","OC","P","R" F SD=$S(ST="O":PSJPAD,1:PSGODT):0 S SD=$O(^PS(55,PSGP,5,"AU",ST,SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,5,"AU",ST,SD,ON)) Q:'ON  I $D(^PS(55,PSGP,5,ON,0)),$P(^(0),"^",9)'["D" D IFT I  D SET
"RTN","PSGVBW",140,0)
 ;*PSJ*5*241:Expired IV orders must be one-time
"RTN","PSGVBW",141,0)
 I PSJPAC'=1 F SD=+PSJPAD:0 S SD=$O(^PS(55,PSGP,"IV","AIS",SD)) Q:'SD  F ON=0:0 S ON=$O(^PS(55,PSGP,"IV","AIS",SD,ON)) Q:'ON  D
"RTN","PSGVBW",142,0)
 .N SCH,STYPE S STYPE=0,SCH=$P($G(^PS(55,PSGP,"IV",ON,0)),U,9)
"RTN","PSGVBW",143,0)
 .S:SCH]"" SCH=$O(^PS(51.1,"APPSJ",SCH,STYPE)) S:SCH]"" STYPE=$P($G(^PS(51.1,SCH,0)),U,5)
"RTN","PSGVBW",144,0)
 .I $D(^PS(55,PSGP,"IV",ON,0)),$P(^(0),"^",17)'["D",'(($P(^(0),"^",17)="E")&($G(STYPE)'="O")) D IFT2 I  D SET
"RTN","PSGVBW",145,0)
 I '$G(PSGPRIF),$D(^TMP("PSGVBW2",$J)) D SET2
"RTN","PSGVBW",146,0)
 Q
"RTN","PSGVBW",147,0)
 ;
"RTN","PSGVBW",148,0)
IFT ; Loop through active UD orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",149,0)
 S ND=$G(^PS(55,PSGP,5,ON,4)) I $S(SD>PSGDT:$S(ND="":1,'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1)):1,$P(ND,"^",13):1,$P(ND,"^",19):1,$P(ND,"^",23):1,1:$P(ND,"^",16)),ST="O":$S(ND="":1,1:'$P(ND,"^",$S(PSJSYSU:PSJSYSU,1:1))),1:$P(ND,"^",16))
"RTN","PSGVBW",150,0)
 Q
"RTN","PSGVBW",151,0)
 ;
"RTN","PSGVBW",152,0)
IFT2 ; Loop through active IV orders in ^PS(55 that have not been verified by pharmacist.
"RTN","PSGVBW",153,0)
 ;S ND=$G(^PS(55,PSGP,"IV",ON,4)) I $S((SD>PSGDT)&(ND=""):1,'$P(ND,"^",$S(+PSJSYSU=1:1,1:4)):1,1:0)
"RTN","PSGVBW",154,0)
 S ND=$G(^PS(55,PSGP,"IV",ON,4))
"RTN","PSGVBW",155,0)
 I ($P($G(^PS(55,PSGP,"IV",ON,.2)),"^",4)="D")&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4)))  Q
"RTN","PSGVBW",156,0)
 I $S((SD>PSGDT)&('$P(ND,"^",$S(+PSJSYSU=1:1,1:4))):1,1:0)
"RTN","PSGVBW",157,0)
 Q
"RTN","PSGVBW",158,0)
SET ; Set patient specific variables for ^TMP subscripts
"RTN","PSGVBW",159,0)
 S PRDON=""
"RTN","PSGVBW",160,0)
 I $G(ON) S PRDON=$P($G(^PS(53.1,+ON,.2)),"^",4),PRDON=$S(PRDON="A":"ASAP",PRDON="S":"STAT",PRDON="R":"ROUTINE",1:"zz")
"RTN","PSGVBW",161,0)
 S PTPRI=$S(PRDON="STAT":1,PRDON="ASAP":2,PRDON="ROUTINE":3,1:3)
"RTN","PSGVBW",162,0)
 I $G(PSGPRIF) Q:(PRD'=PTPRI)
"RTN","PSGVBW",163,0)
 K DIC,X,Y,WDNAME,TMPWD S WDNAME=$G(^DPT(+PSGP,.1)) S X=WDNAME,DIC="^DIC(42,",DIC(0)="BOXZ" D ^DIC S TMPWD=+Y
"RTN","PSGVBW",164,0)
 S TM=$S(PSJPRB="":"",1:$P($G(^PS(57.7,TMPWD,1,+$O(^PS(57.7,"AWRT",TMPWD,PSJPRB,0)),0)),"^")) S:TM="" TM="zz"
"RTN","PSGVBW",165,0)
 ;
"RTN","PSGVBW",166,0)
SETPN ; If searching for specific priority:
"RTN","PSGVBW",167,0)
 ;            -  set patient into ^TMP("PSGBW" sorted by Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",168,0)
 ; If not searching for specific priority:
"RTN","PSGVBW",169,0)
 ;            - set patient into ^TMP("PSGVBW2" sorted by 'Patient Name^IEN^SSN', then Priority
"RTN","PSGVBW",170,0)
 ;            - set patient into ^TMP("PSGVBW3" sorted by Patient IEN
"RTN","PSGVBW",171,0)
 I $G(PSGP(0))="" D DEM^VADPT S PSGP(0)=VADM(1)
"RTN","PSGVBW",172,0)
 S PN=$P(PSGP(0),"^")_U_PSGP_U_PSJPBID
"RTN","PSGVBW",173,0)
 Q:PSGSS="P"
"RTN","PSGVBW",174,0)
 I $G(PSGPRIF) S ^TMP("PSGVBW",$J,WDN,PTPRI,TM,PN)="" Q
"RTN","PSGVBW",175,0)
 S ^TMP("PSGVBW2",$J,PN,+$G(PTPRI))=WDN_"^"_TM,^TMP("PSGVBW3",$J,+PSGP)=""
"RTN","PSGVBW",176,0)
 Q
"RTN","PSGVBW",177,0)
 ;
"RTN","PSGVBW",178,0)
SET2 ; If not searching for a specific priority,find the highest priority order associated with patient. 
"RTN","PSGVBW",179,0)
 ; Set the patient into ^TMP("PSGVBW" sorted by highest Priority Name, Priority #, Team, Patient Name^IEN^SSN
"RTN","PSGVBW",180,0)
 S SETPN="" F  S SETPN=$O(^TMP("PSGVBW2",$J,SETPN)) Q:SETPN=""  D
"RTN","PSGVBW",181,0)
 .S PTPRI=$O(^TMP("PSGVBW2",$J,SETPN,0)) Q:'$G(PTPRI)
"RTN","PSGVBW",182,0)
 .S SUBS=$G(^TMP("PSGVBW2",$J,SETPN,PTPRI)),SETWDN=$P(SUBS,"^"),SETTM=$P(SUBS,"^",2) Q:SETWDN=""!(SETTM="")
"RTN","PSGVBW",183,0)
 .S ^TMP("PSGVBW",$J,SETWDN,PTPRI,SETTM,SETPN)=""
"RTN","PSGVBW",184,0)
 K ^TMP("PSGVBW2",$J)
"RTN","PSGVBW",185,0)
 Q
"RTN","PSGVBW",186,0)
GTOOP ; Get 'Type Of Order' and Package
"RTN","PSGVBW",187,0)
 I $P(PSJSYSU,";",3)<2,'$G(PSJRNF),'$G(PSJIRNF) S PSJPAC=0,PSJTOO=1 D GTPAC Q
"RTN","PSGVBW",188,0)
 S (PSJPAC,PSJTOO)=0 W !!,"1) Non-Verified Orders",!,"2) Pending Orders",!!
"RTN","PSGVBW",189,0)
 N DIR S DIR(0)="LAO^1:2",DIR("A")="Select Order Type(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" D ^DIR
"RTN","PSGVBW",190,0)
 I 'Y D EXIT("TYPE OF ORDER") Q
"RTN","PSGVBW",191,0)
 S PSJTOO=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",192,0)
 D GTPAC
"RTN","PSGVBW",193,0)
 I 'PSJPAC D EXIT("PACKAGE") Q
"RTN","PSGVBW",194,0)
 Q
"RTN","PSGVBW",195,0)
 ;
"RTN","PSGVBW",196,0)
GTPAC ; Prompt user for Package
"RTN","PSGVBW",197,0)
 I ($G(PSJRNF))&('$G(PSJIRNF))&(PSJTOO=2) S PSJPAC=1 Q
"RTN","PSGVBW",198,0)
 I ($G(PSJIRNF))&('$G(PSJRNF))&(PSJTOO=2) S PSJPAC=2 Q
"RTN","PSGVBW",199,0)
 W !!,"1) Unit Dose Orders",!,"2) IV Orders",!
"RTN","PSGVBW",200,0)
 K DIR S DIR(0)="LAO^1:2",DIR("A")="Select Package(s) (1-2): ",DIR("?")="^D TOH^PSGVBW" W ! D ^DIR
"RTN","PSGVBW",201,0)
 S PSJPAC=$S($L(Y)>2:3,1:$P(Y,","))
"RTN","PSGVBW",202,0)
 Q
"RTN","PSGVBW",203,0)
EXIT(X) ; Generic user error message
"RTN","PSGVBW",204,0)
 W !!,X," not selected, option terminated."
"RTN","PSGVBW",205,0)
 Q
"RTN","PSGVBW",206,0)
 ;
"RTN","PSGVBW",207,0)
TOH ; Help text
"RTN","PSGVBW",208,0)
 W !!,"SELECT FROM:",!?5,"1 - NON-VERIFIED ORDERS",!?5,"2 - PENDING ORDERS"
"RTN","PSGVBW",209,0)
 W !!?2,"Enter '1' if you want to verify non-verified orders.  Enter '2' if you",!,"want to complete pending orders.  Enter '1,2' or '1-2' if you want to do both." Q
"RTN","PSGVBW0")
0^7^B41945132^B42020216
"RTN","PSGVBW0",1,0)
PSGVBW0 ;BIR/CML3,MV - SHOW NON-VERFIED ORDERS GATHERED IN PSGVBW ;09/17/97 1:41 PM
"RTN","PSGVBW0",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**29,39,53,56,95,80,110,127,124,243,304**;DEC 16, 1997;Build 22
"RTN","PSGVBW0",3,0)
 ;
"RTN","PSGVBW0",4,0)
 ; Reference to ^PSSLOCK is supported by DBIA #2789
"RTN","PSGVBW0",5,0)
 ; Reference to ^DIR is supported by DBIA 10026
"RTN","PSGVBW0",6,0)
 ; Reference to ^VALM is supported by DBIA 10118
"RTN","PSGVBW0",7,0)
 ;
"RTN","PSGVBW0",8,0)
START ;
"RTN","PSGVBW0",9,0)
 S (LINE,PSGOEA,PSGOEAV)="",$P(LINE,"-",81)="" S PSGPXN=$G(PSGPXN)
"RTN","PSGVBW0",10,0)
 K ^TMP("PSJLIST",$J) D:PSGSS'="P" DISPLAYW Q:'$O(^TMP("PSJSELECT",$J,0))
"RTN","PSGVBW0",11,0)
PROCESS ; Loop through selected patients and display profile/orders.
"RTN","PSGVBW0",12,0)
 K DIR,PSJPNV S PSJPNV=1
"RTN","PSGVBW0",13,0)
 I $P(PSJSYSU,";")=3 S X=$O(^TMP("PSJSELECT",$J,1)),DIR(0)="Y",DIR("A")="Do you want to print a profile for the"_$S(X:"se",1:"")_" patient"_$S(X:"s",1:""),DIR("B")="NO" D
"RTN","PSGVBW0",14,0)
 .D ^DIR K DIR I Y D ^PSJHVARS,^PSGVBWP,RESTORE^PSJHVARS
"RTN","PSGVBW0",15,0)
 .W !!,"Select profile type for order processing.",!!
"RTN","PSGVBW0",16,0)
 D ENL^PSGOU Q:"SNL"'[PSGOL
"RTN","PSGVBW0",17,0)
 F PSJCNT=0:0 S PSJCNT=$O(^TMP("PSJSELECT",$J,PSJCNT)) Q:'PSJCNT  D PROCESS1 S PSGOP=PSGP D ENQL^PSGLW:$P(PSJSYSL,"^",2)]"" Q:$G(PSJGOTO)="E"  I $D(^TMP("PSJSELECT",$J,+$G(PSJGOTO))) S PSJCNT=PSJGOTO-1
"RTN","PSGVBW0",18,0)
 Q
"RTN","PSGVBW0",19,0)
PROCESS1 ;
"RTN","PSGVBW0",20,0)
 S PSJPN=$G(^TMP("PSJSELECT",$J,PSJCNT)) K PSJGOTO
"RTN","PSGVBW0",21,0)
 S PSJLK=$$L^PSSLOCK($P(PSJPN,U,2),1) I 'PSJLK W !,$C(7),$P(PSJLK,U,2) Q
"RTN","PSGVBW0",22,0)
 K PSJGOTO D:PSJPN]"" GTORDERS
"RTN","PSGVBW0",23,0)
 I PSJLK D UL^PSSLOCK($P(PSJPN,U,2))
"RTN","PSGVBW0",24,0)
 I $G(PSGPXN),$$DEFON^PSGPER1 D  K PSGPXPT S PSGPXN=0
"RTN","PSGVBW0",25,0)
 .S PSGPXPT=PSGP
"RTN","PSGVBW0",26,0)
 .N DFN,PSGP S (PSGP,DFN)=PSGPXPT D ^PSGPER,ENCV^PSGSETU,^PSIVXU
"RTN","PSGVBW0",27,0)
 S PSGPXN=$G(PSGPXN)
"RTN","PSGVBW0",28,0)
 Q
"RTN","PSGVBW0",29,0)
 ;
"RTN","PSGVBW0",30,0)
DISPLAYW ; Allow selection of patients on each ward selected.
"RTN","PSGVBW0",31,0)
 K ^TMP("PSJSELECT",$J) S PSJCNT=1,PSGWORP1="" F  S PSGWORP1=$O(^TMP("PSGVBW",$J,PSGWORP1)) Q:PSGWORP1=""  D DISPLAYP
"RTN","PSGVBW0",32,0)
 Q
"RTN","PSGVBW0",33,0)
 ;
"RTN","PSGVBW0",34,0)
DISPLAYP ; Display WORP1 (Ward or Priority)
"RTN","PSGVBW0",35,0)
 N PSGPICK
"RTN","PSGVBW0",36,0)
 S PSGVBWN=PSGWORP1
"RTN","PSGVBW0",37,0)
 D HEADER
"RTN","PSGVBW0",38,0)
 S PSGWORP2="" F  S PSGWORP2=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2)) Q:PSGWORP2=""  S PSGPRIN=PSGWORP2 D DISPLAYT
"RTN","PSGVBW0",39,0)
 I $G(PSJASK),(PSGVBY>0) D ASK
"RTN","PSGVBW0",40,0)
 Q
"RTN","PSGVBW0",41,0)
 ;
"RTN","PSGVBW0",42,0)
DISPLAYT ;
"RTN","PSGVBW0",43,0)
 ;NEW PSGPICK  ;PSGPICK=1-->user selected order, stop display the profile
"RTN","PSGVBW0",44,0)
 S PSGPRIN=PSGWORP2
"RTN","PSGVBW0",45,0)
 S:$G(PSGPRIF) PSGVBWN=PSGWORP2,PSGPRIN=PSGWORP1
"RTN","PSGVBW0",46,0)
 S PSGVBTM="" F  S PSGVBTM=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2,PSGVBTM))  Q:(PSGVBTM=""!$G(PSGPICK))  D V2
"RTN","PSGVBW0",47,0)
 I $G(PSJPRIF),$G(PSJASK),(PSGVBY>0) D ASK
"RTN","PSGVBW0",48,0)
 Q
"RTN","PSGVBW0",49,0)
 ;
"RTN","PSGVBW0",50,0)
GTORDERS ;
"RTN","PSGVBW0",51,0)
 S (PSGP,DFN)=$P(PSJPN,U,2) K PSJACNWP D ^PSJAC
"RTN","PSGVBW0",52,0)
 I PSGOL'="N" D PROFILE Q
"RTN","PSGVBW0",53,0)
 D ENGORD^PSGVBWU
"RTN","PSGVBW0",54,0)
 S PSJPRIO="" F  S PSJPRIO=$O(^TMP("PSJON",$J,PSJPRIO)) Q:PSJPRIO=""  S PSJON="" D
"RTN","PSGVBW0",55,0)
 . F  S PSJON=$O(^TMP("PSJON",$J,PSJPRIO,PSJON)) Q:PSJON=""  D
"RTN","PSGVBW0",56,0)
 .. I $P(PSJON,U,2)=+$P(PSJON,U,2) Q:'$$LOCK^PSJOEA(DFN,$P(PSJON,U,2))  D GTORDER2 Q
"RTN","PSGVBW0",57,0)
 .. I '$$LS^PSSLOCK(DFN,$P(PSJON,U,2)) D DISPORD(DFN,$P(PSJON,U,2)) Q
"RTN","PSGVBW0",58,0)
 .. D DISACTIO^PSJOE(DFN,$P(PSJON,U,2),1) Q:$D(PSJGOTO)  D UNL^PSSLOCK(DFN,$P(PSJON,U,2))
"RTN","PSGVBW0",59,0)
 Q
"RTN","PSGVBW0",60,0)
 ;
"RTN","PSGVBW0",61,0)
GTORDER2 ;
"RTN","PSGVBW0",62,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",63,0)
 .D DISACTIO^PSJOE(DFN,PSJO_"P",1) Q:$D(PSJGOTO)
"RTN","PSGVBW0",64,0)
 I $D(^TMP("PSJCOM",$J)) N PSJORD S PSJORD=$P(PSJON,U,2) D CHK^PSJOEA1
"RTN","PSGVBW0",65,0)
 N PSJO S PSJO=0 F  S PSJO=$O(^PS(53.1,"ACX",$P(PSJON,U,2),PSJO)) Q:'PSJO  D
"RTN","PSGVBW0",66,0)
 .D UNL^PSSLOCK(DFN,PSJO_"P") Q:$G(Y)<0
"RTN","PSGVBW0",67,0)
 Q
"RTN","PSGVBW0",68,0)
 ;
"RTN","PSGVBW0",69,0)
PROFILE ; Display the patient's profile and allow order selection.
"RTN","PSGVBW0",70,0)
 S PSGP=DFN,PSJOL=PSGOL F  D EN^VALM("PSJ LM PNV") Q:'$G(PSJORD)&'$G(PSJNEWOE)  S PSJNEWOE=0
"RTN","PSGVBW0",71,0)
 Q
"RTN","PSGVBW0",72,0)
 ;
"RTN","PSGVBW0",73,0)
DONE ;
"RTN","PSGVBW0",74,0)
 K ^TMP("PSGVBW",$J),^TMP("PSJON",$J)
"RTN","PSGVBW0",75,0)
 K PSGWORP1,PSGWORP2,CF,DA,LINE,NP,POP,PPN,PR,PSGCANFL,PSGION,PSGOL,PSGOEAV,PSGOENOF,PSGON,PSGONC,PSGONR,PSGLMT,PSGPRIF
"RTN","PSGVBW0",76,0)
 K PSGORD,PSGPRF,PSGVBA,PSGVBAF,PSGVBON,PSGVBPN,PSGVBQ,PSGVBQ1,PSGVBSD,PSGVBSS,PSGVBST,PSGVBTM,PSGVBW,PSGVBWN,PSGVBY,QQ,Z
"RTN","PSGVBW0",77,0)
 K LIDT,ND,ORDT,PPN,PRD,PRDNS,PSGINCL,PSGINWD,PSGODT,PSGOEA,PSGOEAV,PSGP,PSGPRD,PSGPRIN,PSGPTMP,PSGSS,PSGVBPN,PSGVBTM,PSGVBWN
"RTN","PSGVBW0",78,0)
 Q
"RTN","PSGVBW0",79,0)
 ;
"RTN","PSGVBW0",80,0)
V2 ;
"RTN","PSGVBW0",81,0)
 S PSGVBPN="" F  S PSGVBPN=$O(^TMP("PSGVBW",$J,PSGWORP1,PSGWORP2,PSGVBTM,PSGVBPN)) Q:(PSGVBPN=""!$G(PSGPICK))  S PSGP=$P(PSGVBPN,"^",2),PPN=$P(PSGVBPN,"^") S:PPN="" PPN=PSGP_";DPT(" D WRT
"RTN","PSGVBW0",82,0)
 Q
"RTN","PSGVBW0",83,0)
 ;
"RTN","PSGVBW0",84,0)
WRT ;
"RTN","PSGVBW0",85,0)
 S PSGVBY=PSGVBY+1,PSJASK=1
"RTN","PSGVBW0",86,0)
 S PSGVBWN=PSGWORP1,PSGPRD=PSGWORP2
"RTN","PSGVBW0",87,0)
 W !,$J(PSGVBY,4),?6,$S(PSGVBTM'="zz":PSGVBTM,1:"Not Found"),?25,$S(PSGPRD="zz":"Not Found",PSGPRD=1:"STAT",PSGPRD=2:"ASAP",PSGPRD=3:"ROUTINE",1:PSGPRD),?38,PPN," (",$P(PSGVBPN,U,3),")" S ^TMP("PSJLIST",$J,PSGVBY)=PSGVBWN_U_PSGVBTM_U_PPN_U_PSGP
"RTN","PSGVBW0",88,0)
 I $Y+1>IOSL,(PSGVBY>0) NEW DIR S DIR(0)="EA",DIR("A")=" '^' TO QUIT " D ^DIR D
"RTN","PSGVBW0",89,0)
 . I X="^" S PSGPICK=1  Q
"RTN","PSGVBW0",90,0)
 . W @IOF
"RTN","PSGVBW0",91,0)
 Q
"RTN","PSGVBW0",92,0)
 ;
"RTN","PSGVBW0",93,0)
ASK ;
"RTN","PSGVBW0",94,0)
 N DIR,PSGDFN,PSGASKX S DIR(0)="LOA^1:"_PSGVBY,DIR("A")="Select 1 - "_PSGVBY_": " D ^DIR I $D(DUOUT)!$D(DTOUT) K ^TMP("PSGVBW",$J) Q
"RTN","PSGVBW0",95,0)
 S:Y]"" PSGPICK=1
"RTN","PSGVBW0",96,0)
 F PSJINDEX=1:1:$L(Y,",")-1 D
"RTN","PSGVBW0",97,0)
 . S PSGASKX=$G(^TMP("PSJLIST",$J,$P(Y,",",PSJINDEX))),PSGDFN=$P(PSGASKX,"^",4)_"^"_$P(PSGASKX,"^",3)
"RTN","PSGVBW0",98,0)
 . D CHK^PSJDPT(.PSGDFN,1) I PSGDFN=-1 Q
"RTN","PSGVBW0",99,0)
 . S:PSGASKX]"" ^TMP("PSJSELECT",$J,PSJCNT)=$P(PSGASKX,U,3,4),^TMP("PSJSELECT",$J,"B",$P(PSGASKX,U,3),PSJCNT)="",PSJCNT=PSJCNT+1
"RTN","PSGVBW0",100,0)
 Q
"RTN","PSGVBW0",101,0)
 ;
"RTN","PSGVBW0",102,0)
H2 ;
"RTN","PSGVBW0",103,0)
 W !!?2,"Select patients either singularly separated by commas (1,2,3), by a range of",!,"patients separated by a dash (1-3), or a combination (1,2,4-6).  To select all",!,"patients, enter 'ALL' or a dash ('-').  You can also enter '-n' to"
"RTN","PSGVBW0",104,0)
 W " select the",!,"first patient through the 'nth' patient or enter 'n-' to select the 'nth'",!,"patient through the last patient.  If a patient is selected more than once,"
"RTN","PSGVBW0",105,0)
 W !,"only the first selection is used.  (Entering '1,2,1' would return '1,2'.)" Q
"RTN","PSGVBW0",106,0)
 ;
"RTN","PSGVBW0",107,0)
HEADER ;
"RTN","PSGVBW0",108,0)
 W:$Y @IOF W !,"ORDERS NOT VERIFIED BY A ",$S($P(PSJSYSU,";",3)>1:"PHARMACIST",1:"NURSE")," - "
"RTN","PSGVBW0",109,0)
 I $G(PSGPRIF) W $S(PRD=1:"STAT",PRD=2:"ASAP",1:"ROUTINE")
"RTN","PSGVBW0",110,0)
 I '$G(PSGPRIF) W $S(PSGVBWN="ZZ":"^OTHER",1:PSGVBWN)
"RTN","PSGVBW0",111,0)
 W !!," No.",?7,"TEAM",?25,"PRIORITY",?38,"PATIENT",!,LINE K PSGVBY S PSGVBY=0 Q
"RTN","PSGVBW0",112,0)
 Q
"RTN","PSGVBW0",113,0)
 ;
"RTN","PSGVBW0",114,0)
NP ;
"RTN","PSGVBW0",115,0)
 W $C(7) R !!,"ENTER AN '^' TO SELECT ORDERS NOW, OR PRESS THE RETURN KEY TO CONTINUE. ",NP:DTIME E  S NP="^"
"RTN","PSGVBW0",116,0)
 Q
"RTN","PSGVBW0",117,0)
DISPORD(DFN,ON)     ;Display the order that being lock by another user
"RTN","PSGVBW0",118,0)
 NEW PSJLINE,PSJOC,X
"RTN","PSGVBW0",119,0)
 S PSJLINE=1
"RTN","PSGVBW0",120,0)
 D DSPLORDU^PSJLMUT1(DFN,ON)
"RTN","PSGVBW0",121,0)
 W ! F X=0:0 S X=$O(PSJOC(ON,X)) Q:'X  W !,PSJOC(ON,X)
"RTN","PSGVBW0",122,0)
 Q
"RTN","PSGVBW0",123,0)
        
"RTN","PSIVACT")
0^6^B30388063^B30113388
"RTN","PSIVACT",1,0)
PSIVACT ;BIR/PR,MLM-UPDATE ORDER STATUS AFTER PATIENT SELECTION ;16 Jul 98 / 12:51 PM
"RTN","PSIVACT",2,0)
 ;;5.0;INPATIENT MEDICATIONS;**15,38,58,110,181,275,304**;16 DEC 97;Build 22
"RTN","PSIVACT",3,0)
 ;
"RTN","PSIVACT",4,0)
 ; Reference to ^PS(55 is supported by DBIA 2191
"RTN","PSIVACT",5,0)
 ;
"RTN","PSIVACT",6,0)
ENNA ; Inpatient entry point.
"RTN","PSIVACT",7,0)
 D:$D(XRTL) T0^%ZOSV
"RTN","PSIVACT",8,0)
 D NOW^%DTC S PSFDT=%,PS=0 D L D:'$G(PSIVRD) PEND
"RTN","PSIVACT",9,0)
 I $D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",10,0)
 Q
"RTN","PSIVACT",11,0)
 ;
"RTN","PSIVACT",12,0)
ENNB ; Ask profile type, gather orders.
"RTN","PSIVACT",13,0)
 D NOW^%DTC S PSFDT=%,PS=0 K ^TMP("PSIV",$J),^TMP("PSJPRO",$J)
"RTN","PSIVACT",14,0)
 S PSIVNV=$S(+PSJSYSU=1:"ANIV",+PSJSYSU=3:"APIV",1:"")
"RTN","PSIVACT",15,0)
 D @P("PT") D:'$G(PSIVRD) PEND
"RTN","PSIVACT",16,0)
 I P("PT")="L",$D(XRT0) S XRTN="PSIVACT" D T1^%ZOSV
"RTN","PSIVACT",17,0)
 Q
"RTN","PSIVACT",18,0)
 ;
"RTN","PSIVACT",19,0)
L ; Long profile
"RTN","PSIVACT",20,0)
 S:'$D(PSJSYSU) PSJSYSU=""
"RTN","PSIVACT",21,0)
 F ON=0:0 K Y S ON=$O(^PS(55,DFN,"IV",+ON)) Q:'ON  D SETP
"RTN","PSIVACT",22,0)
 Q
"RTN","PSIVACT",23,0)
 ;
"RTN","PSIVACT",24,0)
S ; Short profile.
"RTN","PSIVACT",25,0)
 S PSJDCEXP=$$RECDCEXP^PSJP()
"RTN","PSIVACT",26,0)
 I '+$P(PSJDCEXP,U,2) S $P(PSJDCEXP,U,2)=PSFDT
"RTN","PSIVACT",27,0)
 F PSIVDT=$P($G(PSJDCEXP),U,2):0 S PSIVDT=$O(^PS(55,DFN,"IV","AIS",PSIVDT)) Q:'PSIVDT!(PSIVDT'=+PSIVDT)  F ON=0:0 S ON=$O(^PS(55,DFN,"IV","AIS",PSIVDT,+ON)) Q:'ON  S ON=ON_"V",P(17)=$P($G(^PS(55,DFN,"IV",+ON,0)),U,17) D ACTO
"RTN","PSIVACT",28,0)
 I +PSJSYSU=3 S PSIVNV="APIV" D NVACT K PSIVNV
"RTN","PSIVACT",29,0)
 Q
"RTN","PSIVACT",30,0)
 ;
"RTN","PSIVACT",31,0)
NVACT ; Non-verified but have active status
"RTN","PSIVACT",32,0)
 NEW ON
"RTN","PSIVACT",33,0)
 F ON=0:0 S ON=$O(^PS(55,PSIVNV,DFN,ON)) Q:'ON  D
"RTN","PSIVACT",34,0)
 . N CLIN,CLINSORT,SORT,PSIVSTAT,CLINSORT S PSIVSTAT="A"
"RTN","PSIVACT",35,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON) I $L(CLIN)>1 S CLINSORT=$$CLINSORT^PSJO1("A") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",36,0)
 . I $P($G(^PS(55,DFN,"IV",ON,0)),U,17)="E",($P($G(^(.2)),U,4)="D") S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",37,0)
 Q
"RTN","PSIVACT",38,0)
 ;
"RTN","PSIVACT",39,0)
PEND ; Get pending and non-verified orders from 53.1
"RTN","PSIVACT",40,0)
 N PSJCOM,PSJCOM1 S (PSJCOM,PSJCOM1)=0
"RTN","PSIVACT",41,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","P",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",42,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",43,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",44,0)
 . N CLIN,CLINSORT,SORT,PSIVSTAT,CLINSORT S PSIVSTAT=$S('PSJCOM:"P",1:"PD")
"RTN","PSIVACT",45,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON_"P") I $L(CLIN)>1 S CLINSORT=$$CLINSORT^PSJO1("P") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT
"RTN","PSIVACT",46,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,PSIVSTAT,X_9999999999-ON)=""
"RTN","PSIVACT",47,0)
 F ON=0:0 S ON=$O(^PS(53.1,"AS","N",DFN,ON)) Q:'ON  D  S PSJCOM1=PSJCOM
"RTN","PSIVACT",48,0)
 . NEW X S X=$P($G(^PS(53.1,ON,.2)),U,4),X=$S(X="S":1,X="A":2,X="R":3,X="P":4,1:5)
"RTN","PSIVACT",49,0)
 . S PSJCOM=$P($G(^PS(53.1,ON,.2)),U,8) I PSJCOM Q:'$$COMCHK^PSJO1(PSJCOM,2)  Q:PSJCOM=PSJCOM1
"RTN","PSIVACT",50,0)
 . N CLIN,PSIVSTAT,CLINSORT,SORT S PSIVSTAT=$S('PSJCOM:"N",1:"ND")
"RTN","PSIVACT",51,0)
 . S CLIN=$$CLINIC^PSJO1(PSGP,ON_"P") I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1("P") S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_$S('PSJCOM:"N",1:"ND")
"RTN","PSIVACT",52,0)
 . I $G(^PS(53.1,ON,0)),$P(^PS(53.1,ON,0),U,4)'="U" S ^TMP("PSIV",$J,PSIVSTAT,X_9999999999-ON)=""
"RTN","PSIVACT",53,0)
 .; S:$P(^PS(53.1,ON,0),U,4)'="U" ^TMP("PSIV",$J,"P",X_9999999999-ON)=""
"RTN","PSIVACT",54,0)
 ;
"RTN","PSIVACT",55,0)
QUIT ; Kill and exit.
"RTN","PSIVACT",56,0)
 K PSIVCWD,PSIVFLAG,PSIVWD,PSDFN,PSON1,PSFDT,YHOLD,JJ,XHOLD
"RTN","PSIVACT",57,0)
 Q
"RTN","PSIVACT",58,0)
 ;
"RTN","PSIVACT",59,0)
SETP ; Get partial P array,
"RTN","PSIVACT",60,0)
 S ON=ON_"V",Y=$G(^PS(55,DFN,"IV",+ON,0)) F X=2,3,17,21 S P(X)=$P(Y,U,X)
"RTN","PSIVACT",61,0)
 S P(2)=+P(2),P(3)=+P(3) S Y(P(2))="",Y(P(3))=""
"RTN","PSIVACT",62,0)
 I P(2),P(3),P(17)'="P" D CHK
"RTN","PSIVACT",63,0)
 Q
"RTN","PSIVACT",64,0)
 ;
"RTN","PSIVACT",65,0)
CHK ; Check if order is active or expired and save accordingly.
"RTN","PSIVACT",66,0)
 N CLIN,PSIVSTAT,CLINSORT,SORT S PSIVSTAT="A"
"RTN","PSIVACT",67,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON) I CLIN]"" S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",68,0)
 S PS=PS+1 I P(17)="H" S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",69,0)
 I $O(Y(PSFDT))=P(3) D ACTO Q
"RTN","PSIVACT",70,0)
 I $O(Y(PSFDT))="" D NACTO Q
"RTN","PSIVACT",71,0)
 S:"ARO"[P(17) ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" S:"ED"[P(17) ^TMP("PSIV",$J,"X",9999999999-ON)="" S:"E"[P(17) PSIVREA="A",$P(^PS(55,DFN,"IV",+ON,0),U,17)="A",PS("A",9999999999-ON)=""
"RTN","PSIVACT",72,0)
 Q
"RTN","PSIVACT",73,0)
 ;
"RTN","PSIVACT",74,0)
ACTO ; Active orders
"RTN","PSIVACT",75,0)
 ;I "AE"[P(17) S ^TMP("PSIV",$J,"A",9999999999-ON)="" S:P(17)="E" $P(^PS(55,DFN,"IV",+ON,0),U,17)="A" Q ;;mv-not sure why setting status back to "A"???
"RTN","PSIVACT",76,0)
 N CLINSORT,SORT,CLIN,PSIVSTAT S PSIVSTAT="A"
"RTN","PSIVACT",77,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON) I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^A"
"RTN","PSIVACT",78,0)
 I ($P(PSIVSTAT,"^")="Cz") S:("DE"[P(17)) PSIVSTAT="RD" S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",79,0)
 I "A"[P(17) S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",80,0)
 I "HOR"[P(17) S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)="" Q
"RTN","PSIVACT",81,0)
 I "DE"[P(17) S ^TMP("PSIV",$J,"RD",9999999999-ON)=""
"RTN","PSIVACT",82,0)
 Q
"RTN","PSIVACT",83,0)
 ;
"RTN","PSIVACT",84,0)
NACTO ; Inactive orders
"RTN","PSIVACT",85,0)
 ;I "AER"[P(17) S ^TMP("PSIV",$J,"X",9999999999-ON)="" I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE Q
"RTN","PSIVACT",86,0)
 N CLIN,PSIVSTAT,SORT,CLINSORT S PSIVSTAT=""
"RTN","PSIVACT",87,0)
 S CLIN=$$CLINIC^PSJO1(PSGP,ON)
"RTN","PSIVACT",88,0)
 I "AER"[P(17) D
"RTN","PSIVACT",89,0)
 . Q:$P(^PS(55,DFN,"IV",+ON,0),U,3)=""  S PSIVSTAT="A"
"RTN","PSIVACT",90,0)
 . I +PSJSYSU=3,($P($G(^PS(55,DFN,"IV",+ON,.2)),U,4)="D"),'+$P($G(^(4)),U,4) D  Q
"RTN","PSIVACT",91,0)
 .. I (CLIN]"") S CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT
"RTN","PSIVACT",92,0)
 .. S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",93,0)
 . S PSIVSTAT="X" S:(CLIN]"") CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S:($G(CLINSORT)]"") PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT D
"RTN","PSIVACT",94,0)
 .. S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",95,0)
 I "AR"[P(17) S $P(^PS(55,DFN,"IV",+ON,0),U,17)="E" D EXPIR^PSIVOE
"RTN","PSIVACT",96,0)
 I "OD"[P(17) S PSIVSTAT="X" S:(CLIN]"") CLINSORT=$$CLINSORT^PSJO1(PSIVSTAT) S:($G(CLINSORT)]"") PSIVSTAT="Cz^"_CLIN_"^"_CLINSORT_"^"_PSIVSTAT D
"RTN","PSIVACT",97,0)
 .S ^TMP("PSIV",$J,PSIVSTAT,9999999999-ON)=""
"RTN","PSIVACT",98,0)
 Q
"RTN","PSIVACT",99,0)
 ;
"RTN","PSIVACT",100,0)
DCOR ; Auto-cancel IV orders
"RTN","PSIVACT",101,0)
 ;NEED TO NEW VARIABLES LATER.
"RTN","PSIVACT",102,0)
 NEW DA,DIR,DG,ON,ON55,P,PSIVAC,PSIVACT,PSIVLN,PSIVREA,PSIVRES,PSGALO,PSGP,PSJDCDT,PSJIVDCF,PSJIVON,PSJIVORF,PSJORF,VA,VADM,VAERR
"RTN","PSIVACT",103,0)
 S PSGP=DFN,PSIVRES="Auto DC due to Surgery Package"
"RTN","PSIVACT",104,0)
 D NOW^%DTC S PSJDCDT=+%
"RTN","PSIVACT",105,0)
 D ENIV^PSJADT0
"RTN","PSIVACT",106,0)
 Q
"RTN","PSJ304PO")
0^^B6350369^n/a
"RTN","PSJ304PO",1,0)
PSJ304PO ;TMC-Post Install routine for patch PSJ*5*304 ;10/28/14
"RTN","PSJ304PO",2,0)
 ;;5.0;INPATIENT MEDICATIONS ;**304**;;Build 22
"RTN","PSJ304PO",3,0)
 ;
"RTN","PSJ304PO",4,0)
QUE ;
"RTN","PSJ304PO",5,0)
 N NAMSP,PATCH,JOBN,ZTSK,ZTRTN,ZTIO,ZTDTH,ZTDESC,Y,ZTQUEUED,ZTREQ,ZTSAVE,CNT,SBJM
"RTN","PSJ304PO",6,0)
 S NAMSP="PSJ304PO"
"RTN","PSJ304PO",7,0)
 S JOBN="PSJ*5*304 Post Install"
"RTN","PSJ304PO",8,0)
 S PATCH="PSJ*5*304"
"RTN","PSJ304PO",9,0)
 S Y=$$NOW^XLFDT S ZTDTH=$$FMTH^XLFDT(Y)
"RTN","PSJ304PO",10,0)
 ;
"RTN","PSJ304PO",11,0)
 D BMES^XPDUTL("=============================================================")
"RTN","PSJ304PO",12,0)
 D MES^XPDUTL("Queuing background job for "_JOBN_"...")
"RTN","PSJ304PO",13,0)
 D MES^XPDUTL("Start time: "_$$HTE^XLFDT(ZTDTH))
"RTN","PSJ304PO",14,0)
 D MES^XPDUTL("A MailMan message will be sent to the installer upon Post")
"RTN","PSJ304PO",15,0)
 D MES^XPDUTL("Install Completion.")
"RTN","PSJ304PO",16,0)
 D MES^XPDUTL("==============================================================")
"RTN","PSJ304PO",17,0)
 ;
"RTN","PSJ304PO",18,0)
 S ZTRTN="EN^"_NAMSP,ZTIO=""
"RTN","PSJ304PO",19,0)
 S (SBJM,ZTDESC)="Background job for "_JOBN
"RTN","PSJ304PO",20,0)
 S ZTSAVE("JOBN")="",ZTSAVE("ZTDTH")="",ZTSAVE("DUZ")="",ZTSAVE("SBJM")=""
"RTN","PSJ304PO",21,0)
 D ^%ZTLOAD
"RTN","PSJ304PO",22,0)
 D:$D(ZTSK)
"RTN","PSJ304PO",23,0)
 . D MES^XPDUTL("*** Task #"_ZTSK_" Queued! ***")
"RTN","PSJ304PO",24,0)
 . D BMES^XPDUTL("")
"RTN","PSJ304PO",25,0)
 . S ZTSAVE("ZTSK")=""
"RTN","PSJ304PO",26,0)
 D BMES^XPDUTL("")
"RTN","PSJ304PO",27,0)
 K XPDQUES
"RTN","PSJ304PO",28,0)
 Q
"RTN","PSJ304PO",29,0)
 ;
"RTN","PSJ304PO",30,0)
EN ;Do Mail Message
"RTN","PSJ304PO",31,0)
 N DFN,DA,STARTH,STOPH,SUBJ
"RTN","PSJ304PO",32,0)
 S STARTH=$$HTE^XLFDT(ZTDTH)
"RTN","PSJ304PO",33,0)
 K DIK S DFN=0 F  S DFN=$O(^PS(55,DFN)) Q:'DFN  S DA(1)=DFN D
"RTN","PSJ304PO",34,0)
 .S DIK="^PS(55,"_DA(1)_",""IV"",",DIK(1)=".03^AIS" D ENALL2^DIK
"RTN","PSJ304PO",35,0)
 K DIK S DFN=0 F  S DFN=$O(^PS(55,DFN)) Q:'DFN  S DA(1)=DFN D
"RTN","PSJ304PO",36,0)
 .S DIK="^PS(55,"_DA(1)_","_"""IV"""_",",DIK(1)=".03^AIS" D ENALL^DIK
"RTN","PSJ304PO",37,0)
 K DIK
"RTN","PSJ304PO",38,0)
 ;
"RTN","PSJ304PO",39,0)
 ;Send message
"RTN","PSJ304PO",40,0)
 S CNT=1
"RTN","PSJ304PO",41,0)
 S Y=$$NOW^XLFDT S STOPH=$$FMTH^XLFDT(Y),STOPH=$$HTE^XLFDT(STOPH)
"RTN","PSJ304PO",42,0)
 S SUBJ="PSJ*5*304 POST INSTALL Complete"
"RTN","PSJ304PO",43,0)
 S MSG(CNT)="The AIS cross reference have been re-indexed:",CNT=CNT+1
"RTN","PSJ304PO",44,0)
 S MSG(CNT)="    File 55  - AIS for IV Sub-file.",CNT=CNT+1
"RTN","PSJ304PO",45,0)
 S MSG(CNT)=" ",CNT=CNT+1
"RTN","PSJ304PO",46,0)
 S MSG(CNT)="The background job "_ZTSK_" began "_STARTH_" and ",CNT=CNT+1
"RTN","PSJ304PO",47,0)
 S MSG(CNT)="ended "_STOPH_".",CNT=CNT+1
"RTN","PSJ304PO",48,0)
 D MAIL(.MSG,SUBJ)
"RTN","PSJ304PO",49,0)
 Q
"RTN","PSJ304PO",50,0)
 ;
"RTN","PSJ304PO",51,0)
MAIL(MSG,SBJ) ; Send out some mail!
"RTN","PSJ304PO",52,0)
 N DIFROM,XMDUZ,XMSUB,XMTEXT,XMY,I
"RTN","PSJ304PO",53,0)
 S XMDUZ="INPT PHARMACY",XMSUB=SBJM,XMTEXT="MSG("
"RTN","PSJ304PO",54,0)
 S XMY(DUZ)=""
"RTN","PSJ304PO",55,0)
 D ^XMD
"RTN","PSJ304PO",56,0)
 Q ""
"RTN","PSJ304PO",57,0)
 ;
"UP",55,55.01,-1)
55^IV
"UP",55,55.01,0)
55.01
"VER")
8.0^22.0
"^DD",55,55.01,.03,0)
STOP DATE/TIME^RDX^^0;3^S %DT="ETX" D:X'=+X ^%DT D:X=+X ENDL^PSSDDUT3 S X=Y K:Y<1!(Y'[".") X
"^DD",55,55.01,.03,1,0)
^.1
"^DD",55,55.01,.03,1,1,0)
55^AIV
"^DD",55,55.01,.03,1,1,1)
S ^PS(55,"AIV",+$E(X,1,30),DA(1),DA)=""
"^DD",55,55.01,.03,1,1,2)
K ^PS(55,"AIV",+$E(X,1,30),DA(1),DA)
"^DD",55,55.01,.03,1,1,"%D",0)
^^1^1^2931031^
"^DD",55,55.01,.03,1,1,"%D",1,0)
Identifies IV orders by the order's stop date/time.
"^DD",55,55.01,.03,1,2,0)
55.01^AF^MUMPS
"^DD",55,55.01,.03,1,2,1)
Q:$D(PSIVACT)  I '$D(DIU(0)) S PSIVF1=55.01,PSIVF2=.03 D ENTO^PSIVAL
"^DD",55,55.01,.03,1,2,2)
Q:$D(PSIVACT)  I '$D(DIU(0)) S PSIVF1=55.01,PSIVF2=.03 D ENFR^PSIVAL
"^DD",55,55.01,.03,1,2,"%D",0)
^^1^2920831^
"^DD",55,55.01,.03,1,2,"%D",1,0)
Used by IV Package.
"^DD",55,55.01,.03,1,3,0)
55.01^AIS
"^DD",55,55.01,.03,1,3,1)
S ^PS(55,DA(1),"IV","AIS",+X,DA)=""
"^DD",55,55.01,.03,1,3,2)
K ^PS(55,DA(1),"IV","AIS",+X,DA)
"^DD",55,55.01,.03,1,4,0)
55^AIT^MUMPS
"^DD",55,55.01,.03,1,4,1)
I $P($G(^PS(55,DA(1),"IV",DA,0)),U,4)]"" S ^PS(55,DA(1),"IV","AIT",$P(^(0),U,4),+X,DA)=""
"^DD",55,55.01,.03,1,4,2)
I $P($G(^PS(55,DA(1),"IV",DA,0)),U,4)]"" K ^PS(55,DA(1),"IV","AIT",$P(^(0),U,4),+X,DA)
"^DD",55,55.01,.03,1,4,"%D",0)
4^^4^4^2930611^
"^DD",55,55.01,.03,1,4,"%D",1,0)
  Used by IV to gather orders.  X-refs are in the form of:  
"^DD",55,55.01,.03,1,4,"%D",2,0)
  ^PS(55,DA(1),"IV","AIT",type,stop date/time,DA)  
"^DD",55,55.01,.03,1,4,"%D",3,0)
 
"^DD",55,55.01,.03,1,4,"%D",4,0)
  These are used primarily by the Med Due Worksheet and MAR.
"^DD",55,55.01,.03,1,4,"DT")
2930610
"^DD",55,55.01,.03,3)
Enter the stop DATE and TIME for this order.
"^DD",55,55.01,.03,20,0)
^.3LA^1^1
"^DD",55,55.01,.03,20,1,0)
PSJI
"^DD",55,55.01,.03,21,0)
^.001^1^1^3140429^^^^
"^DD",55,55.01,.03,21,1,0)
  This is the date and time the order is to end.
"^DD",55,55.01,.03,"DT")
3140528
"BLD",9500,6)
^267
**END**
**END**

